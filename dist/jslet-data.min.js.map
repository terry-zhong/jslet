{"version":3,"sources":["jslet-data.js"],"names":["root","factory","define","amd","require","exports","module","locale","jQuery","window","jsletlocale","this","undefined","jslet","id","ele","rootUri","ohead","document","getElementsByTagName","uri","lastChild","src","substring","lastIndexOf","global","version","changeStateField","selectStateField","auditLogField","valueSeparator","defaultRecordClass","defaultFocusKeyCode","defaultCharWidth","debugMode","serverErrorHandler","errCode","errMsg","beforeSubmit","settings","afterInstall","container","toArray","iterable","Object","length","results","Array","extend","destination","source","property","emptyFunction","keys","object","hasOwnProperty","push","Function","prototype","update","array","args","arrayLength","merge","slice","call","argumentNames","names","toString","match","replace","split","bind","context","arguments","__method","a","apply","bindAsEventListener","event","curry","delay","timeout","setTimeout","defer","wrap","wrapper","methodize","_methodized","Class","subclass","create","klass","initialize","parent","properties","isFunction","shift","Methods","superclass","subclasses","i","addMethods","constructor","ancestor","IS_DONTENUM_BUGGY","valueOf","isFuncFn","value","method","m","p","_AUTOID","nextId","data","temp","indexOf","cnt","deepClone","String","trim","startsWith","pattern","endsWith","d","debounce","func","wait","immediate","timeoutHander","later","clearTimeout","srcObj","objClone","key","SimpleMap","_keys","_values","get","len","set","k","clear","unset","splice","count","values","formatMessage","msg","Checker","test","required","isString","result","isArray","sKey","arrKeys","formatString","dispFmt","c","next","valueLen","fmtLen","fmtLen1","_SCALEFACTOR","formatNumber","num","preFix","substr","suffix","fmtarr","fmtDecimalLen","strarr","dataDecimalLen","factor","parseInt","Math","round","f","retstr","str","fmt","comma","l","formatDate","date","format","isDate","o","M+","getMonth","d+","getDate","h+","getHours","m+","getMinutes","s+","getSeconds","q+","floor","S","getMilliseconds","RegExp","$1","getFullYear","parseDate","strDate","ch","v","preChar","begin","end","dateParts","y","M","h","s","charAt","isNaN","year","Date","toJSON","convertISODate","dateStr","flag","month","day","hour","minute","second","UTC","_currentPattern","_convertToJsPattern","escapeChar","nextChar","jsPattern","bgn","hasLeft","hasRight","join","like","testValue","between","minValue","maxValue","flagMin","flagMax","compareValue","inlist","valueList","isObject","type","varValue","isEmpty","arrValue","obj","time","delayFunc","value1","value2","caseSensitive","isStr1","isStr2","toLowerCase","localeCompare","getTime","htmlEncode","htmlText","text","html","htmlDecode","getArrayValue","arrValues","index","varName","Error","isBoolean","requiredBooleanValue","requiredStringValue","requiredDateValue","isNumber","isNumeric","requiredNumbericValue","isGTZero","greatThanZero","isGTEZero","greatThanEqualZero","checkMin","checkMax","betweenValue","lessThanMaxValue","requiredArrayValue","requiredObjectValue","isPlanObject","isPlainObject","requiredPlanObjectValue","requiredFunctionValue","isClass","className","instanceOfClass","isDataType","dataType","inArray","arrlist","JSON","normalize","json","isKey","isObj","last","quoteChar","append","parse","e","Common","jsonParseError","stringify","replacer","space","getFunction","funcOrFuncName","console","warn","getRemainingString","wholeStr","cuttingStr","getYear","dateValue","getYearMonth","showError","callBackFn","message","ui","MessageBox","error","alert","showInfo","Info","Clipboard","doc","clipboard","getElementById","appendTo","body","addEventListener","val","clipboardData","setData","preventDefault","putText","select","$","fn","getStyleObject","style","prop","dom","returns","getComputedStyle","camelize","b","toUpperCase","camel","getPropertyValue","currentStyle","css","getCookie","name","start","cookie","unescape","setCookie","expires","path","domain","secure","today","setTime","expires_date","escape","toGMTString","deleteCookie","MessageBus","_messages","SIZECHANGED","_timeoutHandlers","sendMessage","messageName","messageBody","sender","handler","ctrl","ctrls","onReceiveMessage","subscribe","ctrlObj","unsubscribe","messageBus","on","ContextRule","Z","_name","_description","_status","_selected","_condition","_rules","dataStatus","status","item","checker","selected","condition","rules","ContextRuleItem","fldName","_field","_meta","_value","_lookup","_customized","field","meta","ContextRuleMeta","lookup","ContextRuleLookup","customized","customizedFn","_label","_tip","_nullText","_required","_disabled","_readOnly","_visible","_formula","_scale","_defaultValue","_displayFormat","_editMask","_editControl","_range","_regularExpr","_valueCountLimit","_validChars","_customValidator","label","tip","nullText","visible","disabled","readOnly","editMask","mask","scale","formula","displayFormat","editControl","editCtrl","defaultValue","dftValue","range","regularExpr","valueCountLimit","customValidator","validator","validChars","chars","_dataset","_filter","_fixedFilter","_criteria","_displayFields","_onlyLeafLevel","dataset","datasetName","filter","fixedFilter","criteria","displayFields","onlyLeafLevel","createContextRule","cxtRuleCfg","createContextRuleItem","itemCfg","createContextRuleMeta","createContextRuleLookup","metaCfg","lookupCfg","ruleObj","ContextRuleEngine","_matchedRules","_ruleEnv","compile","contextRules","_compileOneRule","evalRule","changingFldName","_evalOneRule","_syncMatchedRules","_compileExpr","_compileRuleItem","ruleItem","props","propName","metaObj","lookupObj","itemObj","isExpr","setting","exprName","Expression","matched","exprObj","conditionExpr","mainFields","hasRule","eval","ruleStatus","dsStatus","changedStatus","DataSetStatus","INSERT","UPDATE","ruleSelected","getFieldValue","_evalRuleItems","isValueChanged","matchedRule","_copyProperties","_evalExpr","srcObject","descObject","propValue","evalObj","fldObj","matchedRules","getField","_syncMatchedRuleMeta","_syncMatchedRuleLookup","_syncMatchedRuleValue","ruleMeta","ruleLookup","fieldLookup","ruleDs","lkDsObj","autoRefreshHostDataset","ruleFilter","filtered","ruleCriteria","query","ruleDisplayFields","ruleOnlyLeafLevel","setValue","dataModule","getDataset","dsName","DatasetType","NORMAL","LOOKUP","DETAIL","onCreatingDataset","dsCatalog","realDsName","hostDatasetName","DataType","NUMBER","STRING","DATE","TIME","BOOLEAN","DATASET","CROSS","PROXY","FieldValueStyle","BETWEEN","MULTIPLE","EditMask","keepChar","transform","clone","DatasetEvent","BEFORESCROLL","AFTERSCROLL","BEFOREINSERT","AFTERINSERT","BEFOREUPDATE","AFTERUPDATE","BEFOREDELETE","AFTERDELETE","BEFORECONFIRM","AFTERCONFIRM","BEFORECANCEL","AFTERCANCEL","BEFORESELECT","AFTERSELECT","BEFORESELECTALL","AFTERSELECTALL","BROWSE","DELETE","RefreshEvent","updateRecordEvent","eventType","UPDATERECORD","fieldName","updateColumnEvent","UPDATECOLUMN","updateAllEvent","_updateAllEvent","changeMetaEvent","metaName","changeAllRows","CHANGEMETA","beforeScrollEvent","recno","scrollEvent","prevRecno","SCROLL","insertEvent","needUpdateAll","updateAll","deleteEvent","selectRecordEvent","SELECTRECORD","selectAllEvent","SELECTALL","changePageEvent","_changePageEvent","errorEvent","errMessage","ERROR","lookupEvent","isMetaChanged","UPDATELOOKUP","aggradedEvent","AGGRADED","UPDATEALL","CHANGEPAGE","FieldValidator","intRegular","expr","floatRegular","checkInputChar","inputChar","existText","cursorPos","valid","getType","checkInputText","inputText","checkRequired","fldType","regular","dateRegular","Dataset","invalidInt","invalidFloat","regExpObj","lastIndex","_addFieldLabel","actual","expected","invalidIntegerPart","invalidDecimalPart","parseFloat","checkValue","fldLabel","fieldValueRequired","fldRange","dataRange","hasLookup","getFieldText","min","strMin","max","strMax","notInRange","moreThanValue","lessThanValue","unique","currDs","dataList","rec","currRec","getRecord","notUnique","serverValidator","url","reqData","ajaxSetting","async","contentType","mimeType","ajax","done","textStatus","jqXHR","errorCode","errorMessage","fail","errorThrown","responseJSON","ConnectError","FieldValueConverter","textToValue","valueToText","isEditing","NumberValueConverter","unitConverted","_unitConvertFactor","rtnText","_unitName","DateValueConverter","invalidDateFieldValue","StringValueConverter","antiXss","BooleanValueConverter","trueText","falseText","LookupValueConverter","valueIndex","lkFldObj","dsLookup","keyFldName","keyField","codeFldName","codeField","nameFldName","nameField","_convertFieldValue","invalidMsg","valueNotFound","setFieldError","first","srcField","srcValues","destFields","_convertDestFields","_innerConvertDestFields","separator","valueCnt","_ignoreFilter","findByField","destValue","_valueConverters","getValueConverter","record2Json","records","excludeFields","record2JsonFilter","getRecInfo","record","recInfo","_jl_","FieldValueCache","put","cacheObj","cache","fldCacheObj","fieldNameOrArray","arrFldNames","j","fldCnt","clearAll","removeCache","removeAllCache","FieldError","errorMsg","errObj","fldErrObj","errMsgObj","putDetailError","errorCount","found","idx","existFieldError","existRecordError","checkingFields","getFirstErrorField","clearFieldError","clearRecordError","clearDatasetError","FieldRawValueAccessor","getRawValue","dataRec","shortName","customValueAccessor","_innerGetValue","trueValue","_innerSetValue","setRawValue","falseValue","getValue","DatasetRelationManager","relations","addRelation","hostDsName","hostFldName","lookupOrDetailDsName","relationType","relation","hostDataset","hostField","lookupDataset","lookupOrDetailDataset","removeRelation","removeDataset","changeDatasetName","oldName","newName","refreshLookupHostDataset","lookupDsName","handleLookupDatasetChanged","getHostFieldObject","datasetRelationManager","emptyPromise","always","displayOrderComparator","fldObj1","fldObj2","order1","displayOrder","order2","DataSelection","_selection","_onChanged","selectAll","fields","fireEvent","removeAll","arrFldObj","getNormalFields","add","recordCount","startRecno","endRecno","_selectCell","remove","tmp","onChanged","isSelected","selObj","_recno_","getSelectionText","surround","encodeSpecialData","seperator","textRec","startSilenceMove","isEof","isStartZero","endSilenceMove","GlobalDataHandler","_datasetMetaChanged","_fieldMetaChanged","_fieldValueChanged","datasetCreated","_datasetCreated","datasetMetaChanged","fieldMetaChanged","fieldValueChanged","globalDataHandler","_recordClass","_dataList","_oriDataList","_fields","_oriFields","_normalFields","_recno","_filteredRecnoArray","_aborted","_proxyFields","_filtered","_innerFilter","_findCondition","_innerFindCondition","_innerFormularFields","_bof","_eof","_igoreEvent","_logChanges","_auditLogEnabled","_modiObject","_inputtingRecord","_lockCount","_fixedIndexFields","_innerFixedIndexFields","_indexFields","_innerIndexFields","_sortingFields","_masterDataset","_masterField","_detailDatasetFields","_linkedControls","_linkedLabels","_silence","_keyField","_codeField","_nameField","_parentField","_levelOrderField","_selectField","_contextRules","_contextRuleEngine","_contextRuleEnabled","_dataProvider","DataProvider","_queryCriteria","_queryUrl","_submitUrl","_pageSize","_pageNo","_pageCount","_ignoreFilterRecno","_fieldValidator","_onFieldChanged","_onFieldFocusing","_isFireGlobalEvent","_onCheckSelectable","_onDataQueried","_onDataSubmitted","_datasetListener","_designMode","_autoShowError","_autoRefreshHostDataset","_aggradedValues","_afterScrollDebounce","_innerAfterScrollDebounce","_calcAggradedValueDebounce","calcAggradedValue","_onlyChangedSubmitted","selection","_changeLog","ChangeLog","_dataTransformer","DataTransformer","_followedValues","_focusedFields","_canFocusFields","_lastFindingValue","_inContextRule","_aggradedFields","_aggradingCount","description","recordClass","clazz","newDsName","fieldNames","parentFldName","levelOrderField","selectFldName","addField","cloneRecord","srcRecord","destRecord","fldValue","newValue","arrFieldObj","_fireMetaChangedEvent","onlyChangedSubmitted","pageSize","pageNo","pageCount","masterDataset","masterField","getMasterFieldObject","designMode","autoShowError","unitConvertFactor","unitName","evt","refreshControl","datasetListener","listener","onCheckSelectable","onDataQueried","onDataSubmitted","fieldValidator","onFieldChanged","onFieldChange","onFieldFocusing","isFireGlobalEvent","getFields","getEditableFields","setVisibleFields","fieldNameArray","_travelField","isBreak","children","_cacheNormalFields","arrFields","calcFocusedFields","addFields","refreshDisplayOrder","refreshAggradedFields","batchMode","addFormulaField","addInnerFormulaField","Field","removeField","dispOrder","addFieldFromDataset","srcDataset","srcFields","sort","moveField","fromFldName","toFldName","fromFldObj","toFldObj","fromParent","toParent","fromIndex","toIndex","oldDesignMode","removeFormulaField","removeInnerFormulaField","aggradedFields","aggraded","arrField","fldName1","cancelTravel","lkf","lkds","dsDetail","detailDataset","getTopField","sortFunc","rec1","rec2","fname","idxFldCfg","dsObj","sortDataset","indexFlds","strFields","useTextToSort","v1","v2","getFieldTextByRecord","getFieldValueByRecord","order","fixedIndexFields","_parseIndexFields","idxFld","fixedIdxFld","_sortByFields","indexFields","indFlds","mergedIndexFields","toggleIndexField","emptyIndexFields","arrFName","hasRecord","_createIndexCfg","isContextRuleEnabled","disableContextRule","disableControls","_refreshInnerRecno","moveToRecord","enableContextRule","enableControls","_combineIndexCfg","childCnt","indexNameObj","_getWholeFilter","oldFilter","newFilter","_doFilterChanged","filterExpr","afiltered","oldFiltered","_filterData","hasData","tempRecno","oldRecno","eventFunc","_fireDatasetEvent","evtType","confirm","_gotoRecno","recnoSilence","recCnt","preno","_initialize","_refreshProxyField","_silenc","calcContextRule","abort","aborted","_moveCursor","recordObj","notLogPos","isBof","prior","firstError","_moveToError","nextError","priorError","lastError","reverse","checkStatusByCancel","cancel","insertChild","parentId","parentFieldNotSet","innerInsert","expanded","findByKey","keyValue","pfldname","parentField","parentParentId","newRec","insertSibling","currPKey","parentKeys","prePKey","lastPKey","parentValue","insertRecord","appendRecord","expandedByRecno","insertedByRecno","inserted","changedStatusByRecno","updatedByRecno","updated","oldStatus","beforeInsertFn","dsMaster","insertMasterFirst","editRecord","preRecno","newRecord","_calcDefaultValue","insertDataset","thisContext","srcContext","appendDataset","batchAppendRecords","replaceExists","fldcnt","valueFollow","fValue","defaultExpr","valueStyle","setFieldValue","checkAggraded","aggrFields","disableAggrading","enableAggrading","getAggradeByValue","aggradedBy","updateAggrByValues","arrAggradeBy","aggrByObj","aggrByValue","arrAggrByValues","exists","existAggrBy","isNum","aggradedValues","notCalcFields","sum","aggradedValueObj","invalidNumberFieldValue","sumValue","pow","getRelativeRecord","delta","isSameAsPrevious","preRec","preValue","currValue","isSame","mergeSameBy","groupFldName","arrFlds","hasParent","pFldName","pKeyValue","prevRec","prePKeyValue","hasChildren","iterateChildren","preKeyValue","rootValue","arrPValues","pValue","isExist","breakIterator","deleteRecord","cannotDelParent","isLast","unlog","log","detailFields","dtlFldObj","deleteSelected","recObj","selectedRecords","_innerValidateData","firstInvalidField","betwwenInvalid","masterDsObj","addFieldError","detailDsHasError","focusEditControl","addDetailFieldError","getRecordErrorInfo","checkAndShowError","existDatasetError","cannotConfirm","focusFirstErrorField","isError","_confirmDetailDataset","hasError","masterFldName","dtlDatasets","dtlFields","_cancelDetailDataset","no","detailDatasets","logChanges","auditLogEnabled","needRefreshCtrl","getFieldError","getFieldErrorByRecno","getFieldValueByRecno","dtlFldName","lookupNotFound","fieldNotFound","_calcFormula","auditLogRec","_logOldEditValue","oldValue","globalHandler","_logNewEditValue","_updateLookupRelativeFields","updateFormula","auditLog","logRec","n","clearFollowedValues","focused","focusedFields","mergedFocusedFields","canFields","lkObj","lkRtnFldMap","returnFieldMap","lkFldName","lkDs","_calcFormulaRelation","formulaFields","evaluator","_innerFormulaRelation","changedFldName","fmlFldName","fmlFields","getFieldTextByRecno","minVal","maxVal","betweenLabel","cacheValue","fixedValue","convert","customValueConverter","setFieldValueLength","valueLength","setFieldText","fType","datasetFieldNotBeSetValue","_textToValue","invalid","find","fromCurrentPosition","foundRecno","fieldNameOrFieldArray","findingValue","findingByText","matchType","matchValue","filteredDataList","byTextArray","byText","returnFieldName","lookupByKey","returnFldName","inChildrenAndSelf","onlyDirectChildren","inChildren","lookupFieldExpected","isDirectChild","copyDataset","underCurrentFilter","selectField","changedField","dataRecord","isSilence","changeProxyFieldName","checkSelectable","selFld","selectedByRecno","onSelectAll","noRefresh","selectByKeyValue","changedRecNum","selectBy","dataProvider","provider","_checkDataProvider","selectedKeyValues","state","queryUrl","criteriaDataset","requery","_doQuerySuccess","info","mainData","main","extraData","extraEntities","_doApplyError","catched","queryUrlRequired","_querying","simpleCriteria","csrfToken","sendRequest","_setChangedState","chgRecs","pendingRecs","_addRecordClassFlag","changeFlag","recClazz","detailRecordClass","pRec","dtlRecClazz","_doSaveSuccess","refreshSubmittedData","submitUrl","hasChangedData","noConfirm","submit","extraInfo","submitUrlRequired","changedRecs","getSubmittingChanged","noDataSubmit","_submitting","_doSubmitSelectedSuccess","deleteOnSuccess","_deleteOnSuccess_","arrRecs","submitSelected","getSubmittingSelected","_refreshInnerControl","updateEvt","focusing","focus","refreshField","refreshLookupField","lookupEvt","addLinkedControl","linkedControl","isLabel","canFocus","removeLinkedControl","arrCtrls","innerExportTextArray","exportOption","csvFlag","exportHeader","onlySelected","includeFields","arrRec","exportFields","dateFields","htmlTagRegarExpr","replaceFn","exportTextArray","exportCsv","textArr","escapeDate","recArr","fldSeperator","exportCsvFile","fileName","createElement","blob","Blob","href","URL","createObjectURL","download","click","showImportDialog","ImportDialog","_importDialog","show","showExportDialog","ExportDialog","_exportDialog","iterate","datalst","isDetailDs","textList","textValue","exportSnapshot","mainDs","changedRecords","_changedRecords","detail","master","details","importSnapshot","snapshot","cannotImportSnapshot","destroy","createEnumDataset","enumStrOrObj","createStringField","EnumDataset","code","recstr","enumStr","recs","createDataset","fieldConfig","dsCfg","setPropValue","setIntPropValue","setBooleanPropValue","fldCfg","createField","chgRecords","_getChangedRecords","masterFldObj","masterRecInfo","detailLog","chgRecList","_convert","submitAllSubData","chgRec","_getStatusPrefix","subList","allList","subChgList","subChgRec","subRecInfo","chgLen","submittedData","_refreshDataset","isDetailDataset","chgLogs","masterRec","_refreshRecord","serverReturnNullRecord","recState","oldRec","_otherDatasetFields","_expr","_parsedExpr","datasetNotFound","mainds","_ParserPattern","otherDs","stag","tmpExpr","exec","otherDatasetFields","inchildren","onlyDirectChild","inchildrenandself","_datasetName","_displayOrder","_tabIndex","_fieldName","_shortName","_dataType","_proxyHostFieldName","_proxyFldObjs","_proxyFieldChanged","_currProxyFieldName","_length","_unique","_defaultExpr","_displayLabel","_message","_displayWidth","_dateFormat","_unitConverted","_displayControl","_detailDataset","_urlExpr","_innerUrlExpr","_urlTarget","_valueStyle","_dataRange","_antiXss","_customValueAccessor","_customValueConverter","_dateChar","_dateRegular","_parent","_children","_trueValue","_falseValue","_trueText","_falseText","_mergeSame","_mergeSameBy","_fixedValue","_valueFollow","_focused","_aggraded","_aggradedBy","_crossSource","_removeRelation","_clearFieldCache","_addRelation","_fireGlobalMetaChangedEvent","displayLabel","fullLabel","labels","pFldObj","_getProxyPropValue","dtype","proxyHostFieldName","proxyFieldChanged","proxyFldName","newProxyFldObj","proxyFldObj","_setProxyPropValue","tabIndex","getEditLength","codeFld","nameFld","alignment","align","_alignment","_fireColumnUpdatedEvent","displayWidth","displayFmt","_dateType","dateFormat","dateSeparator","dateFmt","invalidDate","fieldReadOnly","fieldDisabled","ds","mvalueStyle","displayControl","dispCtrl","lkDsName","_getDatasetName","detailDsObj","FieldLookup","_fireLookupChangedEvent","dsObjOrName","subDataset","dtlDsObj","urlExpr","urlTarget","target","URLTARGETBLANK","calcUrl","isXss","argLen","accessor","converter","mergeSame","crossSource","CrossFieldSource","getTextValue","setTextValue","newDataset","childFlds","_underted","_subDataset","cfg","fieldNameRequired","crossSrc","createCrossFieldSource","detailDs","subdataset","invalidDatasetField","regularMessage","lkfCfg","lkDataset","lookupSource","lookupsource","lookupdataset","lkParam","lookupParam","lookupparam","realDataset","realSource","realsource","realdataset","createFieldLookup","childFldObj","fldChildren","createNumberField","createBooleanField","createDateField","createDatasetField","createCrossField","_hostDatasetName","_hostField","_realDataset","_dsParsed","_codeFormat","_innerdisplayFields","_returnFieldMap","_editFilter","_editItemDisabled","editFilter","editItemDisabled","lkdataset","LookupDatasetNotSameAsHost","codeFormat","fieldExpr","getDefaultDisplayFields","getCurrentDisplayValue","param","_sourceType","_sourceField","_lookupLevel","_labels","_matchExpr","_hideEmptyValue","_hasSubtotal","_subtotalPosition","_subtotalLabel","sourceType","sourceField","lookupLevel","matchExpr","hideEmptyValue","hasSubtotal","subtotalPosition","subtotalLabel","srcType","FilterDataset","and","or","dsOperator","equal","notEqual","greatThan","greatThanAndEqual","lessThan","lessThanAndEqual","likeany","likefirst","likelast","selfchildren0","children0","selfchildren1","children1","_hostDataset","_filterDataset","_varValues","filterDataset","doProxyFieldChanged","hostFldObj","hostLkObj","editorObj","operator","dsFields","fieldLabels","_appendFields","filterFldCfg","lParenthesis","textReadOnly","rParenthesis","logicalOpr","dsFilter","rule1","rule2","firstValue","rule3","oldValueStyle","getFilterExprText","validate","lastRecno","getFilterExpr","_getFieldFilter","hostFldLabel","fldCode","fldDataType","parentName","yearMonth","fldNameStr","funcStr","_getFilterValue","parenthesisCount","valueRequired","parenthesisNotMatched","lkdsField","ApplyAction","QUERY","SAVE","SELECTED","headers","Deferred","reject","resolve","dataOrJqXHR","jqXHRorErrorThrown","promise","XLSXXPorter","importData","fileContent","getHeader","sheet","C","XLSX","utils","decode_range","R","r","cell","encode_cell","hdr","t","format_cell","workbook","read","SheetNames","sheetName","Sheets","header","roa","sheet_to_row_object_array","exportData","convertToXLSXFormat","worksheet","row","col","cell_ref","convertToUnitArray","workBook","buf","ArrayBuffer","view","Uint8Array","charCodeAt","lastRow","lastCol","workSheet","startCell","endCell","encode_range","ws_name","wb","xlsxOpt","bookType","bookSST","wbout","write","saveAs","XPorter","_excelXPorter","excelXPorter","xporter","defaultXPorter"],"mappings":"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","file":"jslet-data.min.js","sourcesContent":["/*!\r\n * Jslet JavaScript framework v4.0.0\r\n * https://github.com/jslet/jslet/\r\n *\r\n * Copyright 2016 Jslet Group and other contributors\r\n * Released under the MIT license\r\n */\r\n/* jshint ignore:start */\r\n\"use strict\";\r\n(function (root, factory) {\r\n    if (typeof define === 'function') {\r\n    \tif(define.amd) {\r\n\t        define('jslet-data', ['jslet-locale', 'jquery'], factory);\r\n\t    } else {\r\n\t    \tdefine(function(require, exports, module) {\r\n\t    \t\tvar locale = require('jslet-locale');\r\n\t    \t\tvar jQuery = require('jquery');\r\n\t    \t\tmodule.exports = factory(locale, jQuery);\r\n\t    \t});\r\n\t    }\r\n    } else {\r\n    \tfactory(window.jsletlocale, window.jQuery);\r\n    \tdelete window.jsletlocale;\r\n    }\r\n})(this, function (locale, jQuery) {\r\n/* jshint ignore:end */\r\n\tif (window.jslet === undefined || jslet === undefined){\r\n\t\t/**\r\n\t\t * Root object/function of jslet framework. Example:\r\n\t\t * <pre><code>\r\n\t\t * var jsletObj = jslet('#tab');\r\n\t\t * </code></pre>\r\n\t\t * @param {String} Html tag id, like '#id'\r\n\t\t * \r\n\t\t * @return {Object} jslet object of the specified Html tag\r\n\t\t */\r\n\t    window.jslet = function(id){\r\n\t        var ele = jQuery(id)[0];\r\n\t        return (ele && ele.jslet) ? ele.jslet : null;\r\n\t    };\r\n\t}\r\n\r\n\tjslet.locale = locale;\r\n\n/*!\r\n * Jslet Javascript Framework v4.0.0\r\n * https://github.com/jslet/jslet/\r\n *\r\n * Copyright 2016 Jslet Team and other contributors\r\n * Released under the MIT license\r\n */\r\n\r\nif (window.jslet === undefined || jslet === undefined){\r\n\t/**\r\n\t * Root object/function of jslet framework. Example:\r\n\t * <pre><code>\r\n\t * var jsletObj = jslet('#tab');\r\n\t * </code></pre>\r\n\t * @param {String} Html tag id, like '#id'\r\n\t * \r\n\t * @return {Object} jslet object of the specified Html tag\r\n\t */\r\n    window.jslet = function(id){\r\n        var ele = jQuery(id)[0];\r\n        return (ele && ele.jslet) ? ele.jslet : null;\r\n    };\r\n}\r\n\r\nif (!jslet.rootUri) {\r\n    var ohead = window.document.getElementsByTagName('head')[0], \r\n        uri = ohead.lastChild.src;\r\n    if(uri) {\r\n\t    uri = uri.substring(0, uri.lastIndexOf('/') + 1);\r\n\t    jslet.rootUri = uri;\r\n    }\r\n}\r\njslet.global = {\r\n\tversion: '3.0.0',\r\n\t\r\n\t//Used in jslet.data.Dataset_applyChanges\r\n\tchangeStateField: 'rs',\r\n\t\r\n\t//Used in jslet.data.Dataset_selected\r\n\tselectStateField: '_sel_',\r\n\t\r\n\tauditLogField: 'al',\r\n\t\r\n\t//Value separator\r\n\tvalueSeparator: ',',\r\n\t\r\n\tdefaultRecordClass: null,\r\n\t\r\n\tdefaultFocusKeyCode: 9,\r\n\t\r\n\tdefaultCharWidth: 12,\r\n\t\r\n\tdebugMode: true\r\n};\r\n\r\n/**\r\n * Global server error handler\r\n * \r\n * @param {String} errCode, error code\r\n * @param {String} errMsg,  error message\r\n * \r\n * @return {Boolean} Identify if handler catch this error, if catched, the rest handler will not process it.\r\n */\r\njslet.global.serverErrorHandler = function(errCode, errMsg) {\r\n\treturn false;\r\n};\r\n\r\n/**\r\n * Global event handler for jQuery.ajax, you can set settings here.\r\n * \r\n * @param {Plan Object} settings jQuery.ajax settings.\r\n * \r\n * @return {Plan Object} jQuery.ajax settings, @see http://api.jquery.com/jQuery.ajax/.\r\n * \t\t\tAttension: \r\n * \t\t\tthe following attributes can not be set: type, contentType, mimeType, dataType, data, context.\r\n */\r\njslet.global.beforeSubmit = function(settings) {\r\n\treturn settings;\r\n};\r\n\r\njslet.global.afterInstall = function(container) {};\r\n\n/*!\r\n * Jslet Javascript Framework v4.0.0\r\n * https://github.com/jslet/jslet/\r\n *\r\n * Copyright 2016 Jslet Team and other contributors\r\n * Released under the MIT license\r\n */\r\n\r\n/* jshint ignore:start */\r\n/**\r\n * the below code from prototype.js(http://prototypejs.org/) \r\n */\r\njslet.toArray = function(iterable) {\r\n\tif (!iterable) {\r\n\t\treturn [];\r\n\t}\r\n\tif ('toArray' in Object(iterable)) {\r\n\t\treturn iterable.toArray();\r\n\t}\r\n\tvar length = iterable.length || 0, results = new Array(length);\r\n\twhile (length--) {\r\n\t\tresults[length] = iterable[length];\r\n\t}\r\n\treturn results;\r\n};\r\n\r\njslet.extend = function(destination, source) {\r\n\tfor ( var property in source) {\r\n\t\tdestination[property] = source[property];\r\n\t}\r\n\treturn destination;\r\n};\r\n\r\njslet.emptyFunction = function() {\r\n};\r\n\r\njslet.keys = function(object) {\r\n\tvar results = [];\r\n\tif ((typeof object) != 'object') {\r\n\t\treturn results;\r\n\t}\r\n\tfor (var property in object) {\r\n\t\tif (object.hasOwnProperty(property)) {\r\n\t\t\tresults.push(property);\r\n\t\t}\r\n\t}\r\n\treturn results;\r\n};\r\n\r\njslet.extend(Function.prototype,\r\n\t\t(function() {\r\n\t\t\tvar slice = Array.prototype.slice;\r\n\r\n\t\t\tfunction update(array, args) {\r\n\t\t\t\tvar arrayLength = array.length, length = args.length;\r\n\t\t\t\twhile (length--) {\r\n\t\t\t\t\tarray[arrayLength + length] = args[length];\r\n\t\t\t\t}\r\n\t\t\t\treturn array;\r\n\t\t\t}\r\n\r\n\t\t\tfunction merge(array, args) {\r\n\t\t\t\tarray = slice.call(array, 0);\r\n\t\t\t\treturn update(array, args);\r\n\t\t\t}\r\n\r\n\t\t\tfunction argumentNames() {\r\n\t\t\t\tvar names = this.toString().match(\r\n\t\t\t\t\t\t/^[\\s\\(]*function[^(]*\\(([^)]*)\\)/)[1].replace(\r\n\t\t\t\t\t\t/\\/\\/.*?[\\r\\n]|\\/\\*(?:.|[\\r\\n])*?\\*\\//g, '').replace(\r\n\t\t\t\t\t\t/\\s+/g, '').split(',');\r\n\t\t\t\treturn names.length == 1 && !names[0] ? [] : names;\r\n\t\t\t}\r\n\r\n\t\t\tfunction bind(context) {\r\n\t\t\t\tif (arguments.length < 2 && (typeof arguments[0] === 'undefined')) {\r\n\t\t\t\t\treturn this;\r\n\t\t\t\t}\r\n\t\t\t\tvar __method = this, args = slice.call(arguments, 1);\r\n\t\t\t\treturn function() {\r\n\t\t\t\t\tvar a = merge(args, arguments);\r\n\t\t\t\t\treturn __method.apply(context, a);\r\n\t\t\t\t};\r\n\t\t\t}\r\n\r\n\t\t\tfunction bindAsEventListener(context) {\r\n\t\t\t\tvar __method = this, args = slice.call(arguments, 1);\r\n\t\t\t\treturn function(event) {\r\n\t\t\t\t\tvar a = update( [ event || window.event ], args);\r\n\t\t\t\t\treturn __method.apply(context, a);\r\n\t\t\t\t};\r\n\t\t\t}\r\n\r\n\t\t\tfunction curry() {\r\n\t\t\t\tif (!arguments.length) {\r\n\t\t\t\t\treturn this;\r\n\t\t\t\t}\r\n\t\t\t\tvar __method = this, args = slice.call(arguments, 0);\r\n\t\t\t\treturn function() {\r\n\t\t\t\t\tvar a = merge(args, arguments);\r\n\t\t\t\t\treturn __method.apply(this, a);\r\n\t\t\t\t};\r\n\t\t\t}\r\n\r\n\t\t\tfunction delay(timeout) {\r\n\t\t\t\tvar __method = this, args = slice.call(arguments, 1);\r\n\t\t\t\ttimeout = timeout * 1000;\r\n\t\t\t\treturn window.setTimeout(function() {\r\n\t\t\t\t\treturn __method.apply(__method, args);\r\n\t\t\t\t}, timeout);\r\n\t\t\t}\r\n\r\n\t\t\tfunction defer() {\r\n\t\t\t\tvar args = update( [ 0.01 ], arguments);\r\n\t\t\t\treturn this.delay.apply(this, args);\r\n\t\t\t}\r\n\r\n\t\t\tfunction wrap(wrapper) {\r\n\t\t\t\tvar __method = this;\r\n\t\t\t\treturn function() {\r\n\t\t\t\t\tvar a = update( [ __method.bind(this) ], arguments);\r\n\t\t\t\t\treturn wrapper.apply(this, a);\r\n\t\t\t\t};\r\n\t\t\t}\r\n\r\n\t\t\tfunction methodize() {\r\n\t\t\t\tif (this._methodized) {\r\n\t\t\t\t\treturn this._methodized;\r\n\t\t\t\t}\r\n\t\t\t\tvar __method = this;\r\n\t\t\t\tthis._methodized = function() {\r\n\t\t\t\t\tvar a = update( [ this ], arguments);\r\n\t\t\t\t\treturn __method.apply(null, a);\r\n\t\t\t\t};\r\n\t\t\t\treturn this._methodized;\r\n\t\t\t}\r\n\r\n\t\t\treturn {\r\n\t\t\t\targumentNames : argumentNames,\r\n\t\t\t\tbind : bind,\r\n\t\t\t\tbindAsEventListener : bindAsEventListener,\r\n\t\t\t\tcurry : curry,\r\n\t\t\t\tdelay : delay,\r\n\t\t\t\tdefer : defer,\r\n\t\t\t\twrap : wrap,\r\n\t\t\t\tmethodize : methodize\r\n\t\t\t};\r\n\t\t})());\r\n\r\n/* Based on Alex Arnell's inheritance implementation. */\r\njslet.Class = (function() {\r\n\r\n\tvar IS_DONTENUM_BUGGY = (function() {\r\n\t\tfor ( var p in {\r\n\t\t\ttoString : 1\r\n\t\t}) {\r\n\t\t\tif (p === 'toString') {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn true;\r\n\t})();\r\n\r\n\tfunction subclass() {\r\n\t}\r\n\t\r\n\tfunction create() {\r\n\t\tvar parent = null, properties = jslet.toArray(arguments);\r\n\t\tif (jQuery.isFunction(properties[0])) {\r\n\t\t\tparent = properties.shift();\r\n\t\t}\r\n\t\tfunction klass() {\r\n\t\t\tthis.initialize.apply(this, arguments);\r\n\t\t}\r\n\r\n\t\tjslet.extend(klass, jslet.Class.Methods);\r\n\t\tklass.superclass = parent;\r\n\t\tklass.subclasses = [];\r\n\r\n\t\tif (parent) {\r\n\t\t\tsubclass.prototype = parent.prototype;\r\n\t\t\tklass.prototype = new subclass();\r\n\t\t\tparent.subclasses.push(klass);\r\n\t\t}\r\n\r\n\t\tfor ( var i = 0, length = properties.length; i < length; i++) {\r\n\t\t\tklass.addMethods(properties[i]);\r\n\t\t}\r\n\t\tif (!klass.prototype.initialize) {\r\n\t\t\tklass.prototype.initialize = jslet.emptyFunction;\r\n\t\t}\r\n\t\tklass.prototype.constructor = klass;\r\n\t\treturn klass;\r\n\t}\r\n\r\n\tfunction addMethods(source) {\r\n\t\tvar ancestor = this.superclass && this.superclass.prototype, properties = jslet\r\n\t\t\t\t.keys(source);\r\n\r\n\t\tif (IS_DONTENUM_BUGGY) {\r\n\t\t\tif (source.toString != Object.prototype.toString) {\r\n\t\t\t\tproperties.push('toString');\r\n\t\t\t}\r\n\t\t\tif (source.valueOf != Object.prototype.valueOf) {\r\n\t\t\t\tproperties.push('valueOf');\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tvar isFuncFn = window.jQuery.isFunction;\r\n\t\tfor ( var i = 0, length = properties.length; i < length; i++) {\r\n\t\t\tvar property = properties[i], value = source[property];\r\n\t\t\tif (ancestor && isFuncFn(value) && value.argumentNames()[0] == '$super') {\r\n\t\t\t\tvar method = value;\r\n\t\t\t\tvalue = (function(m) {\r\n\t\t\t\t\treturn function() {\r\n\t\t\t\t\t\treturn ancestor[m].apply(this, arguments);\r\n\t\t\t\t\t};\r\n\t\t\t\t})(property).wrap(method);\r\n\r\n\t\t\t\tvalue.valueOf = method.valueOf.bind(method);\r\n\t\t\t\tvalue.toString = method.toString.bind(method);\r\n\t\t\t}\r\n\t\t\tthis.prototype[property] = value;\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\treturn {\r\n\t\tcreate : create,\r\n\t\tMethods : {\r\n\t\t\taddMethods : addMethods\r\n\t\t}\r\n\t};\r\n})();\r\n/* end Prototype code */\r\n/* jshint ignore:start */\n/*!\r\n * Jslet Javascript Framework v4.0.0\r\n * https://github.com/jslet/jslet/\r\n *\r\n * Copyright 2016 Jslet Team and other contributors\r\n * Released under the MIT license\r\n */\r\n\r\n\"use strict\";\r\njslet._AUTOID = 0;\r\njslet.nextId = function(){\r\n\treturn 'jslet' + (jslet._AUTOID++);\r\n};\r\n\r\n/**\r\n * Namespace\r\n */\r\nif(!jslet.data) {\r\n\tjslet.data = {};\r\n}\r\n\r\nif(!jslet.locale) {\r\n\tjslet.locale={};\r\n}\r\nif(!jslet.temp) {\r\n\tjslet.temp = {};\r\n}\r\n\r\n//if (!jslet.rootUri) {\r\n//    var ohead = document.getElementsByTagName('head')[0], uri = ohead.lastChild.src;\r\n//    uri = uri.substring(0, uri\r\n//\t\t\t\t\t.lastIndexOf('/')\r\n//\t\t\t\t\t+ 1);\r\n//    jslet.rootUri = uri\r\n//}\r\n\r\n/**\r\n * Javascript language enhancement\r\n */\r\nif(!Array.indexOf){\r\n\tArray.prototype.indexOf = function(value){\r\n\t\tfor(var i = 0, cnt = this.length; i < cnt; i++){\r\n\t\t\tif(this[i] == value)\r\n\t\t\t\treturn i;\r\n\t\t}\r\n\t\treturn -1;\r\n\t};\r\n}\r\n\r\nif(!Object.deepClone){\r\n\t\r\n\t/**\r\n\t * Deep clone object.\r\n\t * <pre><code>\r\n     *     var obj = {attr1: 'aaa', attr2: 123, attr3: {y1: 12, y2:'test'}};\r\n     *  var objClone = obj.deepClone();\r\n     * </code></pre>\r\n     * \r\n     */\r\n\t/*\r\n    Object.prototype.deepClone = function(){\r\n        var objClone;\r\n        if (this.constructor == Object){\r\n            objClone = new this.constructor(); \r\n        }else{\r\n            objClone = new this.constructor(this.valueOf()); \r\n        }\r\n        for(var key in this){\r\n            if ( objClone[key] != this[key] ){ \r\n                if ( typeof(this[key]) == 'object' ){ \r\n                    objClone[key] = this[key].deepClone();\r\n                }else{\r\n                    objClone[key] = this[key];\r\n                }\r\n            }\r\n        }\r\n        objClone.toString = this.toString;\r\n        objClone.valueOf = this.valueOf;\r\n        return objClone; \r\n    } */\r\n}\r\n\r\nif(!String.prototype.trim){\r\n\tString.prototype.trim = function(){\r\n\t\tthis.replace(/^\\s+/, '').replace(/\\s+$/, '');\r\n\t}\t;\r\n}\r\n\r\nif(!String.prototype.startsWith){\r\n\tString.prototype.startsWith = function(pattern) {\r\n\t\treturn this.lastIndexOf(pattern, 0) === 0;\r\n\t};\r\n}\r\n\r\nif(!String.prototype.endsWith){\r\n\t//From Prototype.js\r\n\tString.prototype.endsWith = function(pattern){\r\n        var d = this.length - pattern.length;\r\n        return d >= 0 && this.indexOf(pattern, d) === d;\r\n\t};\r\n}\r\n\r\n\r\njslet.debounce = function(func, wait, immediate) {\r\n\tvar timeoutHander;\r\n\treturn function() {\r\n\t\tvar context = this, args = arguments;\r\n\t\tif(!wait) {\r\n\t\t\tfunc.apply(context, args);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar later = function() {\r\n\t\t\ttimeoutHander = null;\r\n\t\t\tfunc.apply(context, args);\r\n\t\t};\r\n\t\tif(timeoutHander) {\r\n\t\t\tclearTimeout(timeoutHander);\r\n\t\t}\r\n\t\ttimeoutHander = setTimeout(later, wait);\r\n\t};\r\n};\r\n\r\n/*\r\n * Javascript language enhancement(end)\r\n */\r\n\r\njslet.deepClone = function(srcObj){\r\n    var objClone;\r\n    if (srcObj.constructor == Object){\r\n        objClone = new srcObj.constructor(); \r\n    } else {\r\n        objClone = new srcObj.constructor(srcObj.valueOf()); \r\n    }\r\n    for(var key in srcObj){\r\n        if ( objClone[key] != srcObj[key] ){ \r\n            if ( typeof(srcObj[key]) == 'object' ){ \r\n                objClone[key] = srcObj[key].deepClone();\r\n            } else {\r\n                objClone[key] = srcObj[key];\r\n            }\r\n        }\r\n    }\r\n    objClone.toString = srcObj.toString;\r\n    objClone.valueOf = srcObj.valueOf;\r\n    return objClone; \r\n};\r\n                                        \r\n/**\r\n * A simple map for Key/Value data. Example:\r\n * <pre><code>\r\n * var map = new jslet.SimpleMap();\r\n * map.set('background', 'red');\r\n * var color = map.get('background');//return 'red'\r\n * </code></pre>\r\n */\r\njslet.SimpleMap = function () {\r\n    var _keys = [], _values = [];\r\n    this.get = function (key) {\r\n        var len = _keys.length;\r\n        for (var i = 0; i < len; i++) {\r\n            if (key == _keys[i]) {\r\n                return _values[i];\r\n            }\r\n        }\r\n        return null;\r\n    };\r\n\r\n    this.set = function (key, value) {\r\n        var k = _keys.indexOf(key);\r\n        if(k >=0){\r\n            _values[k] = value;\r\n        } else {\r\n            _keys.push(key);\r\n            _values.push(value);\r\n        }\r\n    };\r\n\r\n    this.clear = function () {\r\n        _keys.length = 0;\r\n        _values.length = 0;\r\n    };\r\n\r\n    this.unset = function (key) {\r\n        var len = _keys.length;\r\n        for (var i = 0; i < len; i++) {\r\n            if (_keys[i] == key) {\r\n                _keys.splice(i, 1);\r\n                _values.splice(i, 1);\r\n                return;\r\n            }\r\n        }\r\n    };\r\n\r\n    this.count = function () {\r\n        return _keys.length;\r\n    };\r\n\r\n    this.keys = function () {\r\n        return _keys;\r\n    };\r\n    \r\n    this.values = function() {\r\n    \treturn _values;\r\n    };\r\n};\r\n\r\n/**\r\n * format message with argument. Example:\r\n * <pre><code>\r\n * var msg = jslet.formatMessage('Your name is:{0}', 'Bob');//return: your name is: Bob\r\n * var msg = jslet.formatMessage('They are:{0} and {1}', ['Jerry','Mark']);\r\n * </code></pre>\r\n * \r\n * @param {String} Initial message, placeholder of argument is {n}, n is number \r\n * @param {String/Array of String} args arguments\r\n * @return formatted message\r\n */\r\njslet.formatMessage = function (msg, args) {\r\n\tjslet.Checker.test('jslet.formatMessage#msg', msg).required().isString();\r\n    if(args === undefined || args === null) {\r\n    \treturn msg; \r\n    }\r\n    if(args === false) {\r\n    \targs = 'false';\r\n    }\r\n    if(args === true) {\r\n    \targs = 'true';\r\n    }\r\n    var result = msg, cnt, i;\r\n    if (jslet.isArray(args)) {// array\r\n        cnt = args.length;\r\n        for (i = 0; i < cnt; i++) {\r\n            result = result.replace('{' + i + '}', args[i]);\r\n        }\r\n    } else if(args.keys){// Hash\r\n        var arrKeys = args.keys(), sKey;\r\n        cnt = arrKeys.length;\r\n        for (i = 0; i < cnt; i++) {\r\n            sKey = arrKeys[i];\r\n            result = result.replace('{' + sKey + '}', args.get(sKey));\r\n        }\r\n    } else {\r\n    \treturn msg.replace('{0}', args);\r\n    }\r\n    return result;\r\n};\r\n\r\njslet.formatString = function (value, dispFmt) {\r\n\tif(!dispFmt || !value) {\r\n\t\treturn value;\r\n\t}\r\n\tvar valueLen = value.length,\r\n\t\tfmtLen = dispFmt.length,\r\n\t\tfmtLen1 = fmtLen - 1,\r\n\t\tc, k = -1, result = '', next;\r\n\tfor(var i = 0; i < fmtLen; i++) {\r\n\t\tc = dispFmt[i];\r\n\t\tif(c === '\\\\' && i < fmtLen1) {\r\n\t\t\tnext = dispFmt[i+1];\r\n\t\t\tif(next === '#') {\r\n\t\t\t\tresult += '#';\r\n\t\t\t\ti++;\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(c === '#') {\r\n\t\t\tk++;\r\n\t\t\tif(k === valueLen) {\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tresult += value[k];\r\n\t\t} else {\r\n\t\t\tresult += c;\r\n\t\t}\r\n\t}\r\n\treturn result;\r\n};\r\n\r\n/**\r\n * private constant value\r\n */\r\njslet._SCALEFACTOR = '100000000000000000000000000000000000';\r\n\r\n/**\r\n * Format a number. Example:\r\n * <pre><code>\r\n * var strNum = formatNumber(12345.999,'#,##0.00'); //return '12,346.00'\r\n * var strNum = formatNumber(12345.999,'#,##0.##'); //return '12,346'\r\n * var strNum = formatNumber(123,'000000'); //return '000123'\r\n * </code></pre>\r\n * \r\n * \r\n * @param {Number} num number that need format \r\n * @param {String} pattern pattern for number, like '#,##0.00'\r\n *  # - not required\r\n *  0 - required, if the corresponding digit of the number is empty, fill in with '0'\r\n *  . - decimal point\r\n *\r\n * @return {String}\r\n */\r\njslet.formatNumber = function(num, pattern) {\r\n\tif (!pattern) {\r\n\t\treturn num + '';\r\n\t}\r\n\tif(!num && num !== 0) {\r\n\t\treturn '';\r\n\t}\r\n\tvar preFix = '', c, i;\r\n\tfor (i = 0; i < pattern.length; i++) {\r\n\t\tc = pattern.substr(i, 1);\r\n\t\tif (c == '#' || c == '0' || c == ',') {\r\n\t\t\tif (i > 0) {\r\n\t\t\t\tpreFix = pattern.substr(0, i);\r\n\t\t\t\tpattern = pattern.substr(i);\r\n\t\t\t}\r\n\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\r\n\tvar suffix = '';\r\n\tfor (i = pattern.length - 1; i >= 0; i--) {\r\n\t\tc = pattern.substr(i, 1);\r\n\t\tif (c == '#' || c == '0' || c == ',') {\r\n\t\t\tif (i > 0) {\r\n\t\t\t\tsuffix = pattern.substr(i + 1);\r\n\t\t\t\tpattern = pattern.substr(0, i + 1);\r\n\t\t\t}\r\n\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\r\n\tvar fmtarr = pattern ? pattern.split('.') : [''],fmtDecimalLen = 0;\r\n\tif (fmtarr.length > 1) {\r\n\t\tfmtDecimalLen = fmtarr[1].length;\r\n\t}\r\n\tvar strarr = num ? num.toString().split('.') : ['0'],dataDecimalLen = 0;\r\n\tif (strarr.length > 1) {\r\n\t\tdataDecimalLen = strarr[1].length;\r\n\t}\r\n\tif (dataDecimalLen > fmtDecimalLen) {\r\n\t\tvar factor = parseInt(jslet._SCALEFACTOR.substring(0, fmtDecimalLen + 1));\r\n\t\tnum = Math.round(num * factor) / factor;\r\n\t\tstrarr = num ? num.toString().split('.') : ['0'];\r\n\t}\r\n\tvar retstr = '',\r\n\tstr = strarr[0],\r\n\tfmt = fmtarr[0],\r\n\tcomma = false,\r\n\tk = str.length - 1,\r\n\tf;\r\n\tfor (f = fmt.length - 1; f >= 0; f--) {\r\n\t\tswitch (fmt.substr(f, 1)) {\r\n\t\t\tcase '#' :\r\n\t\t\t\tif (k >= 0) {\r\n\t\t\t\t\tretstr = str.substr(k--, 1) + retstr;\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase '0' :\r\n\t\t\t\tif (k >= 0) {\r\n\t\t\t\t\tretstr = str.substr(k--, 1) + retstr;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tretstr = '0' + retstr;\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase ',' :\r\n\t\t\t\tcomma = true;\r\n\t\t\t\tretstr = ',' + retstr;\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\tif (k >= 0) {\r\n\t\tif (comma) {\r\n\t\t\tvar l = str.length;\r\n\t\t\tfor (; k >= 0; k--) {\r\n\t\t\t\tretstr = str.substr(k, 1) + retstr;\r\n\t\t\t\tif (k > 0 && ((l - k) % 3) === 0) {\r\n\t\t\t\t\tretstr = ',' + retstr;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tretstr = str.substr(0, k + 1) + retstr;\r\n\t\t}\r\n\t}\r\n\r\n\tretstr = retstr + '.';\r\n\r\n\tstr = strarr.length > 1 ? strarr[1] : '';\r\n\tfmt = fmtarr.length > 1 ? fmtarr[1] : '';\r\n\tk = 0;\r\n\tfor (f = 0; f < fmt.length; f++) {\r\n\t\tswitch (fmt.substr(f, 1)) {\r\n\t\t\tcase '#' :\r\n\t\t\t\tif (k < str.length) {\r\n\t\t\t\t\tretstr += str.substr(k++, 1);\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase '0' :\r\n\t\t\t\tif (k < str.length) {\r\n\t\t\t\t\tretstr += str.substr(k++, 1);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tretstr += '0';\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\treturn preFix + retstr.replace(/^,+/, '').replace(/\\.$/, '') + suffix;\r\n};\r\n\r\n/**\r\n * Format date with specified format. Example:\r\n * <pre><code>\r\n * var date = new Date();\r\n * console.log(jslet.formatDate(date, 'yyyy-MM-dd'));//2012-12-21\r\n * </code></pre>\r\n * \r\n * @param {Date} date value.\r\n * @param {String} date format.\r\n * @return {String} String date after format\r\n */\r\njslet.formatDate = function(date, format) {\r\n\tif(!date) {\r\n\t\treturn '';\r\n\t}\r\n\tjslet.Checker.test('jslet.formatDate#date', date).isDate();\r\n\tjslet.Checker.test('jslet.formatDate#format', format).required().isString();\r\n\tvar o = {\r\n\t\t'M+' : date.getMonth() + 1, // month\r\n\t\t'd+' : date.getDate(), // day\r\n\t\t'h+' : date.getHours(), // hour\r\n\t\t'm+' : date.getMinutes(), // minute\r\n\t\t's+' : date.getSeconds(), // second\r\n\t\t'q+' : Math.floor((date.getMonth() + 3) / 3), // quarter\r\n\t\t'S' : date.getMilliseconds()\r\n\t\t// millisecond\r\n\t};\r\n\tif (/(y+)/.test(format)) {\r\n\t\tformat = format.replace(RegExp.$1, \r\n\t\t\t\t(date.getFullYear() + '').substr(4 - RegExp.$1.length));\r\n\t}\r\n\tfor (var k in o) {\r\n\t\tif (new RegExp('(' + k + ')').test(format)) {\r\n\t\t\tformat = format.replace(RegExp.$1, \r\n\t\t\t\tRegExp.$1.length == 1 ? o[k] : ('00' + o[k]).substr(('' + o[k]).length));\r\n\t\t}\r\n\t}\r\n\treturn format;\r\n};\r\n\r\n/**\r\n * Parse a string to Date object. Example\r\n * <pre><code>\r\n * var date = jslet.parseDate('2013-03-25', 'yyyy-MM-dd');\r\n * var date = jslet.parseDate('2013-03-25 15:20:18', 'yyyy-MM-dd hh:mm:ss');\r\n * \r\n * </code></pre>\r\n * \r\n * @param {String} strDate String date\r\n * @param {String} format Date format, like: 'yyyy-MM-dd hh:mm:ss'\r\n * @return Date Object\r\n */\r\njslet.parseDate = function(strDate, format) {\r\n\tif(!strDate) {\r\n\t\treturn null;\r\n\t}\r\n\tjslet.Checker.test('jslet.parseDate#strDate', strDate).isString();\r\n\tjslet.Checker.test('jslet.parseDate#format', format).required().isString();\r\n\t\r\n\tvar preChar = null, ch, v, \r\n\t\tbegin = -1, \r\n\t\tend = 0;\r\n\tvar dateParts = {'y': 0, 'M': 0,'d': 0, 'h': 0,\t'm': 0, 's': 0, 'S': 0};\r\n\t\r\n\tfor(var i = 0, len = format.length; i < len; i++) {\r\n\t\tch = format.charAt(i);\r\n\t\r\n\t\tif(ch != preChar) {\r\n\t\t\tif(preChar && dateParts[preChar] !== undefined && begin >= 0) {\r\n\t\t\t\tend = i;\r\n\t\t\t\tv = parseInt(strDate.substring(begin, end));\r\n\t\t\t\tdateParts[preChar] = isNaN(v)?0:v;\r\n\t\t\t}\r\n\t\t\tbegin = i;\r\n\t\t\tpreChar = ch;\r\n\t\t}\r\n\t}\r\n\tif(begin >= 0) {\r\n\t\tv = parseInt(strDate.substring(begin));\r\n\t\tdateParts[ch] = isNaN(v)?0:v;\r\n\t}\r\n\tvar year = dateParts.y;\r\n\tif(year < 100) {\r\n\t\tyear += 2000;\r\n\t}\r\n\tvar result = new Date(year, dateParts.M - 1, dateParts.d, dateParts.h, dateParts.m, dateParts.s, dateParts.S);\r\n\treturn result;\r\n};\r\n\r\n/**\r\n * Convert Date to SO8601\r\n */\r\nDate.prototype.toJSON = function() {\r\n\treturn jslet.formatDate(this, 'yyyy-MM-ddThh:mm:ss');\r\n};\r\n\r\n/**\r\n * Convert string(ISO date format) to date\r\n * \r\n * @param {String} dateStr date string with ISO date format. Example: 2012-12-21T09:30:24Z\r\n * @return {Date} \r\n */\r\njslet.convertISODate= function(dateStr) {\r\n\tif(!dateStr) {\r\n\t\treturn null;\r\n\t}\r\n\tif(jslet.isDate(dateStr)) {\r\n\t\treturn dateStr;\r\n\t}\r\n\tvar flag = dateStr.substr(10,1);\r\n\tif(dateStr.length === 10 || 'T' == flag) {\r\n\t\tvar year = dateStr.substr(0,4),\r\n\t\tmonth = dateStr.substr(5,2),\r\n\t\tday = dateStr.substr(8,2),\r\n\t\thour = dateStr.substr(11,2),\r\n\t\tminute = dateStr.substr(14,2),\r\n\t\tsecond = dateStr.substr(17,2);\r\n\t\tif('Z' == dateStr.substr(-1,1)) {\r\n\t\t\treturn new Date(Date.UTC(+year, +month - 1, +day, +hour,\r\n\t\t\t\t\t+minute, +second));\r\n\t\t}\r\n\t\treturn new Date(+year, +month - 1, +day, +hour,\r\n\t\t\t\t+minute, +second);\r\n\t}\r\n    return dateStr;\r\n};\r\n\r\n/**\r\n * private variable for convertToJsPattern,don't use it in your program\r\n */\r\njslet._currentPattern = {};\r\n\r\n/**\r\n * private variable for convertToJsPattern,don't use it in your program\r\n * Convert sql pattern to javascript pattern\r\n * \r\n * @param {String} pattern sql pattern\r\n * @param {String} escapeChar default is '\\'\r\n * @return {String} js regular pattern\r\n */\r\njslet._convertToJsPattern = function(pattern, escapeChar) {\r\n\tif (jslet._currentPattern.pattern == pattern && \r\n\t\t\tjslet._currentPattern.escapeChar == escapeChar) {\r\n\t\treturn jslet._currentPattern.result;\r\n\t}\r\n\tjslet._currentPattern.pattern = pattern;\r\n\tjslet._currentPattern.escapeChar = escapeChar;\r\n\r\n\tvar jsPattern = [],\r\n\t\tlen = pattern.length - 1,\r\n\t\tc, \r\n\t\tnextChar,\r\n\t\tbgn = 0, \r\n\t\tend = len,\r\n\t\thasLeft = false,\r\n\t\thasRight = false;\r\n\tif (pattern.charAt(0) == '%'){\r\n       bgn = 1;\r\n       hasLeft = true;\r\n    }\r\n    if (pattern.charAt(len) == '%'){\r\n       end = len - 1;\r\n       hasRight = true;\r\n    }\r\n    if (hasLeft && hasRight){\r\n       jsPattern.push('.*');\r\n    }\r\n    else if (hasRight){\r\n       jsPattern.push('^');\r\n    }\r\n\tfor (var i = bgn; i <= end; i++) {\r\n\t\tc = pattern.charAt(i);\r\n\t\tif (c == '\\\\' && i < len) {\r\n\t\t\tnextChar = pattern.charAt(i + 1);\r\n\t\t\tif (nextChar == '%' || nextChar == '_') {\r\n\t\t\t\tjsPattern.push(nextChar);\r\n\t\t\t\ti++;\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t} else if (c == '_') {\r\n\t\t\tjsPattern.push('.');\r\n\t\t} else {\r\n\t\t\tif (c == '.' || c == '*' || c == '[' || c == ']' || \r\n\t\t\t\t\tc == '{' || c == '}' || c == '+' || c == '(' || \r\n\t\t\t\t\tc == ')' || c == '\\\\' || c == '?' || c == '$' || c == '^')\r\n\t\t\t\tjsPattern.push('\\\\');\r\n\t\t\tjsPattern.push(c);\r\n\t\t}\r\n\t}// end for\r\n\tif (hasLeft && hasRight || hasRight){\r\n       jsPattern.push('.*');\r\n    } else if (hasLeft){\r\n       jsPattern.push('$');\r\n    }\r\n\r\n    jslet._currentPattern.result = new RegExp(jsPattern.join(''), 'ig');\r\n\treturn jslet._currentPattern.result;\r\n};\r\n\r\n/**\r\n *  Test if  the value to match pattern or not,for example:\r\n *  like('abc','%b%') -> true, like('abc','%b') -> false \r\n *  \r\n *  @param {String} testValue need to test value\r\n *  @param {String} pattern sql pattern, syntax like SQL\r\n *  @return {Boolean} True if matched, false otherwise\r\n */\r\njslet.like = function(testValue, pattern, escapeChar) {\r\n\tif (!testValue || !pattern) {\r\n\t\treturn false;\r\n\t}\r\n\tif (pattern.length === 0) {\r\n\t\treturn false;\r\n\t}\r\n\tif (!escapeChar) {\r\n\t\tescapeChar = '\\\\';\r\n\t}\r\n\tvar jsPattern = jslet._convertToJsPattern(pattern, escapeChar);\r\n\tif(!jslet.isString(testValue)) {\r\n\t\ttestValue += '';\r\n\t}\r\n\treturn testValue.match(jsPattern) !== null;\r\n};\r\n\r\n/**\r\n * Between function, all parameters' type must be same. Example:\r\n * <pre><code>\r\n * return between(4,2,5) //true\r\n * return between('c','a','b') // false\r\n * </code></pre>\r\n * \r\n * @param {Object} testValue test value\r\n * @param {Object} minValue minimum value\r\n * @param {Object} maxValue maximum value\r\n * @return {Boolean} True if matched, false otherwise\r\n */\r\njslet.between = function(testValue, minValue, maxValue) {\r\n\tif (arguments.length <= 1) {\r\n\t\treturn false;\r\n\t}\r\n\tvar flagMin = true,\r\n\t\tflagMax = true;\r\n\tif(minValue !== null && minValue !== undefined) { \r\n\t\tflagMin = (jslet.compareValue(testValue, minValue) >= 0);\r\n\t}\r\n\tif(maxValue !== null && maxValue !== undefined) { \r\n\t\tflagMax = (jslet.compareValue(testValue, maxValue) <= 0);\r\n\t}\r\n\treturn flagMin && flagMax;\r\n};\r\n\r\n/**\r\n * Test if the value is in the following list. Example:\r\n * <pre><code>\r\n * return inlist('a','c','d','e') // false\r\n * \r\n * </code></pre>\r\n * @param {Object} testValue test value\r\n * @param {Object} valueList - one or more arguments\r\n * @return {Boolean} True if matched, false otherwise\r\n */\r\njslet.inlist = function(testValue, valueList) {\r\n\tvar cnt = arguments.length;\r\n\tif (cnt < 2) {\r\n\t\treturn false;\r\n\t}\r\n\tfor (var i = 1; i < cnt; i++) {\r\n\t\tif (jslet.compareValue(testValue, arguments[i]) === 0) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t}\r\n\treturn false;\r\n};\r\n\r\n/**\r\n * Test if the given value is an array.\r\n * \r\n * @param {Object} testValue test value\r\n * @return {Boolean} True if the given value is an array, false otherwise\r\n */\r\njslet.isArray = function (testValue) {\r\n    return testValue === null || testValue === undefined || Object.prototype.toString.apply(testValue) === '[object Array]';\r\n};\r\n\r\n/**\r\n * Test if the given value is date object.\r\n * \r\n * @param {Object} testValue test value\r\n * @return {Boolean} True if the given value is date object, false otherwise\r\n */\r\njslet.isDate = function(testValue) {\r\n\treturn testValue === null || testValue === undefined || testValue.constructor == Date;\r\n};\r\n\r\n/**\r\n * Test if the given value is a string object.\r\n * \r\n * @param {Object} testValue test value\r\n * @return {Boolean} True if the given value is String object, false otherwise\r\n */\r\njslet.isString = function(testValue) {\r\n\treturn testValue === null || testValue === undefined || typeof testValue == 'string';\r\n};\r\n\r\njslet.isObject = function(testValue) {\r\n\treturn testValue === null || testValue === undefined || jQuery.type(this.varValue) !== \"object\";\t\r\n};\r\n\r\njslet.isEmpty = function(value) {\r\n\tif(value === null || value === undefined || value === '') {\r\n\t\treturn true;\r\n\t}\r\n\tif(jslet.isArray(value)) {\r\n\t\tvar arrValue = value;\r\n\t\tvar isEmpty = true;\r\n\t\tfor(var i = 0, len = arrValue.length; i < len; i++) {\r\n\t\t\tif(!jslet.isEmpty(arrValue[i])) {\r\n\t\t\t\tisEmpty = false;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn isEmpty;\r\n\t}\r\n\treturn false;\r\n};\r\n\r\njslet.setTimeout = function(obj, func, time) {\r\n    jslet.delayFunc = function () {\r\n        func.call(obj);\r\n    };\r\n    setTimeout(jslet.delayFunc, time);\r\n};\r\n\r\n/**\r\n * Compare two values.\r\n * \r\n *  @param {Object} value1 - value1\r\n *  @param {Object} value2 - value2\r\n *  @param {Boolean} ignoreCase - identify ignoring case sensitive or not if values are string value \r\n *  \r\n *  @return {Integer} 0 - value1 = value2, -1 - value1 < value2, 1 - value1 > value2\r\n */\r\njslet.compareValue = function(value1, value2, caseSensitive) {\r\n\tvalue1 = (value1 === undefined? null: value1);\r\n\tvalue2 = (value2 === undefined? null: value2);\r\n\tif(value1 === value2) {\r\n\t\treturn 0;\r\n\t}\r\n\tif(value1 === null && value2 !== null) {\r\n\t\treturn -1;\r\n\t}\r\n\tif(value2 === null && value1 !== null) {\r\n\t\treturn 1;\r\n\t}\r\n\tvar isStr1 = jslet.isString(value1),\r\n\t\tisStr2 = jslet.isString(value2);\r\n\tif(!isStr1 && !isStr2) {\r\n\t\tif(jslet.isDate(value1)) {\r\n\t\t\tvalue1 = value1.getTime();\r\n\t\t\tvalue2 = value2.getTime();\r\n\t\t}\r\n\t\treturn value1 == value2? 0: (value1 < value2? -1: 1);\r\n\t}\r\n\t//compare string value\r\n\tif(!isStr1) {\r\n\t\tvalue1 = value1 + '';\r\n\t}\r\n\tif(!isStr2) {\r\n\t\tvalue2 = value2 + '';\r\n\t}\r\n\tif(!caseSensitive) {\r\n\t\tvalue1 = value1.toLowerCase();\r\n\t\tvalue2 = value2.toLowerCase();\r\n\t}\r\n\treturn value1.localeCompare(value2);\r\n};\r\n\r\n/**\r\n * Encode html string. Example:\r\n * <pre><code>\r\n * return jslet.htmlEncode('<div />') // 'lt;div /gt;'\r\n * </code></pre>\r\n * \r\n * @param {String} htmlText html text\r\n * @return {String}\r\n */\r\njslet.htmlEncode = function(htmlText){\r\n    if (htmlText) {\r\n        return jQuery('<div />').text(htmlText).html();\r\n    } else {\r\n        return '';\r\n    }\r\n};\r\n\r\n/**\r\n * Decode html string. Example:\r\n * <pre><code>\r\n * return jslet.htmlDecode('lt;div /gt;') // '<div />'\r\n * </code></pre>\r\n * \r\n * @param {String} htmlText encoded html text\r\n * @return {String}\r\n */\r\njslet.htmlDecode = function(htmlText) {\r\n    if (htmlText) {\r\n        return jQuery('<div />').html(htmlText).text();\r\n    } else {\r\n        return '';\r\n    }\r\n};\r\n\r\n/**\r\n * Get a array item safely. Example:\r\n * <pre><code>\r\n * var arrValues = ['a','b'];\r\n * jslet.getArrayValue(arrValues, 1); // return 'b'\r\n * jslet.getArrayValue(arrValues, 3); // return null\r\n * </code></pre>\r\n * \r\n * @param {Array of Object} arrValues  a array of values\r\n * @param {Integer} index index of wanted to get item\r\n * @return {Object}\r\n */\r\njslet.getArrayValue = function(arrValues, index) {\r\n\tif(!arrValues) {\r\n\t\treturn null;\r\n\t}\r\n\t\t\r\n    if(jslet.isArray(arrValues)){\r\n        var len = arrValues.length;\r\n        if(index < len) {\r\n            return arrValues[index];\r\n        } else {\r\n            return null;\r\n        }\r\n    } else {\r\n        if(index === 0) {\r\n            return arrValues;\r\n        } else {\r\n            return null;\r\n        }\r\n    }\r\n};\r\n\r\njslet.Checker = {\r\n\tvarName: null,\r\n\tvarValue: null,\r\n\t\r\n\ttest: function(varName, varValue) {\r\n\t\tthis.varName = varName;\r\n\t\tthis.varValue = varValue;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\ttestValue: function(varValue) {\r\n\t\tthis.varValue = varValue;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\trequired: function() {\r\n\t\tif(this.varValue === null || this.varValue === undefined || this.varValue === '') {\r\n\t\t\t//[{0}] is Required!\r\n\t\t\tthrow new Error(jslet.formatMessage(jslet.locale.Checker.required, [this.varName]));\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\tisBoolean: function() {\r\n\t\tif(this.varValue !== null && \r\n\t\t   this.varValue !== undefined &&\r\n\t\t   this.varValue !== '' &&\r\n\t\t   this.varValue !== 0 && \r\n\t\t   this.varValue !== true && \r\n\t\t   this.varValue !== false) {\r\n\t\t\t//[{0}] must be a Boolean value!\r\n\t\t\tthrow new Error(jslet.formatMessage(jslet.locale.Checker.requiredBooleanValue, [this.varName]));\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\tisString: function() {\r\n\t\tif(this.varValue !== null && \r\n\t\t\tthis.varValue !== undefined &&\r\n\t\t\tthis.varValue !== false &&\r\n\t\t\t!jslet.isString(this.varValue)) {\r\n\t\t\t//[{0}: {1}] must be a String value!\r\n\t\t\tthrow new Error(jslet.formatMessage(jslet.locale.Checker.requiredStringValue, [this.varName, this.varValue]));\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\tisDate: function() {\r\n\t\tif(this.varValue !== null && \r\n\t\t\tthis.varValue !== undefined &&\r\n\t\t\tthis.varValue !== false &&\r\n\t\t\t!jslet.isDate(this.varValue)) {\r\n\t\t\t//[{0}: {1}] must be a Date value!\r\n\t\t\tthrow new Error(jslet.formatMessage(jslet.locale.Checker.requiredDateValue, [this.varName, this.varValue]));\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\tisNumber: function() {\r\n\t\tif(this.varValue !== null && \r\n\t\t\tthis.varValue !== undefined && \r\n\t\t\tthis.varValue !== false &&\r\n\t\t\t!jQuery.isNumeric(this.varValue)) {\r\n\t\t\t//[{0}: {1}] must be a Numberic value!\r\n\t\t\tthrow new Error(jslet.formatMessage(jslet.locale.Checker.requiredNumbericValue, [this.varName, this.varValue]));\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\tisGTZero: function() {\r\n\t\tthis.isNumber();\r\n\t\tif(this.varValue <= 0) {\r\n\t\t\t//[{0}: {1}] must be great than zero!\r\n\t\t\tthrow new Error(jslet.formatMessage(jslet.locale.Checker.greatThanZero, [this.varName, this.varValue]));\r\n\t\t}\r\n\t},\r\n\t\r\n\tisGTEZero: function() {\r\n\t\tthis.isNumber();\r\n\t\tif(this.varValue < 0) {\r\n\t\t\t//[{0}: {1}] must be great than or equal zero!\r\n\t\t\tthrow new Error(jslet.formatMessage(jslet.locale.Checker.greatThanEqualZero, [this.varName, this.varValue]));\r\n\t\t}\r\n\t},\r\n\t\r\n\tbetween: function(minValue, maxValue) {\r\n\t\tvar checkMin = minValue !== null && minValue !== undefined;\r\n\t\tvar checkMax = maxValue !== null && maxValue !== undefined;\r\n\t\tif(checkMin && checkMax && (this.varValue < minValue || this.varValue > maxValue)) {\r\n\t\t\t//[{0} : {1}] must be between [{2}] and [{3}]!\r\n\t\t\tthrow new Error(jslet.formatMessage(jslet.locale.Checker.betweenValue, [this.varName, this.varValue, minValue, maxValue]));\r\n\t\t}\r\n\t\tif(!checkMin && checkMax && this.varValue > maxValue) {\r\n\t\t\t//[{0} : {1}] must be less than [{2}]!\r\n\t\t\tthrow new Error(jslet.formatMessage(jslet.locale.Checker.lessThanMaxValue, [this.varName, this.varValue, maxValue]));\r\n\t\t}\r\n\t\tif(checkMin && !checkMax && this.varValue < minValue) {\r\n\t\t\t//[{0} : {1}] must be great than [{2}]!\r\n\t\t\tthrow new Error(jslet.formatMessage(jslet.locale.Checker.betweenValue, [this.varName, this.varValue, minValue]));\r\n\t\t}\r\n\t},\r\n\t\r\n\tisArray: function() {\r\n\t\tif(this.varValue !== null && \r\n\t\t\tthis.varValue !== undefined &&\r\n\t\t\tthis.varValue !== false &&\r\n\t\t\t!jslet.isArray(this.varValue)) {\r\n\t\t\t//[{0}: {1}] must be an Array!\r\n\t\t\tthrow new Error(jslet.formatMessage(jslet.locale.Checker.requiredArrayValue, [this.varName, this.varValue]));\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\tisObject: function() {\r\n\t\tif(this.varValue !== null && \r\n\t\t\tthis.varValue !== undefined &&\r\n\t\t\tthis.varValue !== false &&\r\n\t\t\tjQuery.type(this.varValue) !== \"object\") {\r\n\t\t\t//[{0}: {1}] must be an Object!\r\n\t\t\tthrow new Error(jslet.formatMessage(jslet.locale.Checker.requiredObjectValue, [this.varName, this.varValue]));\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\tisPlanObject: function() {\r\n\t\tif(this.varValue !== null && \r\n\t\t\t\tthis.varValue !== undefined &&\r\n\t\t\t\tthis.varValue !== false &&\r\n\t\t\t\t!jQuery.isPlainObject(this.varValue)) {\r\n\t\t\t//[{0}: {1}] must be a plan Object!\r\n\t\t\tthrow new Error(jslet.formatMessage(jslet.locale.Checker.requiredPlanObjectValue, [this.varName, this.varValue]));\r\n\t\t}\r\n\t\treturn this;\r\n\t\t\t\t\r\n\t},\r\n\t\r\n\tisFunction: function() {\r\n\t\tif(this.varValue !== null && \r\n\t\t\tthis.varValue !== undefined &&\r\n\t\t\tthis.varValue !== false &&\r\n\t\t\t!jQuery.isFunction(this.varValue)) {\r\n\t\t\t//[{0}: {1}] must be a Function!\r\n\t\t\tthrow new Error(jslet.formatMessage(jslet.locale.Checker.requiredFunctionValue, [this.varName, this.varValue]));\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\tisClass: function(className) {\r\n\t\tthis.isObject();\r\n\t\tif(this.varValue !== null && \r\n\t\t\tthis.varValue !== undefined &&\r\n\t\t\tthis.varValue !== false &&\r\n\t\t\tthis.varValue.className != className) {\r\n\t\t\t//[{0}: {1}] must be instance of [{2}]!\r\n\t\t\tthrow new Error(jslet.formatMessage(jslet.locale.Checker.instanceOfClass, [this.varName, this.varValue, className]));\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\tisDataType: function(dataType) {\r\n\t\tif(dataType == 'S') {\r\n\t\t\tthis.isString();\r\n\t\t}\r\n\t\tif(dataType == 'N') {\r\n\t\t\tthis.isNumber();\r\n\t\t}\r\n\t\tif(dataType == 'D') {\r\n\t\t\tthis.isDate();\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\tinArray: function(arrlist) {\r\n\t\tif(this.varValue !== null && \r\n\t\t\tthis.varValue !== undefined &&\r\n\t\t\tthis.varValue !== false &&\r\n\t\t\tarrlist.indexOf(this.varValue) < 0) {\r\n\t\t\t//[{0}: {1}] must be one of [{2}]!\r\n\t\t\tthrow new Error(jslet.formatMessage(jslet.locale.Checker.inArray, [this.varName, this.varValue, arrlist.join(',')]));\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n\r\n};\r\n\r\njslet.JSON = {\r\n\tnormalize: function (json) {\r\n\t\t//json = jQuery.trim(json);\r\n\t\tvar result = [], c, next, isKey = false, isArray = false, isObj = true, last = '', quoteChar = null, append = false;\r\n\t\tc = json.charAt(0);\r\n\t\tif(c != '{' && c != '[') {\r\n\t\t\tresult.push('{\"');\r\n\t\t\tappend = true;\r\n\t\t}\t\t\r\n\t\tfor(var i = 0, len = json.length; i< len; i++) {\r\n\t\t\tc = json.charAt(i);\r\n\t\t\t\r\n\t\t\tif(quoteChar) {//Not process any char in a String value. \r\n\t\t\t\tif(c == quoteChar) {\r\n\t\t\t\t\tquoteChar = null;\r\n\t\t\t\t\tresult.push('\"');\r\n\t\t\t\t\tlast = '\"';\r\n\t\t\t\t} else {\r\n\t\t\t\t\tresult.push(c);\r\n\t\t\t\t}\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tif(c == '[') {\r\n\t\t\t\tisArray = true;\r\n\t\t\t\tisObj = false;\r\n\t\t\t}\r\n\t\t\tif(c == ']' || c == '{') {\r\n\t\t\t\tisArray = false;\r\n\t\t\t\tisObj = true;\r\n\t\t\t}\r\n\t\t\tif(isKey && (c == ' ' || c == '\\b')) {//Trim blank char in a key.\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tif(isObj && (c == '{' || c == ',')) {\r\n\t\t\t\tisKey = true;\r\n\t\t\t\tresult.push(c);\r\n\t\t\t\tlast = c;\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tif(last == '{' || last == ',') {\r\n\t\t\t\tresult.push('\"');\r\n\t\t\t}\r\n\t\t\tif(isKey && c == \"'\") {\r\n\t\t\t\tresult.push('\"');\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tif(c == ':') {\r\n\t\t\t\tisKey = false;\r\n\t\t\t\tif(last != '\"') {\r\n\t\t\t\t\tresult.push('\"');\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif(!isKey) {\r\n\t\t\t\tif(c == \"'\" || c == '\"') {\r\n\t\t\t\t\tquoteChar = c;\r\n\t\t\t\t\tresult.push('\"');\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tlast = c;\r\n\t\t\tresult.push(c);\r\n\t\t}\r\n\t\tif(append) {\r\n\t\t\tresult.push('}');\r\n\t\t}\r\n\t\treturn result.join('');\r\n\t},\r\n\t\r\n\tparse: function(json) {\r\n\t\ttry {\r\n//\t\t\treturn JSON.parse(this.normalize(json));//has bug\r\n\t\t\treturn JSON.parse(json);\r\n\t\t} catch(e) {\r\n\t\t\tthrow new Error(jslet.formatMessage(jslet.locale.Common.jsonParseError, [json]));\r\n\t\t}\r\n\t},\r\n\t\r\n\tstringify: function(value, replacer, space) {\r\n\t\treturn JSON.stringify(value, replacer, space);\r\n\t}\r\n\r\n};\r\n\r\n/**\r\n * Get specified function with function object or function name.\r\n * \r\n * @param {String or function} funcOrFuncName If its value is function name, find this function in window context.\r\n * @param {Object} context the context which looking for function in.\r\n * @return {function}\r\n */\r\njslet.getFunction = function(funcOrFuncName, context) {\r\n\tif(!funcOrFuncName) {\r\n\t\treturn null;\r\n\t}\r\n\tif(jQuery.isFunction(funcOrFuncName)) {\r\n\t\treturn funcOrFuncName;\r\n\t}\r\n\tif(!context) {\r\n\t\tcontext = window;\r\n\t}\r\n\t\r\n\tvar result = context[funcOrFuncName];\r\n\tif(!result) {\r\n\t\tconsole.warn('NOT found function:' + funcOrFuncName);\r\n\t}\r\n\treturn result;\r\n};\r\n\r\njslet.getRemainingString = function(wholeStr, cuttingStr) {\r\n\tif(!wholeStr || !cuttingStr) {\r\n\t\treturn wholeStr;\r\n\t}\r\n\treturn wholeStr.replace(cuttingStr, '');\r\n};\r\n\r\njslet.getYear = function(dateValue) {\r\n\tif(!dateValue || !jslet.isDate(dateValue)) {\r\n\t\treturn 0;\r\n\t}\r\n\treturn dateValue.getFullYear();\r\n};\r\n\r\njslet.getMonth = function(dateValue) {\r\n\tif(!dateValue || !jslet.isDate(dateValue)) {\r\n\t\treturn 0;\r\n\t}\r\n\treturn dateValue.getMonth() + 1;\r\n};\r\n\r\njslet.getYearMonth = function(dateValue) {\r\n\tif(!dateValue || !jslet.isDate(dateValue)) {\r\n\t\treturn 0;\r\n\t}\r\n\treturn dateValue.getFullYear() * 100 + dateValue.getMonth() + 1;\r\n};\r\n\r\n/**\r\n* Show error message.\r\n*  \r\n* @param {Error object or String} e - error object or error message\r\n* @param {Function} callBackFn - call back function, pattern:\r\n* \tfunction() {\r\n* \t\r\n* \t}\r\n* @param {Integer} timeout - timeout for close this dialog. \r\n*/\r\njslet.showError = function (e, callBackFn, timeout) {\r\n\tvar msg;\r\n\tif (typeof (e) == 'string') {\r\n\t\tmsg = e;\r\n\t} else {\r\n\t\tmsg = e.message;\r\n\t}\r\n\tif (jslet.ui && jslet.ui.MessageBox) {\r\n\t\tjslet.ui.MessageBox.error(msg, null, callBackFn);\r\n\t} else {\r\n\t\twindow.alert(msg);\r\n\t}\r\n};\r\n\r\n/**\r\n* Show Info message.\r\n* \r\n* @param {Error object or String} e - error object or error message\r\n* @param {Function} callBackFn - call back function, pattern:\r\n* \tfunction() {\r\n* \t\r\n* \t}\r\n* @param {Integer} timeout - timeout for close this dialog. \r\n*/\r\njslet.showInfo = function (e, callBackFn, timeout) {\r\n\tvar msg;\r\n\tif (typeof (e) == 'string') {\r\n\t\tmsg = e;\r\n\t} else {\r\n\t\tmsg = e.message;\r\n\t}\r\n\tif (jslet.ui && jslet.ui.MessageBox) {\r\n\t\tjslet.ui.MessageBox.alert(msg, jslet.locale.MessageBox.Info, callBackFn, timeout);\r\n\t} else {\r\n\t\twindow.alert(msg);\r\n\t}\r\n};\r\n\r\njslet.Clipboard = function() {\r\n\tvar doc = window.document;\r\n\tvar clipboard = doc.getElementById('jsletClipboard');\r\n\tif(!clipboard) {\r\n\t\tjQuery('<textarea id=\"jsletClipboard\" style=\"position:absolute;top:-1000px\" tabindex=\"-1\"></textarea>').appendTo(doc.body);\r\n\t\r\n\t    window.addEventListener('copy', function (event) {\r\n\t        var text = jQuery('#jsletClipboard').val();\r\n\t        if(text) {\r\n\t\t        if(event.clipboardData) {\r\n\t\t        \tevent.clipboardData.setData('text/plain', text);\r\n\t\t        } else {\r\n\t\t        \twindow.clipboardData.setData('text', text);\r\n\t\t        }\r\n\t\t        jQuery('#jsletClipboard').val(null);\r\n\t\t        event.preventDefault();\r\n\t\t        return false;\r\n\t        }\r\n\t    });\r\n\t}\r\n};\r\n\r\njslet.Clipboard.putText = function(text) {\r\n\tvar clipboard = jQuery('#jsletClipboard').val(text);\r\n\tclipboard[0].select();\r\n};\r\n\r\njslet.Clipboard();\r\n\r\n\r\n/*\r\n * getStyleObject Plugin for jQuery JavaScript Library\r\n * From: http://upshots.org/?p=112\r\n *\r\n * Copyright: Unknown, see source link\r\n * Plugin version by Dakota Schneider (http://hackthetruth.org)\r\n */\r\n\r\n(function($){\r\n    $.fn.getStyleObject = function(){\r\n        var dom = this.get(0);\r\n        var style, prop;\r\n        var returns = {};\r\n        if(window.getComputedStyle){\r\n            var camelize = function(a,b){\r\n                return b.toUpperCase();\r\n            };\r\n            style = window.getComputedStyle(dom, null);\r\n            for(var i=0;i<style.length;i++){\r\n                prop = style[i];\r\n                var camel = prop.replace(/\\-([a-z])/g, camelize);\r\n                var val = style.getPropertyValue(prop);\r\n                returns[camel] = val;\r\n            }\r\n            return returns;\r\n        }\r\n        if(dom.currentStyle){\r\n            style = dom.currentStyle;\r\n            for(prop in style){\r\n                returns[prop] = style[prop];\r\n            }\r\n            return returns;\r\n        }\r\n        return this.css();\r\n    };\r\n})(jQuery);\r\n\n/*!\r\n * Jslet Javascript Framework v4.0.0\r\n * https://github.com/jslet/jslet/\r\n *\r\n * Copyright 2016 Jslet Team and other contributors\r\n * Released under the MIT license\r\n */\r\n\r\n/**\r\n * Cookie Utils\r\n */\r\n\"use strict\";\r\nif(!jslet.getCookie){\r\n\t/**\r\n\t * Get cookie value with cookie name. Example:\r\n\t * <pre><code>\r\n\t * console.log(jslet.getCookie('name'));\r\n\t * </code></pre>\r\n\t * \r\n\t * @param {String} name Cookie name\r\n\t * @return {String} Cookie value\r\n\t */\r\n\tjslet.getCookie = function(name) {\r\n\t\tvar start = document.cookie.indexOf(name + '=');\r\n\t\tvar len = start + name.length + 1;\r\n\t\tif ((!start) && (name != document.cookie.substring(0, name.length))) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\tif (start == -1){\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\tvar end = document.cookie.indexOf(';', len);\r\n\t\tif (end == -1){\r\n\t\t\tend = document.cookie.length;\r\n\t\t}\r\n\t\treturn window.unescape(document.cookie.substring(len, end));\r\n\t};\r\n}\r\n\r\nif (!jslet.setCookie){\r\n\t/**\r\n\t * Set cookie. Example:\r\n\t * <pre><code>\r\n\t * jslet.setCookie('name', 'value', 1, '/', '.foo.com', true);\r\n\t * </code></pre>\r\n\t * \r\n\t * @param {String} name Cookie name\r\n\t * @param {String} value Cookie value\r\n\t * @param {String} expires Cookie expires(day)\r\n\t * @param {String} path Cookie path\r\n\t * @param {String} domain Cookie domain\r\n\t * @param {Boolean} secure Cookie secure flag\r\n\t * \r\n\t */\r\n\tjslet.setCookie = function(name, value, expires, path, domain, secure) {\r\n\t\tvar today = new Date();\r\n\t\ttoday.setTime(today.getTime());\r\n\t\tif (expires) {\r\n\t\t\texpires = expires * 1000 * 60 * 60 * 24;\r\n\t\t}\r\n\t\tvar expires_date = new Date(today.getTime() + (expires));\r\n\t\tdocument.cookie = name + '=' + window.escape(value) +\r\n\t\t\t((expires) ? ';expires=' + expires_date.toGMTString() : '') + //expires.toGMTString()\r\n\t\t\t((path) ? ';path=' + path : '') +\r\n\t\t\t((domain) ? ';domain=' + domain : '') +\r\n\t\t\t((secure) ? ';secure' : '');\r\n\t};\r\n}\r\nif (!jslet.deleteCookie){\r\n\t/**\r\n\t * Delete specified cookie. Example:\r\n\t * <pre><code>\r\n\t * jslet.deleteCookie('name', '/', '.foo.com');\r\n\t * </code></pre>\r\n\t * \r\n\t * @param {String} name Cookie name\r\n\t * @param {String} name Cookie path\r\n\t * @param {String} name Cookie domain\r\n\t * \r\n\t */\r\n\tjslet.deleteCookie = function(name, path, domain) {\r\n\t\tif (jslet.getCookie(name)) document.cookie = name + '=' +\r\n\t\t\t((path) ? ';path=' + path : '') +\r\n\t\t\t((domain) ? ';domain=' + domain : '') +\r\n\t\t\t';expires=Thu, 01-Jan-1970 00:00:01 GMT';\r\n\t};\r\n}\n/*!\r\n * Jslet Javascript Framework v4.0.0\r\n * https://github.com/jslet/jslet/\r\n *\r\n * Copyright 2016 Jslet Team and other contributors\r\n * Released under the MIT license\r\n */\r\n\r\n/**\r\n* Message bus. Example:\r\n* <pre><code>\r\n*\tvar myCtrlObj = {\r\n*\t\tonReceiveMessage: function(messageName, messageBody){\r\n*\t\t\talert(messageBody.x);\r\n*\t\t}\r\n*\t}\r\n* \r\n*   //Subcribe a message from MessageBus\r\n*   jslet.messageBus.subcribe('MyMessage', myCtrlObj);\r\n*   \r\n*   //Unsubcribe a message from MessageBus\r\n*\tjslet.messageBus.unsubcribe('MyMessage', myCtrlObj);\r\n*\t\r\n*\t//Send a mesasge to MessageBus\r\n*\tjslet.messageBus.sendMessage('MyMessage', {x: 10, y:10});\r\n* \r\n* </code></pre>\r\n* \r\n*/\r\n\"use strict\";\r\njslet.MessageBus = function () {\r\n\tvar _messages = {};\r\n\t//SizeChanged is predefined message\r\n\t_messages[jslet.MessageBus.SIZECHANGED] = [];\r\n\t\r\n\tvar _timeoutHandlers = [];\r\n\t/**\r\n\t * Send a message.\r\n\t * \r\n\t * @param {String} messageName Message name.\r\n\t * @param {Object} mesageBody Message body.\r\n\t */\r\n\tthis.sendMessage = function (messageName, messageBody, sender) {\r\n\t\tif(!_messages[messageName]) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar handler = _timeoutHandlers[messageName];\r\n\t\t\r\n\t\tif (handler){\r\n\t\t\twindow.clearTimeout(handler);\r\n\t\t}\r\n\t\thandler = setTimeout(function(){\r\n\t\t\t_timeoutHandlers[messageName] = null;\r\n\t\t\tvar ctrls = _messages[messageName], ctrl;\r\n\t\t\tfor(var i = 0, cnt = ctrls.length; i < cnt; i++){\r\n\t\t\t\tctrl = ctrls[i];\r\n\t\t\t\tif (ctrl && ctrl.onReceiveMessage){\r\n\t\t\t\t\tctrl.onReceiveMessage(messageName, messageBody);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}, 30);\r\n\t\t_timeoutHandlers[messageName] = handler;\r\n\t};\r\n\r\n\t/**\r\n\t* Subscribe a message.\r\n\t* \r\n\t* @param {String} messageName message name.\r\n\t* @param {Object} ctrlObj control object which need subscribe a message, \r\n\t*   there must be a function: onReceiveMessage in ctrlObj.\r\n\t*\tonReceiveMessage: function(messageName, messageBody){}\r\n\t*   //messageName: String, message name;\r\n\t*   //messageBody: Object, message body;\r\n\t*/\r\n\tthis.subscribe = function(messageName, ctrlObj){\r\n\t\tif (!messageName || !ctrlObj) {\r\n\t\t\tthrow new Error(\"MessageName and ctrlObj required!\");\r\n\t\t}\r\n\t\tvar ctrls = _messages[messageName];\r\n\t\tif (!ctrls){\r\n\t\t\tctrls = [];\r\n\t\t\t_messages[messageName] = ctrls;\r\n\t\t}\r\n\t\tctrls.push(ctrlObj);\r\n\t};\r\n\t\r\n\t/**\r\n\t * Subscribe a message.\r\n\t * \r\n\t * @param {String} messageName message name.\r\n\t * @param {Object} ctrlObj control object which need subscribe a message.\r\n\t */\r\n\tthis.unsubscribe = function(messageName, ctrlObj){\r\n\t\tvar ctrls = _messages[messageName];\r\n\t\tif (!ctrls) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar k = ctrls.indexOf(ctrlObj);\r\n\t\tif (k >= 0) {\r\n\t\t\tctrls.splice(k,1);\r\n\t\t}\r\n\t};\r\n};\r\n\r\njslet.MessageBus.SIZECHANGED = \"SIZECHANGED\";\r\n\r\njslet.messageBus = new jslet.MessageBus();\r\n\r\njQuery(window).on(\"resize\",function(){\r\n\tjslet.messageBus.sendMessage(jslet.MessageBus.SIZECHANGED, null, window);\r\n});\r\n\n/*!\r\n * Jslet Javascript Framework v4.0.0\r\n * https://github.com/jslet/jslet/\r\n *\r\n * Copyright 2016 Jslet Team and other contributors\r\n * Released under the MIT license\r\n */\r\n\r\n \"use strict\";\r\njslet.data.ContextRule = function() {\r\n\tvar Z = this;\r\n\tZ._name = '';\r\n\tZ._description = '';\r\n\tZ._status = undefined;\r\n\tZ._selected = undefined;\r\n\tZ._condition = undefined;\r\n\tZ._rules = [];\r\n};\r\n\r\njslet.data.ContextRule.className = 'jslet.data.ContextRule';\r\n\r\njslet.data.ContextRule.prototype = {\r\n\tclassName: jslet.data.ContextRule.className,\r\n\t\r\n\tdataStatus: ['insert','update','other'],\r\n\t\r\n\tname: function(name) {\r\n\t\tif(name === undefined) {\r\n\t\t\treturn this._name;\r\n\t\t}\r\n\t\t\r\n\t\tjslet.Checker.test('ContextRule.name', name).isString();\r\n\t\tthis._name = jQuery.trim(name);\r\n\t\treturn this;\r\n\t},\r\n\r\n\tstatus: function(status) {\r\n\t\tif(status === undefined) {\r\n\t\t\treturn this._status;\r\n\t\t}\r\n\t\t\r\n\t\tjslet.Checker.test('ContextRule.status', status).isArray();\r\n\t\tif(status) {\r\n\t\t\tvar item, checker;\r\n\t\t\tfor(var i = 0, len = status.length; i < len; i++) {\r\n\t\t\t\titem = jQuery.trim(status[i]);\r\n\t\t\t\tchecker = jslet.Checker.test('ContextRule.status' + i, item).isString().required();\r\n\t\t\t\titem = item.toLowerCase();\r\n\t\t\t\tchecker.testValue(item).inArray(this.dataStatus);\r\n\t\t\t\tstatus[i] = item;\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis._status = status;\r\n\t\treturn this;\r\n\t},\r\n\r\n\tselected: function(selected) {\r\n\t\tif(selected === undefined) {\r\n\t\t\treturn this._selected;\r\n\t\t}\r\n\t\t\r\n\t\tthis._selected = selected? true: false;\r\n\t},\r\n\t\r\n\tcondition: function(condition) {\r\n\t\tif(condition === undefined) {\r\n\t\t\treturn this._condition;\r\n\t\t}\r\n\t\t\r\n\t\tjslet.Checker.test('ContextRule.condition', condition).isString();\r\n\t\tthis._condition = jQuery.trim(condition);\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\trules: function(rules) {\r\n\t\tif(rules === undefined) {\r\n\t\t\treturn this._rules;\r\n\t\t}\r\n\r\n\t\tjslet.Checker.test('ContextRule.rules', rules).isArray();\r\n\t\tthis._rules = rules;\r\n\t\treturn this;\r\n\t}\r\n};\r\n\r\njslet.data.ContextRuleItem = function(fldName) {\r\n\tvar Z = this;\r\n\tjslet.Checker.test('ContextRule.field', fldName).isString();\r\n\tfldName = jQuery.trim(fldName);\r\n\tjslet.Checker.test('ContextRule.field', fldName).required();\r\n\tZ._field = fldName;\r\n\t\r\n\tZ._meta = undefined;\r\n\tZ._value = undefined;\r\n\tZ._lookup = undefined;\r\n\tZ._customized = undefined;\r\n};\r\n\r\njslet.data.ContextRuleItem.className = 'jslet.data.ContextRuleItem';\r\n\r\njslet.data.ContextRuleItem.prototype = {\r\n\tclassName: jslet.data.ContextRuleItem.className,\r\n\t\r\n\tfield: function() {\r\n\t\treturn this._field;\r\n\t},\r\n\t\r\n\tmeta: function(meta) {\r\n\t\tif(meta === undefined) {\r\n\t\t\treturn this._meta;\r\n\t\t}\r\n\t\t\r\n\t\tjslet.Checker.test('ContextRuleItem.meta', meta).isClass(jslet.data.ContextRuleMeta.className);\r\n\t\tthis._meta = meta;\r\n\t\treturn this;\r\n\t},\r\n\r\n\tlookup: function(lookup) {\r\n\t\tif(lookup === undefined) {\r\n\t\t\treturn this._lookup;\r\n\t\t}\r\n\t\t\r\n\t\tjslet.Checker.test('ContextRuleItem.lookup', lookup).isClass(jslet.data.ContextRuleLookup.className);\r\n\t\tthis._lookup = lookup;\r\n\t\treturn this;\r\n\t},\r\n\r\n\tvalue: function(value) {\r\n\t\tif(value === undefined) {\r\n\t\t\treturn this._value;\r\n\t\t}\r\n\t\t\r\n\t\tthis._value = value;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\tcustomized: function(customizedFn) {\r\n\t\tif(customizedFn === undefined) {\r\n\t\t\treturn this._customized;\r\n\t\t}\r\n\t\tjslet.Checker.test('ContextRuleItem.customized', customizedFn).isFunction();\r\n\t\tthis._customized = customizedFn;\r\n\t\treturn this;\r\n\t}\r\n};\r\n\r\njslet.data.ContextRuleMeta = function() {\r\n\tvar Z = this;\r\n\tZ._label = undefined;\r\n\tZ._tip = undefined;\r\n\tZ._nullText = undefined;\r\n\t\r\n\tZ._required = undefined;\r\n\tZ._disabled = undefined;\r\n\tZ._readOnly = undefined;\r\n\tZ._visible = undefined;\r\n\tZ._formula = undefined;\r\n\tZ._scale = undefined;\r\n\tZ._defaultValue = undefined;\r\n\tZ._displayFormat = undefined;\r\n\tZ._editMask = undefined;\r\n\tZ._editControl = undefined;\r\n\t\r\n\tZ._range = undefined;\r\n\tZ._regularExpr = undefined;\r\n\tZ._valueCountLimit = undefined;\r\n\tZ._validChars = undefined;\r\n\tZ._customValidator = undefined;\r\n};\r\n\r\njslet.data.ContextRuleMeta.className = 'jslet.data.ContextRuleMeta';\r\n\r\njslet.data.ContextRuleMeta.prototype = {\r\n\tclassName: jslet.data.ContextRuleMeta.className,\r\n\t\r\n\tproperties: ['label', 'tip','nullText', 'required','disabled','readOnly','visible',\r\n\t             'formula','scale','defaultValue','displayFormat','editMask','editControl',\r\n\t             'range','regularExpr','valueCountLimit','validChars','customValidator'],\r\n\t/**\r\n\t * Get or set field label.\r\n\t * \r\n\t * @param {String or undefined} label Field label.\r\n\t * @return {String or this}\r\n\t */\r\n\tlabel: function (label) {\r\n\t\tif (label === undefined) {\r\n\t\t\treturn this._label;\r\n\t\t}\r\n\t\tjslet.Checker.test('ContextRuleMeta.label', label).isString();\r\n\t\tthis._label = label;\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * Get or set field tip.\r\n\t * \r\n\t * @param {String or undefined} tip Field tip.\r\n\t * @return {String or this}\r\n\t */\r\n\ttip: function(tip) {\r\n\t\tif (tip === undefined) {\r\n\t\t\treturn this._tip;\r\n\t\t}\r\n\t\tjslet.Checker.test('ContextRuleMeta.tip', tip).isString();\r\n\t\tthis._tip = tip;\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * Get or set the display text if the field value is null.\r\n\t * \r\n\t * @param {String or undefined} nullText Field null text.\r\n\t * @return {String or this}\r\n\t */\r\n\tnullText: function (nullText) {\r\n\t\tif (nullText === undefined) {\r\n\t\t\treturn this._nullText;\r\n\t\t}\r\n\t\t\r\n\t\tjslet.Checker.test('ContextRuleMeta.nullText', nullText).isString();\r\n\t\tthis._nullText = jQuery.trim(nullText);\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Get or set flag required.\r\n\t * \r\n\t * @param {Boolean or undefined} required Field is required or not.\r\n\t * @return {Boolean or this}\r\n\t */\r\n\trequired: function (required) {\r\n\t\tvar Z = this;\r\n\t\tif (required === undefined) {\r\n\t\t\treturn Z._required;\r\n\t\t}\r\n\t\tZ._required = required ? true: false;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Get or set field is visible or not.\r\n\t * \r\n\t * @param {Boolean or undefined} visible Field is visible or not.\r\n\t * @return {Boolean or this}\r\n\t */\r\n\tvisible: function (visible) {\r\n\t\tvar Z = this;\r\n\t\tif (visible === undefined){\r\n\t\t\treturn Z._visible;\r\n\t\t}\r\n\t\tZ._visible = visible ? true: false;\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * Get or set field is disabled or not.\r\n\t * \r\n\t * @param {Boolean or undefined} disabled Field is disabled or not.\r\n\t * @return {Boolean or this}\r\n\t */\r\n\tdisabled: function (disabled) {\r\n\t\tvar Z = this;\r\n\t\tif (disabled === undefined) {\r\n\t\t\treturn Z._disabled;\r\n\t\t}\r\n\t\tZ._disabled = disabled ? true: false;\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * Get or set field is readOnly or not.\r\n\t * \r\n\t * @param {Boolean or undefined} readOnly Field is readOnly or not.\r\n\t * @return {Boolean or this}\r\n\t */\r\n\treadOnly: function (readOnly) {\r\n\t\tvar Z = this;\r\n\t\tif (readOnly === undefined){\r\n\t\t\treturn Z._readOnly;\r\n\t\t}\r\n\t\t\r\n\t\tZ._readOnly = readOnly? true: false;\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * Get or set field edit mask.\r\n\t * \r\n\t * @param {jslet.data.EditMask or String or undefined} mask Field edit mask.\r\n\t * @return {jslet.data.EditMask or this}\r\n\t */\r\n\teditMask: function (mask) {\r\n\t\tvar Z = this;\r\n\t\tif (mask === undefined) {\r\n\t\t\treturn Z._editMask;\r\n\t\t}\r\n\t\tZ._editMask = mask;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Get or set field decimal length.\r\n\t * \r\n\t * @param {Integer or undefined} scale Field decimal length.\r\n\t * @return {Integer or this}\r\n\t */\r\n\tscale: function (scale) {\r\n\t\tvar Z = this;\r\n\t\tif (scale === undefined) {\r\n\t\t\treturn Z._scale;\r\n\t\t}\r\n\t\tjslet.Checker.test('ContextRuleMeta.scale', scale).isNumber();\r\n\t\tZ._scale = parseInt(scale);\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Get or set field formula. Example: \r\n\t * <pre><code>\r\n\t *  obj.formula('[price]*[num]');\r\n\t * </code></pre>\r\n\t * \r\n\t * @param {String or undefined} formula Field formula.\r\n\t * @return {String or this}\r\n\t */\r\n\tformula: function (formula) {\r\n\t\tvar Z = this;\r\n\t\tif (formula === undefined) {\r\n\t\t\treturn Z._formula;\r\n\t\t}\r\n\t\t\r\n\t\tjslet.Checker.test('ContextRuleMeta.formula', formula).isString();\r\n\t\tZ._formula = jQuery.trim(formula);\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * Get or set field display format.\r\n\t * For number field like: #,##0.00\r\n\t * For date field like: yyyy/MM/dd\r\n\t * \r\n\t * @param {String or undefined} format Field display format.\r\n\t * @return {String or this}\r\n\t */\r\n\tdisplayFormat: function (format) {\r\n\t\tvar Z = this;\r\n\t\tif (format === undefined) {\r\n\t\t\treturn Z._displayFormat;\r\n\t\t}\r\n\t\t\r\n\t\tjslet.Checker.test('ContextRuleMeta.format', format).isString();\r\n\t\tZ._displayFormat = jQuery.trim(format);\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * Get or set field edit control. It is similar as DBControl configuration.\r\n\t * Here you need not set 'dataset' and 'field' property.   \r\n\t * Example:\r\n\t * <pre><code>\r\n\t * //Normal DBControl configuration\r\n\t * //var normalCtrlCfg = {type:\"DBSpinEdit\",dataset:\"employee\",field:\"age\",minValue:10,maxValue:100,step:5};\r\n\t * \r\n\t * var editCtrlCfg = {type:\"DBSpinEdit\",minValue:10,maxValue:100,step:5};\r\n\t * fldObj.displayControl(editCtrlCfg);\r\n\t * </code></pre>\r\n\t * \r\n\t * @param {DBControl Config or String} editCtrl If String, it will convert to DBControl Config.\r\n\t * @return {DBControl Config or this}\r\n\t */\r\n\teditControl: function (editCtrl) {\r\n\t\tvar Z = this;\r\n\t\tif (editCtrl=== undefined){\r\n\t\t\treturn Z._editControl;\r\n\t\t}\r\n\r\n\t\tZ._editControl = (typeof (editCtrl) === 'string') ? { type: editCtrl } : editCtrl;\r\n\t},\r\n\r\n\t/**\r\n\t * Get or set field default value.\r\n\t * The data type of default value must be same as Field's.\r\n\t * Example:\r\n\t *   Number field: fldObj.defauleValue(100);\r\n\t *   Date field: fldObj.defaultValue(new Date());\r\n\t *   String field: fldObj.defaultValue('test');\r\n\t * \r\n\t * @param {Object or undefined} dftValue Field default value.\r\n\t * @return {Object or this}\r\n\t */\r\n\tdefaultValue: function (dftValue) {\r\n\t\tvar Z = this;\r\n\t\tif (dftValue === undefined) {\r\n\t\t\treturn Z._defaultValue;\r\n\t\t}\r\n\t\tZ._defaultValue = dftValue;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Get or set field rang.\r\n\t * Range is an object as: {min: x, max: y}. Example:\r\n\t * <pre><code>\r\n\t * //For String field\r\n\t *\tvar range = {min: 'a', max: 'z'};\r\n\t *  //For Date field\r\n\t *\tvar range = {min: new Date(2000,1,1), max: new Date(2010,12,31)};\r\n\t *  //For Number field\r\n\t *\tvar range = {min: 0, max: 100};\r\n\t *  fldObj.range(range);\r\n\t * </code></pre>\r\n\t * \r\n\t * @param {Range or Json String} range Field range;\r\n\t * @return {Range or this}\r\n\t */\r\n\trange: function (range) {\r\n\t\tvar Z = this;\r\n\t\tif (range === undefined) {\r\n\t\t\treturn Z._range;\r\n\t\t}\r\n\t\tif (jslet.isString(range)) {\r\n\t\t\t/* jshint ignore:start */\r\n\t\t\tZ._range = new Function('return ' + range);\r\n\t\t\t/* jshint ignore:end */\r\n\t\t} else {\r\n\t\t\tZ._range = range;\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * Get or set regular expression.\r\n\t * You can specify your own validator with regular expression. If regular expression not specified, \r\n\t * The default regular expression for Date and Number field will be used. Example:\r\n\t * <pre><code>\r\n\t * fldObj.regularExpr(/(\\(\\d{3,4}\\)|\\d{3,4}-|\\s)?\\d{8}/ig, 'Invalid phone number!');//like: 0755-12345678\r\n\t * </code></pre>\r\n\t * \r\n\t * @param {String or JSON object} expr Regular expression, format: {expr: xxx, message: yyy};\r\n\t * @return {Object} An object like: { expr: expr, message: message }\r\n\t */\r\n\tregularExpr: function (regularExpr) {\r\n\t\tvar Z = this;\r\n\t\tif (regularExpr === undefined){\r\n\t\t\treturn Z._regularExpr;\r\n\t\t}\r\n\t\t\r\n\t\tif (jslet.isString(regularExpr)) {\r\n\t\t\t/* jshint ignore:start */\r\n\t\t\tZ._regularExpr = new Function('return ' + regularExpr);\r\n\t\t\t/* jshint ignore:end */\r\n\t\t} else {\r\n\t\t\tZ._regularExpr = regularExpr;\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Get or set allowed count when valueStyle is multiple.\r\n\t * \r\n\t * @param {String or undefined} count.\r\n\t * @return {String or this}\r\n\t */\r\n\tvalueCountLimit: function (count) {\r\n\t\tvar Z = this;\r\n\t\tif (count === undefined) {\r\n\t\t\treturn Z._valueCountLimit;\r\n\t\t}\r\n\t\tjslet.Checker.test('ContextRuleMeta.valueCountLimit', count).isNumber();\r\n\t\tZ._valueCountLimit = parseInt(count);\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * Get or set customized validator.\r\n\t * \r\n\t * @param {Function} validator Validator function.\r\n\t * Pattern:\r\n\t *   function(fieldObj, fldValue){}\r\n\t *   //fieldObj: jslet.data.Field, Field object\r\n\t *   //fldValue: Object, Field value\r\n\t *   //return: String, if validate failed, return error message, otherwise return null; \r\n\t */\r\n\tcustomValidator: function (validator) {\r\n\t\tvar Z = this;\r\n\t\tif (validator === undefined) {\r\n\t\t\treturn Z._customValidator;\r\n\t\t}\r\n\t\tjslet.Checker.test('ContextRuleMeta.customValidator', validator).isFunction();\r\n\t\tZ._customValidator = validator;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Valid characters for this field.\r\n\t */\r\n\tvalidChars: function(chars){\r\n\t\tvar Z = this;\r\n\t\tif (chars === undefined){\r\n\t\t\treturn Z._validChars;\r\n\t\t}\r\n\t\t\r\n\t\tjslet.Checker.test('ContextRuleMeta.validChars', chars).isString();\r\n\t\tZ._validChars = jQuery.trim(chars);\r\n\t},\r\n\t\r\n};\r\n\r\njslet.data.ContextRuleLookup = function() {\r\n\tvar Z = this;\r\n\tZ._dataset = undefined;\r\n\tZ._filter = undefined;\r\n\tZ._fixedFilter = undefined;\r\n\tZ._criteria = undefined;\r\n\tZ._displayFields = undefined;\r\n\tZ._onlyLeafLevel = undefined;\r\n};\r\n\r\njslet.data.ContextRuleLookup.className = 'jslet.data.ContextRuleLookup';\r\n\r\njslet.data.ContextRuleLookup.prototype ={\r\n\tclassName: jslet.data.ContextRuleLookup.className,\r\n\t\r\n\tproperties: ['dataset', 'filter', 'fixedFilter', 'criteria', 'displayFields', 'onlyLeafLevel'],\r\n\t\r\n\tdataset: function(datasetName){\r\n\t\tvar Z = this;\r\n\t\tif (datasetName === undefined){\r\n\t\t\treturn Z._dataset;\r\n\t\t}\r\n\t\tjslet.Checker.test('ContextRuleLookup.dataset', datasetName).isString();\r\n\t\tZ._dataset = jQuery.trim(datasetName);\r\n\t},\r\n\r\n\tfilter: function(filter){\r\n\t\tvar Z = this;\r\n\t\tif (filter === undefined){\r\n\t\t\treturn Z._filter;\r\n\t\t}\r\n\t\tjslet.Checker.test('ContextRuleLookup.filter', filter).isString();\r\n\t\tZ._filter = jQuery.trim(filter);\r\n\t},\r\n\r\n\tfixedFilter: function(fixedFilter){\r\n\t\tvar Z = this;\r\n\t\tif (fixedFilter === undefined){\r\n\t\t\treturn Z._fixedFilter;\r\n\t\t}\r\n\t\tjslet.Checker.test('ContextRuleLookup.fixedFilter', fixedFilter).isString();\r\n\t\tZ._fixedFilter = jQuery.trim(fixedFilter);\r\n\t},\r\n\r\n\tcriteria: function(criteria){\r\n\t\tvar Z = this;\r\n\t\tif (criteria === undefined){\r\n\t\t\treturn Z._criteria;\r\n\t\t}\r\n\t\tjslet.Checker.test('ContextRuleLookup.criteria', criteria).isString();\r\n\t\tZ._criteria = jQuery.trim(criteria);\r\n\t},\r\n\r\n\tdisplayFields: function(displayFields){\r\n\t\tvar Z = this;\r\n\t\tif (displayFields === undefined){\r\n\t\t\treturn Z._displayFields;\r\n\t\t}\r\n\t\tjslet.Checker.test('ContextRuleLookup.displayFields', displayFields).isString();\r\n\t\tZ._displayFields = jQuery.trim(displayFields);\r\n\t},\r\n\r\n\tonlyLeafLevel: function(onlyLeafLevel){\r\n\t\tvar Z = this;\r\n\t\tif (onlyLeafLevel === undefined){\r\n\t\t\treturn Z._onlyLeafLevel;\r\n\t\t}\r\n\t\tZ._onlyLeafLevel = onlyLeafLevel ? true: false;\r\n\t}\r\n};\r\n\r\njslet.data.createContextRule = function(cxtRuleCfg) {\r\n\tif(!cxtRuleCfg) {\r\n\t\treturn null;\r\n\t}\r\n\tvar ruleObj = new jslet.data.ContextRule();\r\n\tif(cxtRuleCfg.status !== undefined) {\r\n\t\truleObj.status(cxtRuleCfg.status);\r\n\t}\r\n\tif(cxtRuleCfg.selected !== undefined) {\r\n\t\truleObj.selected(cxtRuleCfg.selected);\r\n\t} \r\n\tif(cxtRuleCfg.condition !== undefined) {\r\n\t\truleObj.condition(cxtRuleCfg.condition);\r\n\t}\r\n\tif(cxtRuleCfg.rules !== undefined) {\r\n\t\tjslet.Checker.test('ContextRule.rules', rules).isArray();\r\n\t\tvar rules = [];\r\n\t\truleObj.rules(rules);\r\n\t\tfor(var i = 0, len = cxtRuleCfg.rules.length; i < len; i++) {\r\n\t\t\trules.push(createContextRuleItem(cxtRuleCfg.rules[i]));\r\n\t\t}\r\n\t}\r\n\t\r\n\tfunction createContextRuleItem(itemCfg) {\r\n\t\tvar item = new jslet.data.ContextRuleItem(itemCfg.field);\r\n\t\tif(itemCfg.meta !== undefined) {\r\n\t\t\titem.meta(createContextRuleMeta(itemCfg.meta));\r\n\t\t}\r\n\t\t\r\n\t\tif(itemCfg.value !== undefined) {\r\n\t\t\titem.value(itemCfg.value);\r\n\t\t}\r\n\t\t\r\n\t\tif(itemCfg.lookup !== undefined) {\r\n\t\t\titem.lookup(createContextRuleLookup(itemCfg.lookup));\r\n\t\t}\r\n\t\t\r\n\t\tif(itemCfg.customized !== undefined) {\r\n\t\t\titem.customized(itemCfg.customized);\r\n\t\t}\r\n\t\treturn item;\r\n\t}\r\n\t\r\n\tfunction createContextRuleMeta(metaCfg) {\r\n\t\tvar meta = new jslet.data.ContextRuleMeta();\r\n\t\tif(metaCfg.label !== undefined) {\r\n\t\t\tmeta.label(metaCfg.label);\r\n\t\t}\r\n\t\t\r\n\t\tif(metaCfg.tip !== undefined) {\r\n\t\t\tmeta.tip(metaCfg.tip);\r\n\t\t}\r\n\t\t\r\n\t\tif(metaCfg.nullText !== undefined) {\r\n\t\t\tmeta.nullText(metaCfg.nullText);\r\n\t\t}\r\n\t\t\r\n\t\tif(metaCfg.required !== undefined) {\r\n\t\t\tmeta.required(metaCfg.required);\r\n\t\t}\r\n\t\t\r\n\t\tif(metaCfg.disabled !== undefined) {\r\n\t\t\tmeta.disabled(metaCfg.disabled);\r\n\t\t}\r\n\t\t\r\n\t\tif(metaCfg.readOnly !== undefined) {\r\n\t\t\tmeta.readOnly(metaCfg.readOnly);\r\n\t\t}\r\n\t\t\r\n\t\tif(metaCfg.visible !== undefined) {\r\n\t\t\tmeta.visible(metaCfg.visible);\r\n\t\t}\r\n\t\t\r\n\t\tif(metaCfg.formula !== undefined) {\r\n\t\t\tmeta.formula(metaCfg.formula);\r\n\t\t}\r\n\t\t\r\n\t\tif(metaCfg.scale !== undefined) {\r\n\t\t\tmeta.scale(metaCfg.scale);\r\n\t\t}\r\n\t\t\r\n\t\tif(metaCfg.required !== undefined) {\r\n\t\t\tmeta.required(metaCfg.required);\r\n\t\t}\r\n\t\t\r\n\t\tif(metaCfg.displayFormat !== undefined) {\r\n\t\t\tmeta.displayFormat(metaCfg.displayFormat);\r\n\t\t}\r\n\t\t\r\n\t\tif(metaCfg.editMask !== undefined) {\r\n\t\t\tmeta.editMask(metaCfg.editMask);\r\n\t\t}\r\n\t\t\r\n\t\tif(metaCfg.editControl !== undefined) {\r\n\t\t\tmeta.editControl(metaCfg.editControl);\r\n\t\t}\r\n\t\t\r\n\t\tif(metaCfg.range !== undefined) {\r\n\t\t\tmeta.range(metaCfg.range);\r\n\t\t}\r\n\t\t\r\n\t\tif(metaCfg.regularExpr !== undefined) {\r\n\t\t\tmeta.regularExpr(metaCfg.regularExpr);\r\n\t\t}\r\n\t\t\r\n\t\tif(metaCfg.valueCountLimit !== undefined) {\r\n\t\t\tmeta.valueCountLimit(metaCfg.valueCountLimit);\r\n\t\t}\r\n\t\t\r\n\t\tif(metaCfg.validChars !== undefined) {\r\n\t\t\tmeta.validChars(metaCfg.validChars);\r\n\t\t}\r\n\t\t\r\n\t\tif(metaCfg.customValidator !== undefined) {\r\n\t\t\tmeta.customValidator(metaCfg.customValidator);\r\n\t\t}\r\n\t\t\r\n\t\treturn meta;\r\n\t}\r\n\r\n\tfunction createContextRuleLookup(lookupCfg) {\r\n\t\tvar lookup = new jslet.data.ContextRuleLookup();\r\n\t\tif(lookupCfg.dataset !== undefined) {\r\n\t\t\tlookup.dataset(lookupCfg.dataset);\r\n\t\t}\r\n\t\t\r\n\t\tif(lookupCfg.filter !== undefined) {\r\n\t\t\tlookup.filter(lookupCfg.filter);\r\n\t\t}\r\n\t\t\r\n\t\tif(lookupCfg.fixedFilter !== undefined) {\r\n\t\t\tlookup.fixedFilter(lookupCfg.fixedFilter);\r\n\t\t}\r\n\t\t\r\n\t\tif(lookupCfg.criteria !== undefined) {\r\n\t\t\tlookup.criteria(lookupCfg.criteria);\r\n\t\t}\r\n\t\t\r\n\t\tif(lookupCfg.displayFields !== undefined) {\r\n\t\t\tlookup.displayFields(lookupCfg.displayFields);\r\n\t\t}\r\n\t\t\r\n\t\tif(lookupCfg.onlyLeafLevel !== undefined) {\r\n\t\t\tlookup.onlyLeafLevel(lookupCfg.onlyLeafLevel);\r\n\t\t}\r\n\t\t\r\n\t\treturn lookup;\r\n\t}\r\n\treturn ruleObj;\r\n};\r\n\r\njslet.data.ContextRuleEngine = function(dataset) {\r\n\tthis._dataset = dataset;\r\n\tthis._matchedRules = [];\r\n\tthis._ruleEnv = {};\r\n};\r\n\r\njslet.data.ContextRuleEngine.prototype = {\r\n\r\n\tcompile: function() {\r\n\t\tvar contextRules = this._dataset.contextRules();\r\n\t\tfor(var i = 0, len = contextRules.length; i < len; i++) {\r\n\t\t\tthis._compileOneRule(contextRules[i]);\r\n\t\t}\r\n\t},\r\n\r\n\tevalRule: function(changingFldName){\r\n\t\tvar contextRules = this._dataset.contextRules();\r\n\t\tvar ruleObj;\r\n\t\tthis._matchedRules = [];\r\n\t\tthis._ruleEnv = {};\r\n\t\tfor(var i = 0, len = contextRules.length; i < len; i++) {\r\n\t\t\truleObj = contextRules[i];\r\n\t\t\tthis._evalOneRule(ruleObj, changingFldName);\r\n\t\t}\r\n\t\tthis._syncMatchedRules(changingFldName);\r\n\t},\r\n\t\r\n\t_compileOneRule: function(ruleObj) {\r\n\t\tvar condition = ruleObj.condition;\r\n\t\tthis._compileExpr(ruleObj, 'condition', true);\r\n\t\tvar rules = ruleObj.rules();\r\n\t\tfor(var i = 0, len = rules.length; i < len; i++) {\r\n\t\t\tthis._compileRuleItem(rules[i]);\r\n\t\t}\r\n\t},\r\n\t\r\n\t_compileRuleItem: function(ruleItem) {\r\n\t\tthis._compileExpr(ruleItem, 'value');\r\n\t\tvar metaObj = ruleItem.meta();\r\n\t\tvar props, propName, i, len;\r\n\t\tif(metaObj) {\r\n\t\t\tprops = metaObj.properties;\r\n\t\t\tlen = props.length;\r\n\t\t\tfor(i = 0; i < len; i++) {\r\n\t\t\t\tpropName = props[i];\r\n\t\t\t\tthis._compileExpr(metaObj, propName);\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar lookupObj = ruleItem.lookup();\r\n\t\tif(lookupObj) {\r\n\t\t\tprops = lookupObj.properties;\r\n\t\t\tlen = props.length;\r\n\t\t\tfor(i = 0; i < len; i++) {\r\n\t\t\t\tpropName = props[i];\r\n\t\t\t\tthis._compileExpr(lookupObj, propName);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t\r\n\t_compileExpr: function(itemObj, propName, isExpr) {\r\n\t\tvar setting = itemObj[propName].call(itemObj),\r\n\t\t\texprName = propName +'Expr';\r\n\t\t\r\n\t\tif(setting !== null && setting !== undefined && jslet.isString(setting)) {\r\n\t\t\tif(setting.indexOf('expr:') === 0) {\r\n\t\t\t\tsetting = setting.substring(5);\r\n\t\t\t\tisExpr = true;\r\n\t\t\t}\r\n\t\t\tif(isExpr) {\r\n\t\t\t\titemObj[exprName] = new jslet.Expression(this._dataset, setting);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t\r\n\t_evalOneRule: function(ruleObj, changingFldName) {\r\n\t\tvar matched = false;\r\n\t\tvar exprObj = ruleObj.conditionExpr;\r\n\t\tvar mainFields = null;\r\n\t\tvar hasRule = false;\r\n\t\t//Check if the rule matched or not\r\n\t\tif(exprObj) {\r\n\t\t\tmainFields = exprObj.mainFields();\r\n\t\t\tif(changingFldName) {\r\n\t\t\t\tif(mainFields && mainFields.indexOf(changingFldName) < 0) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tmatched = exprObj.eval();\r\n\t\t\tif(!matched) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\thasRule = true;\r\n\t\t}\r\n\t\t//if exists 'status' condition\r\n\t\tvar ruleStatus = ruleObj.status();\r\n\t\tif(ruleStatus !== undefined) {\r\n\t\t\tvar dsStatus = 'other', \r\n\t\t\t\tchangedStatus = this._dataset.changedStatus();\r\n\t\t\tif(changedStatus == jslet.data.DataSetStatus.INSERT) {\r\n\t\t\t\tdsStatus = 'insert';\r\n\t\t\t} else if(changedStatus == jslet.data.DataSetStatus.UPDATE) {\r\n\t\t\t\tdsStatus = 'update';\r\n\t\t\t}\r\n\t\t\tif(!hasRule) {\r\n\t\t\t\tmatched = true;\r\n\t\t\t}\r\n\t\t\tmatched = (matched && ruleStatus.indexOf(dsStatus) >= 0);\r\n\t\t\thasRule = true;\r\n\t\t}\r\n\t\t//if exists 'selected' condition\r\n\t\tvar ruleSelected = ruleObj.selected();\r\n\t\tif(ruleSelected !== undefined) {\r\n\t\t\tif(!hasRule) {\r\n\t\t\t\tmatched = true;\r\n\t\t\t}\r\n\t\t\tmatched = (matched && ruleSelected === (this._dataset.selected()? true: false));\r\n\t\t}\r\n\t\tif(matched) {\r\n\t\t\tvar ruleEnv = null;\r\n\t\t\tif(mainFields) {\r\n\t\t\t\tvar fldName;\r\n\t\t\t\tfor(var i = 0, len = mainFields.length; i < len; i++) {\r\n\t\t\t\t\tfldName = mainFields[i];\r\n\t\t\t\t\tif(this._ruleEnv[fldName] === undefined) {\r\n\t\t\t\t\t\tthis._ruleEnv[fldName] = this._dataset.getFieldValue(fldName);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis._evalRuleItems(ruleObj.rules(), changingFldName? true: false);\r\n\t\t}\r\n\t},\r\n\t\r\n\t_evalRuleItems: function(rules, isValueChanged) {\r\n\t\tvar fldName, ruleItem, matchedRule;\r\n\t\tfor(var i = 0, len = rules.length; i < len; i++) {\r\n\t\t\truleItem = rules[i];\r\n\t\t\tfldName = ruleItem.field();\r\n\t\t\tmatchedRule = new jslet.data.ContextRuleItem(fldName);\r\n\t\t\t\r\n\t\t\tvar meta = ruleItem.meta(); \r\n\t\t\tif(meta) {\r\n\t\t\t\tmatchedRule.meta(new jslet.data.ContextRuleMeta());\r\n\t\t\t\tthis._copyProperties(meta, matchedRule.meta());\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tvar lookup = ruleItem.lookup(); \r\n\t\t\tif(lookup) {\r\n\t\t\t\tmatchedRule.lookup(new jslet.data.ContextRuleLookup());\r\n\t\t\t\tthis._copyProperties(lookup, matchedRule.lookup());\r\n\t\t\t}\r\n\r\n\t\t\tif(isValueChanged && ruleItem.value() !== undefined) {\r\n\t\t\t\tmatchedRule.value(this._evalExpr(ruleItem, 'value'));\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tvar customized = ruleItem.customized();\r\n\t\t\tif(customized) {\r\n\t\t\t\tmatchedRule.customized(customized);\r\n\t\t\t}\r\n\t\t\tthis._matchedRules.push(matchedRule);\r\n\t\t}\r\n\t},\r\n\t\r\n\t_copyProperties: function(srcObject, descObject) {\r\n\t\tvar props = srcObject.properties, propName, propValue;\r\n\t\tfor(var i = 0, len = props.length; i < len; i++) {\r\n\t\t\tpropName = props[i];\r\n\t\t\tpropValue = this._evalExpr(srcObject, propName);\r\n\t\t\tif(propValue !== undefined) {\r\n\t\t\t\tdescObject[propName].call(descObject, propValue);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t\r\n\t_evalExpr: function(evalObj, propName) {\r\n\t\tvar exprObj = evalObj[propName + 'Expr'];\r\n\t\tif(exprObj) {\r\n\t\t\treturn exprObj.eval();\r\n\t\t} else {\r\n\t\t\treturn evalObj[propName].call(evalObj);\r\n\t\t}\r\n\t},\r\n\t\r\n\t_syncMatchedRules: function(changingFldName) {\r\n\t\tvar matchedRules = this._matchedRules,\r\n\t\t\truleObj, fldName, fldObj;\r\n\t\t\r\n\t\tfor(var i = 0, len = matchedRules.length; i < len; i++) {\r\n\t\t\truleObj = matchedRules[i];\r\n\t\t\tfldName = ruleObj.field();\r\n\t\t\tfldObj = this._dataset.getField(fldName);\r\n\t\t\tif(fldObj) {\r\n\t\t\t\tthis._syncMatchedRuleMeta(fldObj, ruleObj.meta());\r\n\t\t\t\tthis._syncMatchedRuleLookup(fldObj, ruleObj.lookup());\r\n\t\t\t\tthis._syncMatchedRuleValue(fldObj, ruleObj.value());\r\n\t\t\t\tvar customizedFn = ruleObj.customized();\r\n\t\t\t\tif(customizedFn) {\r\n\t\t\t\t\tcustomizedFn(fldObj, changingFldName);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t\r\n\t_syncMatchedRuleMeta: function(fldObj, ruleMeta) {\r\n\t\tif(!ruleMeta) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar props = ruleMeta.properties, \r\n\t\t\tpropName, propValue;\r\n\t\tfor(var i = 0, len = props.length; i < len; i++) {\r\n\t\t\tpropName = props[i];\r\n\t\t\tpropValue = ruleMeta[propName].call(ruleMeta);\r\n\t\t\tif(propValue !== undefined) {\r\n\t\t\t\tfldObj[propName].call(fldObj, propValue);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t\r\n\t_syncMatchedRuleLookup: function(fldObj, ruleLookup) {\r\n\t\tif(!ruleLookup) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar fieldLookup = fldObj.lookup();\r\n\t\tif(!fieldLookup) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar ruleDs = ruleLookup.dataset();\r\n\t\tif(ruleDs) {\r\n\t\t\tfieldLookup.dataset(ruleDs);\r\n\t\t}\r\n\t\tvar lkDsObj = fieldLookup.dataset();\r\n\t\tlkDsObj.autoRefreshHostDataset(true);\r\n\t\tvar ruleFilter = ruleLookup.filter();\r\n\t\tvar fldName;\r\n\t\tif(ruleFilter !== undefined) {\r\n\t\t\tfor(fldName in this._ruleEnv) {\r\n\t\t\t\truleFilter = ruleFilter.replace('${' + fldName + '}', this._ruleEnv[fldName]);\r\n\t\t\t}\r\n\t\t\tlkDsObj.filter(ruleFilter);\r\n\t\t\tlkDsObj.filtered(true);\r\n\t\t}\r\n\t\truleFilter = ruleLookup.fixedFilter();\r\n\t\tif(ruleFilter !== undefined) {\r\n\t\t\tfor(fldName in this._ruleEnv) {\r\n\t\t\t\truleFilter = ruleFilter.replace('${' + fldName + '}', this._ruleEnv[fldName]);\r\n\t\t\t}\r\n\t\t\tlkDsObj.fixedFilter(ruleFilter);\r\n\t\t\tlkDsObj.filtered(true);\r\n\t\t}\r\n\t\tvar ruleCriteria = ruleLookup.criteria();\r\n\t\tif(ruleCriteria !== undefined) {\r\n\t\t\tlkDsObj.query(ruleCriteria);\r\n\t\t}\r\n\t\tvar ruleDisplayFields = ruleLookup.displayFields();\r\n\t\tif(ruleDisplayFields !== undefined) {\r\n\t\t\tfieldLookup.displayFields(ruleDisplayFields);\r\n\t\t}\r\n\t\tvar ruleOnlyLeafLevel = ruleLookup.onlyLeafLevel();\r\n\t\tif(ruleOnlyLeafLevel !== undefined) {\r\n\t\t\tfieldLookup.onlyLeafLevel(ruleOnlyLeafLevel);\r\n\t\t}\r\n\t},\r\n\t\r\n\t_syncMatchedRuleValue: function(fldObj, value) {\r\n\t\tif(value !== undefined) {\r\n\t\t\tfldObj.setValue(value);\r\n\t\t}\r\n\t}\r\n};\n/*!\r\n * Jslet Javascript Framework v4.0.0\r\n * https://github.com/jslet/jslet/\r\n *\r\n * Copyright 2016 Jslet Team and other contributors\r\n * Released under the MIT license\r\n */\r\n \r\n/**\r\n * keep all dataset object,\r\n * key for dataset name, value for dataset object\r\n */\r\n\"use strict\";\r\njslet.data.dataModule = new jslet.SimpleMap();\r\n/**\r\n * Get dataset object with dataset name.\r\n * \r\n * @param {String} dsName dataset name;\r\n * @return {jslet.data.Dataset} Dataset object.\r\n */\r\njslet.data.getDataset = function (dsName) {\r\n\tif(jslet.isString(dsName)) {\r\n\t\treturn jslet.data.dataModule.get(dsName);\r\n\t}\r\n\treturn dsName;\r\n};\r\n\r\njslet.data.DatasetType = {\r\n\tNORMAL: 0, //Normal dataset\r\n\tLOOKUP: 1, //Lookup dataset\r\n\tDETAIL: 2  //Detail dataset\t \r\n};\r\n\r\njslet.data.onCreatingDataset = function(dsName, dsCatalog, realDsName, hostDatasetName) { };\r\n\r\n\r\njslet.data.DataType = {\r\n\tNUMBER: 'N', //Number\r\n\tSTRING: 'S', //String\r\n\tDATE: 'D',  //Date\r\n\tTIME: 'T',  //Time\r\n\tBOOLEAN: 'B', //Boolean\r\n\tDATASET: 'V', //Dataset field\r\n\tCROSS: 'C',   //Cross Field\r\n\tPROXY: 'P' //Proxy field\r\n};\r\n\r\njslet.data.FieldValueStyle = {\r\n\tNORMAL: 0,\t//Single value\r\n\tBETWEEN: 1, //Between style value\r\n\tMULTIPLE: 2 //Multile value\r\n};\r\n\r\n/**\r\n * @class Edit Mask \r\n */\r\njslet.data.EditMask = function(mask, keepChar, transform){\r\n\t/**\r\n\t * {String} Mask String, rule:\r\n\t *  '#': char set: 0-9 and -, not required\r\n\t *  '0': char set: 0-9, required\r\n\t *  '9': char set: 0-9, not required\r\n\t *  'L': char set: A-Z,a-z, required\r\n\t *  'l': char set: A-Z,a-z, not required\r\n\t *  'A': char set: 0-9,a-z,A-Z, required\r\n\t *  'a': char set: 0-9,a-z,A-Z, not required\r\n\t *  'C': char set: any char, required\r\n\t *  'c': char set: any char, not required\r\n\t */\r\n\tthis.mask = mask; \r\n\t/**\r\n\t * {Boolean} keepChar Keep the literal character or not\r\n\t */\r\n\tthis.keepChar = (keepChar !== undefined ? keepChar: true);\r\n\t/**\r\n\t * {String} transform Transform character into UpperCase or LowerCase,\r\n\t *  optional value: upper, lower or null.\r\n\t */\r\n\tthis.transform = transform;\r\n\t\r\n\tthis.clone = function(){\r\n\t\treturn new jslet.data.EditMask(this.mask, this.keepChar, this.transform);\r\n\t};\r\n};\r\n\r\njslet.data.DatasetEvent = {\r\n\tBEFORESCROLL: 'beforeScroll',\r\n\tAFTERSCROLL: 'afterScroll',\r\n\t\r\n\tBEFOREINSERT: 'beforeInsert',\r\n\tAFTERINSERT: 'afterInsert',\r\n\t\r\n\tBEFOREUPDATE: 'beforeUpdate',\r\n\tAFTERUPDATE: 'afterUpdate',\r\n\t\r\n\tBEFOREDELETE: 'beforeDelete',\r\n\tAFTERDELETE: 'afterDelete',\r\n\t\r\n\tBEFORECONFIRM: 'beforeConfirm',\r\n\tAFTERCONFIRM: 'afterConfirm',\r\n\t\r\n\tBEFORECANCEL: 'beforeCancel',\r\n\tAFTERCANCEL: 'afterCancel',\r\n\t\r\n\tBEFORESELECT: 'beforeSelect',\r\n\tAFTERSELECT: 'afterSelect',\r\n\t\r\n\tBEFORESELECTALL: 'beforeSelectAll',\r\n\tAFTERSELECTALL: 'afterSelectAll'\r\n};\r\n\r\njslet.data.DataSetStatus = {BROWSE:0, INSERT: 1, UPDATE: 2, DELETE: 3};\r\n\r\njslet.data.RefreshEvent = {\r\n\tupdateRecordEvent: function(fldName) {\r\n\t\treturn {eventType: jslet.data.RefreshEvent.UPDATERECORD, fieldName: fldName};\r\n\t},\r\n\t\r\n\tupdateColumnEvent: function(fldName) {\r\n\t\treturn {eventType: jslet.data.RefreshEvent.UPDATECOLUMN, fieldName: fldName};\r\n\t},\r\n\t\r\n\tupdateAllEvent: function() {\r\n\t\treturn this._updateAllEvent;\r\n\t},\r\n\t\r\n\tchangeMetaEvent: function(metaName, fieldName, changeAllRows) {\r\n\t\tvar result = {eventType: jslet.data.RefreshEvent.CHANGEMETA, metaName: metaName, fieldName: fieldName};\r\n\t\tif(changeAllRows !== undefined) {\r\n\t\t\tresult.changeAllRows = changeAllRows;\r\n\t\t}\r\n\t\treturn result;\r\n\t},\r\n\t\r\n\tbeforeScrollEvent: function(recno) {\r\n\t\treturn {eventType: jslet.data.RefreshEvent.BEFORESCROLL, recno: recno};\r\n\t},\r\n\t\r\n\tscrollEvent: function(recno, prevRecno) {\r\n\t\treturn {eventType: jslet.data.RefreshEvent.SCROLL, prevRecno: prevRecno, recno: recno};\r\n\t},\r\n\t\r\n\tinsertEvent: function(prevRecno, recno, needUpdateAll) {\r\n\t\treturn {eventType: jslet.data.RefreshEvent.INSERT, prevRecno: prevRecno, recno: recno, updateAll: needUpdateAll};\r\n\t},\r\n\t\r\n\tdeleteEvent: function(recno) {\r\n\t\treturn {eventType: jslet.data.RefreshEvent.DELETE, recno: recno};\r\n\t},\r\n\t\r\n\tselectRecordEvent: function(recno, selected) {\r\n\t\treturn {eventType: jslet.data.RefreshEvent.SELECTRECORD, recno: recno, selected: selected};\r\n\t},\r\n\t\r\n\tselectAllEvent: function(selected) {\r\n\t\treturn {eventType: jslet.data.RefreshEvent.SELECTALL, selected: selected};\r\n\t},\r\n\t\r\n\tchangePageEvent: function() {\r\n\t\treturn this._changePageEvent;\r\n\t},\r\n\t\r\n\terrorEvent: function(errMessage) {\r\n\t\treturn {eventType: jslet.data.RefreshEvent.ERROR, message: errMessage};\r\n\t},\r\n\t\r\n\tlookupEvent: function(fieldName, isMetaChanged) {\r\n\t\treturn {eventType: jslet.data.RefreshEvent.UPDATELOOKUP, fieldName: fieldName, isMetaChanged: isMetaChanged};\r\n\t},\r\n\t\r\n\taggradedEvent: function() {\r\n\t\treturn {eventType: jslet.data.RefreshEvent.AGGRADED};\t\t\r\n\t}\r\n};\r\n\r\njslet.data.RefreshEvent.CHANGEMETA = 'changeMeta';// fieldname, metatype(title, readonly,disabled,format)\r\njslet.data.RefreshEvent.UPDATEALL = 'updateAll';\r\njslet.data.RefreshEvent.UPDATERECORD = 'updateRecord';// fieldname\r\njslet.data.RefreshEvent.UPDATECOLUMN = 'updateColumn';// fieldname\r\njslet.data.RefreshEvent.BEFORESCROLL = 'beforescroll';\r\njslet.data.RefreshEvent.SCROLL = 'scroll';// preRecno, recno\r\n\r\njslet.data.RefreshEvent.SELECTRECORD = 'selectRecord';//\r\njslet.data.RefreshEvent.SELECTALL = 'selectAll';//\r\njslet.data.RefreshEvent.INSERT = 'insert';\r\njslet.data.RefreshEvent.DELETE = 'delete';// recno\r\njslet.data.RefreshEvent.CHANGEPAGE = 'changePage';\r\njslet.data.RefreshEvent.UPDATELOOKUP = 'updateLookup';\r\njslet.data.RefreshEvent.AGGRADED = 'aggraded';\r\n\r\njslet.data.RefreshEvent.ERROR = 'error';\r\n\r\njslet.data.RefreshEvent._updateAllEvent = {eventType: jslet.data.RefreshEvent.UPDATEALL};\r\njslet.data.RefreshEvent._changePageEvent = {eventType: jslet.data.RefreshEvent.CHANGEPAGE};\r\n\r\n/**\r\n * Field Validator\r\n */\r\njslet.data.FieldValidator = function() {\r\n};\r\n\r\njslet.data.FieldValidator.prototype = {\r\n\t\r\n\tintRegular: { expr: /^(-)?[1-9]*\\d+$/ig},\r\n\t\r\n\tfloatRegular: { expr: /((^-?[1-9])|\\d)\\d*(\\.[0-9]*)?$/ig},\r\n\r\n   /**\r\n\t * Check the specified character is valid or not.\r\n\t * Usually use this when user presses a key down.\r\n\t * \r\n\t * @param {String} inputChar Single character\r\n\t * @param {Boolean} True for passed, otherwise failed.\r\n\t */\r\n\tcheckInputChar: function (fldObj, inputChar, existText, cursorPos) {\r\n\t\tvar validChars = fldObj.validChars();\r\n\t\tvar valid = true;\r\n\t\tif (validChars && inputChar) {\r\n\t\t\tvar c = inputChar.charAt(0);\r\n\t\t\tvalid = validChars.indexOf(c) >= 0;\r\n\t\t}\r\n\t\tif(existText && valid && fldObj.getType() == jslet.data.DataType.NUMBER){\r\n\t\t\tvar scale = fldObj.scale();\r\n\t\t\tvar k = existText.lastIndexOf('.');\r\n\t\t\tif(inputChar == '.') {\r\n\t\t\t\tif(k >= 0) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif(scale > 0 && k >= 0) {\r\n\t\t\t\tif(existText.length - k - 1 === scale && cursorPos - 1 > k) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t}\r\n\t\treturn valid;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Check the specified text is valid or not\r\n\t * Usually use this when a field loses focus.\r\n\t * \r\n\t * @param {jslet.data.Field} fldObj Field Object\r\n\t * @param {String} inputText Input text, it is original text that user inputed. \r\n\t * @return {String} If input text is valid, return null, otherwise return error message.\r\n\t */\r\n\tcheckInputText: function (fldObj, inputText) {\r\n\t\tvar result = this.checkRequired(fldObj, inputText);\r\n\t\tif(result) {\r\n\t\t\treturn result;\r\n\t\t}\r\n\t\tif(inputText === \"\") {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\tvar fldType = fldObj.getType();\r\n\t\t//Check with regular expression\r\n\t\tvar regular = fldObj.regularExpr();\r\n\t\tif (!regular) {\r\n\t\t\tif (fldType == jslet.data.DataType.DATE) {\r\n\t\t\t\tregular = fldObj.dateRegular();\r\n\t\t\t} else {\r\n\t\t\t\tif (fldType == jslet.data.DataType.NUMBER) {\r\n\t\t\t\t\tif (!this.intRegular.message) {\r\n\t\t\t\t\t\tthis.intRegular.message = jslet.locale.Dataset.invalidInt;\r\n\t\t\t\t\t\tthis.floatRegular.message = jslet.locale.Dataset.invalidFloat;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (!fldObj.scale()) {\r\n\t\t\t\t\t\tregular = this.intRegular;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tregular = this.floatRegular;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tif (regular) {\r\n\t\t\tvar regExpObj = regular.expr;\r\n\t\t\tif (typeof regExpObj == 'string') {\r\n\t\t\t\tregExpObj = new RegExp(regular.expr, 'ig');\r\n\t\t\t}\r\n\t\t\tregExpObj.lastIndex = 0;\r\n\t\t\tif (!regExpObj.test(inputText)) {\r\n\t\t\t\treturn this._addFieldLabel(fldObj.label(), regular.message);\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tvar value = inputText;\r\n\t\tif (!fldObj.lookup()) {//Not lookup field\r\n\t\t\tif (fldType == jslet.data.DataType.NUMBER) {\r\n\t\t\t\tvar scale = fldObj.scale() || 0;\r\n\t\t\t\tvar length = fldObj.length();\r\n\t\t\t\tif (scale === 0) {\r\n\t\t\t\t\tvalue = parseInt(inputText);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvar k = inputText.indexOf('.');\r\n\t\t\t\t\tvar actual = k > 0? k: inputText.length,\r\n\t\t\t\t\t\texpected = length - scale;\r\n\t\t\t\t\tif(actual > expected) {\r\n\t\t\t\t\t\treturn this._addFieldLabel(fldObj.label(), \r\n\t\t\t\t\t\t\t\tjslet.formatMessage(jslet.locale.Dataset.invalidIntegerPart, [expected, actual]));\r\n\t\t\t\t\t}\r\n\t\t\t\t\tactual = k > 0 ? inputText.length - k - 1: 0;\r\n\t\t\t\t\tif(actual > scale) {\r\n\t\t\t\t\t\treturn this._addFieldLabel(fldObj.label(), \r\n\t\t\t\t\t\t\t\tjslet.formatMessage(jslet.locale.Dataset.invalidDecimalPart, [scale, actual]));\r\n\t\t\t\t\t}\r\n\t\t\t\t\tvalue = parseFloat(inputText);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (fldType == jslet.data.DataType.DATE) {// Date convert\r\n\t\t\t\tvalue = jslet.parseDate(inputText, fldObj.displayFormat());\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\treturn this.checkValue(fldObj, value);\r\n\t},\r\n\t\r\n\t_addFieldLabel: function(fldLabel, errMsg) {\r\n\t\treturn '[' + fldLabel + ']: ' + errMsg;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Check the required field's value is empty or not\r\n\t * \r\n\t * @param {jslet.data.Field} fldObj Field Object\r\n\t * @param {Object} value field value.\r\n\t * @return {String} If input text is valid, return null, otherwise return error message.\r\n\t */\r\n\tcheckRequired: function(fldObj, value) {\r\n\t\tif (fldObj.required()) {\r\n\t\t\tvar valid = true;\r\n\t\t\tif (value === null || value === undefined) {\r\n\t\t\t\tvalid = false;\r\n\t\t\t}\r\n\t\t\tif(valid && jslet.isString(value) && jQuery.trim(value).length === 0) {\r\n\t\t\t\tvalid = false;\r\n\t\t\t}\r\n\t\t\tif(valid && jslet.isArray(value) && value.length === 0) {\r\n\t\t\t\tvalid = false;\r\n\t\t\t}\r\n\t\t\tif(fldObj.getType() === jslet.data.DataType.BOOLEAN && !value) {\r\n\t\t\t\tvalid = false;\r\n\t\t\t}\r\n\t\t\tif(!valid) {\r\n\t\t\t\treturn this._addFieldLabel(fldObj.label(), jslet.formatMessage(jslet.locale.Dataset.fieldValueRequired));\r\n\t\t\t} else {\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn null;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Check the specified field value is valid or not\r\n\t * It will check required, range and custom validation\r\n\t * \r\n\t * @param {jslet.data.Field} fldObj Field Object\r\n\t * @param {Object} value field value. \r\n\t * @return {String} If input text is valid, return null, otherwise return error message.\r\n\t */\r\n\tcheckValue: function(fldObj, value) {\r\n\t\tvar fldType = fldObj.getType();\r\n\t\t//Check range\r\n\t\tvar fldRange = fldObj.dataRange(),\r\n\t\t\thasLookup = fldObj.lookup()? true: false;\r\n\t\t\r\n\t\tif (hasLookup) {//lookup field need compare code value of the Lookup\r\n\t\t\tvalue = fldObj.dataset().getFieldText(fldObj.name(), true);\r\n\t\t}\r\n\t\t\t\r\n\t\tif (fldRange) {\r\n\t\t\tvar min = fldRange.min,\r\n\t\t\t\tstrMin = min,\r\n\t\t\t\tmax = fldRange.max,\r\n\t\t\t\tstrMax = max;\r\n\t\t\tvar fmt = fldObj.displayFormat();\r\n\t\t\t\r\n\t\t\tif (fldType == jslet.data.DataType.DATE) {\r\n\t\t\t\tif (min) {\r\n\t\t\t\t\tstrMin = jslet.formatDate(min, fmt);\r\n\t\t\t\t}\r\n\t\t\t\tif (max) {\r\n\t\t\t\t\tstrMax = jslet.formatDate(max, fmt);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif (!hasLookup && fldType == jslet.data.DataType.NUMBER) {\r\n\t\t\t\tstrMin = jslet.formatNumber(min, fmt);\r\n\t\t\t\tstrMax = jslet.formatNumber(max, fmt);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif (min !== undefined && max !== undefined && (value < min || value > max)) {\r\n\t\t\t\treturn this._addFieldLabel(fldObj.label(), \r\n\t\t\t\t\t\tjslet.formatMessage(jslet.locale.Dataset.notInRange, [strMin, strMax]));\r\n\t\t\t}\r\n\t\t\tif (min !== undefined && max === undefined && value < min) {\r\n\t\t\t\treturn this._addFieldLabel(fldObj.label(), \r\n\t\t\t\t\t\tjslet.formatMessage(jslet.locale.Dataset.moreThanValue, [strMin]));\r\n\t\t\t}\r\n\t\t\tif (min === undefined && max !== undefined && value > max) {\r\n\t\t\t\treturn this._addFieldLabel(fldObj.label(), \r\n\t\t\t\t\t\tjslet.formatMessage(jslet.locale.Dataset.lessThanValue, [strMax]));\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\t//Check unique in local data, if need check at server side, use 'customValidator' instead.\r\n\t\tif(fldObj.unique()) {\r\n\t\t\tvar currDs = fldObj.dataset(),\r\n\t\t\t\tdataList = currDs.dataList();\r\n\t\t\t\r\n\t\t\tif(value !== null && value !== undefined && dataList && dataList.length > 1) {\r\n\t\t\t\tvar currRec = currDs.getRecord(), \r\n\t\t\t\t\tfldName = fldObj.name(),\r\n\t\t\t\t\trec;\r\n\t\t\t\tfor(var i = 0, len = dataList.length; i < len; i++) {\r\n\t\t\t\t\trec = dataList[i];\r\n\t\t\t\t\tif(rec === currRec) {\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif(rec[fldName] == value) {\r\n\t\t\t\t\t\treturn this._addFieldLabel(fldObj.label(), jslet.locale.Dataset.notUnique);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t//Customized validation\r\n\t\tif (fldObj.customValidator()) {\r\n\t\t\tvar msg = fldObj.customValidator().call(fldObj.dataset(), fldObj, value, jslet.data.serverValidator);\r\n\t\t\tif(msg) {\r\n\t\t\t\treturn this._addFieldLabel(fldObj.label(), msg);\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\treturn null;\r\n\t}\r\n};\r\n\r\n/**\r\n * The common function to validate data at server side.\r\n * \r\n * @param {String} url - Validating url to connect to server.\r\n * @param {Object} reqData - request data to post to server to validate.\r\n */\r\njslet.data.serverValidator = function(url, reqData) {\r\n\tvar ajaxSetting;\r\n\tif(jslet.global.beforeSubmit) {\r\n\t\tajaxSetting = jslet.global.beforeSubmit({url: url});\r\n\t}\r\n\tif(!ajaxSetting) {\r\n\t\tajaxSetting = {};\r\n\t}\r\n\tajaxSetting.type = 'POST';\r\n\tajaxSetting.async = false;\r\n\tajaxSetting.contentType = 'application/json';\r\n\tajaxSetting.mimeType = 'application/json';\r\n\tajaxSetting.dataType = 'json';\r\n\tif(typeof reqData === 'object') {\r\n\t\treqData = jslet.JSON.stringify(reqData);\r\n\t}\r\n\tajaxSetting.data = reqData;\r\n\tvar result = null;\r\n\tjQuery.ajax(url, ajaxSetting)\r\n\t.done(function(data, textStatus, jqXHR) {\r\n\t\tif(data) {\r\n\t\t\tvar errorCode = data.errorCode;\r\n\t\t\tif (errorCode) {\r\n\t\t\t\tresult = data.errorMessage;\r\n\t\t\t} else {\r\n\t\t\t\tif(jslet.isString(data)) {\r\n\t\t\t\t\tresult = data;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tresult = data.result;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tresult = null;\r\n\t\t}\r\n\t})\r\n\t.fail(function( jqXHR, textStatus, errorThrown ) {\r\n\t\tvar data = jqXHR.responseJSON,\r\n\t\t\tresult;\r\n\t\tif(data && data.errorCode) {\r\n\t\t\tresult = data.errorMessage;\r\n\t\t} else {\r\n\t\t\tvar errorCode = textStatus,\r\n\t\t\t\terrorMessage = textStatus;\r\n\t\t\tif(textStatus == 'error') {\r\n\t\t\t\terrorCode = '0000';\r\n\t\t\t\terrorMessage = jslet.locale.Common.ConnectError;\r\n\t\t\t}\r\n\t\t\tresult = errorMessage;\r\n\t\t}\r\n\t});\r\n\treturn result;\r\n};\r\n\r\n/*Start of field value converter*/\r\njslet.data.FieldValueConverter = jslet.Class.create({\r\n\tclassName: 'jslet.data.FieldValueConverter',\r\n\t\r\n\ttextToValue: function(fldObj, inputText) {\r\n\t\tvar value = inputText;\r\n\t\treturn value;\r\n\t},\r\n\t\r\n\tvalueToText: function(fldObj, value, isEditing) {\r\n\t\tvar text = value;\r\n\t\treturn text;\r\n\t}\r\n});\r\njslet.data.FieldValueConverter.className = 'jslet.data.FieldValueConverter';\r\n\r\njslet.data.NumberValueConverter = jslet.Class.create(jslet.data.FieldValueConverter, {\r\n\ttextToValue: function(fldObj, inputText) {\r\n\t\tvar value = null;\r\n\t\tif (inputText) {\r\n\t\t\tif (fldObj.scale() === 0) {\r\n\t\t\t\tvalue = parseInt(inputText);\r\n\t\t\t} else {\r\n\t\t\t\tvalue = parseFloat(inputText);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn value;\r\n\t},\r\n\r\n\tvalueToText: function(fldObj, value, isEditing) {\r\n\t\tvar dataset = fldObj.dataset();\r\n\t\tif (fldObj.unitConverted()) {\r\n\t\t\tvalue = value * dataset._unitConvertFactor;\r\n\t\t}\r\n\r\n\t\tif (!isEditing) {\r\n\t\t\tvar rtnText = jslet.formatNumber(value, fldObj.displayFormat());\r\n\t\t\tif (fldObj.unitConverted() && dataset._unitName) {\r\n\t\t\t\trtnText += dataset._unitName;\r\n\t\t\t}\r\n\t\t\treturn rtnText;\r\n\t\t} else {\r\n\t\t\treturn value;\r\n\t\t}\r\n\t}\r\n});\r\n\r\njslet.data.DateValueConverter = jslet.Class.create(jslet.data.FieldValueConverter, {\r\n\ttextToValue: function(fldObj, inputText) {\r\n\t\tvar value = jslet.parseDate(inputText, fldObj.displayFormat());\r\n\t\treturn value; \r\n\t},\r\n\t\r\n\tvalueToText: function(fldObj, value, isEditing) {\r\n\t\tif (!(value instanceof Date)) {\r\n\t\t\t//Invalid value: [{1}] for DATE field: [{0}]!\r\n\t\t\tthrow new Error(jslet.formatMessage(jslet.locale.Dataset.invalidDateFieldValue, [fldObj.name(), value]));\r\n\t\t}\r\n\r\n\t\treturn value ? jslet.formatDate(value, fldObj.displayFormat()): '';\r\n\t}\r\n});\r\n\r\njslet.data.StringValueConverter = jslet.Class.create(jslet.data.FieldValueConverter, {\r\n\ttextToValue: function(fldObj, inputText) {\r\n\t\tvar value = inputText;\r\n\t\tif (fldObj.antiXss()) {\r\n\t\t\tvalue = jslet.htmlEncode(value);\r\n\t\t}\r\n\t\treturn value;\r\n\t},\r\n\t\r\n\tvalueToText: function(fldObj, value, isEditing) {\r\n\t\tvar dataset = fldObj.dataset(),\r\n\t\t\tdispFmt = fldObj.displayFormat();\r\n\t\tif (!isEditing && dispFmt) {\r\n\t\t\treturn jslet.formatString(value, dispFmt);\r\n\t\t} else {\r\n\t\t\treturn value;\r\n\t\t}\r\n\t}\r\n\t\r\n});\r\n\r\njslet.data.BooleanValueConverter = jslet.Class.create(jslet.data.FieldValueConverter, {\r\n\ttextToValue: function(fldObj, inputText) {\r\n\t\tif(!inputText) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\treturn inputText.toLowerCase() == 'true';\r\n\t},\r\n\t\r\n\tvalueToText: function(fldObj, value, isEditing) {\r\n\t\treturn value ? fldObj.trueText(): fldObj.falseText();\r\n\t}\r\n});\r\n\r\njslet.data.LookupValueConverter = jslet.Class.create(jslet.data.FieldValueConverter, {\r\n\ttextToValue: function(fldObj, inputText, valueIndex) {\r\n\t\tif(!inputText) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\tvar value = '',\r\n\t\t\tlkFldObj = fldObj.lookup(),\r\n\t\t\tdsLookup = lkFldObj.dataset(),\r\n\t\t\tkeyFldName = lkFldObj.keyField(),\r\n\t\t\tcodeFldName = lkFldObj.codeField(),\r\n\t\t\tnameFldName = lkFldObj.nameField();\r\n\t\t\r\n\t\tvalue = this._convertFieldValue(dsLookup, codeFldName, inputText, keyFldName);\r\n\t\tif (value === null) {\r\n\t\t\tif(nameFldName !== codeFldName) {\r\n\t\t\t\tvalue = this._convertFieldValue(dsLookup, nameFldName, inputText, keyFldName);\r\n\t\t\t}\r\n\t\t\tif (value === null) {\r\n\t\t\t\tvar invalidMsg = jslet.formatMessage(jslet.locale.Dataset.valueNotFound);\r\n\t\t\t\tfldObj.dataset().setFieldError(fldObj.name(), invalidMsg, valueIndex, inputText);\r\n\t\t\t\tdsLookup.first();\r\n\t\t\t\treturn undefined;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn value;\r\n\t},\r\n\t\r\n\tvalueToText: function(fldObj, value, isEditing) {\r\n\t\tvar lkFldObj = fldObj.lookup(),\r\n\t\t\tdsLookup = lkFldObj.dataset(),\r\n\t\t\tresult;\r\n\t\tif (!isEditing) {\r\n\t\t\tresult = this._convertFieldValue(dsLookup, lkFldObj.keyField(), value,\r\n\t\t\t\t\tlkFldObj.displayFields());\r\n\t\t} else {\r\n\t\t\tresult = this._convertFieldValue(dsLookup, lkFldObj.keyField(), value, \r\n\t\t\t\t\t'[' + lkFldObj.codeField() + ']');\r\n\t\t}\r\n\t\treturn result;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @private\r\n\t */\r\n\t_convertFieldValue: function (dsLookup, srcField, srcValues, destFields) {\r\n\t\tif (destFields === null) {\r\n\t\t\tthrow new Error('NOT set destFields in method: ConvertFieldValue');\r\n\t\t}\r\n\t\tvar isExpr = destFields.indexOf('[') > -1;\r\n\t\tif (isExpr) {\r\n\t\t\tif (destFields != dsLookup._convertDestFields) {\r\n\t\t\t\tdsLookup._innerConvertDestFields = new jslet.Expression(dsLookup,\r\n\t\t\t\t\t\tdestFields);\r\n\t\t\t\tdsLookup._convertDestFields = destFields;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (typeof (srcValues) != 'string') {\r\n\t\t\tsrcValues += '';\r\n\t\t}\r\n\t\tvar separator = jslet.global.valueSeparator;\r\n\t\tvar values = srcValues.split(separator), valueCnt = values.length - 1;\r\n\t\tdsLookup._ignoreFilter = true;\r\n\t\ttry {\r\n\t\t\tif (valueCnt === 0) {\r\n\t\t\t\tif (!dsLookup.findByField(srcField, values[0])) {\r\n\t\t\t\t\treturn null;\r\n\t\t\t\t}\r\n\t\t\t\tif (isExpr) {\r\n\t\t\t\t\treturn dsLookup._innerConvertDestFields.eval();\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn dsLookup.getFieldValue(destFields);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\r\n\t\t\tvar fldcnt, destValue = '';\r\n\t\t\tfor (var i = 0; i <= valueCnt; i++) {\r\n\t\t\t\tif (!dsLookup.findByField(srcField, values[i])) {\r\n\t\t\t\t\treturn null;\r\n\t\t\t\t}\r\n\t\t\t\tif (isExpr) {\r\n\t\t\t\t\tdestValue += dsLookup._innerConvertDestFields.eval();\r\n\t\t\t\t} else {\r\n\t\t\t\t\tdestValue += dsLookup.getFieldValue(destFields);\r\n\t\t\t\t}\r\n\t\t\t\tif (i != valueCnt) {\r\n\t\t\t\t\tdestValue += separator;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn destValue;\r\n\t\t} finally {\r\n\t\t\tdsLookup._ignoreFilter = false;\r\n\t\t}\r\n\t}\r\n\t\r\n});\r\n\r\njslet.data._valueConverters = {};\r\njslet.data._valueConverters[jslet.data.DataType.NUMBER] = new jslet.data.NumberValueConverter();\r\njslet.data._valueConverters[jslet.data.DataType.STRING] = new jslet.data.StringValueConverter();\r\njslet.data._valueConverters[jslet.data.DataType.DATE] = new jslet.data.DateValueConverter();\r\njslet.data._valueConverters[jslet.data.DataType.BOOLEAN] = new jslet.data.BooleanValueConverter();\r\n\r\njslet.data._valueConverters.lookup = new jslet.data.LookupValueConverter();\r\n\r\n/**\r\n * Get appropriate field value converter.\r\n * \r\n * @param {jslet.data.Field} fldObj field object.\r\n * \r\n * @return {jslet.data.FieldValueConverter} field value converter;\r\n */\r\njslet.data.getValueConverter = function(fldObj) {\r\n\tif(fldObj.lookup()) {\r\n\t\treturn jslet.data._valueConverters.lookup;\r\n\t}\r\n\tvar dataType = fldObj.getType();\r\n\treturn jslet.data._valueConverters[dataType];\r\n};\r\n/* End of field value converter */\r\n\r\n/**\r\n * Convert dataset record to json.\r\n * \r\n * @param {Array of Object} records Dataset records, required.\r\n * @param {Array of String} excludeFields Excluded field names,optional.\r\n * \r\n * @return {String} Json String. \r\n */\r\njslet.data.record2Json = function(records, excludeFields) {\r\n\tfunction record2JsonFilter(key, value) {\r\n\t\tif(key == '_jl_') {\r\n\t\t\treturn undefined;\r\n\t\t}\r\n\t\tif(excludeFields) {\r\n\t\t\tvar fldName;\r\n\t\t\tfor(var i = 0, len = excludeFields.length; i < len; i++) {\r\n\t\t\t\tfldName = excludeFields[i];\r\n\t\t\t\tif(key == fldName) {\r\n\t\t\t\t\treturn undefined;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn value;\t\t\r\n\t}\r\n\t\r\n\tif(!window.JSON || !JSON) {\r\n\t\tconsole.error('Your browser does not support JSON!');\r\n\t\treturn;\r\n\t}\r\n\tif(excludeFields) {\r\n\t\tjslet.Checker.test('record2Json#excludeFields', excludeFields).isArray();\t\t\r\n\t}\r\n\t\r\n\treturn JSON.stringify(records, record2JsonFilter);\r\n};\r\n\r\njslet.data.getRecInfo = function(record) {\r\n\tjslet.Checker.test('jslet.data.getRecInfo#record', record).required();\r\n\tvar recInfo = record._jl_;\r\n\tif(!recInfo) {\r\n\t\trecInfo = {};\r\n\t\trecord._jl_ = recInfo;\r\n\t}\r\n\treturn recInfo;\r\n};\r\n\r\n/*Field value cache manager*/\r\njslet.data.FieldValueCache = {\r\n\t\r\n\tput: function(record, fieldName, value, valueIndex) {\r\n\t\tvar recInfo = jslet.data.getRecInfo(record), \r\n\t\t\tcacheObj = recInfo.cache;\r\n\t\tif(!cacheObj) {\r\n\t\t\tcacheObj = {};\r\n\t\t\trecord._jl_.cache = cacheObj;\r\n\t\t}\r\n\t\tif(valueIndex || valueIndex === 0) {\r\n\t\t\tvar fldCacheObj = cacheObj[fieldName];\r\n\t\t\tif(!fldCacheObj || !jslet.isObject(fldCacheObj)){\r\n\t\t\t\tfldCacheObj = {};\r\n\t\t\t\tcacheObj[fieldName] = fldCacheObj;\r\n\t\t\t}\r\n\t\t\tfldCacheObj[valueIndex+\"\"] = value;\r\n\t\t} else {\r\n\t\t\tcacheObj[fieldName] = value;\r\n\t\t}\r\n\t},\r\n\t\r\n\tget: function(record, fieldName, valueIndex) {\r\n\t\tvar recInfo = jslet.data.getRecInfo(record), \r\n\t\t\tcacheObj = recInfo.cache;\r\n\t\tif(cacheObj) {\r\n\t\t\tif(valueIndex || valueIndex === 0) {\r\n\t\t\t\tvar fldCacheObj = cacheObj[fieldName];\r\n\t\t\t\tif(fldCacheObj && jslet.isObject(fldCacheObj)){\r\n\t\t\t\t\treturn fldCacheObj[valueIndex+\"\"];\r\n\t\t\t\t}\r\n\t\t\t\treturn undefined;\r\n\t\t\t} else {\r\n\t\t\t\treturn cacheObj[fieldName];\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\treturn undefined;\r\n\t\t}\r\n\t},\r\n\t\r\n\tclear: function(record, fieldNameOrArray) {\r\n\t\tvar recInfo = jslet.data.getRecInfo(record), \r\n\t\t\tcacheObj = recInfo.cache;\r\n\t\tif(cacheObj) {\r\n\t\t\tvar arrFldNames;\r\n\t\t\tif(jslet.isString(fieldNameOrArray)) {\r\n\t\t\t\tarrFldNames = fieldNameOrArray.split(',');\r\n\t\t\t} else {\r\n\t\t\t\tarrFldNames = fieldNameOrArray;\r\n\t\t\t}\r\n\t\t\tvar j, fldCnt = arrFldNames.length;\r\n\t\t\tfor(j = 0; j < fldCnt; j++) {\r\n\t\t\t\tdelete cacheObj[arrFldNames[j]];\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t\r\n\tclearAll: function(dataset, fieldNameOrArray) {\r\n\t\tvar dataList = dataset.dataList();\r\n\t\tif(!dataList) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar arrFldNames;\r\n\t\tif(jslet.isString(fieldNameOrArray)) {\r\n\t\t\tarrFldNames = fieldNameOrArray.split(',');\r\n\t\t} else {\r\n\t\t\tarrFldNames = fieldNameOrArray;\r\n\t\t}\r\n\t\tvar rec, cacheObj, recInfo, j, fldCnt = arrFldNames.length;\r\n\t\tfor(var i = 0, len = dataList.length; i < len; i++) {\r\n\t\t\trec = dataList[i];\r\n\t\t\trecInfo = jslet.data.getRecInfo(rec);\r\n\t\t\tcacheObj = recInfo.cache;\r\n\t\t\tif(cacheObj) {\r\n\t\t\t\tfor(j = 0; j < fldCnt; j++) {\r\n\t\t\t\t\tdelete cacheObj[arrFldNames[j]];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t\r\n\tremoveCache: function(record) {\r\n\t\tvar recInfo = jslet.data.getRecInfo(record);\r\n\t\tdelete recInfo.cache;\r\n\t},\r\n\t\r\n\tremoveAllCache: function(dataset) {\r\n\t\tvar dataList = dataset.dataList();\r\n\t\tif(!dataList) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar rec, cacheObj, recInfo;\r\n\t\tfor(var i = 0, len = dataList.length; i < len; i++) {\r\n\t\t\trec = dataList[i];\r\n\t\t\tif(!rec) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\trecInfo = jslet.data.getRecInfo(rec); \r\n\t\t\tdelete recInfo.cache;\r\n\t\t}\r\n\t}\r\n};\r\n/*End of field value cache manager*/\r\n\r\n/*Field value cache manager*/\r\njslet.data.FieldError = {\r\n\t\r\n\tput: function(record, fldName, errorMsg, valueIndex, inputText) {\r\n\t\tif(!errorMsg) {\r\n\t\t\tjslet.data.FieldError.clear(record, fldName, valueIndex);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar recInfo = jslet.data.getRecInfo(record), \r\n\t\t\terrObj = recInfo.error;\r\n\t\tif(!errObj) {\r\n\t\t\terrObj = {};\r\n\t\t\trecInfo.error = errObj;\r\n\t\t}\r\n\t\tvar fldErrObj = errObj[fldName];\r\n\t\tif(!fldErrObj) {\r\n\t\t\tfldErrObj = {};\r\n\t\t\terrObj[fldName] = fldErrObj;\r\n\t\t}\r\n\t\tvar errMsgObj = {message: errorMsg};\r\n\t\tif(inputText !== undefined) {\r\n\t\t\terrMsgObj.inputText = inputText;\r\n\t\t}\r\n\t\tif(!valueIndex) {\r\n\t\t\tvalueIndex = 0;\r\n\t\t}\r\n\t\tfldErrObj[valueIndex+\"\"] = errMsgObj;\r\n\t},\r\n\t\r\n\tputDetailError: function(record, fldName, errorCount) {\r\n\t\tvar recInfo = jslet.data.getRecInfo(record), \r\n\t\t\terrObj = recInfo.error;\r\n\t\tif(!errObj) {\r\n\t\t\terrObj = {};\r\n\t\t\trecInfo.error = errObj;\r\n\t\t}\r\n\t\tvar fldErrObj = errObj[fldName];\r\n\t\tif(!fldErrObj) {\r\n\t\t\tfldErrObj = {};\r\n\t\t\terrObj[fldName] = fldErrObj;\r\n\t\t}\r\n\t\tvar errMsgObj = fldErrObj[\"0\"];\r\n\t\tif(!errMsgObj) {\r\n\t\t\terrMsgObj = {errorCount: 0};\r\n\t\t\tfldErrObj[\"0\"] = errMsgObj;\r\n\t\t}\r\n\t\terrMsgObj.errorCount += errorCount;\r\n\t\tif(errMsgObj.errorCount <= 0) {\r\n\t\t\tjslet.data.FieldError.clear(record, fldName);\r\n\t\t}\r\n\t\t\r\n\t},\r\n\t\r\n\tget: function(record, fldName, valueIndex) {\r\n\t\tvar recInfo = jslet.data.getRecInfo(record), \r\n\t\t\terrObj = recInfo.error;\r\n\t\tif(errObj) {\r\n\t\t\tvar fldErrObj = errObj[fldName];\r\n\t\t\tif(!fldErrObj) {\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\t\t\tif(!valueIndex) {\r\n\t\t\t\tvalueIndex = 0;\r\n\t\t\t}\r\n\t\t\treturn fldErrObj[valueIndex+\"\"];\r\n\t\t} else {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t},\r\n\t\r\n\tclear: function(record, fldName, valueIndex) {\r\n\t\tvar recInfo = jslet.data.getRecInfo(record), \r\n\t\t\terrObj = recInfo.error;\r\n\t\tif(errObj) {\r\n\t\t\tvar fldErrObj = errObj[fldName];\r\n\t\t\tif(!fldErrObj) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tif(!valueIndex) {\r\n\t\t\t\tvalueIndex = 0;\r\n\t\t\t}\r\n\t\t\tdelete fldErrObj[valueIndex+\"\"];\r\n\t\t\tvar found = false;\r\n\t\t\tfor(var idx in fldErrObj) {\r\n\t\t\t\tfound = true;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tif(!found) {\r\n\t\t\t\tdelete errObj[fldName];\r\n\t\t\t} \r\n\t\t}\r\n\t},\r\n\t\r\n\texistFieldError: function(record, fldName, valueIndex) {\r\n\t\tvar recInfo = jslet.data.getRecInfo(record), \r\n\t\terrObj = recInfo.error;\r\n\t\tif(errObj) {\r\n\t\t\tvar fldErrObj = errObj[fldName];\r\n\t\t\tif(!fldErrObj){\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\tif(!valueIndex) {\r\n\t\t\t\tvalueIndex = 0;\r\n\t\t\t}\r\n\t\t\treturn fldErrObj[valueIndex+\"\"] ? true: false;\r\n\t\t}\r\n\t\treturn false;\r\n\t},\r\n\t\r\n\texistRecordError: function(record, checkingFields) {\r\n\t\tvar recInfo = jslet.data.getRecInfo(record);\r\n\t\tif(!recInfo) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tvar errObj = recInfo.error;\r\n\t\tif(errObj) {\r\n\t\t\tfor(var fldName in errObj) {\r\n\t\t\t\tif(checkingFields && checkingFields.indexOf(fldName) < 0) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\tif(errObj[fldName]) {\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t},\r\n\t\r\n\tgetFirstErrorField: function(record, checkingFields) {\r\n\t\tvar recInfo = jslet.data.getRecInfo(record);\r\n\t\tif(!recInfo) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tvar errObj = recInfo.error;\r\n\t\tif(errObj) {\r\n\t\t\tfor(var fldName in errObj) {\r\n\t\t\t\tif(checkingFields && checkingFields.indexOf(fldName) < 0) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\tif(errObj[fldName]) {\r\n\t\t\t\t\treturn fldName;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn null;\r\n\t},\r\n\t\r\n\tclearFieldError: function(dataset, fldName) {\r\n\t\tvar dataList = dataset.dataList();\r\n\t\tif(!dataList) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar rec, errObj, recInfo;\r\n\t\tfor(var i = 0, len = dataList.length; i < len; i++) {\r\n\t\t\trec = dataList[i];\r\n\t\t\trecInfo = jslet.data.getRecInfo(rec);\r\n\t\t\terrObj = recInfo.error;\r\n\t\t\tif(errObj) {\r\n\t\t\t\tdelete errObj[fldName];\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t\r\n\tclearRecordError: function(record) {\r\n\t\tvar recInfo = jslet.data.getRecInfo(record);\r\n\t\tif(recInfo) {\r\n\t\t\tdelete recInfo.error;\r\n\t\t}\r\n\t},\r\n\t\r\n\tclearDatasetError: function(dataset) {\r\n\t\tvar dataList = dataset.dataList();\r\n\t\tif(!dataList) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar rec, errObj, recInfo;\r\n\t\tfor(var i = 0, len = dataList.length; i < len; i++) {\r\n\t\t\trec = dataList[i];\r\n\t\t\trecInfo = jslet.data.getRecInfo(rec);\r\n\t\t\tif(recInfo) {\r\n\t\t\t\tdelete recInfo.error;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n};\r\n/*End of field value error manager*/\r\n\r\njslet.data.FieldRawValueAccessor = {\r\n\tgetRawValue: function(dataRec, fldObj) {\r\n\t\tvar fldName = fldObj.shortName() || fldObj.name(),\r\n\t\t\tcustomValueAccessor = fldObj.customValueAccessor();\r\n\t\t\r\n\t\tvar fldType = fldObj.getType(), \r\n\t\t\tvalue = this._innerGetValue(dataRec, fldName, customValueAccessor);\r\n\t\t\r\n\t\tif(value === undefined || value === null) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\tif(fldType === jslet.data.DataType.BOOLEAN) {\r\n\t\t\treturn value === fldObj.trueValue();\r\n\t\t}\r\n\t\t\r\n\t\tif(fldType === jslet.data.DataType.PROXY) {\r\n\t\t\treturn jslet.JSON.parse(value);\r\n\t\t}\r\n\r\n\t\tif(fldType === jslet.data.DataType.DATE) {\r\n\t\t\tvar flag = false;\r\n\t\t\tif(jslet.isArray(value)) {\r\n\t\t\t\tfor(var i = 0, len = value.length; i < len; i++) {\r\n\t\t\t\t\tvar val = value[i];\r\n\t\t\t\t\tif (!jslet.isDate(val)) {\r\n\t\t\t\t\t\tval = jslet.convertISODate(val);\r\n\t\t\t\t\t\tvalue[i] = val;\r\n\t\t\t\t\t\tflag = true;\r\n\t\t\t\t\t} //end if\r\n\t\t\t\t\t\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tif (!jslet.isDate(value)) {\r\n\t\t\t\t\tvalue = jslet.convertISODate(value);\r\n\t\t\t\t\tflag = true;\r\n\t\t\t\t} //end if\r\n\t\t\t}\r\n\t\t\tif(flag) {\r\n\t\t\t\tthis._innerSetValue(dataRec, fldName, value, customValueAccessor);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn value;\r\n\t},\r\n\t\r\n\tsetRawValue: function(dataRec, fldObj, value) {\r\n\t\tvar fldName = fldObj.shortName() || fldObj.name(),\r\n\t\t\tcustomValueAccessor = fldObj.customValueAccessor();\r\n\t\t\r\n\t\tvar fldType = fldObj.getType();\r\n\t\t\r\n\t\tif(value === undefined || value === null) {\r\n\t\t\tthis._innerSetValue(dataRec, fldName, null, customValueAccessor);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif(fldType === jslet.data.DataType.BOOLEAN) {\r\n\t\t\tvalue = (value? fldObj.trueValue(): fldObj.falseValue());\r\n\t\t}\r\n\t\t\r\n\t\tif(fldType === jslet.data.DataType.PROXY) {\r\n\t\t\tvalue = jslet.JSON.stringify(value);\r\n\t\t}\r\n\t\tthis._innerSetValue(dataRec, fldName, value, customValueAccessor);\r\n\t},\r\n\t\r\n\t_innerGetValue: function(dataRec, fldName, customValueAccessor) {\r\n\t\tif(customValueAccessor) {\r\n\t\t\treturn customValueAccessor.getValue(dataRec, fldName);\r\n\t\t} else {\r\n\t\t\treturn dataRec[fldName];\r\n\t\t}\r\n\t},\r\n\t\r\n\t_innerSetValue:  function(dataRec, fldName, value, customValueAccessor) {\r\n\t\tif(customValueAccessor) {\r\n\t\t\treturn customValueAccessor.setValue(dataRec, fldName, value);\r\n\t\t} else {\r\n\t\t\tdataRec[fldName] = value;\r\n\t\t}\r\n\t}\r\n};\r\n\r\njslet.data.DatasetRelationManager = function() {\r\n\tvar relations= [];\r\n\t\r\n\t/**\r\n\t * Add dataset relation.\r\n\t * \r\n\t * @param {String} hostDsName host dataset name;\r\n\t * @param {String} hostFldName field name of host dataset;\r\n\t * @param {String} lookupOrDetailDsName lookup or detail dataset name;\r\n\t * @param {jslet.data.DatasetType} relationType, optional value: jslet.data.DatasetType.LOOKUP, jslet.data.DatasetType.DETAIL\r\n\t */\r\n\tthis.addRelation = function(hostDsName, hostFldName, lookupOrDetailDsName, relationType) {\r\n\t\tfor(var i = 0, len = relations.length; i < len; i++) {\r\n\t\t\tvar relation = relations[i];\r\n\t\t\tif(relation.hostDataset == hostDsName && \r\n\t\t\t\trelation.hostField == hostFldName && \r\n\t\t\t\trelation.lookupDataset == lookupOrDetailDsName) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\t\trelations.push({hostDataset: hostDsName, hostField: hostFldName, lookupOrDetailDataset: lookupOrDetailDsName, relationType: relationType});\r\n\t};\r\n\t\r\n\tthis.removeRelation = function(hostDsName, hostFldName, lookupOrDetailDsName) {\r\n\t\tfor(var i = relations.length - 1; i >= 0; i--) {\r\n\t\t\tvar relation = relations[i];\r\n\t\t\tif(relation.hostDataset == hostDsName && \r\n\t\t\t\trelation.hostField == hostFldName && \r\n\t\t\t\trelation.lookupOrDetailDataset == lookupOrDetailDsName) {\r\n\t\t\t\trelations.splice(i,1);\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\t\r\n\tthis.removeDataset = function(datasetName) {\r\n\t\tfor(var i = relations.length - 1; i >= 0; i--) {\r\n\t\t\tvar relation = relations[i];\r\n\t\t\tif(relation.hostDataset == datasetName || relation.lookupOrDetailDataset == datasetName) {\r\n\t\t\t\trelations.splice(i,1);\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\t\r\n\tthis.changeDatasetName = function(oldName, newName) {\r\n\t\tif(!oldName || !newName) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tfor(var i = 0, len = relations.length; i < len; i++) {\r\n\t\t\tvar relation = relations[i];\r\n\t\t\tif(relation.hostDataset == oldName) {\r\n\t\t\t\trelation.hostDataset = newName;\r\n\t\t\t}\r\n\t\t\tif(relation.lookupOrDetailDataset == oldName) {\r\n\t\t\t\trelation.lookupOrDetailDataset = newName;\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\t\r\n\tthis.refreshLookupHostDataset = function(lookupDsName) {\r\n\t\tif(!lookupDsName) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar relation, hostDataset;\r\n\t\tfor(var i = 0, len = relations.length; i < len; i++) {\r\n\t\t\trelation = relations[i];\r\n\t\t\tif(relation.lookupOrDetailDataset == lookupDsName &&\r\n\t\t\t\trelation.relationType == jslet.data.DatasetType.LOOKUP) {\r\n\t\t\t\thostDataset = jslet.data.getDataset(relation.hostDataset);\r\n\t\t\t\tif(hostDataset) {\r\n\t\t\t\t\thostDataset.handleLookupDatasetChanged(relation.hostField);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthrow new Error('NOT found Host dataset: ' + relation.hostDataset);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\t\r\n\tthis.getHostFieldObject = function(lookupOrDetailDsName) {\r\n\t\tif(!lookupOrDetailDsName) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar relation, hostDataset;\r\n\t\tfor(var i = 0, len = relations.length; i < len; i++) {\r\n\t\t\trelation = relations[i];\r\n\t\t\tif(relation.lookupOrDetailDataset == lookupOrDetailDsName &&\r\n\t\t\t\trelation.relationType == jslet.data.DatasetType.DETAIL) {\r\n\t\t\t\thostDataset = jslet.data.getDataset(relation.hostDataset);\r\n\t\t\t\tif(hostDataset) {\r\n\t\t\t\t\treturn hostDataset.getField(relation.hostField);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthrow new Error('NOT found Host dataset: ' + relation.hostDataset);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} //end for i\t\r\n\t};\r\n};\r\njslet.data.datasetRelationManager = new jslet.data.DatasetRelationManager();\r\n\r\njslet.emptyPromise = {\r\n\tdone: function(callBackFn) {\r\n\t\tif(callBackFn) {\r\n\t\t\tcallBackFn();\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\tfail: function(callBackFn) {\r\n\t\tif(callBackFn) {\r\n\t\t\tcallBackFn();\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\talways: function(callBackFn) {\r\n\t\tif(callBackFn) {\r\n\t\t\tcallBackFn();\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n};\r\n\r\njslet.data.displayOrderComparator = function(fldObj1, fldObj2) {\r\n\tvar order1 = fldObj1.displayOrder();\r\n\tvar order2 = fldObj2.displayOrder();\r\n\treturn order1 - order2;\r\n};\r\n\r\n/**\r\n * Data selection class.\r\n */\r\njslet.data.DataSelection = function(dataset) {\r\n\tthis._dataset = dataset;\r\n\tthis._selection = [];\r\n\tthis._onChanged = null;\r\n};\r\n\r\njslet.data.DataSelection.prototype = {\r\n\t/**\r\n\t * Select all data.\r\n\t * \r\n\t * @param {String[]} fields An array of field name to be selected.\r\n\t * @param {Boolean} fireEvent Identify firing event or not.\r\n\t */\r\n\tselectAll: function(fields, fireEvent) {\r\n\t\tjslet.Checker.test('DataSelection.add#fields', fields).isArray();\r\n\t\tthis.removeAll();\r\n\t\tif(!fields) {\r\n\t\t\tvar arrFldObj = this._dataset.getNormalFields(), fldName;\r\n\t\t\tfields = [];\r\n\t\t\tfor(var i = 0, len = arrFldObj.length; i < len; i++) {\r\n\t\t\t\tfldName = arrFldObj[i].name();\r\n\t\t\t\tfields.push(fldName);\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.add(0, this._dataset.recordCount() - 1, fields, fireEvent);\r\n\t},\r\n\t\r\n\t/**\r\n\t * Remove all selected data.\r\n\t */\r\n\tremoveAll: function() {\r\n\t\tthis._selection = [];\r\n\t},\r\n\t\r\n\t/**\r\n\t * Add data into selection.\r\n\t * \r\n\t * @param {Integer} startRecno The start recno to be selected.\r\n\t * @param {Integer} endRecno The end recno to be selected.\r\n\t * @param {String[]} fields An array of field name to be selected.\r\n\t * @param {Boolean} fireEvent Identify firing event or not.\r\n\t */\r\n\tadd: function(startRecno, endRecno, fields, fireEvent) {\r\n\t\tjslet.Checker.test('DataSelection.add#startRecno', startRecno).required().isNumber();\r\n\t\tjslet.Checker.test('DataSelection.add#endRecno', endRecno).required().isNumber();\r\n\t\tjslet.Checker.test('DataSelection.add#fields', fields).required().isArray();\r\n\r\n\t\tif(endRecno === undefined) {\r\n\t\t\tendRecno = startRecno;\r\n\t\t}\r\n\t\tvar fldName;\r\n\t\tfor(var recno = startRecno; recno <= endRecno; recno++) {\r\n\t\t\tfor(var i = 0, len = fields.length; i < len; i++) {\r\n\t\t\t\tfldName = fields[i];\r\n\t\t\t\tthis._selectCell(recno, fldName, true);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(fireEvent && this._onChanged) {\r\n\t\t\tthis._onChanged(startRecno, endRecno, fields, true);\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * Unselect data.\r\n\t * \r\n\t * @param {Integer} startRecno The start recno to be unselected.\r\n\t * @param {Integer} endRecno The end recno to be selected.\r\n\t * @param {String[]} fields An array of field name to be unselected.\r\n\t * @param {Boolean} fireEvent Identify firing event or not.\r\n\t */\r\n\tremove: function(startRecno, endRecno, fields, fireEvent) {\r\n\t\tjslet.Checker.test('DataSelection.remove#startRecno', startRecno).required().isNumber();\r\n\t\tjslet.Checker.test('DataSelection.remove#endRecno', endRecno).required().isNumber();\r\n\t\tjslet.Checker.test('DataSelection.remove#fields', fields).required().isArray();\r\n\r\n\t\tif(endRecno === undefined) {\r\n\t\t\tendRecno = startRecno;\r\n\t\t}\r\n\t\tif(startRecno > endRecno) {\r\n\t\t\tvar tmp = startRecno;\r\n\t\t\tstartRecno = endRecno;\r\n\t\t\tendRecno = tmp;\r\n\t\t}\r\n\t\tvar fldName;\r\n\t\tfor(var recno = startRecno; recno <= endRecno; recno++) {\r\n\t\t\tfor(var i = 0, len = fields.length; i < len; i++) {\r\n\t\t\t\tfldName = fields[i];\r\n\t\t\t\tthis._selectCell(recno, fldName, false);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(fireEvent && this._onChanged) {\r\n\t\t\tthis._onChanged(startRecno, endRecno, fields, false);\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * Fired when the selection area is changed.\r\n\t * \r\n\t * @param {Function} onChanged The event handler, format:\r\n\t * \tfunction(startRecno, endRecno, fields, selected) {\r\n\t * \t\t//startRecno - Integer, start recno;\r\n\t * \t\t//endRecno - Integer, end recno;\r\n\t * \t\t//fields - String[], field names;\r\n\t * \t\t//selected - Boolean, selected or not;\t\r\n\t * \t}\r\n\t * \t\r\n\t */\r\n\tonChanged: function(onChanged) {\r\n\t\tif(onChanged === undefined) {\r\n\t\t\treturn this._onChanged;\r\n\t\t}\r\n\t\tjslet.Checker.test('DataSelection.onChanged', onChanged).isFunction();\r\n\t\tthis._onChanged = onChanged;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Check the specified cell is selected or not.\r\n\t * \r\n\t * @param {Integer} recno Record no.\r\n\t * @param {String} fldName Field name.\r\n\t * \r\n\t * @return {Boolean}\r\n\t */\r\n\tisSelected: function(recno, fldName) {\r\n\t\tjslet.Checker.test('DataSelection.isSelected#recno', recno).required().isNumber();\r\n\t\tjslet.Checker.test('DataSelection.isSelected#fldName', fldName).required().isString();\r\n\t\tvar selObj;\r\n\t\tfor(var i = 0, len = this._selection.length; i < len; i++) {\r\n\t\t\tselObj = this._selection[i];\r\n\t\t\tif(selObj._recno_ === recno && selObj[fldName]) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Get selected text.\r\n\t * \r\n\t * @param {String} seperator Seperator for fields.\r\n\t * \r\n\t * @return {String}\r\n\t */\r\n\tgetSelectionText: function(surround, encodeSpecialData, seperator) {\r\n\t\tif(!seperator) {\r\n\t\t\tseperator = '\\t';\r\n\t\t}\r\n\t\tsurround = surround? surround: '';\r\n\t\tencodeSpecialData = encodeSpecialData? true: false;\r\n\t\tvar dataset = this._dataset,\r\n\t\t\tresult = [], \r\n\t\t\tcontext = dataset.startSilenceMove(),\r\n\t\t\tfields = dataset.getNormalFields(),\r\n\t\t\tfldCnt = fields.length,\r\n\t\t\tfldName, textRec, fldObj, text, dataType;\r\n\t\ttry {\r\n\t\t\tdataset.first();\r\n\t\t\twhile(!dataset.isEof()) {\r\n\t\t\t\ttextRec = [];\r\n\t\t\t\tfor(var i = 0; i < fldCnt; i++) {\r\n\t\t\t\t\tfldObj = fields[i];\r\n\t\t\t\t\tfldName = fldObj.name();\r\n\t\t\t\t\tif(!this.isSelected(dataset.recno(), fldName)) {\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t//If Number field does not have lookup field, return field value, not field text. \r\n\t\t\t\t\t//Example: 'amount' field\r\n\t\t\t\t\tdataType = fldObj.getType();\r\n\t\t\t\t\tif(dataType === 'N' && !fldObj.lookup()) {\r\n\t\t\t\t\t\ttext = fldObj.getValue();\r\n\t\t\t\t\t\tif(text === null || text === undefined) {\r\n\t\t\t\t\t\t\ttext = '';\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\ttext = surround + text + surround;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\ttext = dataset.getFieldText(fldName);\r\n\t\t\t\t\t\tif(text === null || text === undefined) {\r\n\t\t\t\t\t\t\ttext = '\"\"';\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\ttext = text.replace(/\"/g,'\"\"');\r\n\t\t\t\t\t\t\tvar isStartZero = false;\r\n\t\t\t\t\t\t\tif(text.startsWith('0')) {\r\n\t\t\t\t\t\t\t\tisStartZero = true;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\ttext = surround + text + surround;\r\n\t\t\t\t\t\t\tif(encodeSpecialData && (isStartZero || dataType === jslet.data.DataType.DATE)) {\r\n\t\t\t\t\t\t\t\ttext = '=' + text;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\ttextRec.push(text); \r\n\t\t\t\t} //End for\r\n\t\t\t\tif(textRec.length > 0) {\r\n\t\t\t\t\tresult.push(textRec.join(seperator));\r\n\t\t\t\t}\r\n\t\t\t\tdataset.next(); \r\n\t\t\t} \r\n\t\t} finally { \r\n\t\t\tdataset.endSilenceMove(context); \r\n\t\t}\r\n\t\tif(result.length > 0) {\r\n\t\t\treturn result.join('\\n');\r\n\t\t} else {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t},\r\n\t\r\n\t_selectCell: function(recno, fldName, selected) {\r\n\t\tvar selObj,\r\n\t\t\tfound = false;\r\n\t\tfor(var i = 0, len = this._selection.length; i < len; i++) {\r\n\t\t\tselObj = this._selection[i];\r\n\t\t\tif(selObj._recno_ === recno) {\r\n\t\t\t\tfound = true;\r\n\t\t\t\tselObj[fldName] = selected;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(selected && !found) {\r\n\t\t\tselObj = {_recno_: recno};\r\n\t\t\tselObj[fldName] = true;\r\n\t\t\tthis._selection.push(selObj);\r\n\t\t}\r\n\t}\r\n};\r\n\r\njslet.data.GlobalDataHandler = function() {\r\n\tvar Z = this;\r\n\tZ._datasetMetaChanged = null;\r\n\tZ._fieldMetaChanged = null;\r\n\tZ._fieldValueChanged = null;\r\n};\r\n\r\njslet.data.GlobalDataHandler.prototype = {\r\n\t\t\r\n\t/**\r\n\t * Fired when dataset created.\r\n\t *  Pattern: \r\n\t *\tfunction(dataset}{}\r\n\t *  \t//dataset:{jslet.data.Dataset} Dataset Object\r\n\t *  \r\n\t * @param {Function or undefined} datasetCreated dataset created event handler.\r\n\t * @return {this or Function}\r\n\t */\r\n\tdatasetCreated: function(datasetCreated) {\r\n\t\tvar Z = this;\r\n\t\tif(datasetCreated === undefined) {\r\n\t\t\treturn Z._datasetCreated;\r\n\t\t}\r\n\t\tjslet.Checker.test('globalDataHandler.datasetCreated', datasetCreated).isFunction();\r\n\t\tZ._datasetCreated = datasetCreated;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Fired when dataset meta is changed.\r\n\t *  Pattern: \r\n\t *\tfunction(dataset, metaName}{}\r\n\t *  \t//dataset:{jslet.data.Dataset} Dataset Object\r\n\t *  \t//metaName: {String} dataset's meta name\r\n\t *  \r\n\t * @param {Function or undefined} datasetMetaChanged dataset meta changed event handler.\r\n\t * @return {this or Function}\r\n\t */\r\n\tdatasetMetaChanged: function(datasetMetaChanged) {\r\n\t\tvar Z = this;\r\n\t\tif(datasetMetaChanged === undefined) {\r\n\t\t\treturn Z._datasetMetaChanged;\r\n\t\t}\r\n\t\tjslet.Checker.test('globalDataHandler.datasetMetaChanged', datasetMetaChanged).isFunction();\r\n\t\tZ._datasetMetaChanged = datasetMetaChanged;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Fired when field meta is changed.\r\n\t *  Pattern: \r\n\t *\tfunction(dataset, fieldName, metaName}{}\r\n\t *  \t//dataset:{jslet.data.Dataset} Dataset Object\r\n\t *  \t//fieldName: {String} field name\r\n\t *  \t//metaName: {String} dataset's meta name\r\n\t *  \r\n\t * @param {Function or undefined} fieldMetaChanged dataset meta changed event handler.\r\n\t * @return {this or Function}\r\n\t */\r\n\tfieldMetaChanged: function(fieldMetaChanged) {\r\n\t\tvar Z = this;\r\n\t\tif(fieldMetaChanged === undefined) {\r\n\t\t\treturn Z._fieldMetaChanged;\r\n\t\t}\r\n\t\tjslet.Checker.test('globalDataHandler.fieldMetaChanged', fieldMetaChanged).isFunction();\r\n\t\tZ._fieldMetaChanged = fieldMetaChanged;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Fired when field value is changed.\r\n\t *  Pattern: \r\n\t *\tfunction(dataset, metaName}{}\r\n\t *  \t//dataset:{jslet.data.Dataset} Dataset Object\r\n\t *  \t//fieldName: {String} field name\r\n\t *  \t//fieldValue: {Object} field value\r\n\t *  \t//valueIndex: {Integer} value index\r\n\t *  \r\n\t * @param {Function or undefined} fieldValueChanged field value changed event handler.\r\n\t * @return {this or Function}\r\n\t */\r\n\tfieldValueChanged: function(fieldValueChanged) {\r\n\t\tvar Z = this;\r\n\t\tif(fieldValueChanged === undefined) {\r\n\t\t\treturn Z._fieldValueChanged;\r\n\t\t}\r\n\t\tjslet.Checker.test('globalDataHandler.fieldValueChanged', fieldValueChanged).isFunction();\r\n\t\tZ._fieldValueChanged = fieldValueChanged;\r\n\t}\r\n};\r\n\r\njslet.data.globalDataHandler = new jslet.data.GlobalDataHandler();\r\n\n/*!\r\n * Jslet Javascript Framework v4.0.0\r\n * https://github.com/jslet/jslet/\r\n *\r\n * Copyright 2016 Jslet Team and other contributors\r\n * Released under the MIT license\r\n */\r\n\r\n\"use strict\";\r\njslet.data.Dataset = function (name) {\r\n\t\r\n\tvar Z = this;\r\n\tZ._name = null; //Dataset name\r\n\tZ._description = null;\r\n\tZ._recordClass = jslet.global.defaultRecordClass; //Record class, used for serialized/deserialize\r\n\tZ._dataList = null; //Array of data records\r\n\tZ._oriDataList = null;\r\n\tZ._fields = []; //Array of jslet.data.Field\r\n\tZ._oriFields = null;\r\n\t\r\n\tZ._normalFields = []; //Array of jslet.data.Field except the fields with children.\r\n\tZ._recno = -1;\r\n\tZ._filteredRecnoArray = null;\r\n\r\n\tZ._unitConvertFactor = 1;\r\n\tZ._unitName = null;\r\n\tZ._aborted = false;\r\n\r\n\tZ._status = 0; // dataset status, optional values: 0:browse;1:created;2:updated;3:deleted;\r\n\tZ._proxyFields = null;\r\n\t\r\n\tZ._fixedFilter = null;\t\r\n\tZ._filter = null;\r\n\tZ._filtered = false;\r\n\tZ._innerFilter = null; //inner variable\r\n\tZ._findCondition = null;\r\n\tZ._innerFindCondition = null; //inner variable\r\n\r\n\tZ._innerFormularFields = null; //inner variable\r\n\r\n\tZ._bof = false;\r\n\tZ._eof = false;\r\n\tZ._igoreEvent = false;\r\n\tZ._logChanges = true;\r\n\tZ._auditLogEnabled = true;\r\n\t\r\n\tZ._modiObject = null;\r\n\tZ._inputtingRecord = {};\r\n\tZ._lockCount = 0;\r\n\r\n\tZ._fixedIndexFields = null;\r\n\tZ._innerFixedIndexFields = [];\r\n\tZ._indexFields = '';\r\n\tZ._innerIndexFields = [];\r\n\tZ._sortingFields = null;\r\n\r\n\tZ._convertDestFields = null;\r\n\tZ._innerConvertDestFields = null;\r\n\r\n\tZ._masterDataset = null;\r\n\tZ._masterField = null;\r\n\tZ._detailDatasetFields = null; //Array of dataset field object\r\n\r\n\tZ._linkedControls = []; //Array of DBControl except DBLabel\r\n\tZ._linkedLabels = []; //Array of DBLabel\r\n\tZ._silence = 0;\r\n\tZ._keyField = null;\r\n\tZ._codeField = null;\r\n\tZ._nameField = null;\r\n\tZ._parentField = null;\r\n\tZ._levelOrderField = null;\r\n\tZ._selectField = null;\r\n\t\r\n\tZ._contextRules = null;\r\n\tZ._contextRuleEngine = null;\r\n\tZ._contextRuleEnabled = false;\r\n\r\n\tZ._dataProvider = jslet.data.DataProvider ? new jslet.data.DataProvider() : null;\r\n\r\n\tZ._queryCriteria = null; //String query parameters \r\n\tZ._queryUrl = null; //String query URL \r\n\tZ._submitUrl = null; //String submit URL\r\n\tZ._pageSize = 500;\r\n\tZ._pageNo = 0;  \r\n\tZ._pageCount = 0;\r\n\t//The following attributes are used for private.\r\n\tZ._ignoreFilter = false;\r\n\tZ._ignoreFilterRecno = 0;\r\n\t\r\n\tZ._fieldValidator = new jslet.data.FieldValidator();\r\n\t\r\n\tZ._onFieldChanged = null;  \r\n\r\n\tZ._onFieldFocusing = null;\r\n\r\n\tZ._isFireGlobalEvent = true;\r\n\r\n\tZ._onCheckSelectable = null;\r\n\r\n\tZ._onDataQueried = null;\r\n\t\r\n\tZ._onDataSubmitted = null;\r\n\t\r\n\tZ._datasetListener = null; //\r\n\t\r\n\tZ._designMode = false;\r\n\t\r\n\tZ._autoShowError = true;\r\n\tZ._autoRefreshHostDataset = false;\r\n\tZ._readOnly = false;\r\n\tZ._aggradedValues = null;\r\n\tZ._afterScrollDebounce = jslet.debounce(Z._innerAfterScrollDebounce, 30);\r\n\tZ._calcAggradedValueDebounce = jslet.debounce(Z.calcAggradedValue, 100);\r\n\tZ._onlyChangedSubmitted = false;\r\n\tZ.selection = new jslet.data.DataSelection(Z);\r\n\tZ._changeLog = new jslet.data.ChangeLog(Z);\r\n\tZ._dataTransformer = new jslet.data.DataTransformer(Z);\r\n\tZ._followedValues = null;\r\n\tZ._focusedFields = null;\r\n\tZ._canFocusFields = null;\r\n\t\r\n\tZ._lastFindingValue = null;\r\n\tZ._inContextRule = false;\r\n\tZ._aggradedFields = null;\r\n\tZ._aggradingCount = 0;\r\n\t\r\n\tthis.name(name);\r\n};\r\njslet.data.Dataset.className = 'jslet.data.Dataset';\r\n\r\njslet.data.Dataset.prototype = {\r\n\r\n\tclassName: jslet.data.Dataset.className,\r\n\t/**\r\n\t* Set dataset's name.\r\n\t* \r\n\t* @param {String} name Dataset's name that must be unique in jslet.data.dataModule variable.\r\n\t* @return {String or this}\r\n\t*/\r\n\tname: function(name) {\r\n\t\tvar Z = this;\r\n\t\tif(name === undefined) {\r\n\t\t\treturn Z._name;\r\n\t\t}\r\n\t\tjslet.Checker.test('Dataset.name', name).required().isString();\r\n\t\tname = jQuery.trim(name);\r\n\t\t\r\n\t\tvar dsName = this._name;\r\n\t\tif (dsName) {\r\n\t\t\tjslet.data.dataModule.unset(dsName);\r\n\t\t\tjslet.data.datasetRelationManager.changeDatasetName(dsName, name);\r\n\t\t}\r\n\t\tjslet.data.dataModule.unset(name);\r\n\t\tjslet.data.dataModule.set(name, this);\r\n\t\tthis._name = name;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Dataset description.\r\n\t * \r\n\t * @param {String} description - Dataset's description.\r\n\t * @return {String or this}\r\n\t */\r\n\tdescription: function(description) {\r\n\t\tif(description === undefined) {\r\n\t\t\treturn this._description || this._name;\r\n\t\t}\r\n\t\tthis._description = description;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t* Set dataset's record class, recordClass is the server entity class quantified name.\r\n\t* It's used for automated serialization.\r\n\t* \r\n\t* @param {String} clazz Server entity class name.\r\n\t* @return {String or this}\r\n\t*/\r\n\trecordClass: function(clazz) {\r\n\t\tvar Z = this;\r\n\t\tif (clazz === undefined) {\r\n\t\t\treturn Z._recordClass;\r\n\t\t}\r\n\t\tjslet.Checker.test('Dataset.recordClass', clazz).isString();\r\n\t\tZ._recordClass = clazz ? clazz.trim() : null;\r\n\t\treturn this;\r\n\t},\r\n\t\t\r\n\t/**\r\n\t* Clone this dataset's structure and return new dataset object..\r\n\t* \r\n\t* @param {String} newDsName New dataset's name.\r\n\t* @param {Array of String} fieldNames a list of field names which will be cloned to new dataset.\r\n\t* \r\n\t* @return {jslet.data.Dataset} Cloned dataset object\r\n\t*/\r\n\tclone: function (newDsName, fieldNames) {\r\n\t\tvar Z = this;\r\n\t\tif (!newDsName) {\r\n\t\t\tnewDsName = Z._name + '_clone';\r\n\t\t}\r\n\t\tvar result = new jslet.data.Dataset(newDsName);\r\n\t\tresult._datasetListener = Z._datasetListener;\r\n\r\n\t\tresult._unitConvertFactor = Z._unitConvertFactor;\r\n\t\tresult._unitName = Z._unitName;\r\n\r\n\t\tresult._fixedFilter = Z._fixedFilter;\r\n\t\tresult._filter = Z._filter;\r\n\t\tresult._filtered = Z._filtered;\r\n\t\tresult._logChanges = Z._logChanges;\r\n\t\tresult._fixedIndexFields = Z._fixedIndexFields;\r\n\t\tresult._indexFields = Z._indexFields;\r\n\t\tresult._onlyChangedSubmitted = Z._onlyChangedSubmitted;\r\n\t\t\r\n\t\tvar keyFldName = Z._keyField,\r\n\t\t\tcodeFldName = Z._codeField,\r\n\t\t\tnameFldName = Z._nameField,\r\n\t\t\tparentFldName = Z._parentField,\r\n\t\t\tlevelOrderField = Z._levelOrderField,\r\n\t\t\tselectFldName = Z._selectField;\r\n\t\tif (fieldNames) {\r\n\t\t\tkeyFldName = keyFldName && fieldNames.indexOf(keyFldName) >= 0 ? keyFldName: null;\r\n\t\t\tcodeFldName = codeFldName && fieldNames.indexOf(codeFldName) >= 0 ? codeFldName: null;\r\n\t\t\tnameFldName = nameFldName && fieldNames.indexOf(nameFldName) >= 0 ? nameFldName: null;\r\n\t\t\tparentFldName = parentFldName && fieldNames.indexOf(parentFldName) >= 0 ? parentFldName: null;\r\n\t\t\tlevelOrderField = levelOrderField && fieldNames.indexOf(levelOrderField) >= 0 ? levelOrderField: null;\r\n\t\t\tselectFldName = selectFldName && fieldNames.indexOf(selectFldName) >= 0 ? selectFldName: null;\r\n\t\t}\r\n\t\tresult._keyField = keyFldName;\r\n\t\tresult._codeField = codeFldName;\r\n\t\tresult._nameField = nameFldName;\r\n\t\tresult._parentField = parentFldName;\r\n\t\tresult._levelOrderField = levelOrderField;\r\n\t\tresult._selectField = selectFldName;\r\n\r\n\t\tresult._contextRules = Z._contextRules;\r\n\t\tvar fldObj, fldName;\r\n\t\tfor(var i = 0, cnt = Z._fields.length; i < cnt; i++) {\r\n\t\t\tfldObj = Z._fields[i];\r\n\t\t\tfldName = fldObj.name();\r\n\t\t\tif (fieldNames) {\r\n\t\t\t\tif (fieldNames.indexOf(fldName) < 0) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tresult.addField(fldObj.clone(fldName, result));\r\n\t\t}\r\n\t\treturn result;\r\n\t},\r\n\r\n\t/**\r\n\t * Clone one record to another\r\n\t * \r\n\t * @param {Plan Object} srcRecord source record\r\n\t * @param {Plan Object} destRecord destination record\r\n\t */\r\n\tcloneRecord: function(srcRecord, destRecord) {\r\n\t\tvar result = destRecord || {}, \r\n\t\t\tfldName, fldObj, fldValue, newValue, \r\n\t\t\tarrFieldObj = this.getNormalFields();\r\n\r\n\t\tfor(var i = 0, len = arrFieldObj.length; i < len; i++) {\r\n\t\t\tfldObj = arrFieldObj[i];\r\n\t\t\tfldName = fldObj.name();\r\n\t\t\tfldValue = srcRecord[fldName];\r\n\t\t\tif(fldValue === undefined) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tif(fldValue && jslet.isArray(fldValue)) {\r\n\t\t\t\tnewValue = [];\r\n\t\t\t\tfor(var j = 0, cnt = fldValue.length; j < cnt; j++) {\r\n\t\t\t\t\tnewValue.push(fldValue[j]);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tnewValue = fldValue;\r\n\t\t\t}\r\n\t\t\tresult[fldName] = newValue;\r\n\t\t}\r\n\t\tjslet.data.FieldValueCache.removeCache(result);\r\n\t\treturn result;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Set or get dataset is readonly or not.\r\n\t * \r\n\t * @param {Boolean} readOnly.\r\n\t * @return {Boolean or this}\r\n\t */\r\n\treadOnly: function(readOnly) {\r\n\t\tvar Z = this;\r\n\t\tif (readOnly === undefined) {\r\n\t\t\treturn Z._readOnly;\r\n\t\t}\r\n\t\t\r\n\t\tZ._readOnly = readOnly? true: false;\r\n\t\tvar fields = Z.getNormalFields(),\r\n\t\t\tfldObj;\r\n\t\tfor(var i = 0, len = fields.length; i < len; i++) {\r\n\t\t\tfldObj = fields[i];\r\n\t\t\tfldObj._fireMetaChangedEvent('readOnly');\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Only submit the changed record to server.\r\n\t * \r\n\t * @param {Boolean} onlyChangedSubmitted.\r\n\t * @return {Boolean or this}\r\n\t */\r\n\tonlyChangedSubmitted: function(onlyChangedSubmitted) {\r\n\t\tif(onlyChangedSubmitted === undefined) {\r\n\t\t\treturn this._onlyChangedSubmitted;\r\n\t\t}\r\n\t\tthis._onlyChangedSubmitted = onlyChangedSubmitted? true: false;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Set or get page size.\r\n\t * \r\n\t * @param {Integer} pageSize.\r\n\t * @return {Integer or this}\r\n\t */\r\n\tpageSize: function(pageSize) {\r\n\t\tif (pageSize === undefined) {\r\n\t\t\treturn this._pageSize;\r\n\t\t}\r\n\t\t\r\n\t\tjslet.Checker.test('Dataset.pageSize#pageSize', pageSize).isGTZero();\r\n\t\tthis._pageSize = pageSize;\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * Set or get page number.\r\n\t * \r\n\t * @param {Integer} pageNo.\r\n\t * @return {Integer or this}\r\n\t */\r\n\tpageNo: function(pageNo) {\r\n\t\tif (pageNo === undefined) {\r\n\t\t\treturn this._pageNo;\r\n\t\t}\r\n\t\t\r\n\t\tjslet.Checker.test('Dataset.pageNo#pageNo', pageNo).isGTZero();\r\n\t\tthis._pageNo = pageNo;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Get page count.\r\n\t * \r\n\t * @return {Integer}\r\n\t */\r\n\tpageCount: function() {\r\n\t\treturn this._pageCount;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Get or set master dataset for \"Detail Dataset\".\r\n\t * This property is for internal use. \r\n\t * \r\n\t * @param {String or undefined} masterDataset - master dataset name.\r\n\t * @return {this or String}\r\n\t */\r\n\tmasterDataset: function(masterDataset) {\r\n\t\tif(masterDataset === undefined) {\r\n\t\t\tif(this._masterDataset) {\r\n\t\t\t\treturn jslet.data.getDataset(this._masterDataset);\r\n\t\t\t} else {\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis._masterDataset = masterDataset;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Get or set master field name for \"Detail Dataset\".\r\n\t * This property is for internal use. \r\n\t * \r\n\t * @param {String or undefined} masterField - master field name.\r\n\t * @return {this or String}\r\n\t */\r\n\tmasterField: function(masterField) {\r\n\t\tif(masterField === undefined) {\r\n\t\t\treturn this._masterField;\r\n\t\t}\r\n\t\tjslet.Checker.test('Dataset.masterField', masterField).isString();\r\n\t\tthis._masterField = masterField;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Get master field object.\r\n\t * \r\n\t * @return {jslet.data.Field} master field object.\r\n\t */\r\n\tgetMasterFieldObject: function() {\r\n\t\tif(this._masterField) {\r\n\t\t\treturn this.masterDataset().getField(this._masterField);\r\n\t\t}\r\n\t\treturn null;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Identify whether dataset is in desin mode.\r\n\t * \r\n\t * @param {boolean} designMode.\r\n\t * @return {boolean or this}\r\n\t */\r\n\tdesignMode: function(designMode) {\r\n\t\tif (designMode === undefined) {\r\n\t\t\treturn this._designMode;\r\n\t\t}\r\n\t\t\r\n\t\tthis._designMode = designMode ? true: false;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Identify whether alerting the error message when confirm or apply to server.\r\n\t * \r\n\t * @param {boolean} autoShowError.\r\n\t * @return {boolean or this}\r\n\t */\r\n\tautoShowError: function(autoShowError) {\r\n\t\tif (autoShowError === undefined) {\r\n\t\t\treturn this._autoShowError;\r\n\t\t}\r\n\t\t\r\n\t\tthis._autoShowError = autoShowError ? true: false;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Update the host dataset or not if this dataset is a lookup dataset and its data has changed.\r\n\t * If true, all datasets which host this dataset as a lookup dataset will be refreshed.\r\n\t * \r\n\t * @param {boolean} flag.\r\n\t * @return {boolean or this}\r\n\t */\r\n\tautoRefreshHostDataset: function(flag) {\r\n\t\tif(flag === undefined) {\r\n\t\t\treturn this._autoRefreshHostDataset;\r\n\t\t}\r\n\t\tthis._autoRefreshHostDataset = flag ? true: false;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Set unit converting factor.\r\n\t * \r\n\t * @param {Double} factor When changed this value, the field's display value will be changed by 'fldValue/factor'.\r\n\t * @param {String} unitName Unit name that displays after field value.\r\n\t * @return {Double or this}\r\n\t */\r\n\tunitConvertFactor: function (factor, unitName) {\r\n\t\tvar Z = this;\r\n\t\tif (arguments.length === 0) {\r\n\t\t\treturn Z._unitConvertFactor;\r\n\t\t}\r\n\t\t\r\n\t\tjslet.Checker.test('Dataset.unitConvertFactor#factor', factor).isGTZero();\r\n\t\tjslet.Checker.test('Dataset.unitConvertFactor#unitName', unitName).isString();\r\n\t\tif (factor > 0) {\r\n\t\t\tZ._unitConvertFactor = factor;\r\n\t\t}\r\n\t\telse{\r\n\t\t\tZ._unitConvertFactor = 1;\r\n\t\t}\r\n\r\n\t\tZ._unitName = unitName;\r\n\t\tfor (var i = 0, cnt = Z._normalFields.length, fldObj; i < cnt; i++) {\r\n\t\t\tfldObj = Z._normalFields[i];\r\n\t\t\tif (fldObj.getType() == jslet.data.DataType.NUMBER && fldObj.unitConverted()) {\r\n\t\t\t\tvar fldName = fldObj.name();\r\n\t\t\t\tjslet.data.FieldValueCache.clearAll(Z, fldName);\r\n\t\t\t\tvar evt = jslet.data.RefreshEvent.updateColumnEvent(fldName);\r\n\t\t\t\tZ.refreshControl(evt);\r\n\t\t\t}\r\n\t\t} //end for\r\n\t\treturn Z;\r\n\t},\r\n\r\n\t/**\r\n\t * Set or get dataset event listener.\r\n\t * Pattern:\r\n\t * function(eventType, dataset) {}\r\n\t * //eventType: jslet.data.DatasetEvent\r\n\t * //dataset: jslet.data.Dataset\r\n\t * \r\n\t * Example:\r\n\t * <pre><code>\r\n\t *   dsFoo.datasetListener(function(eventType, dataset) {\r\n\t *\t\tconsole.log(eventType);\r\n\t *   });\r\n\t * </code></pre>\r\n\t * \r\n\t * @param {Function} listener Dataset event listener\r\n\t * @return {Function or this}\r\n\t */\r\n\tdatasetListener: function(listener) {\r\n\t\tif (arguments.length === 0) {\r\n\t\t\treturn this._datasetListener;\r\n\t\t}\r\n\t\t\r\n\t\tthis._datasetListener = listener;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Fired when check a record if it's selectable or not.\r\n\t * Pattern:\r\n\t *   function() {}\r\n\t *   //return: Boolean, true - record can be selected, false - otherwise.\r\n\t */\r\n\tonCheckSelectable: function(onCheckSelectable) {\r\n\t\tif (onCheckSelectable === undefined) {\r\n\t\t\treturn this._onCheckSelectable;\r\n\t\t}\r\n\t\t\r\n\t\tthis._onCheckSelectable = onCheckSelectable;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Fired after querying data from server.\r\n\t * Pattern:\r\n\t *   function() {}\r\n\t */\r\n\tonDataQueried: function(onDataQueried) {\r\n\t\tif (onDataQueried === undefined) {\r\n\t\t\treturn this._onDataQueried;\r\n\t\t}\r\n\t\t\r\n\t\tthis._onDataQueried = onDataQueried;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Fired after submitting data to server.\r\n\t * Pattern:\r\n\t *   function() {}\r\n\t */\r\n\tonDataSubmitted: function(onDataSubmitted) {\r\n\t\tif (onDataSubmitted === undefined) {\r\n\t\t\treturn this._onDataSubmitted;\r\n\t\t}\r\n\t\t\r\n\t\tthis._onDataSubmitted = onDataSubmitted;\r\n\t\treturn this;\r\n\t},\r\n\r\n\tfieldValidator: function() {\r\n\t\treturn this._fieldValidator;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Set or get dataset onFieldChanged event handler.\r\n\t * Pattern:\r\n\t * function(fldName, value, valueIndex) {}\r\n\t * //fldName: {String} field name\r\n\t * //value: {Object} field value\r\n\t * //valueIndex: {Integer} value index, has value when field value style is BETWEEN or MULTIPLE.\r\n\t * \r\n\t * Example:\r\n\t * <pre><code>\r\n\t *   dsFoo.onFieldChanged(function(fldName, value, valueIndex) {\r\n\t *\t\t\r\n\t *   });\r\n\t * </code></pre>\r\n\t * \r\n\t * @param {Function} onFieldChanged Dataset on field change event handler\r\n\t * @return {Function or this}\r\n\t */\r\n\tonFieldChanged: function(onFieldChanged) {\r\n\t\tif (onFieldChanged === undefined) {\r\n\t\t\treturn this._onFieldChanged;\r\n\t\t}\r\n\t\t\r\n\t\tthis._onFieldChanged = onFieldChanged;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @deprecated\r\n\t * Use onFieldChanged instead.\r\n\t */\r\n\tonFieldChange: function(onFieldChanged) {\r\n\t\tif (onFieldChanged === undefined) {\r\n\t\t\treturn this._onFieldChanged;\r\n\t\t}\r\n\t\t\r\n\t\tthis._onFieldChanged = onFieldChanged;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\tonFieldFocusing: function(onFieldFocusing) {\r\n\t\tif(onFieldFocusing === undefined) {\r\n\t\t\treturn this._onFieldFocusing;\r\n\t\t}\r\n\t\tthis._onFieldFocusing = onFieldFocusing;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Identify if firing global event or not when field value or field meta changed.\r\n\t */\r\n\tisFireGlobalEvent: function(isFireGlobalEvent) {\r\n\t\tif(isFireGlobalEvent === undefined) {\r\n\t\t\treturn this._isFireGlobalEvent;\r\n\t\t}\r\n\t\tthis._isFireGlobalEvent = isFireGlobalEvent? true: false;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Get dataset fields.\r\n\t * @return {Array of jslet.data.Field}\r\n\t */\r\n\tgetFields: function () {\r\n\t\treturn this._fields;\r\n\t},\r\n\r\n\t/**\r\n\t * Get fields except the fields with children.\r\n\t * @return {Array of jslet.data.Field}\r\n\t */\r\n\tgetNormalFields: function() {\r\n\t\treturn this._normalFields;\r\n\t},\r\n\t\r\n\tgetEditableFields: function() {\r\n\t\tvar fields = this._normalFields,\r\n\t\t\tfldObj,\r\n\t\t\tresult = [];\r\n\t\t\r\n\t\tfor(var i = 0, len = fields.length; i < len; i++) {\r\n\t\t\tfldObj = fields[i];\r\n\t\t\tif(fldObj.visible() && !fldObj.disabled() && !fldObj.readOnly()) {\r\n\t\t\t\tresult.push(fldObj.name());\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn result;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Set the specified fields to be visible, others to be hidden.\r\n\t * \r\n\t * Example:\r\n\t * <pre><code>\r\n\t *   dsFoo.setVisibleFields(['field1', 'field3']);\r\n\t * </code></pre>\r\n\t * \r\n\t * @param {String[]} fieldNameArray array of field name\r\n\t */\r\n\tsetVisibleFields: function(fieldNameArray) {\r\n\t\tif(!fieldNameArray) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif(jslet.isString(fieldNameArray)) {\r\n\t\t\tfieldNameArray = fieldNameArray.split(',');\r\n\t\t}\r\n\t\tjslet.Checker.test('Dataset.setVisibleFields#fieldNameArray', fieldNameArray).isArray();\r\n\t\tthis._travelField(this._fields, function(fldObj) {\r\n\t\t\tfldObj.visible(false);\r\n\t\t\treturn false; //Identify if cancel traveling or not\r\n\t\t});\r\n\t\tfor(var i = 0, len = fieldNameArray.length; i < len; i++) {\r\n\t\t\tvar fldName = jQuery.trim(fieldNameArray[i]);\r\n\t\t\tvar fldObj = this.getField(fldName);\r\n\t\t\tif(fldObj) {\r\n\t\t\t\tfldObj.visible(true);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * @private\r\n\t */\r\n\t_travelField: function(fields, callBackFn) {\r\n\t\tif (!callBackFn || !fields) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar isBreak = false;\r\n\t\tfor(var i = 0, len = fields.length; i < len; i++) {\r\n\t\t\tvar fldObj = fields[i];\r\n\t\t\tisBreak = callBackFn(fldObj);\r\n\t\t\tif (isBreak) {\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tvar children = fldObj.children();\r\n\t\t\tif(children && children.length > 0) {\r\n\t\t\t\tisBreak = this._travelField(fldObj.children(), callBackFn);\r\n\t\t\t\tif (isBreak) {\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn isBreak;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @private\r\n\t */\r\n\t_cacheNormalFields: function() {\r\n\t\tvar arrFields = this._normalFields = [];\r\n\t\tthis._travelField(this._fields, function(fldObj) {\r\n\t\t\tvar children = fldObj.children();\r\n\t\t\tif(!children || children.length === 0) {\r\n\t\t\t\tarrFields.push(fldObj);\r\n\t\t\t}\r\n\t\t\treturn false; //Identify if cancel traveling or not\r\n\t\t});\r\n\t\tthis._normalFields = arrFields;\r\n\t\tthis.calcFocusedFields();\r\n\t},\r\n\t\r\n\taddFields: function(arrFldObj) {\r\n\t\tjslet.Checker.test('Dataset.addFields#arrFldObj', arrFldObj).required().isArray();\r\n\t\tvar Z = this;\r\n\t\tfor(var i = 0, len = arrFldObj.length; i < len; i++) {\r\n\t\t\tZ.addField(arrFldObj[i], true);\r\n\t\t}\r\n\t\tZ.refreshDisplayOrder();\r\n\t\tZ.refreshAggradedFields();\r\n\t},\r\n\t\r\n\t/**\r\n\t* Add a new field object.\r\n\t* \r\n\t* @param {jslet.data.Field} fldObj: field object.\r\n\t*/\r\n\taddField: function (fldObj, batchMode) {\r\n\t\tjslet.Checker.test('Dataset.addField#fldObj', fldObj).required().isClass(jslet.data.Field.className);\r\n\t\tvar Z = this,\r\n\t\t\tfldName = fldObj.name();\r\n\t\tif(Z.getField(fldName)) {\r\n\t\t\tZ.removeField(fldName);\r\n\t\t}\r\n\t\tfldObj.dataset(Z);\r\n\t\tZ._fields.push(fldObj);\r\n\t\tvar dispOrder = fldObj.displayOrder(); \r\n\t\tif (!dispOrder) {\r\n\t\t\tfldObj.displayOrder(Z._fields.length - 1);\r\n\t\t}\r\n\t\tvar dataType = fldObj.dataType();\r\n\t\tif (dataType == jslet.data.DataType.DATASET) {\r\n\t\t\tif (!Z._detailDatasetFields) {\r\n\t\t\t\tZ._detailDatasetFields = [];\r\n\t\t\t}\r\n\t\t\tZ._detailDatasetFields.push(fldObj);\r\n\t\t}\r\n\t\tif (dataType == jslet.data.DataType.PROXY) {\r\n\t\t\tif (!Z._proxyFields) {\r\n\t\t\t\tZ._proxyFields = [];\r\n\t\t\t}\r\n\t\t\tZ._proxyFields.push(fldObj);\r\n\t\t}\r\n\t\t\r\n\t\tZ._cacheNormalFields();\r\n\t\t\r\n\t\tfunction addFormulaField(fldObj) {\r\n\t\t\tvar children = fldObj.children();\r\n\t\t\tif(!children || children.length === 0) {\r\n\t\t\t\tZ.addInnerFormulaField(fldObj.name(), fldObj.formula());\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tfor(var i = 0, len = children.length; i < len; i++) {\r\n\t\t\t\taddFormulaField(children[i]);\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\taddFormulaField(fldObj);\r\n\t\t\r\n\t\tif(!batchMode) {\r\n\t\t\tZ.refreshDisplayOrder();\r\n\t\t\tZ.refreshAggradedFields();\r\n\t\t}\r\n\t\treturn Z;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Add specified fields of source dataset into this dataset.\r\n\t * \r\n\t * @param {jslet.data.Dataset} srcDataset New dataset's name.\r\n\t * @param {Array of String} fieldNames a list of field names which will be copied to this dataset.\r\n\t */\r\n\taddFieldFromDataset: function(srcDataset, fieldNames) {\r\n\t\tjslet.Checker.test('Dataset.addFieldFromDataset#srcDataset', srcDataset).required().isClass(jslet.data.Dataset.className);\r\n\t\tjslet.Checker.test('Dataset.addFieldFromDataset#fieldNames', fieldNames).isArray();\r\n\t\tvar Z = this,\r\n\t\t\tfldObj, fldName, \r\n\t\t\tsrcFields = srcDataset.getFields();\r\n\t\tfor(var i = 0, cnt = srcFields.length; i < cnt; i++) {\r\n\t\t\tfldObj = srcFields[i];\r\n\t\t\tfldName = fldObj.name();\r\n\t\t\tif (fieldNames) {\r\n\t\t\t\tif (fieldNames.indexOf(fldName) < 0) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis.addField(fldObj.clone(fldName, this), true);\r\n\t\t}\r\n\t\tZ.refreshDisplayOrder();\r\n\t\tZ.refreshAggradedFields();\r\n\t},\r\n\t\r\n\trefreshDisplayOrder: function() {\r\n\t\tthis._fields.sort(jslet.data.displayOrderComparator);\r\n\t\tthis._cacheNormalFields();\r\n\t},\r\n\t\r\n\tmoveField: function(fromFldName, toFldName) {\r\n\t\tvar Z = this,\r\n\t\t\tfromFldObj = Z.getField(fromFldName),\r\n\t\t\ttoFldObj = Z.getField(toFldName),\r\n\t\t\tfromParent = fromFldObj.parent(),\r\n\t\t\ttoParent = toFldObj.parent();\r\n\t\tif(!fromFldObj || !toFldObj || fromParent != toParent) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar fields;\r\n\t\tif(fromParent) {\r\n\t\t\tfields = fromParent.children();\r\n\t\t} else {\r\n\t\t\tfields = Z._fields;\r\n\t\t}\r\n\t\tvar fldObj, fldName, i,\r\n\t\t\tfromOrder = fromFldObj.displayOrder(),\r\n\t\t\ttoOrder = toFldObj.displayOrder(),\r\n\t\t\tfromIndex = fields.indexOf(fromFldObj),\r\n\t\t\ttoIndex = fields.indexOf(toFldObj),\r\n\t\t\toldDesignMode = Z.designMode();\r\n\t\tZ.designMode(false);\r\n\t\ttry {\r\n\t\t\tfromFldObj.displayOrder(toFldObj.displayOrder());\r\n\t\t\tif(fromIndex < toIndex) {\r\n\t\t\t\tfor(i = fromIndex + 1; i <= toIndex; i++) {\r\n\t\t\t\t\tfldObj = fields[i];\r\n\t\t\t\t\tfldObj.displayOrder(fldObj.displayOrder() - 1);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tfor(i = toIndex; i < fromIndex; i++) {\r\n\t\t\t\t\tfldObj = fields[i];\r\n\t\t\t\t\tfldObj.displayOrder(fldObj.displayOrder() + 1);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} finally {\r\n\t\t\tZ.designMode(oldDesignMode);\r\n\t\t}\r\n\t\tZ.refreshDisplayOrder();\r\n\t\tif(Z.designMode() && Z.isFireGlobalEvent()) {\r\n\t\t\tvar handler = jslet.data.globalDataHandler.fieldMetaChanged();\r\n\t\t\tif(handler) {\r\n\t\t\t\thandler.call(this, Z, null, 'displayOrder');\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * Remove field by field name.\r\n\t * \r\n\t * @param {String} fldName: field name.\r\n\t */\r\n\tremoveField: function (fldName) {\r\n\t\tfunction removeFormulaField(fldObj) {\r\n\t\t\tvar children = fldObj.children();\r\n\t\t\tif(!children || children.length === 0) {\r\n\t\t\t\tZ.removeInnerFormulaField(fldObj.name());\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tfor(var i = 0, len = children.length; i < len; i++) {\r\n\t\t\t\tremoveFormulaField(children[i]);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tjslet.Checker.test('Dataset.removeField#fldName', fldName).required().isString();\r\n\t\tfldName = jQuery.trim(fldName);\r\n\t\tvar Z = this,\r\n\t\t\tfldObj = Z.getField(fldName);\r\n\t\tif (fldObj) {\r\n\t\t\tif (fldObj.dataType() == jslet.data.DataType.DATASET) {\r\n\t\t\t\tvar k = Z._detailDatasetFields.indexOf(fldObj);\r\n\t\t\t\tif (k >= 0) {\r\n\t\t\t\t\tZ._detailDatasetFields.splice(k, 1);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tvar i = Z._fields.indexOf(fldObj);\r\n\t\t\tZ._fields.splice(i, 1);\r\n\t\t\tfldObj.dataset(null);\r\n\t\t\tZ.removeInnerFormulaField(fldName);\r\n\t\t\tZ._cacheNormalFields();\r\n\t\t\tjslet.data.FieldValueCache.clearAll(Z, fldName);\r\n\r\n\t\t\tremoveFormulaField(fldObj);\r\n\t\t\tZ.refreshAggradedFields();\r\n\t\t}\r\n\t\treturn Z;\r\n\t},\r\n\r\n\trefreshAggradedFields: function() {\r\n\t\tvar Z = this;\r\n\t\tZ._aggradedFields = null;\r\n\t\tvar fields = Z.getNormalFields(), \r\n\t\t\tfldObj, aggradedFields = [];\r\n\t\tfor(var i = 0, len = fields.length; i< len; i++) {\r\n\t\t\tfldObj = fields[i];\r\n\t\t\tif(fldObj.aggraded()) {\r\n\t\t\t\taggradedFields.push(fldObj);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(aggradedFields.length > 0) {\r\n\t\t\tZ._aggradedFields = aggradedFields;\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * Get field object by name.\r\n\t * \r\n\t * @param {String} fldName: field name.\r\n\t * @return jslet.data.Field\r\n\t */\r\n\tgetField: function (fldName) {\r\n\t\tjslet.Checker.test('Dataset.getField#fldName', fldName).isString().required();\r\n\t\tfldName = jQuery.trim(fldName);\r\n\r\n\t\tvar arrField = fldName.split('.'), fldName1 = arrField[0];\r\n\t\tvar fldObj = null;\r\n\t\tthis._travelField(this._fields, function(fldObj1) {\r\n\t\t\tvar cancelTravel = false;\r\n\t\t\tif (fldObj1.name() == fldName1) {\r\n\t\t\t\tfldObj = fldObj1;\r\n\t\t\t\tcancelTravel = true;\r\n\t\t\t}\r\n\t\t\treturn cancelTravel; //Identify if cancel traveling or not\r\n\t\t});\r\n\r\n\t\tif (!fldObj) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\t\r\n\t\tif (arrField.length == 1) {\r\n\t\t\treturn fldObj;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tarrField.splice(0, 1);\r\n\t\t\tvar lkf = fldObj.lookup();//Lookup dataset\r\n\t\t\tif (lkf) {\r\n\t\t\t\tvar lkds = lkf.dataset();\r\n\t\t\t\tif (lkds) {\r\n\t\t\t\t\treturn lkds.getField(arrField.join('.'));\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tvar dsDetail = fldObj.detailDataset(); //Detail dataset\r\n\t\t\t\tif(dsDetail) {\r\n\t\t\t\t\treturn dsDetail.getField(arrField.join('.'));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn null;\r\n\t},\r\n\r\n\t/**\r\n\t * Get field object by name.\r\n\t * \r\n\t * @param {String} fldName: field name.\r\n\t * @return jslet.data.Field\r\n\t */\r\n\tgetTopField: function (fldName) {\r\n\t\tjslet.Checker.test('Dataset.getField#fldName', fldName).isString().required();\r\n\t\tfldName = jQuery.trim(fldName);\r\n\t\t\r\n\t\tvar fldObj = this.getField(fldName);\r\n\t\tif (fldObj) {\r\n\t\t\twhile(true) {\r\n\t\t\t\tif (fldObj.parent() === null) {\r\n\t\t\t\t\treturn fldObj;\r\n\t\t\t\t}\r\n\t\t\t\tfldObj = fldObj.parent();\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn null;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @Private,Sort function.\r\n\t * \r\n\t * @param {Object} rec1: dataset record.\r\n\t * @param {Object} rec2: dataset record.\r\n\t */\r\n\tsortFunc: function (rec1, rec2) {\r\n\t\tvar dsObj = jslet.temp.sortDataset;\r\n\t\t\r\n\t\tvar indexFlds = dsObj._sortingFields,\r\n\t\t\tstrFields = [],\r\n\t\t\tfname, idxFldCfg, i, cnt;\r\n\t\tfor (i = 0, cnt = indexFlds.length; i < cnt; i++) {\r\n\t\t\tidxFldCfg = indexFlds[i];\r\n\t\t\tfname = idxFldCfg.fieldName;\r\n\t\t\tif(idxFldCfg.useTextToSort || dsObj.getField(fname).getType() === jslet.data.DataType.STRING) {\r\n\t\t\t\tstrFields.push(fname);\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar  v1, v2, flag = 1;\r\n\t\tfor (i = 0, cnt = indexFlds.length; i < cnt; i++) {\r\n\t\t\tidxFldCfg = indexFlds[i];\r\n\t\t\tfname = idxFldCfg.fieldName;\r\n\t\t\tif(idxFldCfg.useTextToSort) {\r\n\t\t\t\tv1 = dsObj.getFieldTextByRecord(rec1, fname);\r\n\t\t\t\tv2 = dsObj.getFieldTextByRecord(rec2, fname);\r\n\t\t\t} else {\r\n\t\t\t\tv1 = dsObj.getFieldValueByRecord(rec1, fname);\r\n\t\t\t\tv2 = dsObj.getFieldValueByRecord(rec2, fname);\r\n\t\t\t}\r\n\t\t\tif (v1 == v2) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tif (v1 !== null && v2 !== null) {\r\n\t\t\t\tif(strFields.indexOf(fname) >= 0) {\r\n\t\t\t\t\tv1 = v1.toLowerCase();\r\n\t\t\t\t\tv2 = v2.toLowerCase();\r\n\t\t\t\t\tflag = (v1.localeCompare(v2) < 0? -1: 1);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tflag = (v1 < v2 ? -1: 1);\r\n\t\t\t\t}\r\n\t\t\t} else if (v1 === null && v2 !== null) {\r\n\t\t\t\tflag = -1;\r\n\t\t\t} else {\r\n\t\t\t\tif (v1 !== null && v2 === null) {\r\n\t\t\t\t\tflag = 1;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn flag * idxFldCfg.order;\r\n\t\t} //end for\r\n\t\treturn 0;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Set fixed index fields, field names separated by comma(',')\r\n\t * \r\n\t * @param {String} indFlds: fixed index field name.\r\n\t * @return {String or this}\r\n\t */\r\n\tfixedIndexFields: function (fixedIndexFields) {\r\n\t\tvar Z = this;\r\n\t\tif (fixedIndexFields === undefined) {\r\n\t\t\treturn Z._fixedIndexFields;\r\n\t\t}\r\n\t\t\r\n\t\tjslet.Checker.test('Dataset.fixedIndexFields', fixedIndexFields).isString();\r\n\t\t\r\n\t\tZ._fixedIndexFields = fixedIndexFields;\r\n\t\tZ._innerFixedIndexFields = fixedIndexFields? Z._parseIndexFields(fixedIndexFields): [];\r\n\t\tvar idxFld, fixedIdxFld;\r\n\t\tfor(var i = Z._innerIndexFields.length - 1; i>=0; i--) {\r\n\t\t\tidxFld = Z._innerIndexFields[i];\r\n\t\t\tfor(var j = 0, len = Z._innerFixedIndexFields.length; j < len; j++) {\r\n\t\t\t\tfixedIdxFld = Z._innerFixedIndexFields[j];\r\n\t\t\t\tif(idxFld.fieldName === fixedIdxFld.fieldName) {\r\n\t\t\t\t\tZ._innerIndexFields.splice(i, 1);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tZ._sortByFields();\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Set index fields, field names separated by comma(',')\r\n\t * \r\n\t * @param {String} indFlds: index field name.\r\n\t * @return {String or this}\r\n\t */\r\n\tindexFields: function (indFlds) {\r\n\t\tvar Z = this;\r\n\t\tif (indFlds === undefined) {\r\n\t\t\treturn Z._indexFields;\r\n\t\t}\r\n\t\t\r\n\t\tjslet.Checker.test('Dataset.indexFields', indFlds).isString();\r\n\t\tindFlds = jQuery.trim(indFlds);\r\n\t\tif(!indFlds && !Z._indexFields && !Z._fixedIndexFields) {\r\n\t\t\treturn this;\r\n\t\t}\r\n\r\n\t\tZ._indexFields = indFlds;\r\n\t\tZ._innerIndexFields = indFlds? Z._parseIndexFields(indFlds): [];\r\n\t\tvar idxFld, fixedIdxFld;\r\n\t\tfor(var i = Z._innerIndexFields.length - 1; i>=0; i--) {\r\n\t\t\tidxFld = Z._innerIndexFields[i];\r\n\t\t\tfor(var j = 0, len = Z._innerFixedIndexFields.length; j < len; j++) {\r\n\t\t\t\tfixedIdxFld = Z._innerFixedIndexFields[j];\r\n\t\t\t\tif(idxFld.fieldName === fixedIdxFld.fieldName) {\r\n\t\t\t\t\tfixedIdxFld.order = idxFld.order;\r\n\t\t\t\t\tZ._innerIndexFields.splice(i, 1);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tZ._sortByFields();\r\n\t\treturn this;\r\n\t},\r\n\r\n\tmergedIndexFields: function() {\r\n\t\tvar Z = this, i, len,\r\n\t\t\tresult = [];\r\n\t\tfor(i = 0, len = Z._innerFixedIndexFields.length; i < len; i++) {\r\n\t\t\tresult.push(Z._innerFixedIndexFields[i]);\r\n\t\t}\r\n\t\tfor(i = 0, len = Z._innerIndexFields.length; i < len; i++) {\r\n\t\t\tresult.push(Z._innerIndexFields[i]);\r\n\t\t}\r\n\t\treturn result;\r\n\t},\r\n\t\r\n\ttoggleIndexField: function(fldName, emptyIndexFields) {\r\n\t\tvar Z = this,\r\n\t\t\tidxFld, i, \r\n\t\t\tfound = false;\r\n\t\t//Check fixed index fields\r\n\t\tfor(i = Z._innerFixedIndexFields.length - 1; i>=0; i--) {\r\n\t\t\tidxFld = Z._innerFixedIndexFields[i];\r\n\t\t\tif(idxFld.fieldName === fldName) {\r\n\t\t\t\tidxFld.order = (idxFld.order === 1 ? -1: 1);\r\n\t\t\t\tfound = true;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(found) {\r\n\t\t\tif(emptyIndexFields) {\r\n\t\t\t\tZ._innerIndexFields = [];\r\n\t\t\t}\r\n\t\t\tZ._sortByFields();\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t//Check index fields\r\n\t\tfound = false;\r\n\t\tfor(i = Z._innerIndexFields.length - 1; i>=0; i--) {\r\n\t\t\tidxFld = Z._innerIndexFields[i];\r\n\t\t\tif(idxFld.fieldName === fldName) {\r\n\t\t\t\tidxFld.order = (idxFld.order === 1 ? -1: 1);\r\n\t\t\t\tfound = true;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(found) {\r\n\t\t\tif(emptyIndexFields) {\r\n\t\t\t\tZ._innerIndexFields = [];\r\n\t\t\t\tZ._innerIndexFields.push(idxFld);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif(emptyIndexFields) {\r\n\t\t\t\tZ._innerIndexFields = [];\r\n\t\t\t}\r\n\t\t\tidxFld = {fieldName: fldName, order: 1};\r\n\t\t\tZ._innerIndexFields.push(idxFld);\r\n\t\t}\r\n\t\tZ._sortByFields();\r\n\t},\r\n\t\r\n\t_parseIndexFields: function(indexFields) {\r\n\t\tvar arrFields = indexFields.split(','), \r\n\t\t\tfname, fldObj, arrFName, indexNameObj, \r\n\t\t\torder = 1;//asce\r\n\t\tvar result = [];\r\n\t\tfor (var i = 0, cnt = arrFields.length; i < cnt; i++) {\r\n\t\t\tfname = jQuery.trim(arrFields[i]);\r\n\t\t\tarrFName = fname.split(' ');\r\n\t\t\tif (arrFName.length == 1) {\r\n\t\t\t\torder = 1;\r\n\t\t\t} else if (arrFName[1].toLowerCase() == 'asce') {\r\n\t\t\t\torder = 1; //asce\r\n\t\t\t} else {\r\n\t\t\t\torder = -1; //desc\r\n\t\t\t}\r\n\t\t\tresult.push({fieldName: arrFName[0], order: order});\r\n\t\t} //end for\r\n\t\treturn result;\r\n\t},\r\n\t\r\n\t_sortByFields: function() {\r\n\t\tvar Z = this;\r\n\t\tif (!Z.hasRecord()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tZ.selection.removeAll();\r\n\r\n\t\tZ._sortingFields = [];\r\n\t\tvar idxFld, i, cnt;\r\n\t\tfor (i = 0, cnt = Z._innerFixedIndexFields.length; i < cnt; i++) {\r\n\t\t\tidxFld = Z._innerFixedIndexFields[i];\r\n\t\t\tZ._createIndexCfg(idxFld.fieldName, idxFld.order);\r\n\t\t} //end for\r\n\t\tfor (i = 0, cnt = Z._innerIndexFields.length; i < cnt; i++) {\r\n\t\t\tidxFld = Z._innerIndexFields[i];\r\n\t\t\tZ._createIndexCfg(idxFld.fieldName, idxFld.order);\r\n\t\t} //end for\r\n\r\n\t\tif(Z._sortingFields.length === 0) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar currRec = Z.getRecord(), \r\n\t\tflag = Z.isContextRuleEnabled();\r\n\t\tif (flag) {\r\n\t\t\tZ.disableContextRule();\r\n\t\t}\r\n\t\tZ.disableControls();\r\n\t\tjslet.temp.sortDataset = Z;\r\n\t\ttry {\r\n\t\t\tZ.dataList().sort(Z.sortFunc);\r\n\t\t\tZ._refreshInnerRecno();\r\n\t\t} finally {\r\n\t\t\tjslet.temp.sortDataset = null;\r\n\t\t\tZ.moveToRecord(currRec);\r\n\t\t\tif (flag) {\r\n\t\t\t\tZ.enableContextRule();\r\n\t\t\t}\r\n\t\t\tZ.enableControls();\r\n\t\t}\t\t\r\n\t},\r\n\t\r\n\t/**\r\n\t * @private\r\n\t */\r\n\t_createIndexCfg: function(fname, order) {\r\n\t\tvar Z = this,\r\n\t\t\tfldObj = fname;\r\n\t\tif(jslet.isString(fname)) {\r\n\t\t\tfldObj = Z.getField(fname);\r\n\t\t}\r\n\t\tif (!fldObj) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif(fldObj.dataset() !== Z) {\r\n\t\t\tZ._combineIndexCfg(fname, order);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar children = fldObj.children();\r\n\t\tif (!children || children.length === 0) {\r\n\t\t\tvar useTextToSort = true;\r\n\t\t\tif(fldObj.getType() === 'N' && !fldObj.lookup()) {\r\n\t\t\t\tuseTextToSort = false;\r\n\t\t\t}\r\n\t\t\tZ._combineIndexCfg(fldObj.name(), order, useTextToSort);\r\n\t\t} else {\r\n\t\t\tfor(var k = 0, childCnt = children.length; k < childCnt; k++) {\r\n\t\t\t\tZ._createIndexCfg(children[k], order);\r\n\t\t\t}\r\n\t\t}\t\t\r\n\t},\r\n\t\r\n\t/**\r\n\t * @private\r\n\t */\r\n\t_combineIndexCfg: function(fldName, order, useTextToSort) {\r\n\t\tfor(var i = 0, len = this._sortingFields.length; i < len; i++) {\r\n\t\t\tif (this._sortingFields[i].fieldName == fldName) {\r\n\t\t\t\tthis._sortingFields.splice(i,1);//remove duplicated field\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar indexNameObj = {\r\n\t\t\t\tfieldName: fldName,\r\n\t\t\t\torder: order,\r\n\t\t\t\tuseTextToSort: useTextToSort\r\n\t\t\t};\r\n\t\tthis._sortingFields.push(indexNameObj);\r\n\t},\r\n\t\r\n\t_getWholeFilter: function() {\r\n\t\tvar Z = this, \r\n\t\t\tresult = Z._fixedFilter;\r\n\t\tif(result) {\r\n\t\t\tif(Z._filter) {\r\n\t\t\t\treturn '(' + result + ') && (' + Z._filter + ')';\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tresult = Z._filter;\r\n\t\t}\r\n\t\treturn result;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Set or get dataset fixed filter expression\r\n\t * Fixed filter is the global filter expression for dataset.\r\n\t * <pre><code>\r\n\t *   dsFoo.fixedFilter('[age] > 20');\r\n\t * </code></pre>\r\n\t * \r\n\t * @param {String} fixedFilter: fixed filter expression.\r\n\t * @return {String or this}\r\n\t */\r\n\tfixedFilter: function (fixedFilter) {\r\n\t\tvar Z = this;\r\n\t\tif (fixedFilter === undefined) {\r\n\t\t\treturn Z._fixedFilter;\r\n\t\t}\r\n\t\t\r\n\t\tjslet.Checker.test('dataset.fixedFilter', fixedFilter).isString();\r\n\t\tif(fixedFilter) {\r\n\t\t\tfixedFilter = jQuery.trim(fixedFilter);\r\n\t\t}\r\n\t\tvar oldFilter = Z._getWholeFilter();\r\n\t\tZ._fixedFilter = fixedFilter;\r\n\t\tvar newFilter = Z._getWholeFilter();\r\n\t\t\r\n\t\tif (!newFilter) {\r\n\t\t\tZ._innerFilter = null;\r\n\t\t\tZ._filtered = false;\r\n\t\t\tZ._filteredRecnoArray = null;\r\n\t\t} else {\r\n\t\t\tif(oldFilter == newFilter) {\r\n\t\t\t\treturn this;\r\n\t\t\t} else {\r\n\t\t\t\tZ._innerFilter = new jslet.Expression(Z, newFilter);\r\n\t\t\t}\r\n\t\t}\r\n\t\tZ._doFilterChanged();\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Set or get dataset filter expression\r\n\t * Filter can work depending on property: filtered, filtered must be true.\r\n\t * <pre><code>\r\n\t *   dsFoo.filter('[name] like \"Bob%\"');\r\n\t *   dsFoo.filter('[age] > 20');\r\n\t * </code></pre>\r\n\t * \r\n\t * @param {String} filterExpr: filter expression.\r\n\t * @return {String or this}\r\n\t */\r\n\tfilter: function (filterExpr) {\r\n\t\tvar Z = this;\r\n\t\tif (filterExpr === undefined) {\r\n\t\t\treturn Z._filter;\r\n\t\t}\r\n\t\t\r\n\t\tjslet.Checker.test('dataset.filter#filterExpr', filterExpr).isString();\r\n\t\tif(filterExpr) {\r\n\t\t\tfilterExpr = jQuery.trim(filterExpr);\r\n\t\t}\r\n\r\n\t\tvar oldFilter = Z._getWholeFilter();\r\n\t\tZ._filter = filterExpr;\r\n\t\tvar newFilter = Z._getWholeFilter();\r\n\t\t\r\n\t\tif (!newFilter) {\r\n\t\t\tZ._innerFilter = null;\r\n\t\t\tZ._filtered = false;\r\n\t\t\tZ._filteredRecnoArray = null;\r\n\t\t} else {\r\n\t\t\tif(oldFilter == newFilter) {\r\n\t\t\t\treturn this;\r\n\t\t\t} else {\r\n\t\t\t\tZ._innerFilter = new jslet.Expression(Z, newFilter);\r\n\t\t\t}\r\n\t\t}\r\n\t\tZ._doFilterChanged();\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * Set or get filtered flag\r\n\t * Only filtered is true, the filter can work\r\n\t * \r\n\t * @param {Boolean} afiltered: filter flag.\r\n\t * @return {Boolean or this}\r\n\t */\r\n\tfiltered: function (afiltered) {\r\n\t\tvar Z = this;\r\n\t\tif (afiltered === undefined) {\r\n\t\t\treturn Z._filtered;\r\n\t\t}\r\n\t\t\r\n\t\tvar oldFilter = Z._getWholeFilter(), \r\n\t\t\toldFiltered = Z._filtered;\r\n\t\tif (afiltered && !oldFilter) {\r\n\t\t\tZ._filtered = false;\r\n\t\t} else {\r\n\t\t\tZ._filtered = afiltered ? true: false;\r\n\t\t}\r\n\r\n\t\tif(oldFiltered == Z._filtered) {\r\n\t\t\treturn this;\r\n\t\t}\r\n\t\tthis._doFilterChanged();\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t_doFilterChanged: function() {\r\n\t\tvar Z = this;\r\n\t\tZ.selection.removeAll();\r\n\t\tZ.disableControls();\r\n\t\ttry {\r\n\t\t\tif (!Z._filtered) {\r\n\t\t\t\tZ._filteredRecnoArray = null;\r\n\t\t\t} else {\r\n\t\t\t\tZ._refreshInnerRecno();\r\n\t\t\t}\r\n\t\t\tZ.first();\r\n\t\t\tZ._calcAggradedValueDebounce.call(Z);\t\t\r\n\t\t}\r\n\t\tfinally {\r\n\t\t\tZ.enableControls();\r\n\t\t}\r\n\t\tZ.refreshLookupHostDataset();\r\n\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @private, filter data\r\n\t */\r\n\t_filterData: function () {\r\n\t\tvar Z = this,\r\n\t\t \tfilter = Z._getWholeFilter();\r\n\t\tif (!Z._filtered || !filter || \r\n\t\t\t\tZ._status == jslet.data.DataSetStatus.INSERT || \r\n\t\t\t\tZ._status == jslet.data.DataSetStatus.UPDATE) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\tvar result = Z._innerFilter.eval();\r\n\t\treturn result;\r\n\t},\r\n\r\n\t/**\r\n\t * @private\r\n\t */\r\n\t_refreshInnerRecno: function () {\r\n\t\tvar Z = this;\r\n\t\tif (!Z.hasData()) {\r\n\t\t\tZ._filteredRecnoArray = null;\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tZ._filteredRecnoArray = null;\r\n\t\tvar tempRecno = [];\r\n\t\tvar oldRecno = Z._recno;\r\n\t\ttry {\r\n\t\t\tfor (var i = 0, cnt = Z.dataList().length; i < cnt; i++) {\r\n\t\t\t\tZ._recno = i;\r\n\t\t\t\tif (Z._filterData()) {\r\n\t\t\t\t\ttempRecno.push(i);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tfinally {\r\n\t\t\tZ._recno = oldRecno;\r\n\t\t}\r\n\t\tZ._filteredRecnoArray = tempRecno;\r\n\t},\r\n\r\n\t_innerAfterScrollDebounce: function() {\r\n\t\tvar Z = this,\r\n\t\t\teventFunc = jslet.getFunction(Z._datasetListener);\r\n\t\tif(eventFunc) {\r\n\t\t\teventFunc.call(Z, jslet.data.DatasetEvent.AFTERSCROLL);\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * @private\r\n\t */\r\n\t_fireDatasetEvent: function (evtType) {\r\n\t\tvar Z = this;\r\n\t\tif (Z._silence || Z._igoreEvent || !Z._datasetListener) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif(evtType == jslet.data.DatasetEvent.AFTERSCROLL) {\r\n\t\t\tZ._afterScrollDebounce.call(Z);\r\n\t\t} else {\r\n\t\t\tvar eventFunc = jslet.getFunction(Z._datasetListener);\r\n\t\t\tif(eventFunc) {\r\n\t\t\t\teventFunc.call(Z, evtType);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * Get record count\r\n\t * \r\n\t * @return {Integer}\r\n\t */\r\n\trecordCount: function () {\r\n\t\tvar records = this.dataList();\r\n\t\tif (records) {\r\n\t\t\tif (!this._filteredRecnoArray) {\r\n\t\t\t\treturn records.length;\r\n\t\t\t} else {\r\n\t\t\t\treturn this._filteredRecnoArray.length;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn 0;\r\n\t},\r\n\r\n\thasRecord: function () {\r\n\t\treturn this.recordCount() > 0;\r\n\t},\r\n\t\r\n\thasData: function() {\r\n\t\tvar records = this.dataList();\r\n\t\treturn records && records.length > 0;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Set or get record number\r\n\t * \r\n\t * @param {Integer}record number\r\n\t * @return {Integer or this}\r\n\t */\r\n\trecno: function (recno) {\r\n\t\tvar Z = this;\r\n\t\tif (recno === undefined) {\r\n\t\t\treturn Z._recno;\r\n\t\t}\r\n\t\tjslet.Checker.test('dataset.recno#recno', recno).isGTEZero();\r\n\t\trecno = parseInt(recno);\r\n\t\tif(!Z.hasRecord()) {\r\n\t\t\tZ._bof = Z._eof = true;\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\t\r\n\t\tif (recno == Z._recno) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\tZ.confirm();\r\n\t\tZ._gotoRecno(recno);\r\n\t\tZ._bof = Z._eof = false;\r\n\t\treturn true;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Set record number silently, it will not fire any event.\r\n\t * \r\n\t * @param {Integer}recno - record number\r\n\t */\r\n\trecnoSilence: function (recno) {\r\n\t\tvar Z = this;\r\n\t\tif (recno === undefined) {\r\n\t\t\treturn Z._recno;\r\n\t\t}\r\n\t\tZ._recno = recno;\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * @private\r\n\t * Goto specified record number(Private)\r\n\t * \r\n\t * @param {Integer}recno - record number\r\n\t */\r\n\t_gotoRecno: function (recno) {\r\n\t\tvar Z = this,\r\n\t\t\trecCnt = Z.recordCount();\r\n\t\tif(recCnt === 0) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tif (recno >= recCnt) {\r\n\t\t\trecno = recCnt - 1;\r\n\t\t} else if (recno < 0) {\r\n\t\t\trecno = 0;\r\n\t\t}\r\n\t\t\r\n\t\tif (Z._recno == recno) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tvar evt;\r\n\t\tif (!Z._silence) {\r\n\t\t\tZ._aborted = false;\r\n\t\t\ttry {\r\n\t\t\t\tZ._fireDatasetEvent(jslet.data.DatasetEvent.BEFORESCROLL);\r\n\t\t\t\tif (Z._aborted) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t} finally {\r\n\t\t\t\tZ._aborted = false;\r\n\t\t\t}\r\n\t\t\tif (!Z._lockCount) {\r\n\t\t\t\tevt = jslet.data.RefreshEvent.beforeScrollEvent(Z._recno);\r\n\t\t\t\tZ.refreshControl(evt);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar preno = Z._recno;\r\n\t\tZ._recno = recno;\r\n\t\t\r\n\t\tif (Z._recno != preno && Z._detailDatasetFields && Z._detailDatasetFields.length > 0) {\r\n\t\t\tvar fldObj, dsDetail;\r\n\t\t\tfor (var i = 0, len = Z._detailDatasetFields.length; i < len; i++) {\r\n\t\t\t\tfldObj = Z._detailDatasetFields[i];\r\n\t\t\t\tdsDetail = fldObj.detailDataset();\r\n\t\t\t\tif (dsDetail) {\r\n\t\t\t\t\tdsDetail._initialize(true);\r\n\t\t\t\t}\r\n\t\t\t} //end for\r\n\t\t} //end if\r\n\t\tZ._refreshProxyField(null, Z._silenc);\r\n\t\tif (Z._contextRuleEnabled) {\r\n\t\t\tthis.calcContextRule();\r\n\t\t}\r\n\t\tif (!Z._silence) {\r\n\t\t\tZ._fireDatasetEvent(jslet.data.DatasetEvent.AFTERSCROLL);\r\n\t\t\tif (!Z._lockCount) {\r\n\t\t\t\tevt = jslet.data.RefreshEvent.scrollEvent(Z._recno, preno);\r\n\t\t\t\tZ.refreshControl(evt);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn true;\r\n\t},\r\n\r\n\t/**\r\n\t * Abort insert/update/delete action before insert/update/delete.\r\n\t * \r\n\t */\r\n\tabort: function () {\r\n\t\tthis._aborted = true;\r\n\t},\r\n\r\n\t/**\r\n\t * Get aborted status.\r\n\t * \r\n\t * @return {Boolean}\r\n\t */\r\n\taborted: function() {\r\n\t\treturn this._aborted;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @private\r\n\t * Move cursor back to startRecno(Private)\r\n\t * \r\n\t * @param {Integer}startRecno - record number\r\n\t */\r\n\t_moveCursor: function (recno) {\r\n\t\tvar Z = this;\r\n\t\tZ.confirm();\r\n\t\tZ._gotoRecno(recno);\r\n\t},\r\n\r\n\t/**\r\n\t * Move record cursor by record object\r\n\t * \r\n\t * @param {Object}recordObj - record object\r\n\t * @return {Boolean} true - Move successfully, false otherwise. \r\n\t */\r\n\tmoveToRecord: function (recordObj) {\r\n\t\tvar Z = this;\r\n\t\tZ.confirm();\r\n\t\tif (!Z.hasRecord() || !recordObj) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tjslet.Checker.test('dataset.moveToRecord#recordObj', recordObj).isObject();\r\n\t\tvar k = Z.dataList().indexOf(recordObj);\r\n\t\tif (k < 0) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tif (Z._filteredRecnoArray) {\r\n\t\t\tk = Z._filteredRecnoArray.indexOf(k);\r\n\t\t\tif (k < 0) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t}\r\n\t\tZ._gotoRecno(k);\r\n\t\treturn true;\r\n\t},\r\n\r\n\t/**\r\n\t * @private\r\n\t */\r\n\tstartSilenceMove: function (notLogPos) {\r\n\t\tvar Z = this;\r\n\t\tvar context = {};\r\n\t\tif (!notLogPos) {\r\n\t\t\tcontext.recno = Z._recno;\r\n\t\t} else {\r\n\t\t\tcontext.recno = -999;\r\n\t\t}\r\n\r\n\t\tZ._silence++;\r\n\t\treturn context;\r\n\t},\r\n\r\n\t/**\r\n\t * @private\r\n\t */\r\n\tendSilenceMove: function (context) {\r\n\t\tvar Z = this;\r\n\t\tif (context.recno != -999 && context.recno != Z._recno) {\r\n\t\t\tZ._gotoRecno(context.recno);\r\n\t\t}\r\n\t\tZ._silence--;\r\n\t},\r\n\r\n\t/**\r\n\t * Check dataset cursor at the last record\r\n\t * \r\n\t * @return {Boolean}\r\n\t */\r\n\tisBof: function () {\r\n\t\treturn this._bof;\r\n\t},\r\n\r\n\t/**\r\n\t * Check dataset cursor at the first record\r\n\t * \r\n\t * @return {Boolean}\r\n\t */\r\n\tisEof: function () {\r\n\t\treturn this._eof;\r\n\t},\r\n\r\n\t/**\r\n\t * Move cursor to first record\r\n\t */\r\n\tfirst: function () {\r\n\t\tvar Z = this;\r\n\t\tif(!Z.hasRecord()) {\r\n\t\t\tZ._bof = Z._eof = true;\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tZ._moveCursor(0);\r\n\t\tZ._bof = Z._eof = false;\r\n\t},\r\n\r\n\t/**\r\n\t * Move cursor to last record\r\n\t */\r\n\tnext: function () {\r\n\t\tvar Z = this;\r\n\t\tvar recCnt = Z.recordCount();\r\n\t\tif(recCnt === 0) {\r\n\t\t\tZ._bof = Z._eof = true;\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif(Z._recno == recCnt - 1) {\r\n\t\t\tZ._bof = false;\r\n\t\t\tZ._eof = true;\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tZ._bof = Z._eof = false;\r\n\t\tZ._moveCursor(Z._recno + 1);\r\n\t},\r\n\r\n\t/**\r\n\t * Move cursor to prior record\r\n\t */\r\n\tprior: function () {\r\n\t\tvar Z = this;\r\n\t\tif(!Z.hasRecord()) {\r\n\t\t\tZ._bof = Z._eof = true;\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif(Z._recno === 0) {\r\n\t\t\tZ._bof = true;\r\n\t\t\tZ._eof = false;\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tZ._bof = Z._eof = false;\r\n\t\tZ._moveCursor(Z._recno - 1);\r\n\t},\r\n\r\n\t/**\r\n\t * Move cursor to next record\r\n\t */\r\n\tlast: function () {\r\n\t\tvar Z = this;\r\n\t\tif(!Z.hasRecord()) {\r\n\t\t\tZ._bof = Z._eof = true;\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tZ._bof = Z._eof = false;\r\n\t\tZ._moveCursor(Z.recordCount() - 1);\r\n\t\tZ._bof = Z._eof = false;\r\n\t},\r\n\r\n\tfirstError: function() {\r\n\t\treturn this._moveToError(0);\r\n\t},\r\n\t\r\n\tnextError: function() {\r\n\t\treturn this._moveToError(this.recno() + 1);\r\n\t},\r\n\t\r\n\tpriorError: function() {\r\n\t\treturn this._moveToError(this.recno() - 1, true);\r\n\t},\r\n\t\r\n\tlastError: function() {\r\n\t\treturn this._moveToError(this.recordCount() - 1, true);\r\n\t},\r\n\t\r\n\t_moveToError: function(startRecno, reverse) {\r\n\t\tvar Z = this, i,\r\n\t\t\trecCnt = Z.recordCount() - 1;\r\n\t\tif(recCnt < 0) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tif(!reverse) {\r\n\t\t\tif(startRecno < 0) {\r\n\t\t\t\tstartRecno = 0;\r\n\t\t\t}\r\n\t\t\tfor(i = startRecno; i < recCnt; i++) {\r\n\t\t\t\tif(Z.existRecordError(i)) {\r\n\t\t\t\t\tZ._moveCursor(i);\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif(startRecno > recCnt) {\r\n\t\t\t\tstartRecno = recCnt;\r\n\t\t\t}\r\n\t\t\tfor(i = startRecno; i >= 0; i--) {\r\n\t\t\t\tif(Z.existRecordError(i)) {\r\n\t\t\t\t\tZ._moveCursor(i);\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @private\r\n\t * Check dataset status and cancel dataset \r\n\t */\r\n\tcheckStatusByCancel: function () {\r\n\t\tif (this._status != jslet.data.DataSetStatus.BROWSE) {\r\n\t\t\tthis.cancel();\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * Insert child record by parentId, and move cursor to the newly record.\r\n\t * \r\n\t * @param {Object} parentId - key value of parent record\r\n\t */\r\n\tinsertChild: function (parentId) {\r\n\t\tvar Z = this;\r\n\t\tif (!Z._parentField || !Z.keyField()) {\r\n\t\t\t//Dataset properties: [parentField] and [keyField] not set, use insertRecord() instead!\r\n\t\t\tthrow new Error(jslet.locale.Dataset.parentFieldNotSet);\r\n\t\t}\r\n\r\n\t\tif (!Z.hasRecord()) {\r\n\t\t\tZ.innerInsert();\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tvar context = Z.startSilenceMove(true);\r\n\t\ttry {\r\n\t\t\tZ.expanded(true);\r\n\t\t\tif (parentId) {\r\n\t\t\t\tif (!Z.findByKey(parentId)) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tparentId = Z.keyValue();\r\n\t\t\t}\r\n\r\n\t\t\tvar pfldname = Z.parentField(), \r\n\t\t\t\tparentParentId = Z.getFieldValue(pfldname);\r\n\t\t\twhile (true) {\r\n\t\t\t\tZ.next();\r\n\t\t\t\tif (Z.isEof()) {\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tif (parentParentId == Z.getFieldValue(pfldname)) {\r\n\t\t\t\t\tZ.prior();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} finally {\r\n\t\t\tZ.endSilenceMove(context);\r\n\t\t}\r\n\r\n\t\tZ.innerInsert(function (newRec) {\r\n\t\t\tnewRec[Z._parentField] = parentId;\r\n\t\t});\r\n\t},\r\n\r\n\t/**\r\n\t * Insert sibling record of current record, and move cursor to the newly record.\r\n\t */\r\n\tinsertSibling: function () {\r\n\t\tvar Z = this;\r\n\t\tif (!Z._parentField || !Z._keyField) {\r\n\t\t\t//Dataset properties: [parentField] and [keyField] not set, use insertRecord() instead!\r\n\t\t\tthrow new Error(jslet.locale.Dataset.parentFieldNotSet);\r\n\t\t}\r\n\r\n\t\tif (!Z.hasRecord()) {\r\n\t\t\tZ.innerInsert();\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tvar parentId = Z.getFieldValue(Z.parentField()),\r\n\t\t\tcontext = Z.startSilenceMove(true),\r\n\t\t\tfound = false,\r\n\t\t\tparentKeys = [],\r\n\t\t\tcurrPKey, \r\n\t\t\tprePKey = Z.keyValue(),\r\n\t\t\tlastPKey = prePKey;\r\n\t\ttry {\r\n\t\t\tZ.next();\r\n\t\t\twhile (!Z.isEof()) {\r\n\t\t\t\tcurrPKey = Z.parentValue();\r\n\t\t\t\tif(currPKey == prePKey) {\r\n\t\t\t\t\tparentKeys.push(prePKey);\r\n\t\t\t\t\tlastPKey = prePKey;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif(lastPKey != currPKey) {\r\n\t\t\t\t\t\tif(parentKeys.indexOf(currPKey) < 0) {\r\n\t\t\t\t\t\t\tZ.prior();\r\n\t\t\t\t\t\t\tfound = true;\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tprePKey = currPKey;\r\n\t\t\t\tZ.next();\r\n\t\t\t}\r\n\t\t\tif (!found) {\r\n\t\t\t\tZ.last();\r\n\t\t\t}\r\n\t\t} finally {\r\n\t\t\tZ.endSilenceMove(context);\r\n\t\t}\r\n\r\n\t\tZ.innerInsert(function (newRec) {\r\n\t\t\tnewRec[Z._parentField] = parentId;\r\n\t\t});\r\n\t},\r\n\r\n\t/**\r\n\t * Insert record after current record, and move cursor to the newly record.\r\n\t */\r\n\tinsertRecord: function () {\r\n\t\tthis.innerInsert();\r\n\t},\r\n\r\n\t/**\r\n\t * Add record after last record, and move cursor to the newly record.\r\n\t */\r\n\tappendRecord: function () {\r\n\t\tvar Z = this;\r\n\r\n\t\tZ._silence++;\r\n\t\ttry {\r\n\t\t\tZ.last();\r\n\t\t} finally {\r\n\t\t\tZ._silence--;\r\n\t\t}\r\n\t\tZ.insertRecord();\r\n\t},\r\n\r\n\t/**\r\n\t * @private\r\n\t */\r\n\tstatus: function(status) {\r\n\t\tif(status === undefined) {\r\n\t\t\treturn this._status;\r\n\t\t}\r\n\t\tthis._status = status;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Get or set the current record is expanded or not.\r\n\t * \r\n\t * @param {Boolean or undefined} expanded - true - expanded, false - collapsed.\r\n\t * \r\n\t * @param {Boolean or this}\r\n\t */\r\n\texpanded: function(expanded) {\r\n\t\treturn this.expandedByRecno(this.recno(), expanded);\r\n\t},\r\n\t\r\n\t/**\r\n\t * Get or set the specified record is expanded or not.\r\n\t * \r\n\t * @param {Integer} recno - record number.\r\n\t * @param {Boolean or undefined} expanded - true - expanded, false - collapsed.\r\n\t * \r\n\t * @param {Boolean or this}\r\n\t */\r\n\texpandedByRecno: function(recno, expanded) {\r\n\t\tjslet.Checker.test('dataset.expandedByRecno', recno).required().isNumber();\r\n\t\tvar record = this.getRecord(recno);\r\n\t\tvar recInfo = jslet.data.getRecInfo(record);\r\n\t\tif(expanded === undefined) {\r\n\t\t\tvar result = recInfo && recInfo.expanded;\r\n\t\t\treturn result? true: false;\r\n\t\t}\r\n\t\tif(recInfo === null) {\r\n\t\t\treturn this;\r\n\t\t}\r\n\t\trecInfo.expanded = expanded;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Get or set the specified record is inserted or not.\r\n\t * \r\n\t * @param {Integer} recno - record number.\r\n\t * @param {Boolean or undefined} inserted - true - inserted, false - not changed.\r\n\t * \r\n\t * @param {Boolean or this}\r\n\t */\r\n\tinsertedByRecno: function(recno, inserted) {\r\n\t\tif(inserted === undefined) {\r\n\t\t\treturn this.changedStatusByRecno(recno) === jslet.data.DataSetStatus.INSERT;\r\n\t\t}\r\n\t\tif(inserted) {\r\n\t\t\tthis.changedStatusByRecno(recno, jslet.data.DataSetStatus.INSERT);\r\n\t\t} else {\r\n\t\t\tthis.changedStatusByRecno(recno, jslet.data.DataSetStatus.BROWSE);\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Get or set the specified record is updated or not.\r\n\t * \r\n\t * @param {Integer} recno - record number.\r\n\t * @param {Boolean or undefined} updated - true - updated, false - not changed.\r\n\t * \r\n\t * @param {Boolean or this}\r\n\t */\r\n\tupdatedByRecno: function(recno, updated) {\r\n\t\tif(updated === undefined) {\r\n\t\t\treturn this.changedStatusByRecno(recno) === jslet.data.DataSetStatus.UPDATE;\r\n\t\t}\r\n\t\tif(updated) {\r\n\t\t\tthis.changedStatusByRecno(recno, jslet.data.DataSetStatus.UPDATE);\r\n\t\t} else {\r\n\t\t\tthis.changedStatusByRecno(recno, jslet.data.DataSetStatus.BROWSE);\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @private\r\n\t */\r\n\tchangedStatus: function(status) {\r\n\t\tif(status === undefined) {\r\n\t\t\treturn this.changedStatusByRecno(this._recno, status);\r\n\t\t}\r\n\t\tthis.changedStatusByRecno(this._recno, status);\r\n\t},\r\n\t\r\n\t/**\r\n\t * @private\r\n\t */\r\n\tchangedStatusByRecno: function(recno, status) {\r\n\t\tvar Z = this, record, recInfo;\r\n\t\tif(status === undefined) {\r\n\t\t\trecord = Z.getRecord(recno);\r\n\t\t\tif(!record) {\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\t\t\trecInfo = jslet.data.getRecInfo(record);\t\t\r\n\t\t\tif(!recInfo) {\r\n\t\t\t\treturn jslet.data.DataSetStatus.BROWSE;\r\n\t\t\t}\r\n\t\t\treturn recInfo.status;\r\n\t\t}\r\n\t\tif(!Z._logChanges) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\trecord = Z.getRecord(recno);\r\n\t\tif(!record) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\trecInfo = jslet.data.getRecInfo(record);\t\t\r\n\t\tvar\toldStatus = recInfo.status;\r\n\t\tif(status === jslet.data.DataSetStatus.DELETE) {\r\n\t\t\trecInfo.status = status;\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif(oldStatus === jslet.data.DataSetStatus.INSERT) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif(oldStatus != status) {\r\n\t\t\tif (Z._contextRuleEnabled) {\r\n\t\t\t\tZ.calcContextRule();\r\n\t\t\t}\r\n\t\t\trecInfo.status = status;\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * @Private\r\n\t */\r\n\tinnerInsert: function (beforeInsertFn) {\r\n\t\tvar Z = this;\r\n\t\tZ.confirm();\r\n\r\n\t\tZ.selection.removeAll();\r\n\t\tvar dsMaster = Z.masterDataset();\r\n\t\tif (dsMaster) {\r\n\t\t\tif (!dsMaster.hasRecord()) {\r\n\t\t\t\tthrow new Error(jslet.locale.Dataset.insertMasterFirst);\r\n\t\t\t}\r\n\t\t\tdsMaster.editRecord();\r\n\t\t}\r\n\r\n\t\tZ._aborted = false;\r\n\t\ttry {\r\n\t\t\tZ._fireDatasetEvent(jslet.data.DatasetEvent.BEFOREINSERT);\r\n\t\t\tif (Z._aborted) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t} finally {\r\n\t\t\tZ._aborted = false;\r\n\t\t}\r\n\r\n\t\tvar records = Z.dataList();\r\n\t\tif (records === null) {\r\n\t\t\trecords = [];\r\n\t\t\tZ.dataList(records);\r\n\t\t}\r\n\t\tvar preRecno = Z.recno(), k;\r\n\t\tif (Z.hasRecord()) {\r\n\t\t\tk = records.indexOf(this.getRecord()) + 1;\r\n\t\t} else {\r\n\t\t\tk = 0;\r\n\t\t}\r\n\r\n\t\tvar newRecord = {};\r\n\t\trecords.splice(k, 0, newRecord);\r\n\r\n\t\tif (Z._filteredRecnoArray && Z._filteredRecnoArray.length > 0) {\r\n\t\t\tfor (var i = Z._filteredRecnoArray.length - 1; i >= 0; i--) {\r\n\t\t\t\tif (Z._filteredRecnoArray[i] < k) {\r\n\t\t\t\t\tZ._filteredRecnoArray.splice(i + 1, 0, k);\r\n\t\t\t\t\tZ._recno = k;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tZ._filteredRecnoArray[i] += 1;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tZ._recno = k;\r\n\t\t}\r\n\t\t\r\n\t\tZ.status(jslet.data.DataSetStatus.INSERT);\r\n\t\tZ.changedStatus(jslet.data.DataSetStatus.INSERT);\r\n\t\tZ._lockCount++;\r\n\t\ttry {\r\n\t\t\tZ._calcDefaultValue();\r\n\t\t\tif (beforeInsertFn) {\r\n\t\t\t\tbeforeInsertFn(newRecord);\r\n\t\t\t}\r\n\t\r\n\t\t\t//calc other fields' range to use context rule\r\n\t\t\tif (Z._contextRuleEnabled) {\r\n\t\t\t\tZ.calcContextRule();\r\n\t\t\t}\r\n\t\r\n\t\t\tZ._fireDatasetEvent(jslet.data.DatasetEvent.AFTERINSERT);\r\n\t\t\tZ._fireDatasetEvent(jslet.data.DatasetEvent.AFTERSCROLL);\r\n\t\t} finally {\r\n\t\t\tZ._lockCount--;\r\n\t\t}\r\n\t\tvar evt = jslet.data.RefreshEvent.insertEvent(preRecno, Z.recno(), Z._recno < Z.recordCount() - 1);\r\n\t\tZ.refreshControl(evt);\r\n\t},\r\n\r\n\t/**\r\n\t * Insert all records of source dataset into current dataset;\r\n\t * Source dataset's structure must be same as current dataset \r\n\t * \r\n\t * @param {Integer}srcDataset - source dataset\r\n\t */\r\n\tinsertDataset: function (srcDataset) {\r\n\t\tvar Z = this;\r\n\t\tvar oldFiltered = Z.filtered();\r\n\t\tvar thisContext = Z.startSilenceMove(true);\r\n\t\tvar srcContext = srcDataset.startSilenceMove(true), rec;\r\n\t\ttry {\r\n\t\t\tZ.filtered(false);\r\n\t\t\tsrcDataset.first();\r\n\t\t\twhile (!srcDataset.isEof()) {\r\n\t\t\t\tZ.insertRecord();\r\n\t\t\t\tZ.cloneRecord(srcDataset.getRecord(), Z.getRecord());\r\n\t\t\t\tZ.confirm();\r\n\t\t\t\tsrcDataset.next();\r\n\t\t\t}\r\n\t\t} finally {\r\n\t\t\tsrcDataset.endSilenceMove(srcContext);\r\n\t\t\tZ.filtered(oldFiltered);\r\n\t\t\tZ.endSilenceMove(thisContext);\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * Append all records of source dataset into current dataset;\r\n\t * Source dataset's structure must be same as current dataset \r\n\t * \r\n\t * @param {Integer}srcDataset - source dataset\r\n\t */\r\n\tappendDataset: function (srcDataset) {\r\n\t\tvar Z = this;\r\n\t\tZ._silence++;\r\n\t\ttry {\r\n\t\t\tZ.last();\r\n\t\t} finally {\r\n\t\t\tZ._silence--;\r\n\t\t}\r\n\t\tZ.insertDataset(srcDataset);\r\n\t},\r\n\r\n\t/**\r\n\t * Append records into dataset.\r\n\t * \r\n\t * @param {Array} records An array of object which need to append to dataset\r\n\t * @param {Boolean} replaceExists true - replace the record if it exists, false - skip to append if it exists. \r\n\t */\r\n\tbatchAppendRecords: function(records, replaceExists) {\r\n\t\tjslet.Checker.test('dataset.records', records).required().isArray();\r\n\t\tvar Z = this;\r\n\t\tZ.confirm();\r\n\t\t\r\n\t\tZ.selection.removeAll();\r\n\t\tZ.disableControls();\r\n\t\ttry{\r\n\t\t\tvar keyField = Z.keyField(), rec, found,\r\n\t\t\t\tkeyValue;\r\n\t\t\tfor(var i = 0, len = records.length; i < len; i++) {\r\n\t\t\t\trec = records[i];\r\n\t\t\t\tfound = false;\r\n\t\t\t\tif(keyField) {\r\n\t\t\t\t\tkeyValue = rec[keyField];\r\n\t\t\t\t\tif(keyValue && Z.findByKey(keyValue)) {\r\n\t\t\t\t\t\tfound = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif(found) {\r\n\t\t\t\t\tif(replaceExists) {\r\n\t\t\t\t\t\tZ.editRecord();\r\n\t\t\t\t\t\tZ.cloneRecord(rec, Z.getRecord());\r\n\t\t\t\t\t\tZ.confirm();\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tZ.appendRecord();\r\n\t\t\t\t\tZ.cloneRecord(rec, Z.getRecord());\r\n\t\t\t\t\tZ.confirm();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} finally {\r\n\t\t\tZ.enableControls();\r\n\t\t\tZ.refreshControl(jslet.data.RefreshEvent._updateAllEvent);\r\n\t\t\tZ.refreshLookupHostDataset();\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * @rivate\r\n\t * Calculate default value.\r\n\t */\r\n\t_calcDefaultValue: function () {\r\n\t\tvar Z = this, fldObj, expr, value, fldName;\r\n\t\tfor (var i = 0, fldcnt = Z._normalFields.length; i < fldcnt; i++) {\r\n\t\t\tfldObj = Z._normalFields[i];\r\n\t\t\tfldName = fldObj.name();\r\n\t\t\tif (fldObj.getType() == jslet.data.DataType.DATASET) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif(fldObj.valueFollow() && Z._followedValues) {\r\n\t\t\t\tvar fValue = Z._followedValues[fldName];\r\n\t\t\t\tif(fValue !== undefined) {\r\n\t\t\t\t\tfldObj.setValue(fValue);\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tvalue = fldObj.defaultValue();\r\n\t\t\tif (value === undefined || value === null || value === '') {\r\n\t\t\t\texpr = fldObj.defaultExpr();\r\n\t\t\t\tif (!expr) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\tvalue = window.eval(expr);\r\n\t\t\t} else {\r\n\t\t\t\tif(fldObj.getType() === jslet.data.DataType.NUMBER) {\r\n\t\t\t\t\tvalue = fldObj.scale() > 0 ? parseFloat(value): parseInt(value);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tvar valueStyle = fldObj.valueStyle();\r\n\t\t\tif(value && jslet.isDate(value)) {\r\n\t\t\t\tvalue = new Date(value.getTime());\r\n\t\t\t}\r\n\t\t\tif(valueStyle == jslet.data.FieldValueStyle.BETWEEN) {\r\n\t\t\t\tif(value) {\r\n\t\t\t\t\tvalue = [value, value];\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvalue = [null, null];\r\n\t\t\t\t}\r\n\t\t\t} else if(valueStyle == jslet.data.FieldValueStyle.MULTIPLE) {\r\n\t\t\t\tvalue = [value];\r\n\t\t\t}\r\n\t\t\tZ.setFieldValue(fldName, value);\t\t\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * @rivate\r\n\t * Calculate default value.\r\n\t */\r\n\tcheckAggraded: function(fldName) {\r\n\t\tvar Z = this,\r\n\t\t\taggrFields = Z._aggradedFields;\r\n\t\tif(!aggrFields || aggrFields.length === 0) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tif(!fldName) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\tvar fldObj;\r\n\t\tfor(var i = 0, len = aggrFields.length; i < len; i++) {\r\n\t\t\tif(aggrFields[i].name() === fldName) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Disable aggrade value. It's used for improving performance for batch operating, especially for huge data.\r\n\t */\r\n\tdisableAggrading: function() {\r\n\t\tthis._aggradingCount++;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Enable aggrade value.\r\n\t */\r\n\tenableAggrading: function() {\r\n\t\tvar Z = this;\r\n\t\tif(Z._aggradingCount > 0) {\r\n\t\t\tZ._aggradingCount--;\r\n\t\t\tif(Z._aggradingCount === 0) {\r\n\t\t\t\tZ._calcAggradedValueDebounce.call(Z);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * \r\n\t * Calculate aggraded value.\r\n\t */\r\n\tcalcAggradedValue: function(fldName) {\r\n\t\tvar Z = this;\r\n\t\t\r\n\t\tif(Z._aggradingCount > 0 || !Z.checkAggraded(fldName)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar aggrFields = Z._aggradedFields,\r\n\t\t\tfldObj, aggradedBy,\r\n\t\t\tarrAggradeBy = [],\r\n\t\t\taggradedValues = null,\r\n\t\t\tnotCalcFields = [],\r\n\t\t\tisNum, i, len;\r\n\t\tfor(i = 0, len = aggrFields.length; i < len; i++) {\r\n\t\t\tfldObj = aggrFields[i];\r\n\t\t\taggradedBy = fldObj.aggradedBy();\r\n\t\t\tisNum = fldObj.getType() === jslet.data.DataType.NUMBER;\r\n\t\t\tif((!isNum || isNum && fldObj.lookup()) && !aggradedBy) {\r\n\t\t\t\tif(!aggradedValues) {\r\n\t\t\t\t\taggradedValues = {};\r\n\t\t\t\t}\r\n\t\t\t\tfldName = fldObj.name();\r\n\t\t\t\taggradedValues[fldName] = {count: Z.recordCount(), sum: 0};\r\n\t\t\t\tnotCalcFields.push(fldName);\r\n\t\t\t}\r\n\t\t\tif(aggradedBy && arrAggradeBy.indexOf(aggradedBy) === -1) {\r\n\t\t\t\tarrAggradeBy.push({aggradedBy: aggradedBy, values: {}, exists: false});\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(aggrFields.length === notCalcFields.length) {\r\n\t\t\tZ.aggradedValues(aggradedValues);\t\t\t\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif(!aggradedValues) {\r\n\t\t\taggradedValues = {};\r\n\t\t}\r\n\t\t\r\n\t\tfunction getAggradeByValue(aggradedBy) {\r\n\t\t\tif(aggradedBy.indexOf(',') < 0) {\r\n\t\t\t\treturn Z.getFieldValue(aggradedBy);\r\n\t\t\t}\r\n\t\t\tvar fieldNames = aggradedBy.split(',');\r\n\t\t\tvar values = [];\r\n\t\t\tfor(var i = 0, len = fieldNames.length; i < len; i++) {\r\n\t\t\t\tvalues.push(Z.getFieldValue(fieldNames[i]));\r\n\t\t\t}\r\n\t\t\treturn values.join(',');\r\n\t\t}\r\n\t\t\r\n\t\tfunction updateAggrByValues(arrAggradeBy) {\r\n\t\t\tvar aggrByObj, \r\n\t\t\t\taggrByValue,\r\n\t\t\t\tarrAggrByValues;\t\t\t\r\n\t\t\tfor(var i = 0, len = arrAggradeBy.length; i < len; i++) {\r\n\t\t\t\taggrByObj = arrAggradeBy[i];\r\n\t\t\t\tarrAggrByValues = aggrByObj.values;\r\n\t\t\t\taggrByValue = getAggradeByValue(aggrByObj.aggradedBy);\r\n\t\t\t\tif(!arrAggrByValues[aggrByValue]) {\r\n\t\t\t\t\tarrAggrByValues[aggrByValue] = null;\r\n\t\t\t\t\taggrByObj.exists = false;\r\n\t\t\t\t} else {\r\n\t\t\t\t\taggrByObj.exists = true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tfunction existAggrBy(arrAggradeBy, aggradedBy) {\r\n\t\t\tvar aggrByObj;\t\t\t\r\n\t\t\tfor(var i = 0, len = arrAggradeBy.length; i < len; i++) {\r\n\t\t\t\taggrByObj = arrAggradeBy[i];\r\n\t\t\t\tif(aggrByObj.aggradedBy == aggradedBy) {\r\n\t\t\t\t\treturn aggrByObj.exists;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tconsole.warn('Not found aggradedBy value!');\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\t\r\n\t\tvar oldRecno = Z.recnoSilence(),\r\n\t\t\tfldCnt = aggrFields.length, \r\n\t\t\tvalue, totalValue,\r\n\t\t\taggradedValueObj;\r\n\t\ttry{\r\n\t\t\tfor(var k = 0, recCnt = Z.recordCount(); k < recCnt; k++) {\r\n\t\t\t\tZ.recnoSilence(k);\r\n\t\t\t\tupdateAggrByValues(arrAggradeBy);\r\n\t\t\t\t\r\n\t\t\t\tfor(i = 0; i < fldCnt; i++) {\r\n\t\t\t\t\tfldObj = aggrFields[i];\r\n\t\t\t\t\tfldName = fldObj.name();\r\n\t\t\t\t\tif(notCalcFields.indexOf(fldName) >= 0) {\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\t\t\t\t\taggradedBy = fldObj.aggradedBy();\r\n\t\t\t\t\tif(aggradedBy && existAggrBy(arrAggradeBy, aggradedBy)) {\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\t\t\t\t\taggradedValueObj = aggradedValues[fldName];\r\n\t\t\t\t\tif(!aggradedValueObj) {\r\n\t\t\t\t\t\taggradedValueObj = {count: 0, sum: 0};\r\n\t\t\t\t\t\taggradedValues[fldName] = aggradedValueObj; \r\n\t\t\t\t\t}\r\n\t\t\t\t\taggradedValueObj.count = aggradedValueObj.count + 1;\r\n\t\t\t\t\tif(fldObj.getType() === jslet.data.DataType.NUMBER) {\r\n\t\t\t\t\t\tvalue = Z.getFieldValue(fldName) || 0;\r\n\t\t\t\t\t\tif(jslet.isString(value)) {\r\n\t\t\t\t\t\t\t//Invalid value: [{1}] for NUMBER field: [{0}]!\r\n\t\t\t\t\t\t\tthrow new Error(jslet.formatMessage(jslet.locale.Dataset.invalidNumberFieldValue, [fldName, value]));\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\taggradedValueObj.sum = aggradedValueObj.sum + value;\r\n\t\t\t\t\t}\r\n\t\t\t\t} //end for i\r\n\t\t\t} //end for k\r\n\t\t}finally{\r\n\t\t\tZ.recnoSilence(oldRecno);\r\n\t\t}\r\n\t\tvar scale;\r\n\t\tfor(i = 0; i < fldCnt; i++) {\r\n\t\t\tfldObj = aggrFields[i];\r\n\t\t\tfldName = fldObj.name();\r\n\t\t\tscale = fldObj.scale() || 0;\r\n\t\t\taggradedValueObj = aggradedValues[fldName];\r\n\t\t\tif(!aggradedValueObj ) {\r\n\t\t\t\taggradedValueObj = {count: 0, sum: 0};\r\n\t\t\t\taggradedValues[fldName] = aggradedValueObj;\r\n\t\t\t}\r\n\t\t\tvar sumValue = aggradedValueObj.sum;\r\n\t\t\tif(sumValue) {\r\n\t\t\t\tvar pow = Math.pow(10, scale);\r\n\t\t\t\tsumValue = Math.round(sumValue * pow) / pow;\r\n\t\t\t\taggradedValueObj.sum = sumValue;\r\n\t\t\t}\r\n\t\t} //end for i\r\n\t\tZ.aggradedValues(aggradedValues);\t\t\t\r\n\t},\r\n\t\r\n\taggradedValues: function(aggradedValues) {\r\n\t\tvar Z = this;\r\n\t\tif(aggradedValues === undefined) {\r\n\t\t\treturn Z._aggradedValues;\r\n\t\t}\r\n\t\tZ._aggradedValues = aggradedValues;\r\n\t\tif(!Z._aggradedValues && !aggradedValues) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tvar evt = jslet.data.RefreshEvent.aggradedEvent();\r\n\t\tZ.refreshControl(evt);\r\n\t},\r\n\t\r\n\t/**\r\n\t * Get record object by record number.\r\n\t * \r\n\t * @param {Integer} recno Record Number.\r\n\t * @return {Object} Dataset record.\r\n\t */\r\n\tgetRecord: function (recno) {\r\n\t\tvar Z = this, k;\r\n\t\tif (recno === undefined || recno === null) {\r\n\t\t\trecno = Z._recno >= 0 ? Z._recno : 0;\r\n\t\t} else {\r\n\t\t\tif (recno < 0 || recno >= Z.recordCount()) {\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(!Z.hasData()) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\tvar records = Z.dataList();\r\n\t\t//Used to convert field value for performance purpose. \r\n\t\tif(Z._ignoreFilter) {\r\n\t\t\treturn records[Z._ignoreFilterRecno || 0];\r\n\t\t}\r\n\t\t\r\n\t\tif (Z.recordCount() === 0) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\t\r\n\t\tif (Z._filteredRecnoArray) {\r\n\t\t\tk = Z._filteredRecnoArray[recno];\r\n\t\t} else {\r\n\t\t\tk = recno;\r\n\t\t}\r\n\r\n\t\treturn records[k];\r\n\t},\r\n\r\n\t/**\r\n\t * @private\r\n\t */\r\n\tgetRelativeRecord: function (delta) {\r\n\t\treturn this.getRecord(this._recno + delta);\r\n\t},\r\n\r\n\t/**\r\n\t * @private\r\n\t */\r\n\tisSameAsPrevious: function (fldName) {\r\n\t\tvar Z = this,\r\n\t\t\tpreRec = Z.getRelativeRecord(-1);\r\n\t\tif (!preRec) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tvar currRec = Z.getRecord(),\r\n\t\t\tpreValue = Z.getFieldValueByRecord(preRec, fldName),\r\n\t\t\tcurrValue = Z.getFieldValueByRecord(currRec, fldName),\r\n\t\t\tisSame = false;\r\n\t\tif(!preValue && preValue !== 0 && !currValue && currValue !== 0) {\r\n\t\t\tisSame = true;\r\n\t\t} else if(preValue && currValue) {\r\n\t\t\tif(jslet.isDate(preValue)) { //Date time comparing\r\n\t\t\t\tisSame = (preValue.getTime() == currValue.getTime());\r\n\t\t\t} else {\r\n\t\t\t\tisSame = (preValue == currValue);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(!isSame) {\r\n\t\t\treturn isSame;\r\n\t\t}\r\n\t\tvar\tfldObj = Z.getField(fldName),\r\n\t\t\tmergeSameBy = fldObj.mergeSameBy();\r\n\t\tif(mergeSameBy) {\r\n\t\t\tvar arrFlds = mergeSameBy.split(','), groupFldName;\r\n\t\t\tfor(var i = 0, len = arrFlds.length; i < len; i++) {\r\n\t\t\t\tgroupFldName = jQuery.trim(arrFlds[i]);\r\n\t\t\t\tif(preRec[groupFldName] != currRec[groupFldName]) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn isSame;\r\n\t},\r\n\r\n\t/**\r\n\t * Check wheather the current record has child records or not\r\n\t * \r\n\t * @return {Boolean}\r\n\t */\r\n\thasParent: function() {\r\n\t\tvar Z = this,\r\n\t\t\tpFldName = Z.parentField();\r\n\t\tif(!pFldName || Z.recno() === 0) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tvar recno = Z.recno() - 1;\r\n\t\tfor(var k = recno; k >= 0; k--) {\r\n\t\t\tvar pKeyValue = Z.getFieldValue(pFldName),\r\n\t\t\t\tprevRec = this.getRelativeRecord(k - recno),\r\n\t\t\t\tkeyValue = this.getFieldValueByRecord(prevRec, Z.keyField());\r\n\t\t\t\r\n\t\t\tif(jslet.compareValue(pKeyValue, keyValue) === 0) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\tvar prePKeyValue = this.getFieldValueByRecord(prevRec, Z.parentField());\r\n\t\t\tif(jslet.compareValue(pKeyValue, prePKeyValue) !== 0) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Check the current record has child records or not\r\n\t * \r\n\t * @return {Boolean}\r\n\t */\r\n\thasChildren: function () {\r\n\t\tvar Z = this;\r\n\t\tif (!Z._parentField) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tif(Z._recno < Z.recordCount() - 1) {\r\n\t\t\tif (Z.parentValue(Z._recno + 1) === Z.keyValue()) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t},\r\n\t\r\n\t/** \r\n\t* Iterate the child records of current record, and run the specified callback function. \r\n\t* Callback function pattern:\r\n\t* \t//@param {Boolean} isDirectChild - true - is direct child, false - otherwise.\r\n\t* \t//@return {Boolean} identify continue iterating or not, true - break iterating, false -continue iterating.\r\n\t*   //\r\n\t* \tfunction(isDirectChild) {\r\n\t* \t\treturn false;\r\n\t* \t}\r\n\t* Example: \r\n\t* \r\n\t* dataset.iterateChildren(function(isDirectChild){\r\n\t* \tvar fldValue = this.getFieldValue('xxx');\r\n\t* \tthis.setFieldValue('xxx', fldValue);\r\n\t* }); \r\n\t* \r\n\t*/ \r\n\titerateChildren: function(callBackFn) {\r\n\t\tvar Z = this;\r\n\t\tif (!Z._parentField) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar context = Z.startSilenceMove(),\r\n\t\t\tpreKeyValue = Z.keyValue(),\r\n\t\t\trootValue = preKeyValue,\r\n\t\t\tarrPValues = [];\r\n\t\ttry {\r\n\t\t\tZ.next();\r\n\t\t\tvar keyValue, pValue, isExist;\r\n\t\t\twhile (!Z.isEof()) {\r\n\t\t\t\tpValue = Z.parentValue();\r\n\t\t\t\tisExist = (arrPValues.indexOf(pValue) >= 0);\r\n\t\t\t\tif(jslet.compareValue(pValue, preKeyValue) === 0 && !isExist) {\r\n\t\t\t\t\tarrPValues.push(preKeyValue);\r\n\t\t\t\t\tisExist = true;\r\n\t\t\t\t}\r\n\t\t\t\tif (!isExist) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tif(callBackFn) {\r\n\t\t\t\t\tvar breakIterator = callBackFn.call(Z, jslet.compareValue(pValue, rootValue) === 0);\r\n\t\t\t\t\tif(breakIterator) {\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tpreKeyValue = Z.keyValue();\r\n\t\t\t\tZ.next();\r\n\t\t\t}\r\n\t\t} finally {\r\n\t\t\tZ.endSilenceMove(context);\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * Update record and send dataset to update status.\r\n\t * You can use cancel() or confirm() method to return browse status.\r\n\t */\r\n\teditRecord: function () {\r\n\t\tvar Z = this;\r\n\t\tif (Z._status == jslet.data.DataSetStatus.UPDATE ||\r\n\t\t\tZ._status == jslet.data.DataSetStatus.INSERT) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tZ.selection.removeAll();\r\n\t\tif (!Z.hasRecord()) {\r\n\t\t\tZ.insertRecord();\r\n\t\t} else {\r\n\t\t\tZ._aborted = false;\r\n\t\t\ttry {\r\n\t\t\t\tZ._fireDatasetEvent(jslet.data.DatasetEvent.BEFOREUPDATE);\r\n\t\t\t\tif (Z._aborted) { \r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t} finally {\r\n\t\t\t\tZ._aborted = false;\r\n\t\t\t}\r\n\r\n\t\t\tZ._modiObject = {};\r\n\t\t\tjQuery.extend(Z._modiObject, Z.getRecord());\r\n\t\t\tvar dsMaster = Z.masterDataset();\r\n\t\t\tif (dsMaster) {\r\n\t\t\t\tdsMaster.editRecord();\r\n\t\t\t}\r\n\r\n\t\t\tZ.status(jslet.data.DataSetStatus.UPDATE);\r\n//\t\t\tZ.changedStatus(jslet.data.DataSetStatus.UPDATE);\r\n\t\t\tZ._fireDatasetEvent(jslet.data.DatasetEvent.AFTERUPDATE);\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * Delete record\r\n\t */\r\n\tdeleteRecord: function () {\r\n\t\tvar Z = this;\r\n\t\tvar recCnt = Z.recordCount();\r\n\t\tif (recCnt === 0 || Z.changedStatus() === jslet.data.DataSetStatus.DELETE) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tZ.selection.removeAll();\r\n\t\tif (Z._status == jslet.data.DataSetStatus.INSERT) {\r\n\t\t\tZ.cancel();\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tZ._silence++;\r\n\t\ttry {\r\n\t\t\tZ.checkStatusByCancel();\r\n\t\t} finally {\r\n\t\t\tZ._silence--;\r\n\t\t}\r\n\r\n\t\tif (Z.hasChildren()) {\r\n\t\t\tjslet.showInfo(jslet.locale.Dataset.cannotDelParent);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tZ._aborted = false;\r\n\t\ttry {\r\n\t\t\tZ._fireDatasetEvent(jslet.data.DatasetEvent.BEFOREDELETE);\r\n\t\t\tif (Z._aborted) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t} finally {\r\n\t\t\tZ._aborted = false;\r\n\t\t}\r\n\t\tvar preRecno = Z.recno(), \r\n\t\t\tisLast = preRecno == (recCnt - 1), \r\n\t\t\tk = Z._recno;\r\n\t\tif(Z.changedStatus() === jslet.data.DataSetStatus.INSERT) {\r\n\t\t\tZ._changeLog.unlog();\r\n\t\t} else {\r\n\t\t\tZ.changedStatus(jslet.data.DataSetStatus.DELETE);\r\n\t\t\tZ._changeLog.log();\r\n\t\t}\r\n\t\tZ.dataList().splice(k, 1);\r\n\t\tZ._refreshInnerRecno();\r\n\t\t\r\n\t\tvar dsMaster = Z.masterDataset();\r\n\t\tif (dsMaster) {\r\n\t\t\tdsMaster.editRecord();\r\n\t\t}\r\n\r\n\t\tZ.status(jslet.data.DataSetStatus.BROWSE);\r\n\t\t\r\n\t\tif (isLast) {\r\n\t\t\tZ._silence++;\r\n\t\t\ttry {\r\n\t\t\t\tZ.prior();\r\n\t\t\t} finally {\r\n\t\t\t\tZ._silence--;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tZ._refreshProxyField();\r\n\t\t\tif (Z._contextRuleEnabled) {\r\n\t\t\t\tthis.calcContextRule();\r\n\t\t\t}\r\n\t\t}\r\n\t\tZ._calcAggradedValueDebounce.call(Z);\r\n\t\tvar evt = jslet.data.RefreshEvent.deleteEvent(preRecno);\r\n\t\tZ.refreshControl(evt);\r\n\t\t\r\n\t\tZ._fireDatasetEvent(jslet.data.DatasetEvent.AFTERSCROLL);\t\r\n\t\tZ.refreshLookupHostDataset();\r\n\t\tvar detailFields = Z._detailDatasetFields;\r\n\t\tif(detailFields) {\r\n\t\t\tvar dtlFldObj, dsDetail;\r\n\t\t\tfor(var i = 0, len = detailFields.length; i < len; i++) {\r\n\t\t\t\tdtlFldObj = detailFields[i];\r\n\t\t\t\tdsDetail = dtlFldObj.detailDataset();\r\n\t\t\t\tif(dsDetail) {\r\n\t\t\t\t\tdsDetail.refreshControl();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (Z.isBof() && Z.isEof()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tevt = jslet.data.RefreshEvent.scrollEvent(Z._recno);\r\n\t\tZ.refreshControl(evt);\r\n\t\t\r\n\t},\r\n\r\n\t/**\r\n\t * Delete all selected records;\r\n\t */\r\n\tdeleteSelected: function() {\r\n\t\tvar Z = this, \r\n\t\t\trecords = Z.selectedRecords(),\r\n\t\t\trecObj;\r\n\t\tZ.disableControls();\r\n\t\ttry {\r\n\t\t\tfor(var i = records.length - 1; i >= 0; i--) {\r\n\t\t\t\trecObj = records[i];\r\n\t\t\t\tZ.moveToRecord(recObj);\r\n\t\t\t\tZ.deleteRecord();\r\n\t\t\t}\r\n\t\t} finally {\r\n\t\t\tZ.enableControls();\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * @private\r\n\t */\r\n\t_innerValidateData: function () {\r\n\t\tvar Z = this;\r\n\t\tif (Z._status == jslet.data.DataSetStatus.BROWSE || Z.recordCount() === 0) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar fldObj, fldName, fldValue, invalidMsg, firstInvalidField = null;\r\n\r\n\t\tfor (var i = 0, cnt = Z._normalFields.length; i < cnt; i++) {\r\n\t\t\tfldObj = Z._normalFields[i];\r\n\t\t\tif (fldObj.disabled() || fldObj.readOnly() || !fldObj.visible()) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tfldName = fldObj.name();\r\n\t\t\tfldValue = Z.getFieldValue(fldName);\r\n\t\t\tif(fldObj.valueStyle() == jslet.data.FieldValueStyle.NORMAL && Z.existFieldError(fldName)) {\r\n\t\t\t\tinvalidMsg = Z._fieldValidator.checkRequired(fldObj, fldValue);\r\n\t\t\t\tinvalidMsg = invalidMsg || Z._fieldValidator.checkValue(fldObj, fldValue);\r\n\t\t\t\tif (invalidMsg) {\r\n\t\t\t\t\tZ.setFieldError(fldName, invalidMsg);\r\n\t\t\t\t\tif(!firstInvalidField) {\r\n\t\t\t\t\t\tfirstInvalidField = fldName;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tinvalidMsg = Z._fieldValidator.checkRequired(fldObj, fldValue);\r\n\t\t\t\tif (invalidMsg) {\r\n\t\t\t\t\tZ.setFieldError(fldName, invalidMsg);\r\n\t\t\t\t\tif(!firstInvalidField) {\r\n\t\t\t\t\t\tfirstInvalidField = fldName;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif(fldObj.valueStyle() == jslet.data.FieldValueStyle.BETWEEN) {\r\n\t\t\t\t\tvar v1 = null, v2 = null;\r\n\t\t\t\t\tif(fldValue && fldValue.length === 2) {\r\n\t\t\t\t\t\tv1 = fldValue[0];\r\n\t\t\t\t\t\tv2 = fldValue[1];\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif(v1 && v2) {\r\n\t\t\t\t\t\tinvalidMsg = null;\r\n\t\t\t\t\t\tif(jslet.isDate(v1) && v1.getTime() > v2.getTime() || v1 > v2) {\r\n\t\t\t\t\t\t\tinvalidMsg = jslet.locale.Dataset.betwwenInvalid;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (invalidMsg) {\r\n\t\t\t\t\t\t\tZ.setFieldError(fldName, invalidMsg, 0);\r\n\t\t\t\t\t\t\tif(!firstInvalidField) {\r\n\t\t\t\t\t\t\t\tfirstInvalidField = fldName;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif(fldValue) {\r\n\t\t\t\t\tvar recObj = Z.getRecord();\r\n\t\t\t\t\tfor(var k = 0, len = fldValue.length; k < len; k++) {\r\n\t\t\t\t\t\tif(Z.existFieldError(fldName, k)) {\r\n\t\t\t\t\t\t\tinvalidMsg = invalidMsg || Z._fieldValidator.checkValue(fldObj, fldValue);\r\n\t\t\t\t\t\t\tif (invalidMsg) {\r\n\t\t\t\t\t\t\t\tZ.setFieldError(fldName, invalidMsg, k);\r\n\t\t\t\t\t\t\t\tif(!firstInvalidField) {\r\n\t\t\t\t\t\t\t\t\tfirstInvalidField = fldName;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} //end for k\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t} //end for i\r\n\t\tif(Z._masterDataset && Z._masterField) {\r\n\t\t\tvar masterDsObj = jslet.data.getDataset(Z._masterDataset),\r\n\t\t\t\tmasterFldObj = masterDsObj.getField(Z._masterField);\r\n\t\t\tif(Z.existRecordError()) {\r\n\t\t\t\t//'Detail Dataset: {0} has error data!'\r\n\t\t\t\tmasterDsObj.addFieldError(Z._masterField, jslet.formatMessage(jslet.locale.Dataset.detailDsHasError, [Z.name()]));\r\n\t\t\t} else {\r\n\t\t\t\tmasterDsObj.addFieldError(Z._masterField, null);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif(firstInvalidField) {\r\n\t\t\tZ.focusEditControl(firstInvalidField);\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * @private\r\n\t */\r\n\terrorMessage: function(errMessage) {\r\n\t\tvar evt = jslet.data.RefreshEvent.errorEvent(errMessage || '');\r\n\t\tthis.refreshControl(evt);\r\n\t},\r\n\t\r\n\taddFieldError: function(fldName, errorMsg, valueIndex, inputText) {\r\n\t\tjslet.data.FieldError.put(this.getRecord(), fldName, errorMsg, valueIndex, inputText);\r\n\t},\r\n\t\r\n\taddDetailFieldError: function(fldName, errorCount) {\r\n\t\tjslet.data.putDetailError.put(this.getRecord(), fldName, errorCount);\r\n\t},\r\n\t\r\n\texistRecordError: function(recno, checkingFields) {\r\n\t\treturn jslet.data.FieldError.existRecordError(this.getRecord(recno), checkingFields);\r\n\t},\r\n\t\r\n\tgetRecordErrorInfo: function(recno, checkingFields) {\r\n\t\tvar record = this.getRecord(recno);\r\n\t\tif(!this.existRecordError()) {\r\n\t\t\treturn '';\r\n\t\t}\r\n\t\tvar recInfo = jslet.data.getRecInfo(record);\r\n\t\tif(!recInfo) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\tvar result = '',\r\n\t\t\terrObj = recInfo.error,\r\n\t\t\tfldObj;\r\n\t\tif(errObj) {\r\n\t\t\tfor(var fldName in errObj) {\r\n\t\t\t\tif(checkingFields && checkingFields.indexOf(fldName) < 0) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\tvar msg = jslet.data.FieldError.get(record, fldName).message;\r\n\t\t\t\tif(msg) {\r\n\t\t\t\t\tfldObj = this.getField(fldName);\r\n\t\t\t\t\tif(result) {\r\n\t\t\t\t\t\tresult += ', ';\r\n\t\t\t\t\t}\r\n\t\t\t\t\tresult += msg;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn result;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Check show error message if the dataset exists error data.\r\n\t * \r\n\t * @param {String[]} checkingFields - checking field names.\r\n\t */\r\n\tcheckAndShowError: function(checkingFields) {\r\n\t\tvar Z = this;\r\n\t\tif(Z.existDatasetError(checkingFields)) {\r\n\t\t\tif (Z._autoShowError) {\r\n\t\t\t\tjslet.showError(jslet.locale.Dataset.cannotConfirm, function() {\r\n\t\t\t\t\tZ.focusFirstErrorField();\r\n\t\t\t\t}, 2000);\r\n\t\t\t} else {\r\n\t\t\t\tconsole.warn(jslet.locale.Dataset.cannotConfirm);\r\n\t\t\t\tZ.focusFirstErrorField();\r\n\t\t\t}\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\treturn false;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Check if the dataset exists error data.\r\n\t * \r\n\t * @param {String[]} checkingFields - checking field names.\r\n\t */\r\n\texistDatasetError: function(checkingFields) {\r\n\t\tvar Z = this, isError = false,\r\n\t\t\tdataList = Z.dataList();\r\n\t\tif(!dataList) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tfor(var i = 0, len = dataList.length; i < len; i++) {\r\n\t\t\tisError = jslet.data.FieldError.existRecordError(dataList[i], checkingFields);\r\n\t\t\tif(isError) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Confirm insert or update\r\n\t */\r\n\tconfirm: function () {\r\n\t\tvar Z = this;\r\n\t\tif (Z._status === jslet.data.DataSetStatus.BROWSE) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\tvar dataList = Z.dataList();\r\n\t\tif(!dataList || dataList.length ===0) {\r\n\t\t\tZ._status = jslet.data.DataSetStatus.BROWSE;\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\tZ._fireDatasetEvent(jslet.data.DatasetEvent.BEFORECONFIRM);\r\n\t\tZ._confirmDetailDataset();\r\n\t\tZ._innerValidateData();\r\n\t\tif(Z.status() === jslet.data.DataSetStatus.UPDATE) {\r\n\t\t\tZ.changedStatus(jslet.data.DataSetStatus.UPDATE);\r\n\t\t}\r\n\t\t\r\n\t\tvar evt, hasError = Z.existRecordError();\r\n\t\tvar rec = Z.getRecord();\r\n\t\tZ._modiObject = null;\r\n\t\tZ.status(jslet.data.DataSetStatus.BROWSE);\r\n\t\tif(!hasError) {\r\n\t\t\tZ._changeLog.log();\r\n\t\t}\r\n\t\tZ._fireDatasetEvent(jslet.data.DatasetEvent.AFTERCONFIRM);\r\n\t\tZ._calcAggradedValueDebounce.call(Z);\r\n\t\tevt = jslet.data.RefreshEvent.updateRecordEvent();\r\n\t\tZ.refreshControl(evt);\r\n\t\tif(hasError) {\r\n\t\t\tZ.errorMessage(jslet.locale.Dataset.cannotConfirm);\t\t\t\r\n\t\t} else {\r\n\t\t\tjslet.data.FieldError.clearRecordError(Z.getRecord());\r\n\t\t\tZ.errorMessage();\r\n\t\t}\r\n\t\tvar dsMaster = Z.masterDataset();\r\n\t\tif (dsMaster) {\r\n\t\t\tvar masterFldName = Z.masterField();\r\n\t\t\tif(hasError) {\r\n\t\t\t\t//'Detail Dataset: {0} has error data!'\r\n\t\t\t\tdsMaster.addFieldError(masterFldName, jslet.formatMessage(jslet.locale.Dataset.detailDsHasError, [Z.name()]));\r\n\t\t\t} else {\r\n\t\t\t\tdsMaster.addFieldError(masterFldName, null);\r\n\t\t\t}\r\n\t\t\tdsMaster.refreshControl(evt);\r\n\t\t}\r\n\r\n\t\treturn !hasError;\r\n\t},\r\n\r\n\t/*\r\n\t * @private\r\n\t */\r\n\t_confirmDetailDataset: function() {\r\n\t\tvar Z = this,\r\n\t\t\tfldObj, i, len,\r\n\t\t\tdtlDatasets = [],\r\n\t\t\tdtlFields = [];\r\n\t\tfor (i = 0, len = Z._normalFields.length; i < len; i++) {\r\n\t\t\tfldObj = Z._normalFields[i];\r\n\t\t\tif(fldObj.getType() === jslet.data.DataType.DATASET) {\r\n\t\t\t\tdtlDatasets.push(fldObj.detailDataset());\r\n\t\t\t\tdtlFields.push(fldObj.name());\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar dsDetail, oldShowError;\r\n\t\tfor(i = 0, len = dtlDatasets.length; i < len; i++) {\r\n\t\t\tdsDetail = dtlDatasets[i];\r\n\t\t\tif(!dsDetail) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tdsDetail.confirm();\r\n\t\t\tif(dsDetail.existDatasetError()) {\r\n\t\t\t\t//'Detail Dataset: {0} has error data!'\r\n\t\t\t\tZ.addFieldError(dtlFields[i], jslet.formatMessage(jslet.locale.Dataset.detailDsHasError, [dsDetail.name()]));\r\n\t\t\t} else {\r\n\t\t\t\tZ.addFieldError(dtlFields[i], null);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * Cancel insert or update\r\n\t */\r\n\tcancel: function () {\r\n\t\tvar Z = this;\r\n\t\tif (Z._status == jslet.data.DataSetStatus.BROWSE) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (Z.recordCount() === 0) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tZ._aborted = false;\r\n\t\ttry {\r\n\t\t\tZ._fireDatasetEvent(jslet.data.DatasetEvent.BEFORECANCEL);\r\n\t\t\tif (Z._aborted) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t} finally {\r\n\t\t\tZ._aborted = false;\r\n\t\t}\r\n\t\t Z._cancelDetailDataset();\r\n\t\t var evt, \r\n\t\t\tk = Z._recno,\r\n\t\t\trecords = Z.dataList();\r\n\t\tif (Z._status == jslet.data.DataSetStatus.INSERT) {\r\n\t\t\tZ.selection.removeAll();\r\n\t\t\tvar no = Z.recno();\r\n\t\t\trecords.splice(k, 1);\r\n\t\t\tZ._refreshInnerRecno();\r\n\t\t\tif(no >= Z.recordCount()) {\r\n\t\t\t\tZ._recno = Z.recordCount() - 1;\r\n\t\t\t}\r\n\t\t\tZ._refreshProxyField();\r\n\t\t\tif (Z._contextRuleEnabled) {\r\n\t\t\t\tthis.calcContextRule();\r\n\t\t\t}\r\n\r\n\t\t\tZ._calcAggradedValueDebounce.call(Z);\r\n\t\t\tevt = jslet.data.RefreshEvent.deleteEvent(no);\r\n\t\t\tZ.refreshControl(evt);\r\n\t\t\tZ.status(jslet.data.DataSetStatus.BROWSE);\r\n\t\t\tZ._fireDatasetEvent(jslet.data.DatasetEvent.AFTERSCROLL);\r\n\t\t\tevt = jslet.data.RefreshEvent.scrollEvent(Z._recno); \r\n\t\t\tZ.refreshControl(evt); \r\n\t\t\treturn;\r\n\t\t} else {\r\n\t\t\tif (Z._filteredRecnoArray) {\r\n\t\t\t\tk = Z._filteredRecnoArray[Z._recno];\r\n\t\t\t}\r\n\t\t\trecords[k] = Z._modiObject;\r\n\t\t\tjslet.data.FieldValueCache.removeCache(Z._modiObject);\r\n\t\t\tZ._modiObject = null;\r\n\t\t}\r\n\r\n\t\tZ._refreshProxyField();\r\n\t\tZ._calcAggradedValueDebounce.call(Z);\r\n\t\tZ.status(jslet.data.DataSetStatus.BROWSE);\r\n\t\tZ._fireDatasetEvent(jslet.data.DatasetEvent.AFTERCANCEL);\r\n\r\n\t\tevt = jslet.data.RefreshEvent.updateRecordEvent();\r\n\t\tZ.refreshControl(evt);\r\n\t},\r\n\r\n    /*\r\n     * @private\r\n     */\r\n    _cancelDetailDataset: function() {\r\n        var Z = this,\r\n            fldObj, i, len,\r\n            detailDatasets = [];\r\n        for (i = 0, len = Z._normalFields.length; i < len; i++) {\r\n            fldObj = Z._normalFields[i];\r\n            if(fldObj.getType() === jslet.data.DataType.DATASET) {\r\n                detailDatasets.push(fldObj.detailDataset());\r\n            }\r\n        }\r\n        var dsDetail;\r\n        for(i = 0, len = detailDatasets.length; i < len; i++) {\r\n            dsDetail = detailDatasets[i];\r\n            dsDetail.cancel();\r\n        }\r\n    },\r\n     \r\n\t/**\r\n\t * If logChanges is false, the changes made by user will not be send to server. \r\n\t * If you don't need submit data to server, you can set this property value to false.\r\n\t * \r\n\t * @param {Boolean or undefined} logChanges - True: log user changes, otherwise false, default is true.\r\n\t * @return {this or Boolean}\r\n\t */\r\n\tlogChanges: function (logChanges) {\r\n\t\tif (logChanges === undefined) {\r\n\t\t\treturn this._logChanges;\r\n\t\t}\r\n\r\n\t\tthis._logChanges = logChanges;\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * Edit log means the log when user modify records. For some sensitive data, user need audit who & when modify data. \r\n\t * \r\n\t * @param {Boolean or undefined} auditLogEnabled - True: enable audit log, otherwise false.\r\n\t * @return {this or Boolean}\r\n\t */\r\n\tauditLogEnabled: function(auditLogEnabled) {\r\n\t\tif(auditLogEnabled === undefined) {\r\n\t\t\treturn this._auditLogEnabled;\r\n\t\t}\r\n\t\tthis.auditLogEnabled = auditLogEnabled? true: false;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Disable refreshing controls, you often use it in a batch operation;\r\n\t * After batch operating, use enableControls()\r\n\t */\r\n\tdisableControls: function () {\r\n\t\tthis._lockCount++;\r\n\t\tvar fldObj, dsDetail;\r\n\t\tfor (var i = 0, cnt = this._normalFields.length; i < cnt; i++) {\r\n\t\t\tfldObj = this._normalFields[i];\r\n\t\t\tdsDetail = fldObj.detailDataset();\r\n\t\t\tif (dsDetail !== null) {\t\t\t\t\r\n\t\t\t\tdsDetail.disableControls();\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * Enable refreshing controls.\r\n\t * \r\n\t * @param {Boolean} refreshCtrl true - Refresh control immediately, false - Otherwise.\r\n\t */\r\n\tenableControls: function (needRefreshCtrl) {\r\n\t\tif (this._lockCount > 0) {\r\n\t\t\tthis._lockCount--;\r\n\t\t}\r\n\t\tif (!needRefreshCtrl) {\r\n\t\t\tthis.refreshControl();\r\n\t\t}\r\n\r\n\t\tvar fldObj, dsDetail;\r\n\t\tfor (var i = 0, cnt = this._normalFields.length; i < cnt; i++) {\r\n\t\t\tfldObj = this._normalFields[i];\r\n\t\t\tdsDetail = fldObj.detailDataset();\r\n\t\t\tif (dsDetail !== null) {\t\t\t\t\r\n\t\t\t\tdsDetail.enableControls();\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * Check the specified field if it is valid or not.\r\n\t * \r\n\t * @param fldName {String} - field name;\r\n\t * @param valueIndex {Integer} - value index.\r\n\t * @return {Boolean} true - exists invalid data.\r\n\t */\r\n\texistFieldError: function(fldName, valueIndex) {\r\n\t\tif (this.recordCount() === 0) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tvar currRec = this.getRecord();\r\n\t\tif (!currRec) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\treturn jslet.data.FieldError.existFieldError(currRec, fldName, valueIndex);\r\n\t},\r\n\t\r\n\tgetFieldError: function(fldName, valueIndex) {\r\n\t\treturn this.getFieldErrorByRecno(null, fldName, valueIndex);\r\n\t},\r\n\t\r\n\tgetFieldErrorByRecno: function(recno, fldName, valueIndex) {\r\n\t\tif (this.recordCount() === 0) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tvar currRec = this.getRecord(recno);\r\n\t\tif (!currRec) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\treturn jslet.data.FieldError.get(currRec, fldName, valueIndex);\r\n\t},\r\n\t\r\n\tsetFieldError: function(fldName, errorMsg, valueIndex, inputText) {\r\n\t\tvar Z = this;\r\n\t\tif (Z.recordCount() === 0) {\r\n\t\t\treturn Z;\r\n\t\t}\r\n\r\n\t\tvar currRec = Z.getRecord();\r\n\t\tif (!currRec) {\r\n\t\t\treturn Z;\r\n\t\t}\r\n\t\tjslet.data.FieldError.put(currRec, fldName, errorMsg, valueIndex, inputText);\r\n\t\treturn this;\r\n\t},\r\n\t\t\r\n\t/**\r\n\t * Get field value of specified record number\r\n\t * \r\n\t * @param {Object} recno - specified record number\r\n\t * @param {String} fldName - field name\r\n\t * @return {Object} field value\r\n\t */\r\n\tgetFieldValueByRecno: function(recno, fldName, valueIndex) {\r\n\t\tvar dataRec = this.getRecord(recno);\r\n\t\tif(!dataRec) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\treturn this.getFieldValueByRecord(dataRec, fldName, valueIndex);\r\n\t},\r\n\t\r\n\t/**\r\n\t * Get field value of specified record\r\n\t * \r\n\t * @param {Object} dataRec - specified record\r\n\t * @param {String} fldName - field name\r\n\t * @return {Object} field value\r\n\t */\r\n\tgetFieldValueByRecord: function (dataRec, fldName, valueIndex) {\r\n\t\tvar Z = this;\r\n\t\tif (Z.recordCount() === 0) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tif (!dataRec) {\r\n\t\t\tdataRec = Z.getRecord();\r\n\t\t}\r\n\t\tZ._refreshProxyField(dataRec, true);\r\n\r\n\t\tvar k = fldName.indexOf('.'), \r\n\t\t\tdtlFldName, fldValue = null,\r\n\t\t\tfldObj = Z.getField(fldName),\r\n\t\t\tvalue, lkds;\r\n\t\tif (k > 0) { //field chain\r\n\t\t\tdtlFldName = fldName.substr(0, k);\r\n\t\t\tfldObj = Z.getField(dtlFldName);\r\n\t\t\tvar lkf = fldObj.lookup(),\r\n\t\t\t\tdsDetail = fldObj.detailDataset();\r\n\t\t\t\r\n\t\t\tif (!lkf && !dsDetail) {\r\n\t\t\t\tthrow new Error(jslet.formatMessage(jslet.locale.Dataset.lookupNotFound, [dtlFldName]));\r\n\t\t\t}\r\n\t\t\tif(lkf) {\r\n\t\t\t\tvalue = jslet.data.FieldRawValueAccessor.getRawValue(dataRec, fldObj);\r\n\t\t\t\tlkds = lkf.dataset();\r\n\t\t\t\tif(!value) {\r\n\t\t\t\t\tfldValue = null;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (lkds.findByField(lkds.keyField(), value)) {\r\n\t\t\t\t\t\tfldValue = lkds.getFieldValue(fldName.substr(k + 1));\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthrow new Error(jslet.formatMessage(jslet.locale.Dataset.valueNotFound,\r\n\t\t\t\t\t\t\t\t\t[lkds.name(),lkds.keyField(), value]));\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tfldValue = dsDetail.getFieldValue(fldName.substr(k + 1));\r\n\t\t\t}\r\n\t\t\t\r\n\t\t} else { //single field\r\n\t\t\tif (!fldObj) {\r\n\t\t\t\tthrow new Error(jslet.formatMessage(jslet.locale.Dataset.fieldNotFound, [fldName]));\r\n\t\t\t}\r\n\t\t\tvar formula = fldObj.formula();\r\n\t\t\tif (!formula) {\r\n\t\t\t\tfldValue = jslet.data.FieldRawValueAccessor.getRawValue(dataRec, fldObj);\r\n\t\t\t} else {\r\n\t\t\t\tif(dataRec[fldName] === undefined) {\r\n\t\t\t\t\tfldValue = Z._calcFormula(dataRec, fldName);\r\n\t\t\t\t\tjslet.data.FieldRawValueAccessor.setRawValue(dataRec, fldObj, fldValue);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tfldValue = jslet.data.FieldRawValueAccessor.getRawValue(dataRec, fldObj);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif(!fldObj.valueStyle() || valueIndex === undefined) { //jslet.data.FieldValueStyle.NORMAL\r\n\t\t\treturn fldValue;\r\n\t\t}\r\n\t\treturn jslet.getArrayValue(fldValue, valueIndex);\r\n\t},\r\n\r\n\t/**\r\n\t * Get field value of current record\r\n\t * \r\n\t * @param {String} fldName - field name\r\n\t * @param {Integer or undefined} valueIndex get the specified value if a field has multiple values.\r\n\t *\t\tif valueIndex is not specified, all values(Array of value) will return.\r\n\t * @return {Object}\r\n\t */\r\n\tgetFieldValue: function (fldName, valueIndex) {\r\n\t\tif (this.recordCount() === 0) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tvar currRec = this.getRecord();\r\n\t\tif (!currRec) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\treturn this.getFieldValueByRecord(currRec, fldName, valueIndex);\r\n\t},\r\n\r\n\t/**\r\n\t * Set field value of current record.\r\n\t * \r\n\t * @param {String} fldName - field name\r\n\t * @param {Object} value - field value\r\n\t * @param {Integer or undefined} valueIndex set the specified value if a field has multiple values.\r\n\t *\t\tif valueIndex is not specified, Array of value will be set.\r\n\t * @return {this}\r\n\t */\r\n\tsetFieldValue: function (fldName, value, valueIndex) {\r\n\t\tvar Z = this,\r\n\t\t\tfldObj = Z.getField(fldName);\r\n\t\tif (fldObj === null) {\r\n\t\t\tthrow new Error(jslet.formatMessage(jslet.locale.Dataset.fieldNotFound, [fldName]));\r\n\t\t}\r\n\t\tif(Z._status == jslet.data.DataSetStatus.BROWSE) {\r\n\t\t\tZ.editRecord();\r\n\t\t}\r\n\t\tvar auditLogRec = Z._logOldEditValue(fldName);\r\n\t\tvar currRec = Z.getRecord(),\r\n\t\t\tdataType = fldObj.getType();\r\n\t\tif(!fldObj.valueStyle() || valueIndex === undefined) { //jslet.data.FieldValueStyle.NORMAL\r\n\t\t\tif(value && dataType === jslet.data.DataType.NUMBER && !jslet.isArray(value)) {\r\n\t\t\t\tvar oldValue = value;\r\n\t\t\t\tvalue = fldObj.scale() > 0 ? parseFloat(value): parseInt(value);\r\n\t\t\t\tif(window.isNaN(value)) {\r\n\t\t\t\t\t//Invalid value: [{1}] for NUMBER field: [{0}]!\r\n\t\t\t\t\tthrow new Error(jslet.formatMessage(jslet.locale.Dataset.invalidNumberFieldValue, [fldName, oldValue]));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tjslet.data.FieldRawValueAccessor.setRawValue(currRec, fldObj, value);\r\n\t\t\tif (fldObj.getType() == jslet.data.DataType.DATASET) {//dataset field\r\n\t\t\t\treturn this;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tvar arrValue = jslet.data.FieldRawValueAccessor.getRawValue(currRec, fldObj);\r\n\r\n\t\t\tif(!arrValue || !jslet.isArray(arrValue)) {\r\n\t\t\t\tarrValue = [];\r\n\t\t\t}\r\n\t\t\tvar len = arrValue.length;\r\n\t\t\tif(valueIndex < len) {\r\n\t\t\t\tarrValue[valueIndex] = value;\r\n\t\t\t} else {\r\n\t\t\t\tfor(var i = len; i < valueIndex; i++) {\r\n\t\t\t\t\tarrValue.push(null);\r\n\t\t\t\t}\r\n\t\t\t\tarrValue.push(value);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tjslet.data.FieldRawValueAccessor.setRawValue(currRec, fldObj, arrValue);\r\n\t\t}\r\n\t\tZ.setFieldError(fldName, null, valueIndex);\r\n\t\tif (Z._onFieldChanged) {\r\n\t\t\tvar eventFunc = jslet.getFunction(Z._onFieldChanged);\r\n\t\t\tif(eventFunc) {\r\n\t\t\t\teventFunc.call(Z, fldName, value, valueIndex);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(Z.isFireGlobalEvent()) {\r\n\t\t\tvar globalHandler = jslet.data.globalDataHandler.fieldValueChanged();\r\n\t\t\tif(globalHandler) {\r\n\t\t\t\tglobalHandler.call(Z, Z, fldName, value, valueIndex);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(fldObj.valueFollow()) {\r\n\t\t\tif(!Z._followedValues) {\r\n\t\t\t\tZ._followedValues = {};\r\n\t\t\t}\r\n\t\t\tZ._followedValues[fldName] = value;\r\n\t\t}\r\n\t\tZ._refreshProxyField(currRec, true);\r\n\t\t//calc other fields' range to use context rule\r\n\t\tif (Z._contextRuleEnabled) {\r\n\t\t\tZ.calcContextRule(fldName);\r\n\t\t}\r\n\t\tjslet.data.FieldValueCache.clear(currRec, fldName);\r\n\t\tZ._logNewEditValue(fldName, auditLogRec);\r\n\t\tZ._updateLookupRelativeFields(fldObj, value);\r\n\t\tvar evt = jslet.data.RefreshEvent.updateRecordEvent(fldName);\r\n\t\tZ.refreshControl(evt);\r\n\t\tZ.updateFormula(fldName);\r\n//\t\tZ.calcAggradedValue(fldName);\r\n\t\tZ._calcAggradedValueDebounce.call(Z);\r\n\t\treturn this;\r\n\t},\r\n\r\n\t_logOldEditValue: function(fldName) {\r\n\t\tvar Z = this;\r\n\t\tif(!Z._auditLogEnabled || !Z._logChanges) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\tvar status = Z.changedStatus() || Z._status;\r\n\t\tif(status !== jslet.data.DataSetStatus.UPDATE) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\tvar currRec = Z.getRecord(); \r\n\t\tvar auditLog = currRec[jslet.global.auditLogField];\r\n\t\tif(!auditLog) {\r\n\t\t\tauditLog = {};\r\n\t\t\tcurrRec[jslet.global.auditLogField] = auditLog;\r\n\t\t}\r\n\t\tvar logRec = auditLog[fldName];\r\n\t\tif(!logRec) {\r\n\t\t\tlogRec = {};\r\n\t\t\tauditLog[fldName] = logRec;\r\n\t\t}\r\n\t\tvar oldValue = logRec.o;\r\n\t\tif(!oldValue) {\r\n\t\t\tlogRec.o = Z.getFieldText(fldName);\r\n\t\t}\r\n\t\treturn logRec;\r\n\t},\r\n\t\r\n\t_logNewEditValue: function(fldName, auditLogRec) {\r\n\t\tif(auditLogRec) {\r\n\t\t\tauditLogRec.n = this.getFieldText(fldName);\r\n\t\t}\r\n\t},\r\n\t\r\n\tclearFollowedValues: function() {\r\n\t\tthis._followedValues = null;\r\n\t},\r\n\t\r\n\tcalcFocusedFields: function() {\r\n\t\tvar Z = this, fldObj;\r\n\t\tZ._focusedFields = null;\r\n\t\tfor(var i = 0, len = Z._normalFields.length; i < len; i++) {\r\n\t\t\tfldObj = Z._normalFields[i];\r\n\t\t\tif(fldObj.focused()) {\r\n\t\t\t\tif(!Z._focusedFields) {\r\n\t\t\t\t\tZ._focusedFields = [];\r\n\t\t\t\t}\r\n\t\t\t\tZ._focusedFields.push(fldObj.name());\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t\r\n\tfocusedFields: function() {\r\n\t\treturn this._focusedFields;\r\n\t},\r\n\t\r\n\tmergedFocusedFields: function() {\r\n\t\tvar fields = this._focusedFields,\r\n\t\t\tresult = fields,\r\n\t\t\tcanFields = this._canFocusFields;\r\n\t\tif(fields && canFields) {\r\n\t\t\tfor(var i = fields.length - 1; i >= 0; i--) {\r\n\t\t\t\tif(canFields.indexOf(fields[i]) < 0) {\r\n\t\t\t\t\tresult = fields.slice(0);\r\n\t\t\t\t\tresult.splice(i, 1);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn result;\r\n\t},\r\n\t\r\n\t_updateLookupRelativeFields: function(fldObj, fldValue) {\r\n\t\t//Only single value can update relative fields.\r\n\t\tif(!fldValue || fldObj.valueStyle() !== jslet.data.FieldValueStyle.NORMAL) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar lkObj = fldObj.lookup();\r\n\t\tif(!lkObj) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar lkRtnFldMap = lkObj.returnFieldMap();\r\n\t\tif(!lkRtnFldMap) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar lkFldName, lkDs = lkObj.dataset();\r\n\t\tif(jslet.compareValue(lkDs.keyValue(), fldValue) !== 0) {\r\n\t\t\tif(!lkDs.findByKey(fldValue)) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar keyFldName = fldObj.name();\r\n\t\tfor(var fldName in lkRtnFldMap) {\r\n\t\t\t//Avoid setting value to key field.\r\n\t\t\tif(keyFldName == fldName) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tlkFldName = lkRtnFldMap[fldName];\r\n\t\t\tthis.setFieldValue(fldName, lkDs.getFieldValue(lkFldName));\r\n\t\t}\r\n\t\t\r\n\t},\r\n\t\r\n\t_calcFormulaRelation: function() {\r\n\t\tvar Z = this;\r\n\t\tif(!Z._innerFormularFields) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar fields = Z._innerFormularFields.keys(),\r\n\t\t\tfldName, formulaFields, formulaFldName, fldObj;\r\n\t\tvar relation = new jslet.SimpleMap();\r\n\t\tfor(var i = 0, len = fields.length; i < len; i++) {\r\n\t\t\tfldName = fields[i];\r\n\t\t\tvar evaluator = Z._innerFormularFields.get(fldName);\r\n\t\t\tformulaFields = evaluator.mainFields();\r\n\t\t\trelation.set(fldName, formulaFields);\r\n\t\t} //end for i\r\n\t\tZ._innerFormulaRelation = relation.count() > 0? relation: null;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @rivate\r\n\t */\r\n\taddInnerFormulaField: function(fldName, formula) {\r\n\t\tvar Z = this;\r\n\t\tif(!formula) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (!Z._innerFormularFields) {\r\n\t\t\tZ._innerFormularFields = new jslet.SimpleMap();\r\n\t\t}\r\n\t\tvar evaluator = new jslet.Expression(Z, formula);\r\n\t\tZ._innerFormularFields.set(fldName, evaluator);\r\n\t\tZ._calcFormulaRelation();\r\n\t},\r\n\t\r\n\t/**\r\n\t * @rivate\r\n\t */\r\n\tremoveInnerFormulaField: function (fldName) {\r\n\t\tif (this._innerFormularFields) {\r\n\t\t\tthis._innerFormularFields.unset(fldName);\r\n\t\t\tthis._calcFormulaRelation();\r\n\t\t}\r\n\t},\r\n\r\n\t_calcFormula: function(currRec, fldName) {\r\n\t\tvar Z = this,\r\n\t\t\tevaluator = Z._innerFormularFields.get(fldName),\r\n\t\t\tresult = null;\r\n\t\tif(evaluator) {\r\n\t\t\tevaluator.context.dataRec = currRec;\r\n\t\t\tresult = evaluator.eval();\r\n\t\t}\r\n\t\treturn result;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @private\r\n\t */\r\n\tupdateFormula: function (changedFldName) {\r\n\t\tvar Z = this;\r\n\t\tif(!Z._innerFormulaRelation) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar fmlFields = Z._innerFormulaRelation.keys(),\r\n\t\t\tfmlFldName, fields, fldObj,\r\n\t\t\tcurrRec = this.getRecord();\r\n\t\tfor(var i = 0, len = fmlFields.length; i < len; i++) {\r\n\t\t\tfmlFldName = fmlFields[i];\r\n\t\t\tfields = Z._innerFormulaRelation.get(fmlFldName);\r\n\t\t\tfldObj = Z.getField(fmlFldName);\r\n\t\t\tif(!fields || fields.length === 0) {\r\n\t\t\t\tfldObj.setValue(Z._calcFormula(currRec, fmlFldName));\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tvar found = false;\r\n\t\t\tfor(var j = 0, cnt = fields.length; j < cnt; j++) {\r\n\t\t\t\tif(fields[j] == changedFldName) {\r\n\t\t\t\t\tfound = true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif(found) {\r\n\t\t\t\tfldObj.setValue(Z._calcFormula(currRec, fmlFldName));\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * Get field display text. \r\n\t * \r\n\t * @param {String} fldName Field name\r\n\t * @param {Boolean} isEditing In edit mode or not, if in edit mode, return 'Input Text', else return 'Display Text'\r\n\t * @param {Integer} valueIndex identify which item will get if the field has multiple values.\r\n\t * @return {String} \r\n\t */\r\n\tgetFieldText: function (fldName, isEditing, valueIndex) {\r\n\t\tif (this.recordCount() === 0) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tvar currRec = this.getRecord();\r\n\t\tif (!currRec) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\treturn this.getFieldTextByRecord(currRec, fldName, isEditing, valueIndex);\r\n\t},\r\n\t\r\n\t/**\r\n\t * Get field display text by record number.\r\n\t * \r\n\t * @param {Object} recno - record number.\r\n\t * @param {String} fldName - Field name\r\n\t * @param {Boolean} isEditing - In edit mode or not, if in edit mode, return 'Input Text', else return 'Display Text'\r\n\t * @param {Integer} valueIndex - identify which item will get if the field has multiple values.\r\n\t * @return {String} \r\n\t */\r\n\tgetFieldTextByRecno: function (recno, fldName, isEditing, valueIndex) {\r\n\t\tvar dataRec = this.getRecord(recno);\r\n\t\tif(!dataRec) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\treturn this.getFieldTextByRecord(dataRec, fldName, isEditing, valueIndex);\r\n\t},\r\n\t\r\n\t/**\r\n\t * Get field display text by data record.\r\n\t * \r\n\t * @param {Object} dataRec - data record.\r\n\t * @param {String} fldName - Field name\r\n\t * @param {Boolean} isEditing - In edit mode or not, if in edit mode, return 'Input Text', else return 'Display Text'\r\n\t * @param {Integer} valueIndex - identify which item will get if the field has multiple values.\r\n\t * @return {String} \r\n\t */\r\n\tgetFieldTextByRecord: function (dataRec, fldName, isEditing, valueIndex) {\r\n\t\tvar Z = this;\r\n\t\tif (Z.recordCount() === 0) {\r\n\t\t\treturn '';\r\n\t\t}\r\n\t\tvar currRec = dataRec, \r\n\t\t\tk = fldName.indexOf('.'), \r\n\t\t\tfldObj, value;\r\n\t\t\r\n\t\tvar errObj = jslet.data.FieldError.get(currRec, fldName, valueIndex);\r\n\t\tif(errObj && errObj.message) {\r\n\t\t\tvar inputText = errObj.inputText;\r\n\t\t\tif(inputText !== undefined && inputText !== null) {\r\n\t\t\t\treturn inputText;\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tZ._refreshProxyField(currRec, true);\r\n\t\tif (k > 0) { //Field chain\r\n\t\t\tvar dtlFldName = fldName.substr(0, k);\r\n\t\t\tfldName = fldName.substr(k + 1);\r\n\t\t\tfldObj = Z.getField(dtlFldName);\r\n\t\t\tif (!fldObj) {\r\n\t\t\t\tthrow new Error(jslet.formatMessage(jslet.locale.Dataset.fieldNotFound, [fldName]));\r\n\t\t\t}\r\n\t\t\tvar lkf = fldObj.lookup(),\r\n\t\t\t\tdsDetail = fldObj.detailDataset();\r\n\t\t\tif (!lkf && !dsDetail) {\r\n\t\t\t\tthrow new Error(jslet.formatMessage(jslet.locale.Dataset.lookupNotFound, [fldName]));\r\n\t\t\t}\r\n\t\t\tif(lkf) {\r\n\t\t\t\tvalue = currRec[dtlFldName];\r\n\t\t\t\tif (value === null || value === undefined) {\r\n\t\t\t\t\treturn '';\r\n\t\t\t\t}\r\n\t\t\t\tvar lkds = lkf.dataset();\r\n\t\t\t\tif (lkds.findByField(lkds.keyField(), value)) {\r\n\t\t\t\t\tif (fldName.indexOf('.') > 0) {\r\n\t\t\t\t\t\treturn lkds.getFieldValue(fldName);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\treturn lkds.getFieldText(fldName, isEditing, valueIndex);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthrow new Error(jslet.formatMessage(jslet.locale.Dataset.valueNotFound,\r\n\t\t\t\t\t\t\t[lkds.name(), lkds.keyField(), value]));\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\t//Can't use it in sort function.\r\n\t\t\t\treturn dsDetail.getFieldText(fldName, isEditing, valueIndex);\r\n\t\t\t}\r\n\t\t}\r\n\t\t//Not field chain\r\n\t\tfldObj = Z.getField(fldName);\r\n\t\tif (!fldObj) {\r\n\t\t\tthrow new Error(jslet.formatMessage(jslet.locale.Dataset.lookupNotFound, [fldName]));\r\n\t\t}\r\n\t\tif (fldObj.getType() == jslet.data.DataType.DATASET) {\r\n\t\t\treturn '';\r\n\t\t}\r\n\t\tvar valueStyle = fldObj.valueStyle(),\r\n\t\t\tresult = [];\r\n\t\tif(valueStyle == jslet.data.FieldValueStyle.BETWEEN && valueIndex === undefined)\r\n\t\t{\r\n\t\t\tvar minVal = Z.getFieldTextByRecord(currRec, fldName, isEditing, 0),\r\n\t\t\t\tmaxVal = Z.getFieldTextByRecord(currRec, fldName, isEditing, 1);\r\n\t\t\tif(!isEditing && !minVal && !maxVal){\r\n\t\t\t\treturn '';\r\n\t\t\t}\r\n\t\t\tresult.push(minVal);\r\n\t\t\tif(isEditing) {\r\n\t\t\t\tresult.push(jslet.global.valueSeparator);\r\n\t\t\t} else {\r\n\t\t\t\tresult.push(jslet.locale.Dataset.betweenLabel);\r\n\t\t\t}\r\n\t\t\tresult.push(maxVal);\r\n\t\t\treturn result.join('');\r\n\t\t}\r\n\t\t\r\n\t\tif(valueStyle == jslet.data.FieldValueStyle.MULTIPLE && valueIndex === undefined)\r\n\t\t{\r\n\t\t\tvar arrValues = Z.getFieldValue(fldName), \r\n\t\t\t\tlen = 0;\r\n\t\t\tif(arrValues && jslet.isArray(arrValues)) {\r\n\t\t\t\tlen = arrValues.length - 1;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tfor(var i = 0; i <= len; i++) {\r\n\t\t\t\tresult.push(Z.getFieldTextByRecord(currRec, fldName, isEditing, i));\r\n\t\t\t\tif(i < len) {\r\n\t\t\t\t\tresult.push(jslet.global.valueSeparator);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn result.join('');\r\n\t\t}\r\n\t\t//Get cached display value if exists.\r\n\t\tif(!isEditing) {\r\n\t\t\tvar cacheValue = jslet.data.FieldValueCache.get(currRec, fldName, valueIndex);\r\n\t\t\tif(cacheValue !== undefined) {\r\n\t\t\t\treturn cacheValue;\r\n\t\t\t}\r\n\t\t}\r\n\t\tvalue = Z.getFieldValueByRecord(currRec, fldName, valueIndex);\r\n\t\tif (value === null || value === undefined) {\r\n\t\t\tvar fixedValue = fldObj.fixedValue();\r\n\t\t\tif(fixedValue) {\r\n\t\t\t\treturn fixedValue;\r\n\t\t\t}\r\n\t\t\treturn '';\r\n\t\t}\r\n\r\n\t\tvar convert = fldObj.customValueConverter() || jslet.data.getValueConverter(fldObj);\r\n\t\tif(!convert) {\r\n\t\t\tthrow new Error('Can\\'t find any field value converter!');\r\n\t\t}\r\n\t\tvar text = convert.valueToText(fldObj, value, isEditing);\r\n\t\t//Put display value into cache\r\n\t\tif(!isEditing) {\r\n\t\t\tjslet.data.FieldValueCache.put(currRec, fldName, text, valueIndex);\r\n\t\t}\r\n\t\treturn text;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @private\r\n\t */\r\n\tsetFieldValueLength: function(fldObj, valueLength) {\r\n\t\tif(!fldObj.valueStyle()) { //jslet.data.FieldValueStyle.NORMAL\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar value = this.getFieldValue(fldObj.name());\r\n\t\tif(value && jslet.isArray(value)) {\r\n\t\t\tvalue.length = valueLength;\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * Set field value by input value. There are two forms to use:\r\n\t *   1. setFieldText(fldName, inputText, valueIndex)\r\n\t *   2. setFieldText(fldName, inputText, keyValue, displayValue, valueIndex)\r\n\t *   \r\n\t * @param {String} fldName - field name\r\n\t * @param {String} inputText - String value inputed by user\r\n\t * @param {Object} keyValue - key value\r\n\t * @param {String} displayValue - display value\r\n\t * @param {Integer} valueIndex identify which item will set if the field has multiple values.\r\n\t */\r\n\tsetFieldText: function (fldName, inputText, valueIndex) {\r\n\t\tvar Z = this,\r\n\t\tfldObj = Z.getField(fldName);\r\n\t\tif (fldObj === null) {\r\n\t\t\tthrow new Error(jslet.formatMessage(jslet.locale.Dataset.fieldNotFound, [fldName]));\r\n\t\t}\r\n\t\tvar fType = fldObj.getType();\r\n\t\tif (fType == jslet.data.DataType.DATASET) {\r\n\t\t\tthrow new Error(jslet.formatMessage(jslet.locale.Dataset.datasetFieldNotBeSetValue, [fldName]));\r\n\t\t}\r\n\t\t\r\n\t\tvar value = Z._textToValue(fldObj, inputText, valueIndex);\r\n\t\tif(value !== undefined) {\r\n\t\t\tZ.setFieldValue(fldName, value, valueIndex);\r\n\t\t}\r\n\t},\r\n\r\n\t_textToValue: function(fldObj, inputText, valueIndex) {\r\n\t\tvar Z = this, value;\r\n\t\t\r\n\t\tif((fldObj.valueStyle() === jslet.data.FieldValueStyle.BETWEEN ||\r\n\t\t\tfldObj.valueStyle() === jslet.data.FieldValueStyle.MULTIPLE) && \t\t\t\t\r\n\t\t\tvalueIndex === undefined) {\r\n\t\t\t//Set an array value\r\n\t\t\tif(!jslet.isArray(inputText)) {\r\n\t\t\t\tinputText = inputText.split(jslet.global.valueSeparator);\r\n\t\t\t}\r\n\t\t\tvar len = inputText.length, \r\n\t\t\t\tvalues = [],\r\n\t\t\t\tinvalid = false;\r\n\t\t\tfor(var k = 0; k < len; k++ ) {\r\n\t\t\t\tvalue = Z._textToValue(fldObj, inputText[k], k);\r\n\t\t\t\tif(value === undefined) {\r\n\t\t\t\t\tinvalid = true;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif(!invalid) {\r\n\t\t\t\t\t\tvalues.push(value);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif(!invalid) {\r\n\t\t\t\treturn values;\r\n\t\t\t}\r\n\t\t\treturn undefined;\r\n\t\t}\r\n\t\tvar fldName = fldObj.name(), evt,\r\n\t\t\tinvalidMsg = Z._fieldValidator.checkInputText(fldObj, inputText);\r\n\t\tif (invalidMsg) {\r\n\t\t\tZ.setFieldError(fldName, invalidMsg, valueIndex, inputText);\r\n\t\t\tevt = jslet.data.RefreshEvent.updateRecordEvent(fldName);\r\n\t\t\tZ.refreshControl(evt);\r\n\t\t\treturn undefined;\r\n\t\t} else {\r\n\t\t\tZ.setFieldError(fldName, null, valueIndex);\r\n\t\t}\r\n\t\t\r\n\t\tvar convert = fldObj.customValueConverter() || jslet.data.getValueConverter(fldObj);\r\n\t\tif(!convert) {\r\n\t\t\tthrow new Error('Can\\'t find any field value converter!');\r\n\t\t}\r\n\t\tvalue = convert.textToValue(fldObj, inputText, valueIndex);\r\n\t\tif(Z.getFieldError(fldName, valueIndex)) {\r\n\t\t\tevt = jslet.data.RefreshEvent.updateRecordEvent(fldName);\r\n\t\t\tZ.refreshControl(evt);\r\n\t\t}\r\n\t\treturn value;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Get key value of current record\r\n\t * \r\n\t * @param {Integer} recno recno optional, if not specified, it will get key value of current record.\r\n\t * @return {Object} Key value\r\n\t */\r\n\tkeyValue: function (recno) {\r\n\t\tif (!this._keyField || this.recordCount() === 0) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\treturn this.getFieldValueByRecno(recno, this._keyField);\r\n\t},\r\n\r\n\t/**\r\n\t * Get parent record key value of current record\r\n\t * @param {Integer} recno recno optional, if not specified, it will get parent key value of current record.\r\n\t * \r\n\t * @return {Object} Parent record key value.\r\n\t */\r\n\tparentValue: function (recno) {\r\n\t\tif (!this._parentField || this.recordCount() === 0) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\treturn this.getFieldValueByRecno(recno, this._parentField);\r\n\t},\r\n\r\n\t/**\r\n\t * Find record with specified condition\r\n\t * if found, then move cursor to that record\r\n\t * <pre><code>\r\n\t *   dsFoo.find('[name] like \"Bob%\"');\r\n\t *   dsFoo.find('[age] > 20');\r\n\t * </code></pre>\r\n\t * @param {String} condition condition expression.\r\n\t * @param {Boolean} fromCurrentPosition Identify whether finding data from current position or not.\r\n\t * @return {Boolean} \r\n\t */\r\n\tfind: function (condition, fromCurrentPosition) {\r\n\t\tvar Z = this;\r\n\t\tif (Z.recordCount() === 0) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tZ.confirm();\r\n\t\tif (condition === null) {\r\n\t\t\tZ._findCondition = null;\r\n\t\t\tZ._innerFindCondition = null;\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tif (condition != Z._findCondition) {\r\n\t\t\tZ._innerFindCondition = new jslet.Expression(this, condition);\r\n\t\t}\r\n\t\tif (Z._innerFindCondition.eval()) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\tZ._silence++;\r\n\t\tvar foundRecno = -1, \r\n\t\t\toldRecno = Z._recno;\r\n\t\ttry {\r\n\t\t\tif(!fromCurrentPosition) {\r\n\t\t\t\tZ.first();\r\n\t\t\t}\r\n\t\t\twhile (!Z.isEof()) {\r\n\t\t\t\tif (Z._innerFindCondition.eval()) {\r\n\t\t\t\t\tfoundRecno = Z._recno;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tZ.next();\r\n\t\t\t}\r\n\t\t} finally {\r\n\t\t\tZ._silence--;\r\n\t\t\tZ._recno = oldRecno;\r\n\t\t}\r\n\t\tif (foundRecno >= 0) {// can fire scroll event\r\n\t\t\tZ._gotoRecno(foundRecno);\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\treturn false;\r\n\t},\r\n\r\n\t/**\r\n\t * Find record with specified field name and value. If found, move cursor the found record.\r\n\t * \r\n\t * <pre><code>\r\n\t *   dsFoo.findByField('name', 'Tom'); // return true\r\n\t *   dsFoo.findByField('id,name', '5');\r\n\t *   dsFoo.findByField('id,name', 'Jack');\r\n\t *   dsFoo.findByField(['id', 'name'], '7');\r\n\t *   \r\n\t * </code></pre>\r\n\t * \r\n\t * @param {String} fieldNameOrFieldArray - field name or field name array.\r\n\t * @param {Object} findingValue - finding value\r\n\t * @param {Boolean} startRecno start position to find value.\r\n\t * @param {Boolean} findingByText - Identify whether finding data with field text, default is with field value\r\n\t * @param {String} matchType null or undefined - match whole value, 'first' - match first, 'last' - match last, 'any' - match any\r\n\t * @return {Boolean} \r\n\t */\r\n\tfindByField: function (fieldNameOrFieldArray, findingValue, startRecno, findingByText, matchType) {\r\n\t\tvar Z = this;\r\n\t\tZ.confirm();\r\n\t\t\r\n\t\tfunction matchValue(matchType, value, findingValue) {\r\n\t\t\tif(!matchType) {\r\n\t\t\t\treturn jslet.compareValue(value, findingValue) === 0;\r\n\t\t\t}\r\n\t\t\tif(matchType == 'first') {\r\n\t\t\t\treturn jslet.like(value, findingValue + '%');\r\n\t\t\t}\r\n\t\t\tif(matchType == 'any') {\r\n\t\t\t\treturn jslet.like(value, '%' + findingValue + '%');\r\n\t\t\t}\r\n\t\t\tif(matchType == 'last') {\r\n\t\t\t\treturn jslet.like(value, '%' + findingValue);\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tvar records = Z._ignoreFilter? Z.dataList(): Z.filteredDataList();\r\n\t\tif(!records || records.length === 0) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\t\r\n\t\tvar fields = fieldNameOrFieldArray;\r\n\t\tif(jslet.isString(fieldNameOrFieldArray)) {\r\n\t\t\tfields = fieldNameOrFieldArray.split(',');\r\n\t\t}\r\n\t\tvar byTextArray = [], i,\r\n\t\t\tfldCnt = fields.length,\r\n\t\t\tfldName, fldObj;\r\n\t\tfor(i = 0; i < fldCnt; i++) {\r\n\t\t\tfldName = fields[i];\r\n\t\t\tfldObj = Z.getField(fldName);\r\n\t\t\tif(!fldObj) {\r\n\t\t\t\tthrow new Error(jslet.formatMessage(jslet.locale.Dataset.fieldNotFound, [fldName]));\r\n\t\t\t}\r\n\t\t\tvar byText = true;\r\n\t\t\tif(fldObj.getType() === 'N' && !fldObj.lookup()) {\r\n\t\t\t\tbyText = false;\r\n\t\t\t}\r\n\t\t\tbyTextArray[i] = byText;\r\n\t\t}\r\n\t\tvar start = !Z._ignoreFilter && startRecno? startRecno: 0;\r\n\t\tvar dataRec, foundRecno = -1, value, len;\r\n\t\tfor(i = start, len = records.length; i < len; i++) {\r\n\t\t\tdataRec = records[i];\r\n\t\t\t\r\n\t\t\tfor(var j = 0; j < fldCnt; j++) {\r\n\t\t\t\tfldName = fields[j];\r\n\t\t\t\tif(findingByText && byTextArray[j]) {\r\n\t\t\t\t\tvalue = Z.getFieldTextByRecord(dataRec, fldName);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvalue = Z.getFieldValueByRecord(dataRec, fldName);\r\n\t\t\t\t}\r\n\t\t\t\tif (matchValue(matchType, value, findingValue)) {\r\n\t\t\t\t\tfoundRecno = i;\r\n\t\t\t\t\tif(Z._ignoreFilter) { // Only used in value converting, so does not need to move cursor.\r\n\t\t\t\t\t\tZ._ignoreFilterRecno = i;\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif(foundRecno >= 0) {\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (foundRecno >= 0) {// can fire scroll event\r\n\t\t\tZ._gotoRecno(foundRecno);\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\treturn false;\r\n\t},\r\n\r\n\t/**\r\n\t * Find record with key value.\r\n\t * \r\n\t * @param {Object} keyValue Key value.\r\n\t * @return {Boolean}\r\n\t */\r\n\tfindByKey: function (keyValue) {\r\n\t\tvar keyField = this.keyField();\r\n\t\tif (!keyField) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\treturn this.findByField(keyField, keyValue);\r\n\t},\r\n\r\n\t/**\r\n\t * Find record and return the specified field value\r\n\t * \r\n\t * @param {String} fldName - field name\r\n\t * @param {Object} findingValue - finding field value\r\n\t * @param {String} returnFieldName - return value field name\r\n\t * \r\n\t * @return {Object} field value.\r\n\t */\r\n\tlookup: function (fldName, findingValue, returnFieldName) {\r\n\t\tif (this.findByField(fldName, findingValue)) {\r\n\t\t\treturn this.getFieldValue(returnFieldName);\r\n\t\t} else {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * Find record with key value and return the specified field value.\r\n\t * \r\n\t * @param {Object} keyValue - key value\r\n\t * @param {String} returnFieldName - return value field name\r\n\t * \r\n\t * @return {Object} field value.\r\n\t */\r\n\tlookupByKey: function(keyValue, returnFldName) {\r\n\t\tif (this.findByKey(keyValue)) {\r\n\t\t\treturn this.getFieldValue(returnFldName);\r\n\t\t} else {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * Check if the field value of 'fldName' is the parent value or one of the children of 'parentValue'.\r\n\t * \r\n\t * @param {String} fldname - field name which is checking, this field must connect a 'tree-style' dataset;\r\n\t * @param {Object} parentValue - the value which is used to check;\r\n\t * @param {Boolean} onlyDirectChildren - true - only the direct children to be used to check, false - otherwise.\r\n\t * \r\n\t * @return {Boolean} true - the field value of current record is one of the children of the 'parentValue', false -otherwise.\r\n\t */\r\n\tinChildrenAndSelf: function(fldName, parentValue, onlyDirectChildren) {\r\n\t\tjslet.Checker.test('inchildren#fldName', fldName).required().isString();\r\n\t\tjslet.Checker.test('inchildren#parentValue', parentValue).required();\r\n\t\tvar fldValue = this.getFieldValue(fldName);\r\n\t\tif(jslet.compareValue(fldValue, parentValue) === 0) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\treturn this.inChildren(fldName, parentValue, onlyDirectChildren);\r\n\t},\r\n\t\r\n\t/**\r\n\t * Check the field value of 'fldName' is one of the children of 'parentValue' or not.\r\n\t * \r\n\t * @param {String} fldname - field name which is checking, this field must connect a 'tree-style' dataset;\r\n\t * @param {Object} parentValue - the value which is used to check;\r\n\t * @param {Boolean} onlyDirectChildren - true - only the direct children to be used to check, false - otherwise.\r\n\t * \r\n\t * @return {Boolean} true - the field value of current record is one of the children of the 'parentValue', false -otherwise.\r\n\t */\r\n\tinChildren: function(fldName, parentValue, onlyDirectChildren) {\r\n\t\tjslet.Checker.test('inchildren#fldName', fldName).required().isString();\r\n\t\tjslet.Checker.test('inchildren#parentValue', parentValue).required();\r\n\t\tvar Z = this,\r\n\t\t\tfldObj = Z.getField(fldName);\r\n\t\tif(!fldObj) {\r\n\t\t\tthrow new Error(jslet.formatMessage(jslet.locale.Dataset.fieldNotFound, [fldName]));\r\n\t\t}\r\n\t\tvar lookup = fldObj.lookup();\r\n\t\tif(!lookup) {\r\n\t\t\tthrow new Error(jslet.formatMessage(jslet.locale.Dataset.lookupFieldExpected, [fldName]));\r\n\t\t}\r\n\t\tvar lkds = lookup.dataset();\r\n\t\tjslet.Checker.test('inchildren#lookupDataset', lkds).required();\r\n\t\tjslet.Checker.test('inchildren#lookupDataset.parentField', lkds.parentField()).required();\r\n\t\tif(!lkds.findByKey(parentValue)) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tvar fldValue = Z.getFieldValue(fldName);\r\n\t\tvar found = false;\r\n\t\tlkds.iterateChildren(function(isDirectChild) {\r\n\t\t\tvar breakIterator = false;\r\n\t\t\tif(!onlyDirectChildren || (onlyDirectChildren && isDirectChild)) {\r\n\t\t\t\tif(jslet.compareValue(lkds.keyValue(), fldValue) === 0) {\r\n\t\t\t\t\tbreakIterator = true;\r\n\t\t\t\t\tfound = true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn breakIterator;\r\n\t\t});\r\n\t\treturn found;\r\n\t},\r\n\r\n\t/**\r\n\t * Copy dataset's data. Example:\r\n\t * <pre><code>\r\n\t * var list = dsFoo.copyDataset(true);\r\n\t * \r\n\t * </code></pre>\r\n\t * \r\n\t * @param {Boolean} underCurrentFilter - if true, copy data under dataset's {@link}filter\r\n\t * @return {Object[]} Array of records. \r\n\t */\r\n\tcopyDataset: function (underCurrentFilter) {\r\n\t\tvar Z = this;\r\n\t\tif (Z.recordCount() === 0) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\tvar result = [];\r\n\r\n\t\tif ((!underCurrentFilter || !Z._filtered)) {\r\n\t\t\treturn Z.dataList().slice(0);\r\n\t\t}\r\n\r\n\t\tvar foundRecno = -1, \r\n\t\t\toldRecno = Z._recno, \r\n\t\t\toldFiltered = Z._filtered;\r\n\t\tif (!underCurrentFilter) {\r\n\t\t\tZ._filtered = false;\r\n\t\t}\r\n\r\n\t\tZ._silence++;\r\n\t\ttry {\r\n\t\t\tZ.first();\r\n\t\t\twhile (!Z.isEof()) {\r\n\t\t\t\tresult.push(Z.getRecord());\r\n\t\t\t\tZ.next();\r\n\t\t\t}\r\n\t\t} finally {\r\n\t\t\tZ._silence--;\r\n\t\t\tZ._recno = oldRecno;\r\n\t\t\tif (!underCurrentFilter) {\r\n\t\t\t\tZ._filtered = oldFiltered;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn result;\r\n\t},\r\n\r\n\t/**\r\n\t * Set or get 'key' field name\r\n\t * \r\n\t * @param {String} keyFldName Key field name.\r\n\t * @return {String or this}\r\n\t */\r\n\tkeyField: function (keyFldName) {\r\n\t\tif (keyFldName === undefined) {\r\n\t\t\treturn this._keyField;\r\n\t\t}\r\n\t\tjslet.Checker.test('Dataset.keyField', keyFldName).isString();\r\n\t\tthis._keyField = jQuery.trim(keyFldName);\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * Set or get 'code' field name\r\n\t * \r\n\t * @param {String} codeFldName Code field name.\r\n\t * @return {String or this}\r\n\t */\r\n\tcodeField: function (codeFldName) {\r\n\t\tif (codeFldName === undefined) {\r\n\t\t\treturn this._codeField;\r\n\t\t}\r\n\t\t\r\n\t\tjslet.Checker.test('Dataset.codeField', codeFldName).isString();\r\n\t\tthis._codeField = jQuery.trim(codeFldName);\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Set or get 'name' field name\r\n\t * \r\n\t * @param {String} nameFldName Name field name\r\n\t * @return {String or this}\r\n\t */\r\n\tnameField: function (nameFldName) {\r\n\t\tif (nameFldName === undefined) {\r\n\t\t\treturn this._nameField;\r\n\t\t}\r\n\t\t\r\n\t\tjslet.Checker.test('Dataset.nameField', nameFldName).isString();\r\n\t\tthis._nameField = jQuery.trim(nameFldName);\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * Set or get 'parent' field name\r\n\t * \r\n\t * @param {String} parentFldName Parent field name.\r\n\t * @return {String or this}\r\n\t */\r\n\tparentField: function (parentFldName) {\r\n\t\tif (parentFldName === undefined) {\r\n\t\t\treturn this._parentField;\r\n\t\t}\r\n\t\t\r\n\t\tjslet.Checker.test('Dataset.parentField', parentFldName).isString();\r\n\t\tthis._parentField = jQuery.trim(parentFldName);\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\tlevelOrderField: function(fldName) {\r\n\t\tif (fldName === undefined) {\r\n\t\t\treturn this._levelOrderField;\r\n\t\t}\r\n\t\t\r\n\t\tjslet.Checker.test('Dataset.levelOrderField', fldName).isString();\r\n\t\tthis._levelOrderField = jQuery.trim(fldName);\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Set or get 'select' field name. \"Select field\" is a field to store the selected state of a record. \r\n\t * \r\n\t * @param {String} parentFldName Parent field name.\r\n\t * @return {String or this}\r\n\t */\r\n\tselectField: function (selectFldName) {\r\n\t\tif (selectFldName === undefined) {\r\n\t\t\treturn this._selectField;\r\n\t\t}\r\n\t\t\r\n\t\tjslet.Checker.test('Dataset.selectField', selectFldName).isString();\r\n\t\tthis._selectField = jQuery.trim(selectFldName);\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Set or get context rule\r\n\t * \r\n\t * @param {jslet.data.ContextRule[]} contextRule Context rule;\r\n\t * @return {jslet.data.ContextRule[] or this}\r\n\t */\r\n\tcontextRules: function (rules) {\r\n\t\tif (rules === undefined) {\r\n\t\t\treturn this._contextRules;\r\n\t\t}\r\n\t\tif(jslet.isString(rules)) {\r\n\t\t\trules = rules? jslet.JSON.parse(rules): null;\r\n\t\t}\r\n\t\tjslet.Checker.test('Dataset.contextRules', rules).isArray();\r\n\t\tif(!rules || rules.length === 0) {\r\n\t\t\tthis._contextRules = null;\r\n\t\t\tthis._contextRuleEngine = null;\r\n\t\t} else {\r\n\t\t\tvar ruleObj;\r\n\t\t\tfor(var i = 0, len = rules.length; i < len; i++) {\r\n\t\t\t\truleObj = rules[i];\r\n\t\t\t\tif(!ruleObj.className || \r\n\t\t\t\t\t\truleObj.className != jslet.data.ContextRule.className) {\r\n\t\t\t\t\t\r\n\t\t\t\t\tjslet.Checker.test('Dataset.contextRules#ruleObj', ruleObj).isPlanObject();\r\n\t\t\t\t\trules[i] = jslet.data.createContextRule(ruleObj);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis._contextRules = rules;\r\n\t\t\tthis._contextRuleEngine = new jslet.data.ContextRuleEngine(this);\r\n\t\t\tthis._contextRuleEngine.compile();\r\n\t\t\tthis.enableContextRule();\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Disable context rule\r\n\t */\r\n\tdisableContextRule: function () {\r\n\t\tthis._contextRuleEnabled = false;\r\n//\t\tthis.restoreContextRule();\r\n\t},\r\n\r\n\t/**\r\n\t * Enable context rule, any context rule will be calculated.\r\n\t */\r\n\tenableContextRule: function () {\r\n\t\tthis._contextRuleEnabled = true;\r\n\t\tthis.calcContextRule();\r\n\t},\r\n\r\n\t/**\r\n\t * Check context rule enable or not.\r\n\t * \r\n\t * @return {Boolean}\r\n\t */\r\n\tisContextRuleEnabled: function () {\r\n\t\treturn this._contextRuleEnabled;\r\n\t},\r\n\r\n\t/**\r\n\t * @private\r\n\t */\r\n\tcalcContextRule: function (changedField) {\r\n\t\tvar Z = this;\r\n\t\tif(Z.recordCount() === 0) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tif(Z._contextRuleEngine) {\r\n\t\t\tZ._inContextRule = true;\r\n\t\t\ttry {\r\n\t\t\t\tZ._contextRuleEngine.evalRule(changedField);\r\n\t\t\t} finally {\r\n\t\t\t\tZ._inContextRule = false;\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * @private\r\n\t */\r\n\t_refreshProxyField: function(dataRecord, isSilence) {\r\n\t\tvar Z = this;\r\n\t\tif(!Z._proxyFields || Z.recordCount() === 0) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif(!dataRecord) {\r\n\t\t\tdataRecord = Z.getRecord();\r\n\t\t}\r\n\r\n\t\tvar fldObj;\r\n\t\tfor(var i = 0, len = Z._proxyFields.length; i < len; i++) {\r\n\t\t\tfldObj = Z._proxyFields[i];\r\n\t\t\tfldObj.changeProxyFieldName(dataRecord, isSilence);\r\n\t\t}\r\n\t},\r\n\t\r\n\r\n\t/**\r\n\t * Check current record if it's selectable.\r\n\t */\r\n\tcheckSelectable: function (recno) {\r\n\t\tif(this.recordCount() === 0) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tif(this._onCheckSelectable) {\r\n\t\t\tvar eventFunc = jslet.getFunction(this._onCheckSelectable);\r\n\t\t\tif(eventFunc) {\r\n\t\t\t\treturn eventFunc.call(this, recno);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn true;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Get or set selected state of current record.\r\n\t */\r\n\tselected: function (selected) {\r\n\t\tvar Z = this;\r\n\t\tvar selFld = Z._selectField || jslet.global.selectStateField,\r\n\t\t\trec = Z.getRecord();\r\n\t\t\r\n\t\tif(selected === undefined) {\r\n\t\t\treturn rec && rec[selFld];\r\n\t\t}\r\n\t\t\r\n\t\tif(rec) {\r\n\t\t\tif(Z.checkSelectable()) {\r\n\t\t\t\tZ._aborted = false;\r\n\t\t\t\ttry {\r\n\t\t\t\t\tZ._fireDatasetEvent(jslet.data.DatasetEvent.BEFORESELECT);\r\n\t\t\t\t\tif (Z._aborted) {\r\n\t\t\t\t\t\treturn Z;\r\n\t\t\t\t\t}\r\n\t\t\t\t} finally {\r\n\t\t\t\t\tZ._aborted = false;\r\n\t\t\t\t}\r\n\t\t\t\trec[selFld] = selected;\r\n\t\t\t\tZ._fireDatasetEvent(jslet.data.DatasetEvent.AFTERSELECT);\r\n\t\t\t\tif(this._contextRuleEngine) {\r\n\t\t\t\t\tthis._contextRuleEngine.evalRule();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn Z;\r\n\t},\r\n\t\r\n\tselectedByRecno: function(recno) {\r\n\t\tvar Z = this,\r\n\t\t\tselFld = Z._selectField || jslet.global.selectStateField,\r\n\t\t\trec = Z.getRecord(recno);\r\n\t\t\r\n\t\treturn rec && rec[selFld];\r\n\t},\r\n\t\r\n\t/**\r\n\t * Select/unselect all records.\r\n\t * \r\n\t * @param {Boolean}selected  true - select records, false otherwise.\r\n\t * @param {Function)onSelectAll Select event handler.\r\n\t *\tPattern: function(dataset, Selected}{}\r\n\t *\t//dataset: jslet.data.Dataset\r\n\t *\t//Selected: Boolean\r\n\t *\t//return: true - allow user to select, false - otherwise.\r\n\r\n\t * @param {Boolean}noRefresh Refresh controls or not.\r\n\t */\r\n\tselectAll: function (selected, onSelectAll, noRefresh) {\r\n\t\tvar Z = this;\r\n\t\tif (Z.recordCount() === 0) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\ttry {\r\n\t\t\tZ._fireDatasetEvent(jslet.data.DatasetEvent.BEFORESELECTALL);\r\n\t\t\tif (Z._aborted) {\r\n\t\t\t\treturn Z;\r\n\t\t\t}\r\n\t\t} finally {\r\n\t\t\tZ._aborted = false;\r\n\t\t}\r\n\r\n\t\tjslet.Checker.test('Dataset.selectAll#onSelectAll', onSelectAll).isFunction();\r\n\t\tvar oldRecno = Z.recno();\r\n\t\ttry {\r\n\t\t\tfor (var i = 0, cnt = Z.recordCount(); i < cnt; i++) {\r\n\t\t\t\tZ.recnoSilence(i);\r\n\r\n\t\t\t\tZ.selected(selected);\r\n\t\t\t}\r\n\t\t} finally {\r\n\t\t\tZ.recnoSilence(oldRecno);\r\n\t\t}\r\n\t\tif (onSelectAll) {\r\n\t\t\tonSelectAll(this, selected);\r\n\t\t}\r\n\t\tZ._fireDatasetEvent(jslet.data.DatasetEvent.AFTERSELECTALL);\r\n\t\tif (!noRefresh) {\r\n\t\t\tvar evt = jslet.data.RefreshEvent.selectAllEvent(selected);\r\n\t\t\tZ.refreshControl(evt);\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * Select/unselect record by key value.\r\n\t * \r\n\t * @param {Boolean} selected true - select records, false otherwise.\r\n\t * @param {Object) keyValue Key value.\r\n\t * @param {Boolean} noRefresh Refresh controls or not.\r\n\t */\r\n\tselectByKeyValue: function (selected, keyValue, noRefresh) {\r\n\t\tvar Z = this,\r\n\t\t\toldRecno = Z.recno(),\r\n\t\t\tcnt = Z.recordCount(),\r\n\t\t\tv, changedRecNum = [];\r\n\t\ttry {\r\n\t\t\tfor (var i = 0; i < cnt; i++) {\r\n\t\t\t\tZ.recnoSilence(i);\r\n\t\t\t\tv = Z.getFieldValue(Z._keyField);\r\n\t\t\t\tif (v == keyValue) {\r\n\t\t\t\t\tZ.selected(selected);\r\n\t\t\t\t\tchangedRecNum.push(i);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t} //end for\r\n\t\t} finally {\r\n\t\t\tZ.recnoSilence(oldRecno);\r\n\t\t}\r\n\t\tif (!noRefresh) {\r\n\t\t\tvar evt = jslet.data.RefreshEvent.selectRecordEvent(changedRecNum, selected);\r\n\t\t\tZ.refreshControl(evt);\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * Select current record or not.\r\n\t * If 'selectBy' is not empty, select all records which value of 'selectBy' field is same as the current record.\r\n\t * <pre><code>\r\n\t * dsEmployee.select(true, 'gender');\r\n\t * //if the 'gender' of current value is female, all female employees will be selected.  \r\n\t * </code></pre>\r\n\t * \r\n\t * @param {Boolean}selected - true: select records, false:unselect records\r\n\t * @param {String)selectBy - field names, multiple fields concatenated with ',' \r\n\t */\r\n\tselect: function (selected, selectBy) {\r\n\t\tvar Z = this;\r\n\t\tif (Z.recordCount() === 0) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tvar changedRecNum = [];\r\n\t\tif (!selectBy) {\r\n\t\t\tZ.selected(selected);\r\n\t\t\tchangedRecNum.push(Z.recno());\r\n\t\t} else {\r\n\t\t\tvar arrFlds = selectBy.split(','), \r\n\t\t\t\tarrValues = [], i, \r\n\t\t\t\tfldCnt = arrFlds.length;\r\n\t\t\tfor (i = 0; i < fldCnt; i++) {\r\n\t\t\t\tarrValues[i] = Z.getFieldValue(arrFlds[i]);\r\n\t\t\t}\r\n\t\t\tvar v, preRecno = Z.recno(), flag;\r\n\t\t\ttry {\r\n\t\t\t\tfor (var k = 0, recCnt = Z.recordCount(); k < recCnt; k++) {\r\n\t\t\t\t\tZ.recnoSilence(k);\r\n\t\t\t\t\tflag = 1;\r\n\t\t\t\t\tfor (i = 0; i < fldCnt; i++) {\r\n\t\t\t\t\t\tv = Z.getFieldValue(arrFlds[i]);\r\n\t\t\t\t\t\tif (v != arrValues[i]) {\r\n\t\t\t\t\t\t\tflag = 0;\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (flag) {\r\n\t\t\t\t\t\tZ.selected(selected);\r\n\t\t\t\t\t\tchangedRecNum.push(Z.recno());\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} finally {\r\n\t\t\t\tZ.recnoSilence(preRecno);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar evt = jslet.data.RefreshEvent.selectRecordEvent(changedRecNum, selected);\r\n\t\tZ.refreshControl(evt);\r\n\t},\r\n\r\n\t/**\r\n\t * Set or get data provider\r\n\t * \r\n\t * @param {jslet.data.Provider} provider - data provider\r\n\t * @return {jslet.data.Provider or this}\r\n\t */\r\n\tdataProvider: function (provider) {\r\n\t\tif (provider === undefined) {\r\n\t\t\treturn this._dataProvider;\r\n\t\t}\r\n\t\tthis._dataProvider = provider;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @private\r\n\t */\r\n\t_checkDataProvider: function () {\r\n\t\tif (!this._dataProvider) {\r\n\t\t\tthrow new Error('DataProvider required, use: yourDataset.dataProvider(yourDataProvider);');\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * Get selected records\r\n\t * \r\n\t * @return {Object[]} Array of records\r\n\t */\r\n\tselectedRecords: function () {\r\n\t\tvar Z = this;\r\n\t\tif (!Z.hasRecord()) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tvar preRecno = Z.recno(), result = [];\r\n\t\ttry {\r\n\t\t\tfor (var k = 0, recCnt = Z.recordCount(); k < recCnt; k++) {\r\n\t\t\t\tZ.recnoSilence(k);\r\n\t\t\t\tif(Z.selected()) {\r\n\t\t\t\t\tresult.push(Z.getRecord());\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} finally {\r\n\t\t\tZ.recnoSilence(preRecno);\r\n\t\t}\r\n\t\t\r\n\t\treturn result;\r\n\t},\r\n\r\n\t/**\r\n\t * Get key values of selected records.\r\n\t * \r\n\t * @return {Object[]} Array of selected record key values\r\n\t */\r\n\tselectedKeyValues: function () {\r\n\t\tvar oldRecno = this.recno(), result = [];\r\n\t\ttry {\r\n\t\t\tfor (var i = 0, cnt = this.recordCount(); i < cnt; i++) {\r\n\t\t\t\tthis.recnoSilence(i);\r\n\t\t\t\tvar state = this.selected();\r\n\t\t\t\tif (state && state !== 2) { // 2: partial select\r\n\t\t\t\t\tresult.push(this.getFieldValue(this._keyField));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} finally {\r\n\t\t\tthis.recnoSilence(oldRecno);\r\n\t\t}\r\n\t\tif (result.length > 0) {\r\n\t\t\treturn result;\r\n\t\t} else {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t},\r\n\r\n\tqueryUrl: function(url) {\r\n\t\tif(url === undefined) {\r\n\t\t\treturn this._queryUrl;\r\n\t\t}\r\n\t\tjslet.Checker.test('Dataset.queryUrl', url).isString();\r\n\t\tthis._queryUrl = jQuery.trim(url);\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Query data from server. Example:\r\n\t * <pre><code>\r\n\t * dsEmployee.queryUrl('../getemployee.do');\r\n\t * var criteria = {name:'Bob', age:25};\r\n\t * dsEmployee.query(condition);\r\n\t * </code></pre>\r\n\t * @param {Plan Object or jslet.data.Dataset} criteria Condition should be a JSON object or criteria dataset.\r\n\t */\r\n\tquery: function (criteria) {\r\n\t\tif(criteria && criteria instanceof jslet.data.Dataset) {\r\n\t\t\tvar criteriaDataset = criteria;\r\n\t\t\tcriteriaDataset.confirm();\r\n\t\t\tif(criteriaDataset.checkAndShowError()) {\r\n\t\t\t\treturn jslet.emptyPromise;\r\n\t\t\t}\r\n\t\t\tcriteria = criteriaDataset.getRecord();\r\n\t\t}\r\n\t\tthis._queryCriteria = criteria;\r\n\t\treturn this.requery();\r\n\t},\r\n\r\n\t_doQuerySuccess: function(result, dataset) {\r\n\t\tvar Z = dataset;\r\n\t\tif (!result) {\r\n\t\t\tZ.dataList([]);\r\n\t\t\tif(result && result.info) {\r\n\t\t\t\tjslet.showInfo(result.info);\r\n\t\t\t}\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar mainData = result.main;\r\n\t\tif (mainData) {\r\n\t\t\tZ.dataList(mainData);\r\n\t\t}\r\n\t\tvar extraData = result.extraEntities;\r\n\t\tif(extraData) {\r\n\t\t\tvar dsName, dsObj;\r\n\t\t\tfor (dsName in extraData) {\r\n\t\t\t\tdsObj = jslet.data.getDataset(dsName);\r\n\t\t\t\tif (dsObj) {\r\n\t\t\t\t\tdsObj.dataList(extraData[dsName]);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tconsole.warn(dsName + ' is returned from server, but this datase does not exist!');\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (result.pageNo) {\r\n\t\t\tZ._pageNo = result.pageNo;\r\n\t\t}\r\n\t\tif (result.pageCount) {\r\n\t\t\tZ._pageCount = result.pageCount;\r\n\t\t}\r\n\t\tif(Z._onDataQueried) {\r\n\t\t\tZ._onDataQueried.call(Z);\r\n\t\t}\r\n\r\n\t\tvar evt = jslet.data.RefreshEvent.changePageEvent();\r\n\t\tZ.refreshControl(evt);\r\n\t\tif(result && result.info) {\r\n\t\t\tjslet.showInfo(result.info);\r\n\t\t}\r\n\t},\r\n\t\r\n\t_doApplyError: function(result, dataset) {\r\n\t\tvar Z = dataset,\r\n\t\t\terrCode = result.errorCode,\r\n\t\t\terrMsg = result.errorMessage;\r\n\t\tif(jslet.global.serverErrorHandler) {\r\n\t\t\tvar catched = jslet.global.serverErrorHandler(errCode, errMsg);\r\n\t\t\tif(catched) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\t\terrMsg = errMsg + \"[\" + errCode + \"]\";\r\n\t\tZ.errorMessage(errMsg);\r\n\t\tif(Z._autoShowError) {\r\n\t\t\tjslet.showError(errMsg);\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * Send request to refresh with current condition.\r\n\t */\r\n\trequery: function () {\r\n\t\tvar Z = this;\r\n\t\tZ._checkDataProvider();\r\n\r\n\t\tif(!this._queryUrl) {\r\n\t\t\t//QueryUrl required! Use: yourDataset.queryUrl(yourUrl)\r\n\t\t\tthrow new Error(jslet.locale.Dataset.queryUrlRequired);\r\n\t\t}\r\n\t\tif(Z._querying) { //Avoid duplicate submitting\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tZ._querying = true;\r\n\t\ttry {\r\n\t\t\tvar reqData = {};\r\n\t\t\tif(Z._pageNo > 0) {\r\n\t\t\t\treqData.pageNo = Z._pageNo;\r\n\t\t\t\treqData.pageSize = Z._pageSize;\r\n\t\t\t}\r\n\t\t\tvar criteria = Z._queryCriteria;\r\n\t\t\tif(criteria) {\r\n\t\t\t\tif(jslet.isArray(criteria)) {\r\n\t\t\t\t\treqData.criteria = criteria;\r\n\t\t\t\t} else {\r\n\t\t\t\t\treqData.simpleCriteria = criteria;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif(Z.csrfToken) {\r\n\t\t\t\treqData.csrfToken = Z.csrfToken;\r\n\t\t\t}\r\n\t\t\treqData = jslet.data.record2Json(reqData);\r\n\t\t\tvar url = Z._queryUrl;\r\n\t\t\treturn Z._dataProvider.sendRequest(Z, url, reqData)\r\n\t\t\t.done(Z._doQuerySuccess)\r\n\t\t\t.fail(Z._doApplyError)\r\n\t\t\t.always(function(){Z._querying = false;});\r\n\t\t} catch(e) {\r\n\t\t\tZ._querying = false;\r\n\t\t}\r\n\t},\r\n\r\n\t_setChangedState: function(flag, chgRecs, pendingRecs) {\r\n\t\tif(!chgRecs || chgRecs.length === 0) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar result = this._addRecordClassFlag(chgRecs, flag, this._recordClass || jslet.global.defaultRecordClass);\r\n\t\tfor(var i = 0, len = result.length; i < len; i++) {\r\n\t\t\tpendingRecs.push(result[i]);\r\n\t\t}\r\n\t},\r\n\r\n\t_addRecordClassFlag: function(records, changeFlag, recClazz) {\r\n\t\tvar fields = this.getFields(),\r\n\t\t\tfldObj, i, len, \r\n\t\t\tdetailRecordClass = null;\r\n\t\t\r\n\t\tfor(i = 0, len = fields.length; i < len; i++) {\r\n\t\t\tfldObj = fields[i];\r\n\t\t\tif(fldObj.getType() === jslet.data.DataType.DATASET) {\r\n\t\t\t\tif(!detailRecordClass) {\r\n\t\t\t\t\tdetailRecordClass = {};\r\n\t\t\t\t}\r\n\t\t\t\tdetailRecordClass[fldObj.name()] = fldObj.detailDataset().recordClass();\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar result = [], rec, pRec, dtlRecClazz, cnt;\r\n\t\tfor (i = 0, cnt = records.length; i < cnt; i++) {\r\n\t\t\trec = records[i];\r\n\t\t\tpRec = {};\r\n\t\t\tif(recClazz) {\r\n\t\t\t\tpRec[\"@type\"] = recClazz;\r\n\t\t\t}\r\n\t\t\trec[jslet.global.changeStateField] = changeFlag + i;\r\n\t\t\tvar fldValue;\r\n\t\t\tfor(var prop in rec) {\r\n\t\t\t\tfldValue = rec[prop];\r\n\t\t\t\tif(fldValue && detailRecordClass) {\r\n\t\t\t\t\tdtlRecClazz = detailRecordClass[prop];\r\n\t\t\t\t\tif(dtlRecClazz) {\r\n\t\t\t\t\t\tfldValue = this._addRecordClassFlag(fldValue, changeFlag, dtlRecClazz);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tpRec[prop] = fldValue;\r\n\t\t\t}\r\n\t\t\tresult.push(pRec);\r\n\t\t}\r\n\t\treturn result;\r\n\t},\r\n\t\r\n\t_doSaveSuccess: function(result, dataset) {\r\n\t\tif (!result) {\r\n\t\t\tif(result && result.info) {\r\n\t\t\t\tjslet.showInfo(result.info);\r\n\t\t\t}\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar mainData = result.main;\r\n\t\tvar Z = dataset;\r\n\t\tZ._dataTransformer.refreshSubmittedData(mainData);\r\n\r\n\t\tZ._calcAggradedValueDebounce.call(Z);\r\n\t\tZ.selection.removeAll();\r\n\t\tif(Z._onDataSubmitted) {\r\n\t\t\tZ._onDataSubmitted.call(Z);\r\n\t\t}\r\n\t\t\r\n\t\tZ.refreshControl();\r\n\t\tZ.refreshLookupHostDataset();\r\n\t\tif(result && result.info) {\r\n\t\t\tjslet.showInfo(result.info);\r\n\t\t}\r\n\t},\r\n\t\r\n\tsubmitUrl: function(url) {\r\n\t\tif(url === undefined) {\r\n\t\t\treturn this._submitUrl;\r\n\t\t}\r\n\r\n\t\tjslet.Checker.test('Dataset.submitUrl', url).isString();\r\n\t\tthis._submitUrl = jQuery.trim(url);\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Identify dataset has changed records.\r\n\t */\r\n\thasChangedData: function(noConfirm) {\r\n\t\tvar Z = this;\r\n\t\tif(!noConfirm) {\r\n\t\t\tZ.confirm();\r\n\t\t}\r\n\t\tvar dataList = Z.dataList(), record, recInfo;\r\n\t\tif(!dataList) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tfor(var i = 0, len = dataList.length; i < len; i++) {\r\n\t\t\trecord = dataList[i];\r\n\t\t\trecInfo = jslet.data.getRecInfo(record);\r\n\t\t\tif(recInfo && recInfo.status && recInfo.status !== jslet.data.DataSetStatus.BROWSE) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Submit changed data to server. \r\n\t * If server side save data successfully and return the changed data, Jslet can refresh the local data automatically.\r\n\t * \r\n\t * Cause key value is probably generated at server side(like sequence), we need an extra field which store an unique value to update the key value,\r\n\t * this extra field is named '_s_', its value will start a letter 'i', 'u' or 'd', and follow a sequence number, like: i1, i2, u1, u2, d1, d3,....\r\n\t * You don't care about it in client side, it is generated by Jslet automatically.\r\n\t * \r\n\t * At server side, you can use the leading letter to distinguish which action will be sent to DB('i' for insert, 'u' for update and 'd' for delete)\r\n\t * If the records need be changed in server(like sequence key or other calculated fields), you should return them back.Notice:\r\n\t * you need not to change this value of extra field: '_s_', just return it. Example:\r\n\t * <pre><code>\r\n\t * dsFoo.insertRecord();\r\n\t * dsFoo.setFieldValue('name','Bob');\r\n\t * dsFoo.setFieldValue('code','A01');\r\n\t * dsFoo.confirm();\r\n\t * dsFoo.submitUrl('../foo_save.do');\r\n\t * dsFoo.submit();\r\n\t * </code></pre>\r\n\t * \r\n\t * @param {Object} extraInfo extraInfo to send to server\r\n\t * @param {Array of String} excludeFields Array of field names which need not be sent to server;\r\n\t */\r\n\tsubmit: function(extraInfo, excludeFields) {\r\n\t\tvar Z = this;\r\n\t\tZ.confirm();\r\n\t\tif(Z.checkAndShowError()) {\r\n\t\t\treturn jslet.emptyPromise;\r\n\t\t}\r\n\t\tZ._checkDataProvider();\r\n\r\n\t\tif(!Z._submitUrl) {\r\n\t\t\t//Dataset\\'s submitUrl required! Use: yourDataset.submitUrl(yourUrl)\r\n\t\t\tthrow new Error(jslet.locale.Dataset.submitUrlRequired);\r\n\t\t}\r\n\t\tvar changedRecs = Z._dataTransformer.getSubmittingChanged();\r\n\t\tif (!changedRecs || changedRecs.length === 0) {\r\n\t\t\tjslet.showInfo(jslet.locale.Dataset.noDataSubmit);\r\n\t\t\treturn jslet.emptyPromise;\r\n\t\t}\r\n\t\tif(Z._submitting) { //Avoid duplicate submitting\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tZ._submitting = true;\r\n\t\ttry {\r\n\t\t\tvar reqData = {main: changedRecs};\r\n\t\t\tif(extraInfo) {\r\n\t\t\t\treqData.extraInfo = extraInfo;\r\n\t\t\t}\r\n\t\t\tif(Z.csrfToken) {\r\n\t\t\t\treqData.csrfToken = Z.csrfToken;\r\n\t\t\t}\r\n\t\t\treqData = jslet.data.record2Json(reqData, excludeFields);\r\n\t\t\tvar url = Z._submitUrl;\r\n\t\t\treturn Z._dataProvider.sendRequest(Z, url, reqData)\r\n\t\t\t.done(Z._doSaveSuccess)\r\n\t\t\t.fail(Z._doApplyError)\r\n\t\t\t.always(function(){\r\n\t\t\t\tZ._submitting = false;\r\n\t\t\t});\r\n\t\t} catch(e) {\r\n\t\t\tZ._submitting = false;\r\n\t\t}\r\n\t},\r\n\t\r\n\t_doSubmitSelectedSuccess: function(result, dataset) {\r\n\t\tif(!result) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar mainData = result.main;\r\n\t\tif (!mainData || mainData.length === 0) {\r\n\t\t\tif(result.info) {\r\n\t\t\t\tjslet.showInfo(result.info);\r\n\t\t\t}\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar Z = dataset,\r\n\t\t\tdeleteOnSuccess = Z._deleteOnSuccess_,\r\n\t\t\tarrRecs = Z.selectedRecords() || [],\r\n\t\t\ti, k, rec,\r\n\t\t\trecords = Z.dataList();\r\n\t\tZ.selection.removeAll();\r\n\t\tif(deleteOnSuccess) {\r\n\t\t\tfor(i = arrRecs.length; i >= 0; i--) {\r\n\t\t\t\trec = arrRecs[i];\r\n\t\t\t\tk = records.indexOf(rec);\r\n\t\t\t\trecords.splice(k, 1);\r\n\t\t\t}\r\n\t\t\tZ._refreshInnerRecno();\r\n\t\t} else {\r\n\t\t\tvar newRec, oldRec, len;\r\n\t\t\tZ._dataTransformer.refreshSubmittedData(mainData);\r\n\t\t}\r\n\t\tZ._calcAggradedValueDebounce.call(Z);\r\n\t\tif(Z._onDataSubmitted) {\r\n\t\t\tZ._onDataSubmitted.call(Z);\r\n\t\t}\r\n\t\tZ.refreshControl();\r\n\t\tZ.refreshLookupHostDataset();\r\n\t\tif(result && result.info) {\r\n\t\t\tjslet.showInfo(result.info);\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * Send selected data to server whether or not the records have been changed. \r\n\t * Under some special scenarios, we need send user selected record to server to process. \r\n\t * Sever side need not send back the processed records. Example:\r\n\t * \r\n\t * <pre><code>\r\n\t * //Audit the selected records, if successful, delete the selected records.\r\n\t * dsFoo.submitSelected('../foo_audit.do', true);\r\n\t * \r\n\t * </code></pre>\r\n\t * @param {String} url Url\r\n\t * @param {Boolean} deleteOnSuccess If processing successfully at server side, delete the selected record or not.\r\n\t * @param {Object} extraInfo extraInfo\r\n\t * @param {Array of String} excludeFields Array of field names which need not be sent to server;\r\n\t */\r\n\tsubmitSelected: function (url, deleteOnSuccess, extraInfo, excludeFields) {\r\n\t\tvar Z = this;\r\n\t\tZ.confirm();\r\n\t\tif(Z.checkAndShowError()) {\r\n\t\t\treturn jslet.emptyPromise;\r\n\t\t}\r\n\t\tZ._checkDataProvider();\r\n\t\tjslet.Checker.test('Dataset.submitSelected#url', url).required().isString();\r\n\t\tif(Z._submitting) { //Avoid duplicate submitting\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tZ._submitting = true;\r\n\t\ttry {\r\n\t\t\tvar changedRecs = Z._dataTransformer.getSubmittingSelected() || [];\r\n\t\r\n\t\t\tZ._deleteOnSuccess_ = deleteOnSuccess;\r\n\t\t\tvar reqData = {main: changedRecs};\r\n\t\t\tif(Z.csrfToken) {\r\n\t\t\t\treqData.csrfToken = Z.csrfToken;\r\n\t\t\t}\r\n\t\t\tif(extraInfo) {\r\n\t\t\t\treqData.extraInfo = extraInfo;\r\n\t\t\t}\r\n\t\t\treqData = jslet.data.record2Json(reqData, excludeFields);\r\n\t\t\treturn Z._dataProvider.sendRequest(Z, url, reqData)\r\n\t\t\t.done(Z._doSubmitSelectedSuccess)\r\n\t\t\t.fail(Z._doApplyError)\r\n\t\t\t.always(function(){\r\n\t\t\t\tZ._submitting = false;\r\n\t\t\t});\r\n\t\t} catch(e) {\r\n\t\t\tZ._submitting = false;\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * @private\r\n\t */\r\n\t_refreshInnerControl: function (updateEvt) {\r\n\t\tvar i, cnt, ctrl;\r\n\t\tif (updateEvt.eventType == jslet.data.RefreshEvent.UPDATEALL || \r\n\t\t\t\tupdateEvt.eventType == jslet.data.RefreshEvent.CHANGEMETA) {\r\n\t\t\tcnt = this._linkedLabels.length;\r\n\t\t\tfor (i = 0; i < cnt; i++) {\r\n\t\t\t\tctrl = this._linkedLabels[i];\r\n\t\t\t\tif (ctrl.refreshControl) {\r\n\t\t\t\t\tctrl.refreshControl(updateEvt);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tcnt = this._linkedControls.length;\r\n\t\tfor (i = 0; i < cnt; i++) {\r\n\t\t\tctrl = this._linkedControls[i];\r\n\t\t\tif (ctrl && ctrl.refreshControl) {\r\n\t\t\t\tctrl.refreshControl(updateEvt);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * Focus on the edit control that link specified field name.\r\n\t * \r\n\t * @param {String} fldName Field name\r\n\t */\r\n\tfocusEditControl: function (fldName) {\r\n\t\tvar Z = this,\r\n\t\t\tctrl, el, fldObj;\r\n\t\tif(jslet.temp.focusing) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tfor (var i = Z._linkedControls.length - 1; i >= 0; i--) {\r\n\t\t\tctrl = Z._linkedControls[i];\r\n\t\t\tif(!ctrl.field) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tif (ctrl.field() == fldName) {\r\n\t\t\t\t//Avoid nesting call\r\n\t\t\t\tjslet.temp.focusing = true;\r\n\t\t\t\ttry {\r\n\t\t\t\t\tctrl.focus();\r\n\t\t\t\t} finally {\r\n\t\t\t\t\tjslet.temp.focusing = false;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} //end for\r\n\t},\r\n\r\n\t/**\r\n\t * Focus the first error field.\r\n\t */\r\n\tfocusFirstErrorField: function() {\r\n\t\tvar fldName = jslet.data.FieldError.getFirstErrorField(this.getRecord());\r\n\t\tif(!fldName) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis.focusEditControl(fldName);\r\n\t},\r\n\t\r\n\t/**\r\n\t * Refresh whole field.\r\n\t * \r\n\t * @param {String} fldName field name.\r\n\t */\r\n\trefreshField: function(fldName) {\r\n\t\tthis.refreshControl(jslet.data.RefreshEvent.updateColumnEvent(fldName));\r\n\t},\r\n\t\r\n\t/**\r\n\t * Refresh lookup field.\r\n\t * \r\n\t * @param {String} fldName field name.\r\n\t */\r\n\trefreshLookupField: function(fldName) {\r\n\t\tvar lookupEvt = jslet.data.RefreshEvent.lookupEvent(fldName);\r\n\t\tthis.refreshControl(lookupEvt);\r\n\t},\r\n\t\r\n\t/**\r\n\t * @private \r\n\t */\r\n\trefreshControl: function (updateEvt) {\r\n\t\tif (this._lockCount) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (!updateEvt) {\r\n\t\t\tupdateEvt = jslet.data.RefreshEvent.updateAllEvent();\r\n\t\t}\r\n\t\tthis._refreshInnerControl(updateEvt);\r\n\t},\r\n\r\n\t/**\r\n\t * @private \r\n\t */\r\n\taddLinkedControl: function (linkedControl) {\r\n\t\tif (linkedControl.isLabel) {\r\n\t\t\tthis._linkedLabels.push(linkedControl);\r\n\t\t} else {\r\n\t\t\tthis._linkedControls.push(linkedControl);\r\n\t\t\tvar fldName = null;\r\n\t\t\tif(linkedControl.field) {\r\n\t\t\t\tfldName = linkedControl.field();\r\n\t\t\t}\r\n\t\t\tif(fldName && linkedControl.canFocus()) {\r\n\t\t\t\tif(!this._canFocusFields) {\r\n\t\t\t\t\tthis._canFocusFields = [];\r\n\t\t\t\t}\r\n\t\t\t\tthis._canFocusFields.push(fldName);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * @private \r\n\t */\r\n\tremoveLinkedControl: function (linkedControl) {\r\n\t\tvar arrCtrls = linkedControl.isLabel ? this._linkedLabels : this._linkedControls;\r\n\t\t\r\n\t\tvar k = arrCtrls.indexOf(linkedControl);\r\n\t\tif (k >= 0) {\r\n\t\t\tarrCtrls.splice(k, 1);\r\n\t\t}\r\n\t\tif(!linkedControl.isLabel && linkedControl.field) {\r\n\t\t\tvar fldName = linkedControl.field();\r\n\t\t\tif(fldName) {\r\n\t\t\t\tk = this._canFocusFields.indexOf(fldName);\r\n\t\t\t\tif(k >= 0) {\r\n\t\t\t\t\tthis._canFocusFields.splice(k, 1);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\trefreshLookupHostDataset: function() {\r\n\t\tif(this._autoRefreshHostDataset) {\r\n\t\t\tjslet.data.datasetRelationManager.refreshLookupHostDataset(this._name);\r\n\t\t}\r\n\t},\r\n\t\r\n\thandleLookupDatasetChanged: function(fldName) {\r\n\t\tvar Z = this;\r\n\t\tZ.refreshLookupField(fldName);\r\n\t\tif(!Z._inContextRule) {\r\n\t\t\tjslet.data.FieldValueCache.clearAll(Z, fldName);\r\n\t\t}\r\n\t\t//Don't use the following code, is will cause DBAutoComplete control issues.\r\n\t\t//this.refreshControl(jslet.data.RefreshEvent.updateColumnEvent(fldName));\r\n\t},\r\n\r\n\tinnerExportTextArray: function(exportOption, csvFlag) {\r\n\t\tvar Z = this;\r\n\t\tZ.confirm();\r\n\t\tif(Z.existDatasetError()) {\r\n\t\t\tconsole.warn(jslet.locale.Dataset.cannotConfirm);\r\n\t\t}\r\n\r\n\t\tvar exportHeader = true,\r\n\t\t\texportDisplayValue = true,\r\n\t\t\tonlySelected = false,\r\n\t\t\tincludeFields = null,\r\n\t\t\texcludeFields = null,\r\n\t\t\tescapeDate = true;\r\n\t\t\r\n\t\tif(exportOption && jQuery.isPlainObject(exportOption)) {\r\n\t\t\tif(exportOption.exportHeader !== undefined) {\r\n\t\t\t\texportHeader = exportOption.exportHeader? true: false;\r\n\t\t\t}\r\n\t\t\tif(exportOption.onlySelected !== undefined) {\r\n\t\t\t\tonlySelected = exportOption.onlySelected? true: false;\r\n\t\t\t}\r\n\t\t\tif(exportOption.includeFields !== undefined) {\r\n\t\t\t\tincludeFields = exportOption.includeFields;\r\n\t\t\t\tjslet.Checker.test('Dataset.exportCsv#exportOption.includeFields', includeFields).isArray();\r\n\t\t\t}\r\n\t\t\tif(exportOption.excludeFields !== undefined) {\r\n\t\t\t\texcludeFields = exportOption.excludeFields;\r\n\t\t\t\tjslet.Checker.test('Dataset.exportCsv#exportOption.excludeFields', excludeFields).isArray();\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar result = [], \r\n\t\t\tarrRec, \r\n\t\t\tfldCnt = Z._normalFields.length, \r\n\t\t\tfldObj, fldName, value,\r\n\t\t\texportFields = [],\r\n\t\t\tdateFields = null;\r\n\t\tfor(var i = 0; i < fldCnt; i++) {\r\n\t\t\tfldObj = Z._normalFields[i];\r\n\t\t\tfldName = fldObj.name();\r\n\t\t\tif(includeFields && includeFields.length > 0) {\r\n\t\t\t\tif(includeFields.indexOf(fldName) < 0) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tif(!fldObj.visible()) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif(excludeFields && excludeFields.length > 0) {\r\n\t\t\t\tif(excludeFields.indexOf(fldName) >= 0) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t} \r\n\t\t\tif(csvFlag && fldObj.getType() === jslet.data.DataType.DATE) {\r\n\t\t\t\tif(!dateFields) {\r\n\t\t\t\t\tdateFields = [];\r\n\t\t\t\t}\r\n\t\t\t\tdateFields.push(i);\r\n\t\t\t}\r\n\t\t\texportFields.push(fldObj);\r\n\t\t}\r\n\t\tfldCnt = exportFields.length;\r\n\t\tif (exportHeader) {\r\n\t\t\tarrRec = [];\r\n\t\t\tfor(i = 0; i < fldCnt; i++) {\r\n\t\t\t\tfldObj = exportFields[i];\r\n\t\t\t\tfldName = fldObj.label();\r\n\t\t\t\tarrRec.push(fldName);\r\n\t\t\t}\r\n\t\t\tresult.push(arrRec);\r\n\t\t}\r\n\r\n\t\tvar context = Z.startSilenceMove(), text, dataType,\r\n\t\t\thtmlTagRegarExpr = /<\\/?[^>]*>/g;\r\n\t\ttry{\r\n\t\t\tZ.first();\r\n\t\t\twhile(!Z.isEof()) {\r\n\t\t\t\tif (onlySelected && !Z.selected()) {\r\n\t\t\t\t\tZ.next();\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\tarrRec = [];\r\n\t\t\t\tfor(i = 0; i < fldCnt; i++) {\r\n\t\t\t\t\tfldObj = exportFields[i];\r\n\t\t\t\t\tfldName = fldObj.name();\r\n\t\t\t\t\t//If Number field does not have lookup field, return field value, not field text. \r\n\t\t\t\t\t//Example: 'amount' field\r\n\t\t\t\t\tdataType = fldObj.getType();\r\n\t\t\t\t\tif(dataType === jslet.data.DataType.NUMBER && !fldObj.lookup()) {\r\n\t\t\t\t\t\ttext = fldObj.getValue();\r\n\t\t\t\t\t\tif(text === null || text === undefined) {\r\n\t\t\t\t\t\t\ttext = '';\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\ttext += '';\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\ttext = Z.getFieldText(fldName);\r\n\t\t\t\t\t\tif(text === null || text === undefined) {\r\n\t\t\t\t\t\t\ttext = '';\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif(text && dataType === jslet.data.DataType.STRING) {\r\n\t\t\t\t\t\t\tvar replaceFn = text.replace;\r\n\t\t\t\t\t\t\tif(replaceFn) {\r\n\t\t\t\t\t\t\t\ttext = replaceFn.call(text, htmlTagRegarExpr, ''); //Get rid of HTML tag\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\ttext += '';\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tarrRec.push(text);\r\n\t\t\t\t}\r\n\t\t\t\tresult.push(arrRec);\r\n\t\t\t\tZ.next();\r\n\t\t\t} // end while\r\n\t\t\tif(!csvFlag) {\r\n\t\t\t\treturn result;\r\n\t\t\t} else {\r\n\t\t\t\treturn [result, dateFields];\r\n\t\t\t}\r\n\t\t}finally{\r\n\t\t\tZ.endSilenceMove(context);\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * Export dataset as text array.\r\n\t * \r\n\t * Export option pattern:\r\n\t * {exportHeader: true|false, //export with field labels\r\n\t *  onlySelected: true|false, //export selected records or not\r\n\t *  includeFields: ['fldName1', 'fldName2',...], //Array of field names which to be exported\r\n\t *  excludeFields: ['fldName1', 'fldName2',...]  //Array of field names which not to be exported\r\n\t *  }\r\n\t *  \r\n\t * @param exportOption {PlanObject} export options\r\n\t * \r\n\t * @return {String} Csv Text. \r\n\t */\r\n\texportTextArray: function(exportOption) {\r\n\t\treturn this.innerExportTextArray(exportOption);\r\n\t},\r\n\t\r\n\t/**\r\n\t * Export data with CSV format.\r\n\t * \r\n\t * Export option pattern:\r\n\t * {exportHeader: true|false, //export with field labels\r\n\t *  onlySelected: true|false, //export selected records or not\r\n\t *  includeFields: ['fldName1', 'fldName2',...], //Array of field names which to be exported\r\n\t *  excludeFields: ['fldName1', 'fldName2',...]  //Array of field names which not to be exported\r\n\t *  }\r\n\t *  \r\n\t * @param exportOption {PlanObject} export options\r\n\t * \r\n\t * @return {String} Csv Text. \r\n\t */\r\n\texportCsv: function(exportOption) {\r\n\t\tvar textArr = this.innerExportTextArray(exportOption, true),\r\n\t\t\tdateFields = textArr[1];\r\n\t\ttextArr = textArr[0];\r\n\t\t\t\r\n\t\tif(textArr.length === 0) {\r\n\t\t\treturn '';\r\n\t\t}\r\n\t\tvar escapeDate = true;\r\n\t\tif(exportOption.escapeDate !== undefined) {\r\n\t\t\tescapeDate = exportOption.escapeDate? true: false;\r\n\t\t}\r\n\t\t\r\n\t\tvar\trecArr = textArr[0],\r\n\t\t\tfldCnt = recArr.length,\r\n\t\t\tfldSeperator = ',', \r\n\t\t\tsurround='\"',\r\n\t\t\ttext, isDate = false;\r\n\t\t\r\n\t\tfor(var i = 0, recCnt = textArr.length; i < recCnt; i++) {\r\n\t\t\trecArr = textArr[i];\r\n\t\t\tfor(var j = 0; j < fldCnt; j++) {\r\n\t\t\t\ttext = recArr[j];\r\n\t\t\t\tif(text) {\r\n\t\t\t\t\ttext = text.replace(/\"/g,'\"\"');\r\n\t\t\t\t\tvar isStartZero = false;\r\n\t\t\t\t\tif(text.startsWith('0')) {\r\n\t\t\t\t\t\tisStartZero = true;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tisDate = false;\r\n\t\t\t\t\t\tif(escapeDate && dateFields && i > 0 && dateFields.indexOf(j) >= 0) {\r\n\t\t\t\t\t\t\tisDate = true;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\ttext = surround + text + surround;\r\n\t\t\t\t\tif(isStartZero || isDate) {\r\n\t\t\t\t\t\ttext = '=' + text;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttext = '\"\"';\r\n\t\t\t\t}\r\n\t\t\t\trecArr[j] = text;\r\n\t\t\t}\r\n\t\t\ttextArr[i] = recArr.join(fldSeperator);\r\n\t\t}\r\n\t\treturn textArr.join('\\n');\r\n\t},\r\n\r\n\t/**\r\n\t * Export data to CSV file.\r\n\t * \r\n\t * Export option pattern:\r\n\t * {exportHeader: true|false, //export with field labels\r\n\t *  exportDisplayValue: true|false, //true: export display value of field, false: export actual value of field\r\n\t *  onlySelected: true|false, //export selected records or not\r\n\t *  includeFields: ['fldName1', 'fldName2',...], //Array of field names which to be exported\r\n\t *  excludeFields: ['fldName1', 'fldName2',...]  //Array of field names which not to be exported\r\n\t *  }\r\n\t *  \r\n\t * @param exportOption {PlanObject} export options\r\n\t */\r\n\texportCsvFile: function(fileName, exportOption) {\r\n\t\tjslet.Checker.test('Dataset.exportCsvFile#fileName', fileName).required().isString();\r\n    \tvar str = this.exportCsv(exportOption);\r\n        var a = document.createElement('a');\r\n\t\t\r\n        var blob = new window.Blob([str], {'type': 'text\\/csv'});\r\n        a.href = window.URL.createObjectURL(blob);\r\n        a.download = fileName;\r\n        a.click();\r\n    },\r\n    \r\n    showImportDialog: function() {\r\n    \tif(!jslet.ui.ImportDialog) {\r\n    \t\tconsole.warn('jslet.ui.ImportDialog not installed!');\r\n    \t\treturn;\r\n    \t}\r\n    \tvar Z = this;\r\n    \tif(!Z._importDialog) {\r\n    \t\tZ._importDialog = new jslet.ui.ImportDialog(Z);\r\n    \t}\r\n    \tZ._importDialog.show(); \r\n    },\r\n    \r\n    showExportDialog: function(fileName) {\r\n    \tif(!jslet.ui.ExportDialog) {\r\n    \t\tconsole.warn('jslet.ui.ExportDialog not installed!');\r\n    \t\treturn;\r\n    \t}\r\n    \tvar Z = this;\r\n    \tif(!Z._exportDialog) {\r\n    \t\tZ._exportDialog = new jslet.ui.ExportDialog(Z);\r\n    \t}\r\n    \tZ._exportDialog.show(fileName);\r\n    },\r\n    \r\n\t/** \r\n\t* Get filtered data list. \r\n\t* \r\n\t*/ \r\n\tfilteredDataList: function() { \r\n\t\tvar Z= this, \r\n\t\t\tresult = [], \r\n\t\t\toldRecno = Z.recnoSilence(); \r\n\t\tZ.confirm();\r\n\t\ttry { \r\n\t\t\tfor(var i = 0, len = Z.recordCount(); i < len; i++) {\r\n\t\t\t\tZ.recnoSilence(i); \r\n\t\t\t\tresult.push(Z.getRecord()); \r\n\t\t\t} \r\n\t\t} finally { \r\n\t\t\tZ.recnoSilence(oldRecno); \r\n\t\t} \r\n\t\treturn result; \r\n\t}, \r\n\r\n\t/** \r\n\t* Iterate the whole dataset, and run the specified callback function. \r\n\t* Example: \r\n\t* \r\n\t* dataset.iterate(function(){\r\n\t* \tvar fldValue = this.getFieldValue('xxx');\r\n\t* \tthis.setFieldValue('xxx', fldValue);\r\n\t* }); \r\n\t* \r\n\t*/ \r\n\titerate: function(callBackFn, startRecno, endRecno) { \r\n\t\tjslet.Checker.test('Dataset.iterate#callBackFn', callBackFn).required().isFunction(); \r\n\t\tvar Z= this, \r\n\t\t\tresult = [], \r\n\t\t\tcontext = Z.startSilenceMove(); \r\n\t\ttry{\r\n\t\t\tstartRecno = startRecno || 0;\r\n\t\t\tif(endRecno !== 0 && !endRecno) {\r\n\t\t\t\tendRecno = Z.recordCount() - 1;\r\n\t\t\t}\r\n\t\t\tfor(var k = startRecno; k <= endRecno; k++) {\r\n\t\t\t\tZ.recno(k);\r\n\t\t\t\tif(callBackFn) { \r\n\t\t\t\t\tif(callBackFn.call(Z)) {\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t} \r\n\t\t\t\t} \r\n\t\t\t} \r\n\t\t}finally{ \r\n\t\t\tZ.endSilenceMove(context); \r\n\t\t} \r\n\t\treturn result; \r\n\t}, \r\n\t\r\n\t/**\r\n\t * Set or get raw data list\r\n\t * \r\n\t * @param {Object[]} datalst - raw data list\r\n\t */\r\n\tdataList: function (datalst) {\r\n\t\tvar Z = this;\r\n\t\tif (datalst === undefined) {\r\n\t\t\tif(Z._masterField) {\r\n\t\t\t\treturn Z.masterDataset().getFieldValue(Z._masterField);\r\n\t\t\t}\r\n\t\t\treturn Z._dataList;\r\n\t\t}\r\n\t\tjslet.Checker.test('Dataset.dataList', datalst).isArray();\r\n\t\tif(Z._masterField) {\r\n\t\t\tif(datalst === null) {\r\n\t\t\t\tdatalst = [];\r\n\t\t\t}\r\n\t\t\tZ.masterDataset().setFieldValue(Z._masterField, datalst);\r\n\t\t} else {\r\n\t\t\tZ._dataList = datalst;\r\n\t\t}\r\n\t\tZ._initialize();\r\n\t\tvar fields = Z._detailDatasetFields;\r\n\t\tif(fields) {\r\n\t\t\tvar fldObj, dsDetail;\r\n\t\t\tfor(var i = 0, len = fields.length; i < len; i++) {\r\n\t\t\t\tfldObj = fields[i];\r\n\t\t\t\tdsDetail = fldObj.detailDataset();\r\n\t\t\t\tif(dsDetail) {\r\n\t\t\t\t\tdsDetail.confirm();\r\n\t\t\t\t\tdsDetail._initialize();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t_initialize: function(isDetailDs) {\r\n\t\tvar Z = this;\r\n\t\tif(!isDetailDs) { //Master dataset\r\n\t\t\tjslet.data.FieldValueCache.removeAllCache(Z);\r\n\t\t\tjslet.data.FieldError.clearDatasetError(Z);\r\n\t\t\tZ._changeLog.clear();\r\n\t\t}\r\n\t\tZ.status(jslet.data.DataSetStatus.BROWSE);\r\n\t\tZ._recno = -1;\r\n\t\tZ._sortByFields();\r\n\t\tZ.filter(null);\r\n\t\tif(Z.filtered() || Z.fixedFilter()) {\r\n\t\t\tZ._doFilterChanged();\t\t\t\r\n\t\t}\r\n\t\tZ.first();\r\n\t\tZ.refreshControl(jslet.data.RefreshEvent._updateAllEvent);\r\n\t\tZ.refreshLookupHostDataset();\r\n\t},\r\n\t\r\n\t/**\r\n\t * Return dataset data with field text, field text is formatted or calculated field value.\r\n\t * You can use them to do your special processing like: use them in jquery template.\r\n\t */\r\n\ttextList: function() {\r\n\t\tvar Z = this;\r\n\t\tZ.confirm();\r\n\t\t\r\n\t\tvar\toldRecno = Z.recno(), \r\n\t\t\tresult = [],\r\n\t\t\tfldCnt = Z._normalFields.length,\r\n\t\t\tfldObj, fldName, textValue, textRec;\r\n\t\ttry {\r\n\t\t\tfor (var i = 0, cnt = Z.recordCount(); i < cnt; i++) {\r\n\t\t\t\tZ.recnoSilence(i);\r\n\t\t\t\ttextRec = {};\r\n\t\t\t\tfor(var j = 0; j < fldCnt; j++) {\r\n\t\t\t\t\tfldObj = Z._normalFields[j];\r\n\t\t\t\t\tfldName = fldObj.name();\r\n\t\t\t\t\ttextValue = Z.getFieldText(fldName);\r\n\t\t\t\t\ttextRec[fldName] = textValue;\r\n\t\t\t\t}\r\n\t\t\t\tresult.push(textRec);\r\n\t\t\t}\r\n\t\t\treturn result;\r\n\t\t} finally {\r\n\t\t\tthis.recnoSilence(oldRecno);\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * Export dataset snapshot. Dataset snapshot can be used for making a backup when inputing a lot of data. \r\n\t * \r\n\t * @return {Object} Dataset snapshot.\r\n\t */\r\n\texportSnapshot: function() {\r\n\t\tvar Z = this;\r\n\t\tif(Z.dataList() === 0) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\tvar\tmainDs = {name: Z.name(), recno: Z.recno(), status: Z.status(), dataList: Z.dataList(), changedRecords: Z._changeLog._changedRecords};\r\n\t\tvar indexFields = Z.indexFields();\r\n\t\tif(indexFields) {\r\n\t\t\tmainDs.indexFields = indexFields;\r\n\t\t}\r\n\t\tvar filter = Z.filter();\r\n\t\tif(filter) {\r\n\t\t\tmainDs.filter = filter;\r\n\t\t\tmainDs.filtered = Z.filtered();\r\n\t\t}\r\n\t\tvar result = {master: mainDs};\r\n\t\tvar details = null, detail;\r\n\t\tvar detailFields = Z._detailDatasetFields;\r\n\t\tif(detailFields) {\r\n\t\t\tvar dtlFldObj, dsDetail;\r\n\t\t\tfor(var i = 0, len = detailFields.length; i < len; i++) {\r\n\t\t\t\tdtlFldObj = detailFields[i];\r\n\t\t\t\tdsDetail = dtlFldObj.detailDataset();\r\n\t\t\t\tif(dsDetail) {\r\n\t\t\t\t\tif(!details) {\r\n\t\t\t\t\t\tdetails = [];\r\n\t\t\t\t\t}\r\n\t\t\t\t\tdetail = {name: dsDetail.name(), recno: dsDetail.recno(), status: dsDetail.status()};\r\n\t\t\t\t\tindexFields = dsDetail.indexFields();\r\n\t\t\t\t\tif(indexFields) {\r\n\t\t\t\t\t\tdsDetail.indexFields = indexFields;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tfilter = dsDetail.filter();\r\n\t\t\t\t\tif(filter) {\r\n\t\t\t\t\t\tdsDetail.filter = filter;\r\n\t\t\t\t\t\tdsDetail.filtered = dsDetail.filtered();\r\n\t\t\t\t\t}\r\n\t\t\t\t\tdetails.push(detail);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(details) {\r\n\t\t\tresult.details = details;\r\n\t\t}\r\n\t\t\r\n\t\treturn result;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Import a dataset snapshot.\r\n\t * \r\n\t * @param {Object} snapshot Dataset snapshot.\r\n\t */\r\n\timportSnapshot: function(snapshot) {\r\n\t\tjslet.Checker.test('Dataset.importSnapshot#snapshot', snapshot).required().isPlanObject();\r\n\t\tvar master = snapshot.master;\r\n\t\tjslet.Checker.test('Dataset.importSnapshot#snapshot.master', master).required().isPlanObject();\r\n\t\tvar Z = this,\r\n\t\t\tdsName = master.name;\r\n\t\tif(dsName != Z._name) {\r\n\t\t\t//Snapshot name: [{0}] does not match the current dataset name: [{1}], cannot import snapshot!\r\n\t\t\tthrow new Error(jslet.formatMessage(jslet.locale.Dataset.cannotImportSnapshot, [dsName, Z._name]));\r\n\t\t}\r\n\t\tZ._dataList = master.dataList;\r\n\t\tZ._changeLog._changedRecords = master.changedRecords;\r\n\t\tif(master.indexFields !== undefined) {\r\n\t\t\tZ.indexFields(master.indexFields);\r\n\t\t}\r\n\t\tif(master.filter !== undefined) {\r\n\t\t\tZ.filter(master.filter);\r\n\t\t\tZ.filtered(master.filtered);\r\n\t\t}\r\n\t\tif(master.recno >= 0) {\r\n\t\t\tZ._silence++;\r\n\t\t\ttry {\r\n\t\t\t\tZ.recno(master.recno);\r\n\t\t\t} finally {\r\n\t\t\t\tZ._silence--;\r\n\t\t\t}\r\n\t\t}\r\n\t\tZ.refreshControl();\r\n\t\tvar details = snapshot.details;\r\n\t\tif(!details || details.length === 0) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar detail, dsDetail;\r\n\t\tfor(var i = 0, len = details.length; i < len; i++) {\r\n\t\t\tdetail = details[i];\r\n\t\t\tdsDetail = jslet.data.getDataset(detail.name);\r\n\t\t\tif(dsDetail) {\r\n\t\t\t\tif(detail.indexFields !== undefined) {\r\n\t\t\t\t\tdsDetail.indexFields(detail.indexFields);\r\n\t\t\t\t}\r\n\t\t\t\tif(detail.filter !== undefined) {\r\n\t\t\t\t\tdsDetail.filter(detail.filter);\r\n\t\t\t\t\tdsDetail.filtered(detail.filtered);\r\n\t\t\t\t}\r\n\t\t\t\tif(detail.recno >= 0) {\r\n\t\t\t\t\tdsDetail._silence++;\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\tdsDetail.recno(detail.recno);\r\n\t\t\t\t\t} finally {\r\n\t\t\t\t\t\tdsDetail._silence--;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tdsDetail.refreshControl();\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t\r\n\tdestroy: function () {\r\n\t\tvar Z = this;\r\n\t\tZ._masterDataset = null;\r\n\t\tZ._masterField = null;\r\n\t\tZ._fields = null;\r\n\t\tZ._linkedControls = null;\r\n\t\tZ._innerFilter = null;\r\n\t\tZ._innerFindCondition = null;\r\n\t\tZ._sortingFields = null;\r\n\t\tZ._innerFormularFields = null;\r\n\t\tZ._aggradedFields = null;\r\n\t\t\r\n\t\tjslet.data.dataModule.unset(Z._name);\r\n\t\tjslet.data.datasetRelationManager.removeDataset(Z._name);\t\t\r\n\t}\r\n\t\r\n};\r\n// end Dataset\r\n\r\n/**\r\n * Create Enum Dataset. Example:\r\n * <pre><code>\r\n * var dsGender = jslet.data.createEnumDataset('gender', 'F:Female,M:Male');\r\n * dsGender.getFieldValue('code');//return 'F'\r\n * dsGender.getFieldValue('name');//return 'Female'\r\n * dsGender.next();\r\n * dsGender.getFieldValue('code');//return 'M'\r\n * dsGender.getFieldValue('name');//return 'Male'\r\n * </code></pre>\r\n * \r\n * @param {String} dsName dataset name;  \r\n * @param {String or Object} enumStrOrObject a string or an object which stores enumeration data; if it's a string, the format must be:<code>:<name>,<code>:<name>\r\n * @return {jslet.data.Dataset}\r\n */\r\njslet.data.createEnumDataset = function(dsName, enumStrOrObj) {\r\n\tjslet.Checker.test('createEnumDataset#enumStrOrObj', enumStrOrObj).required();\r\n\t\t\r\n\tvar dsObj = new jslet.data.Dataset(dsName);\r\n\tvar fldObj = jslet.data.createStringField('code', 10);\r\n\tfldObj.label(jslet.locale.EnumDataset.code);\r\n\tdsObj.addField(fldObj);\r\n\tvar fldObj = jslet.data.createStringField('name', 20);\r\n\tfldObj.label(jslet.locale.EnumDataset.name);\r\n\tdsObj.addField(fldObj);\r\n\r\n\tdsObj.keyField('code');\r\n\tdsObj.codeField('code');\r\n\tdsObj.nameField('name');\r\n\r\n\tvar dataList = [];\r\n\tif(jslet.isString(enumStrOrObj)) {\r\n\t\tvar enumStr = jQuery.trim(enumStrOrObj);\r\n\t\tvar recs = enumStr.split(','), recstr, rec;\r\n\t\tfor (var i = 0, cnt = recs.length; i < cnt; i++) {\r\n\t\t\trecstr = jQuery.trim(recs[i]);\r\n\t\t\trec = recstr.split(':');\r\n\t\r\n\t\t\tdataList[dataList.length] = {\r\n\t\t\t\t'code' : jQuery.trim(rec[0]),\r\n\t\t\t\t'name' : jQuery.trim(rec[1])\r\n\t\t\t};\r\n\t\t}\r\n\t} else {\r\n\t\tfor(var key in enumStrOrObj) {\r\n\t\t\tdataList[dataList.length] = {code: key, name: enumStrOrObj[key]};\r\n\t\t}\r\n\t}\r\n\tdsObj.dataList(dataList);\r\n\tdsObj.indexFields('code');\r\n\treturn dsObj;\r\n};\r\n\r\n/**\r\n * Create dataset with field configurations. Example:\r\n * <pre><code>\r\n *   var fldCfg = [{\r\n *     name: 'deptid',\r\n *     type: 'S',\r\n *     length: 10,\r\n *     label: 'ID'\r\n *   }, {\r\n *     name: 'name',\r\n *     type: 'S',\r\n *     length: 20,\r\n *     label: 'Dept. Name'\r\n *   }];\r\n *   var dsCfg = {keyField: 'deptid', codeField: 'deptid', nameField: 'name'};\r\n *   var dsDepartment = jslet.data.createDataset('department', fldCfg, dsCfg);\r\n * </code></pre>\r\n * \r\n * @param {String} dsName - dataset name\r\n * @param {jslet.data.Field[]} field configuration\r\n * @param {Object} dsCfg - dataset configuration\r\n * @return {jslet.data.Dataset}\r\n */\r\njslet.data.createDataset = function(dsName, fieldConfig, dsCfg) {\r\n\tjslet.Checker.test('createDataset#fieldConfig', fieldConfig).required().isArray();\r\n\tjslet.Checker.test('Dataset.createDataset#datasetCfg', dsCfg).isPlanObject();\r\n\tvar dsObj = new jslet.data.Dataset(dsName),\r\n\t\tfldObj, fldCfg, \r\n\t\tarrFldObj = [];\r\n\tfor (var i = 0, cnt = fieldConfig.length; i < cnt; i++) {\r\n\t\tfldCfg = fieldConfig[i];\r\n\t\tjslet.Checker.test('Dataset.createDataset#fieldCfg', fldCfg).isPlanObject();\r\n\t\t\r\n\t\tfldCfg.datasetName = dsName;\r\n\t\tfldObj = jslet.data.createField(fldCfg);\r\n\t\tarrFldObj.push(fldObj);\r\n\t}\r\n\tdsObj.addFields(arrFldObj);\r\n\t\r\n\tfunction setPropValue(propName) {\r\n\t\tvar propValue = dsCfg[propName];\r\n\t\tif(propValue === undefined) {\r\n\t\t\tpropValue = dsCfg[propName.toLowerCase()];\r\n\t\t}\r\n\t\tif (propValue !== undefined) {\r\n\t\t\tdsObj[propName](propValue);\r\n\t\t}\r\n\t}\r\n\t\r\n\tfunction setIntPropValue(propName) {\r\n\t\tvar propValue = dsCfg[propName];\r\n\t\tif(propValue === undefined) {\r\n\t\t\tpropValue = dsCfg[propName.toLowerCase()];\r\n\t\t}\r\n\t\tif (propValue !== undefined) {\r\n\t\t\tdsObj[propName](parseInt(propValue));\r\n\t\t}\r\n\t}\r\n\t\r\n\tfunction setBooleanPropValue(propName) {\r\n\t\tvar propValue = dsCfg[propName];\r\n\t\tif(propValue === undefined) {\r\n\t\t\tpropValue = dsCfg[propName.toLowerCase()];\r\n\t\t}\r\n\t\tif (propValue !== undefined) {\r\n\t\t\tif(jslet.isString(propValue)) {\r\n\t\t\t\tif(propValue) {\r\n\t\t\t\t\tpropValue = propValue != '0' && propValue != 'false';\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tdsObj[propName](propValue? true: false);\r\n\t\t}\r\n\t}\r\n\t\r\n\tif(dsCfg) {\r\n\t\tsetPropValue('keyField');\r\n\t\tsetPropValue('codeField');\r\n\t\tsetPropValue('nameField');\r\n\t\tsetPropValue('parentField');\r\n\t\tsetPropValue('levelOrderField');\r\n\t\tsetPropValue('selectField');\r\n\t\tsetPropValue('recordClass');\r\n\t\tsetPropValue('description');\r\n\t\t\r\n\t\tsetPropValue('queryUrl');\r\n\t\tsetPropValue('submitUrl');\r\n\t\tsetIntPropValue('pageNo');\r\n\t\tsetIntPropValue('pageSize');\r\n\t\tsetPropValue('fixedIndexFields');\r\n\t\tsetPropValue('indexFields');\r\n\t\tsetPropValue('fixedFilter');\r\n\t\tsetPropValue('filter');\r\n\t\tsetBooleanPropValue('filtered');\r\n\t\tsetBooleanPropValue('autoShowError');\r\n\t\tsetBooleanPropValue('autoRefreshHostDataset');\r\n\t\tsetBooleanPropValue('readOnly');\r\n\t\tsetBooleanPropValue('logChanges');\r\n\t\tsetBooleanPropValue('auditLogEnabled');\r\n\t\tsetBooleanPropValue('isFireGlobalEvent');\r\n\t\t\r\n\t\tsetPropValue('datasetListener');\r\n\t\tsetPropValue('onFieldChange');\r\n\t\tsetPropValue('onFieldChanged');\r\n\t\tsetPropValue('onFieldChanging');\r\n\t\tsetPropValue('onCheckSelectable');\r\n\t\tsetPropValue('contextRules');\r\n\t}\r\n\tif(dsObj.isFireGlobalEvent()) {\r\n\t\tvar globalHandler = jslet.data.globalDataHandler.datasetCreated();\r\n\t\tif(globalHandler) {\r\n\t\t\tglobalHandler(dsObj);\r\n\t\t}\r\n\t}\r\n\treturn dsObj;\r\n};\r\n\r\n//\r\n//jslet.data.createCrossDataset = function(sourceDataset, labelField, valueField, crossDsName) {\r\n//\tif(!crossDsName) { \r\n//\t\tcrossDsName = sourceDataset.name()+'_cross'; \r\n//\t} \r\n//\tjslet.Checker.test('createCrossDataset#labelField', labelField).required().isString();\r\n//\tjslet.Checker.test('createCrossDataset#valueField', valueField).required().isString();\r\n//\r\n//\tif(jslet.isString(sourceDataset)) {\r\n//\t\tsourceDataset = jslet.data.getDataset(sourceDataset);\r\n//\t}\r\n//\tjslet.Checker.test('createCrossDataset#sourceDataset', sourceDataset).required().isClass(jslet.data.Dataset.className);\r\n//\t\r\n//\tvar lblFldObj = sourceDataset.getField(labelField);\r\n//\tif(!lblFldObj) {\r\n//\t\tthrow new Error('Not found field: ' + labelField);\r\n//\t}\r\n//\tvar lblLkFld = lblFldObj.lookup(); \r\n//\tif(!lblLkFld) { \r\n//\t\tthrow new Error(sourceDataset.name() + '.' + labelField + ' must have lookup dataset!'); \r\n//\t} \r\n//\tvar valueFldObj = sourceDataset.getField(valueField); \r\n//\tif(!valeFldObj) {\r\n//\t\tthrow new Error('Not found field: ' + valeFldObj);\r\n//\t}\r\n//\tif(valeFldObj.getType() != jslet.data.DataType.NUMBER) {\r\n//\t\thasTotalField = false;\r\n//\t}\r\n//\t\r\n//\tvar labelFldNames = labelField.split(',');\r\n//\t\t\r\n//\t{name: '', horiFields:[{field:'', subTotal: false, showAll:false}, \r\n//\t           vertFields:[{field:'', subTotal: false, showAll:false}], \r\n//\t           cellFields:'',\r\n//\t           totalPosition: 'before/after',\r\n//\t           indent: true}\r\n//\t\r\n//\t\r\n//}\r\n\r\njslet.data.ChangeLog = function(dataset) {\r\n\tthis._dataset = dataset;\r\n\tthis._changedRecords = null;\r\n};\r\n\r\njslet.data.ChangeLog.prototype = {\r\n\tchangedRecords: function(changedRecords) {\r\n\t\tif(changedRecords === undefined) {\r\n\t\t\treturn this._changedRecords;\r\n\t\t}\r\n\t\tthis._changedRecords = changedRecords;\r\n\t},\r\n\t\r\n\tlog: function(recObj) {\r\n\t\tif(!this._dataset.logChanges()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif(!recObj) {\r\n\t\t\trecObj = this._dataset.getRecord();\r\n\t\t}\r\n\t\tvar recInfo = jslet.data.getRecInfo(recObj);\r\n\t\tif(!recInfo.status) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar chgRecords = this._getChangedRecords();\r\n\t\tif(chgRecords.indexOf(recObj) < 0) {\r\n\t\t\tchgRecords.push(recObj);\r\n\t\t}\r\n\t},\r\n\t\r\n\tunlog: function(recObj) {\r\n\t\tif(!this._dataset.logChanges()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif(!recObj) {\r\n\t\t\trecObj = this._dataset.getRecord();\r\n\t\t}\r\n\t\tvar chgRecords = this._getChangedRecords(recObj);\r\n\t\tvar k = chgRecords.indexOf(recObj);\r\n\t\tif(k >= 0) {\r\n\t\t\tchgRecords.splice(k, 1);\r\n\t\t}\r\n\t},\r\n\t\r\n\tclear: function() {\r\n\t\tthis._changedRecords = null;\r\n\t},\r\n\t\r\n\t_getChangedRecords: function() {\r\n\t\tvar dsObj = this._dataset;\r\n\t\tvar masterFldObj = dsObj.getMasterFieldObject(),\r\n\t\t  \tchgRecords;\r\n\t\tif(masterFldObj) {\r\n\t\t\tvar masterFldName = masterFldObj.name(),\r\n\t\t\t\tmasterDsObj = masterFldObj.dataset(),\r\n\t\t\t\tmasterRecInfo = jslet.data.getRecInfo(masterDsObj.getRecord());\r\n\t\t\tif(!masterRecInfo.detailLog) {\r\n\t\t\t\tmasterRecInfo.detailLog = {};\r\n\t\t\t}\r\n\t\t\tchgRecords = masterRecInfo.detailLog[masterFldName];\r\n\t\t\tif(!chgRecords) {\r\n\t\t\t\tchgRecords = [];\r\n\t\t\t\tmasterRecInfo.detailLog[masterFldName] = chgRecords;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif(!this._changedRecords) {\r\n\t\t\t\tthis._changedRecords = [];\r\n\t\t\t}\r\n\t\t\tchgRecords = this._changedRecords;\r\n\t\t}\r\n\t\treturn chgRecords;\r\n\t}\r\n\t\r\n};\r\n\r\njslet.data.DataTransformer = function(dataset) {\r\n\tthis._dataset = dataset;\r\n};\r\n\r\njslet.data.DataTransformer.prototype = {\r\n\t\t\r\n\thasChangedData: function() {\r\n\t\tvar chgRecList = this._dataset._changeLog._changedRecords;\r\n\t\tif(!chgRecList || chgRecList.length === 0) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\treturn true;\r\n\t},\r\n\t\r\n\tgetSubmittingChanged: function() {\r\n\t\tvar chgRecList = this._dataset._changeLog._changedRecords;\r\n\t\tif(!chgRecList || chgRecList.length === 0) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\tvar result = this._convert(this._dataset, chgRecList);\r\n\t\treturn result;\r\n\t},\r\n\t\r\n\tgetSubmittingSelected: function() {\r\n\t\tvar chgRecList = this._dataset.selectedRecords();\r\n\t\tif(!chgRecList || chgRecList.length === 0) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\tvar result = this._convert(this._dataset, chgRecList, true);\r\n\t\treturn result;\r\n\t},\r\n\t\r\n\t_convert: function(dsObj, chgRecList, submitAllSubData) {\r\n\t\tif(!chgRecList || chgRecList.length === 0) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\tvar chgRec, recInfo, status, newRec,\r\n\t\t\trecClazz = dsObj._recordClass || jslet.global.defaultRecordClass,\r\n\t\t\tresult = [],\r\n\t\t\tdetailLog;\r\n\t\tfor(var i = 0, len = chgRecList.length; i < len; i++) {\r\n\t\t\tchgRec = chgRecList[i];\r\n\t\t\trecInfo = jslet.data.getRecInfo(chgRec);\r\n\t\t\tnewRec = {};\r\n\t\t\tif(recClazz) {\r\n\t\t\t\tnewRec[\"@type\"] = recClazz;\r\n\t\t\t}\r\n\t\t\tdetailLog = recInfo.detailLog;\r\n\t\t\tchgRec[jslet.global.changeStateField] = this._getStatusPrefix(recInfo.status) + i;\r\n\t\t\tvar fldObj, subList;\r\n\t\t\tfor(var fldName in chgRec) {\r\n\t\t\t\tif(fldName === '_jl_') {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\tfldObj = dsObj.getField(fldName);\r\n\t\t\t\tif(fldObj && fldObj.getType() === jslet.data.DataType.DATASET) {\r\n\t\t\t\t\tvar dsDetail = fldObj.detailDataset();\r\n\t\t\t\t\tif(submitAllSubData === undefined) {\r\n\t\t\t\t\t\tsubmitAllSubData = !dsDetail._onlyChangedSubmitted;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tvar allList = chgRec[fldName];\r\n\t\t\t\t\tif(!submitAllSubData) { //add deleted record\r\n\t\t\t\t\t\tvar subChgList = detailLog? detailLog[fldName]: null;\r\n\t\t\t\t\t\tif(subChgList) {\r\n\t\t\t\t\t\t\tvar subChgRec, subRecInfo;\r\n\t\t\t\t\t\t\tfor(var k = 0, chgLen = subChgList.length; k < chgLen; k++) {\r\n\t\t\t\t\t\t\t\tsubChgRec = subChgList[k];\r\n\t\t\t\t\t\t\t\tsubRecInfo = jslet.data.getRecInfo(subChgRec);\r\n\t\t\t\t\t\t\t\tif(subRecInfo && subRecInfo.status === jslet.data.DataSetStatus.DELETE) {\r\n\t\t\t\t\t\t\t\t\tallList.push(subChgRec);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tsubList = this._convert(dsDetail, allList);\r\n\t\t\t\t\tif(subList) {\r\n\t\t\t\t\t\tnewRec[fldName] = subList;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tnewRec[fldName] = chgRec[fldName];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tresult.push(newRec);\r\n\t\t}\r\n\t\treturn result;\r\n\t},\r\n\t\r\n\t_getStatusPrefix: function(status) {\r\n\t\treturn  status === jslet.data.DataSetStatus.INSERT ? 'i' : \r\n\t\t\t(status === jslet.data.DataSetStatus.UPDATE? 'u':\r\n\t\t\t status === jslet.data.DataSetStatus.DELETE? 'd':'s');\r\n\t},\r\n\t\t\t\r\n\trefreshSubmittedData: function(submittedData) {\r\n\t\tif(!submittedData || submittedData.length === 0) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis._refreshDataset(this._dataset, submittedData);\r\n\t},\r\n\t\r\n\t_refreshDataset: function(dsObj, submittedData, isDetailDataset) {\r\n\t\tif(!submittedData || submittedData.length === 0) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar masterFldObj = dsObj.getMasterFieldObject(), chgLogs;\r\n\t\tif(!masterFldObj) {\r\n\t\t\tchgLogs = dsObj._changeLog._changedRecords;\r\n\t\t} else {\r\n\t\t\tvar masterRec = masterFldObj.dataset().getRecord();\r\n\t\t\tvar masterRecInfo = jslet.data.getRecInfo(masterRec);\r\n\t\t\tchgLogs = masterRecInfo.detailLog? masterRecInfo.detailLog[masterFldObj.name()]: null;\r\n\t\t}\r\n\r\n\t\tvar newRec, oldRec, flag;\r\n\t\tfor(var i = 0, len = submittedData.length; i < len; i++) {\r\n\t\t\tnewRec = submittedData[i];\r\n\t\t\tif(!newRec) {\r\n\t\t\t\t//'The return record exists null. Please check it.'\r\n\t\t\t\tconsole.warn(jslet.locale.Dataset.serverReturnNullRecord);\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tthis._refreshRecord(dsObj, newRec, chgLogs);\r\n\t\t}\r\n\t},\r\n\t\t\r\n\t_refreshRecord: function(dsObj, newRec, chgLogs) {\r\n\t\tvar recState = newRec[jslet.global.changeStateField];\r\n\t\tif(!recState) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar i, len;\r\n\t\tif(chgLogs && recState.charAt(0) == 'd') {\r\n\t\t\tfor(i = 0, len = chgLogs.length; i < len; i++) {\r\n\t\t\t\tif(recState == chgLogs[i][jslet.global.changeStateField]) {\r\n\t\t\t\t\tchgLogs.splice(i, 1);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar oldRec, fldObj,\r\n\t\t\trecords = dsObj.dataList() || [];\r\n\t\tfor(i = records.length - 1; i >= 0; i--) {\r\n\t\t\toldRec = records[i];\r\n\t\t\tif(oldRec[jslet.global.changeStateField] != recState) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tfor(var fldName in newRec) {\r\n\t\t\t\tif(!fldName) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\tfldObj = dsObj.getField(fldName);\r\n\t\t\t\tif(fldObj && fldObj.detailDataset()) {\r\n\t\t\t\t\tthis._refreshDataset(fldObj.detailDataset(), newRec[fldName], true);\r\n\t\t\t\t} else {\r\n\t\t\t\t\toldRec[fldName] = newRec[fldName];\r\n\t\t\t\t}\r\n\t\t\t} // end for fldName\r\n\t\t\tif(chgLogs) {\r\n\t\t\t\tfor(i = 0, len = chgLogs.length; i < len; i++) {\r\n\t\t\t\t\tif(recState == chgLogs[i][jslet.global.changeStateField]) {\r\n\t\t\t\t\t\tchgLogs.splice(i, 1);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\toldRec[jslet.global.changeStateField] = null;\r\n\t\t\tvar auditLog = oldRec[jslet.global.auditLogField];\r\n\t\t\tif(auditLog) {\r\n\t\t\t\tdelete oldRec[jslet.global.auditLogField];\r\n\t\t\t}\r\n\t\t\tvar recInfo = jslet.data.getRecInfo(oldRec);\r\n\t\t\tif(recInfo && recInfo.status) {\r\n\t\t\t\trecInfo.status = 0;\r\n\t\t\t}\r\n\t\t\tjslet.data.FieldValueCache.removeCache(oldRec);\r\n\t\t} // end for i\r\n\t}\r\n\t\r\n};\n/*!\r\n * Jslet Javascript Framework v4.0.0\r\n * https://github.com/jslet/jslet/\r\n *\r\n * Copyright 2016 Jslet Team and other contributors\r\n * Released under the MIT license\r\n */\r\n\r\n\"use strict\";\r\njslet.Expression = function(dataset, expr) {\r\n\tjslet.Checker.test('jslet.Expression#dataset', dataset).required();\r\n\tjslet.Checker.test('jslet.Expression#expr', expr).required().isString();\r\n\tthis._fields = [];\r\n\tthis._otherDatasetFields = [];\r\n\tthis._expr = expr;\r\n\tthis._parsedExpr = '';\r\n\tif (typeof dataset == 'string') {\r\n\t\tthis._dataset = jslet.data.getDataset(dataset);\r\n\t\tif (!this._dataset) {\r\n\t\t\tthrow new Error(jslet.formatMessage(jslet.locale.Dataset.datasetNotFound, [dataset]));\r\n\t\t}\r\n\t}else{\r\n\t\tjslet.Checker.test('jslet.Expression#dataset', dataset).isClass(jslet.data.Dataset.className);\r\n\t\tthis._dataset = dataset;\r\n\t}\r\n\t\r\n\tthis.context = {mainds: dataset};\r\n\tthis.parse();\r\n};\r\n\r\njslet.Expression.prototype = {\r\n\t_ParserPattern: /\\[[_a-zA-Z][\\.!\\w]*(,\\d){0,1}]/gim,\r\n\t\r\n\tparse: function() {\r\n\t\t\r\n\t\tvar start = 0, end, k, \r\n\t\t\tdsName, fldName, \r\n\t\t\totherDs, stag, dsObj,\r\n\t\t\ttmpExpr = [], \r\n\t\t\tvalueIndex = null;\r\n\t\tthis._ParserPattern.lastIndex = 0;\r\n\t\twhile ((stag = this._ParserPattern.exec(this._expr)) !== null) {\r\n\t\t\tfldName = stag[0];\r\n\r\n\t\t\tif (!fldName || fldName.endsWith('(')) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\tdsName = null;\r\n\t\t\tfldName = fldName.substr(1, fldName.length - 2);\r\n\t\t\tk = fldName.indexOf(',');\r\n\t\t\tif(k > 0) {\r\n\t\t\t\tvalueIndex = parseInt(fldName.substr(k + 1));\r\n\t\t\t\tif(isNaN(valueIndex)) {\r\n\t\t\t\t\tvalueIndex = null;\r\n\t\t\t\t}\r\n\t\t\t\tfldName = fldName.substr(0, k);\r\n\t\t\t}\r\n\t\t\tk = fldName.indexOf('!');\r\n\t\t\tif (k > 0) {\r\n\t\t\t\tdsName = fldName.substr(0, k);\r\n\t\t\t\tfldName = fldName.substr(k + 1);\r\n\t\t\t}\r\n\r\n\t\t\tend = stag.index;\r\n\t\t\tdsObj = this._dataset;\r\n\t\t\tif(dsName) {\r\n\t\t\t\totherDs = jslet.data.dataModule.get(dsName);\r\n\t\t\t\tif (!otherDs) {\r\n\t\t\t\t\tthrow new Error(jslet.formatMessage(jslet.locale.Dataset.datasetNotFound, [dsName]));\r\n\t\t\t\t}\r\n\t\t\t\tthis.context[dsName] = otherDs;\r\n\t\t\t\tdsObj = otherDs;\r\n\t\t\t}\r\n\r\n\t\t\tif (!dsName) {\r\n\t\t\t\ttmpExpr.push(this._expr.substring(start, end));\r\n\t\t\t\ttmpExpr.push('context.mainds.getFieldValueByRecord(context.dataRec, \"');\r\n\t\t\t\tthis._fields.push(fldName);\r\n\t\t\t} else {\r\n\t\t\t\ttmpExpr.push(this._expr.substring(start, end));\r\n\t\t\t\ttmpExpr.push('context.');\r\n\t\t\t\ttmpExpr.push(dsName);\r\n\t\t\t\ttmpExpr.push('.getFieldValue(\"');\r\n\t\t\t\tthis._otherDatasetFields.push({\r\n\t\t\t\t\t\t\tdataset : dsName,\r\n\t\t\t\t\t\t\tfieldName : fldName\r\n\t\t\t\t\t\t});\r\n\t\t\t}\r\n\t\t\ttmpExpr.push(fldName);\r\n\t\t\ttmpExpr.push('\"');\r\n\t\t\tif(valueIndex !== null) {\r\n\t\t\t\ttmpExpr.push(',');\r\n\t\t\t\ttmpExpr.push(valueIndex);\r\n\t\t\t}\r\n\t\t\ttmpExpr.push(')');\r\n\t\t\t\r\n\t\t\tstart = end + stag[0].length;\r\n\t\t}//end while\r\n\t\ttmpExpr.push(this._expr.substr(start));\r\n\t\tthis._parsedExpr = tmpExpr.join('');\r\n\t}, //end function\r\n\r\n\t/**\r\n\t * Get fields included in the expression.\r\n\t * \r\n\t * @return {Array of String}\r\n\t */\r\n\tmainFields: function() {\r\n\t\treturn this._fields;\r\n\t},\r\n\r\n\t/**\r\n\t * Get fields of other dataset included in the expression.\r\n\t * Other dataset fields are identified with 'datasetName!fieldName', like: department!deptName\r\n\t * \r\n\t * @return {Array of Object} the return value like:[{dataset : 'dsName', fieldName: 'fldName'}]\r\n\t */\r\n\totherDatasetFields: function() {\r\n\t\treturn this._otherDatasetFields;\r\n\t},\r\n\r\n\t/**\r\n\t * Evaluate the expression.\r\n\t * \r\n\t * @param {Object} dataRec Data record object, this argument is used in parsedExpr \r\n\t * @return {Object} The value of Expression.\r\n\t */\r\n\teval: function(dataRec) {\r\n\t\tvar context = this.context;\r\n\t\tcontext.mainds = this._dataset;\r\n\t\tcontext.dataRec = dataRec;\r\n\t\t//Customized functions for expression evaluation\r\n\t\tvar like = jslet.like;\r\n\t\tvar between = jslet.between;\r\n\t\tvar inlist = jslet.inlist;\r\n\t\tvar inchildren = function(fldName, parentValue, onlyDirectChild) {\r\n\t\t\treturn context.mainds.inChildren(fldName, parentValue, onlyDirectChild);\r\n\t\t};\r\n\t\tvar inChildren = inchildren;\r\n\t\tvar inchildrenandself = function(fldName, parentValue, onlyDirectChild) {\r\n\t\t\treturn context.mainds.inChildrenAndSelf(fldName, parentValue, onlyDirectChild);\r\n\t\t};\r\n\t\tvar inChildrenAndSelf = inchildrenandself;\r\n\t\t/* jshint ignore:start */\r\n\t\treturn eval(this._parsedExpr); //Don't use window.eval\r\n\t\t/* jshint ignore:end */\r\n\r\n\t},\r\n\t\r\n\tdestroy: function() {\r\n\t\tthis._dataset = null;\r\n\t\tthis._fields = null;\r\n\t\tthis._otherDatasetFields = [];\r\n\t\tthis._parsedExpr = null;\r\n\t\tthis._expr = null;\r\n\t\tthis.context = null;\r\n\t}\r\n\t\r\n};\r\n\r\n\n/*!\r\n * Jslet Javascript Framework v4.0.0\r\n * https://github.com/jslet/jslet/\r\n *\r\n * Copyright 2016 Jslet Team and other contributors\r\n * Released under the MIT license\r\n */\r\n \r\n/**\r\n * @class Field \r\n * \r\n * @param {String} fieldName Field name\r\n * @param {jslet.data.DataType} dataType Data type of field\r\n */\r\n\"use strict\";\r\njslet.data.Field = function (fieldName, dataType) {\r\n\tjslet.Checker.test('Field#fieldName', fieldName).isString();\r\n\tfieldName = jQuery.trim(fieldName);\r\n\tjslet.Checker.test('Field#fieldName', fieldName).required();\r\n\tjslet.Checker.test('Field#dataType', dataType).isString().required();\r\n\r\n\tvar Z = this;\r\n\t\r\n\tZ._dataset = null;\r\n\tZ._datasetName = null;\r\n\tZ._displayOrder = 0;\r\n\tZ._tabIndex = null;\r\n\tZ._fieldName = fieldName;\r\n\tZ._shortName = null;\r\n\tZ._dataType = dataType;\r\n\t\r\n\tZ._proxyHostFieldName = null;\r\n\t\r\n\tZ._proxyFldObjs = null;\r\n\tZ._proxyFieldChanged = null;\r\n\tZ._currProxyFieldName = null;\r\n\t\r\n\tZ._length = 0;\r\n\tZ._scale = 0;\r\n\tZ._unique = false;\r\n\t\r\n\tZ._defaultExpr = null;\r\n\tZ._defaultValue = null;\r\n\tZ._label = null;\r\n\tZ._displayLabel = null;\r\n\tZ._tip = null;\r\n\tZ._message = null;\r\n\tZ._displayWidth = 0;\r\n\tZ._editMask = null;\r\n\tZ._displayFormat = null;\r\n\tZ._dateFormat = null;\r\n\tZ._formula = null;\r\n\tZ._readOnly = false;\r\n\tZ._visible = true;\r\n\tZ._disabled = false;\r\n\tZ._unitConverted = false;\r\n\r\n\tZ._lookup = null;\r\n\t\r\n\tZ._displayControl = null;\r\n\tZ._editControl = null;\r\n\tZ._detailDataset = null;\r\n\tZ._urlExpr = null;\r\n\tZ._innerUrlExpr = null;\r\n\tZ._urlTarget = null;\r\n\tZ._valueStyle = jslet.data.FieldValueStyle.NORMAL; //0 - Normal, 1 - Between style value, 2 - Multiple value\r\n\tZ._valueCountLimit = 0;\r\n\tZ._required = false;\r\n\tZ._nullText = jslet.locale.Dataset.nullText;\r\n\tZ._dataRange= null;\r\n\tZ._regularExpr = null;\r\n\tZ._antiXss = true;\r\n\t\r\n\tZ._customValueAccessor = null;\r\n\tZ._customValueConverter = null;\r\n\tZ._customValidator = null;\r\n\tZ._validChars = null; //Array of characters\r\n\tZ._dateChar = null;\r\n\tZ._dateRegular = null;\r\n\tZ._parent = null; //parent field object\r\n\tZ._children = null; //child field object\r\n\tZ._trueValue = true;\r\n\tZ._falseValue = false;\r\n\tZ._trueText = null;\r\n\tZ._falseText = null;\r\n\tZ._mergeSame = false;\r\n\tZ._mergeSameBy = null;\r\n\tZ._fixedValue = null;\r\n\tZ._valueFollow = false;\r\n\tZ._focused = false;\r\n\tZ._aggraded = false; //optional value: sum, count, avg\r\n\tZ._aggradedBy = null;\r\n\t\r\n\tZ._crossSource = null;\r\n};\r\n\r\njslet.data.Field.className = 'jslet.data.Field';\r\n\r\njslet.data.Field.prototype = {\r\n\tclassName: jslet.data.Field.className,\r\n\t\r\n\t/**\r\n\t * {jslet.data.Dataset}\r\n\t */\r\n\tdataset: function (dataset) {\r\n\t\tvar Z = this;\r\n\t\tif (dataset === undefined) {\r\n\t\t\tif(Z._parent) {\r\n\t\t\t\treturn Z._parent.dataset();\r\n\t\t\t}\r\n\t\t\treturn Z._dataset;\r\n\t\t}\r\n\t\t\r\n\t\tif(jslet.isString(dataset)) {\r\n\t\t\tdataset = jslet.data.getDataset(dataset); \r\n\t\t} else {\r\n\t\t\tjslet.Checker.test('Field.dataset', dataset).isClass(jslet.data.Dataset.className);\r\n\t\t}\r\n\t\tif(dataset) {\r\n\t\t\tZ._datasetName = dataset.name();\r\n\t\t}\r\n\t\tZ._removeRelation();\r\n\t\tZ._dataset = dataset;\r\n\t\tZ._clearFieldCache();\r\n\t\tZ._addRelation();\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Get or set field name\r\n\t * \r\n\t * @param {String or undefined} fldName Field name.\r\n\t * @return {String}\r\n\t */\r\n\tname: function () {\r\n\t\tif(arguments.length >0) {\r\n\t\t\tconsole.error(\"Can't change field name!\");\r\n\t\t}\r\n\t\treturn this._fieldName;\r\n\t},\r\n\r\n\tshortName: function(shortName) {\r\n\t\tvar Z = this;\r\n\t\tif (shortName === undefined) {\r\n\t\t\treturn Z._shortName;\r\n\t\t}\r\n\t\tjslet.Checker.test('Field.shortName', shortName).isString();\r\n\t\tZ._shortName = shortName;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Get or set field label, field label can be used to display, configure, export, import data .\r\n\t * \r\n\t * @param {String or undefined} label Field label.\r\n\t * @return {String or this}\r\n\t */\r\n\tlabel: function (label) {\r\n\t\tvar Z = this;\r\n\t\tif (label === undefined) {\r\n\t\t\treturn Z._label || Z._fieldName;\r\n\t\t}\r\n\t\tjslet.Checker.test('Field.label', label).isString();\r\n\t\tZ._label = label;\r\n\t\tZ._fireMetaChangedEvent('label');\r\n\t\tZ._fireGlobalMetaChangedEvent('label');\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * Get or set field display label, display label is only used to display data.\r\n\t * In some scenarios, display label can be different from field label.\r\n\t * \r\n\t * @param {String or undefined} label Field label.\r\n\t * @return {String or this}\r\n\t */\r\n\tdisplayLabel: function (displayLabel) {\r\n\t\tvar Z = this;\r\n\t\tif (displayLabel === undefined) {\r\n\t\t\treturn Z._displayLabel || Z.label();\r\n\t\t}\r\n\t\tjslet.Checker.test('Field.displayLabel', displayLabel).isString();\r\n\t\tZ._displayLabel = displayLabel;\r\n\t\tZ._fireMetaChangedEvent('label');\r\n\t\tZ._fireGlobalMetaChangedEvent('label');\r\n\t\treturn this;\r\n\t},\r\n\r\n\tfullLabel: function(separator) {\r\n\t\tif(!this.parent()) {\r\n\t\t\treturn this.label();\r\n\t\t}\r\n\t\tif(separator === undefined) {\r\n\t\t\tseparator = '_';\r\n\t\t}\r\n\t\tvar labels = [this.label()];\r\n\t\tvar pFldObj = this.parent();\r\n\t\twhile(pFldObj) {\r\n\t\t\tlabels.push(pFldObj.label());\r\n\t\t\tpFldObj = pFldObj.parent();\r\n\t\t}\r\n\t\treturn labels.reverse().join(separator);\r\n\t},\r\n\t\r\n\t/**\r\n\t * Get or set field tip.\r\n\t * \r\n\t * @param {String or undefined} tip Field tip.\r\n\t * @return {String or this}\r\n\t */\r\n\ttip: function(tip) {\r\n\t\tvar Z = this;\r\n\t\tif (tip === undefined) {\r\n\t\t\treturn Z._tip;\r\n\t\t}\r\n\t\tjslet.Checker.test('Field.tip', tip).isString();\r\n\t\tZ._tip = tip;\r\n\t\tZ._fireMetaChangedEvent('tip');\r\n\t\tZ._fireGlobalMetaChangedEvent('tip');\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Get field data type.\r\n\t * \r\n\t * @param {jslet.data.DataType}\r\n\t */\r\n\tgetType: function () {\r\n\t\tif(this._dataType == jslet.data.DataType.PROXY) {\r\n\t\t\tvar result = this._getProxyPropValue('dataType') || jslet.data.DataType.STRING;\r\n\t\t\tif(result === jslet.data.DataType.Dataset) {\r\n\t\t\t\treturn this._dataType;\r\n\t\t\t} else {\r\n\t\t\t\treturn result;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this._dataType;\r\n\t},\r\n\r\n\t/**\r\n\t * Get or set field's data type.\r\n\t * \r\n\t * @param {String or undefined} dataType - field's data type.\r\n\t * @return {String or this}\r\n\t */\r\n\tdataType: function(dataType) {\r\n\t\tif(dataType === undefined) {\r\n\t\t\treturn this._dataType;\r\n\t\t}\r\n\t\tjslet.Checker.test('Field#dataType', dataType).isString().required();\r\n\t\tvar dtype = dataType;\r\n\t\tif (dtype === null) {\r\n\t\t\tdtype = jslet.data.DataType.STRING;\r\n\t\t} else {\r\n\t\t\tdtype = dtype.toUpperCase();\r\n\t\t\tif (dtype != jslet.data.DataType.STRING && \r\n\t\t\t\t\tdtype != jslet.data.DataType.NUMBER && \r\n\t\t\t\t\tdtype != jslet.data.DataType.DATE && \r\n\t\t\t\t\tdtype != jslet.data.DataType.BOOLEAN && \r\n\t\t\t\t\tdtype != jslet.data.DataType.CROSS && \r\n\t\t\t\t\tdtype != jslet.data.DataType.PROXY && \r\n\t\t\t\t\tdtype != jslet.data.DataType.DATASET)\r\n\t\t\tdtype = jslet.data.DataType.STRING;\r\n\t\t}\r\n\t\tthis._dataType = dtype;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\tproxyHostFieldName: function(proxyHostFieldName) {\r\n\t\tvar Z = this;\r\n\t\tif(proxyHostFieldName === undefined) {\r\n\t\t\treturn Z._proxyHostFieldName;\r\n\t\t}\r\n\t\tZ._proxyHostFieldName = proxyHostFieldName;\r\n\t},\r\n\t\r\n\tproxyFieldChanged: function(proxyFieldChanged) {\r\n\t\tvar Z = this;\r\n\t\tif (proxyFieldChanged === undefined) {\r\n\t\t\treturn Z._proxyFieldChanged;\r\n\t\t}\r\n\t\tjslet.Checker.test('Field.proxyFieldChanged', proxyFieldChanged).required().isFunction();\r\n\t\tZ._proxyFieldChanged = proxyFieldChanged;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\tchangeProxyFieldName: function(dataRecord, isSilence) {\r\n\t\tvar Z = this,\r\n\t\t\tfldObj, proxyHostFldName, proxyFldName;\r\n\t\t\r\n\t\tproxyFldName = dataRecord[Z._proxyHostFieldName];\r\n\t\tif(!proxyFldName || Z._currProxyFieldName == proxyFldName) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif(!Z._proxyFldObjs) {\r\n\t\t\tZ._proxyFldObjs = {};\r\n\t\t}\r\n\t\tvar oldProxyFldObj = Z._proxyFldObjs[Z._currProxyFieldName],\r\n\t\t\tnewProxyFldObj = Z._proxyFldObjs[proxyFldName];\r\n\t\t\r\n\t\tif(!newProxyFldObj) {\r\n\t\t\tnewProxyFldObj = new jslet.data.Field(proxyFldName, 'S');\r\n\t\t\tZ._proxyFieldChanged.call(Z._dataset, dataRecord, proxyFldName, newProxyFldObj);\r\n\t\t\tZ._proxyFldObjs[proxyFldName] = newProxyFldObj;\r\n\t\t}\r\n\t\tZ._currProxyFieldName = proxyFldName;\r\n\t\tif(!isSilence) {\r\n\t\t\tZ._fireMetaChangedEvent('editControl');\r\n\t\t}\r\n\t},\r\n\t\r\n\t_getProxyPropValue: function(propName) {\r\n\t\tif(!this._proxyFldObjs) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\tvar proxyFldObj = this._proxyFldObjs[this._currProxyFieldName];\r\n\t\tif(proxyFldObj) {\r\n\t\t\treturn proxyFldObj[propName]();\r\n\t\t}\r\n\t\treturn null;\r\n\t},\r\n\t\r\n\t_setProxyPropValue: function(propName, propValue) {\r\n\t\tif(!this._proxyFldObjs) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar proxyFldObj = this._proxyFldObjs[this._currProxyFieldName];\r\n\t\tif(proxyFldObj) {\r\n\t\t\tproxyFldObj[propName](propValue);\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * Get or set parent field object.\r\n\t * \r\n\t * @param {jslet.data.Field or undefined} parent Parent field object.\r\n\t * @return {jslet.data.Field or this}\r\n\t */\r\n\tparent: function (parent) {\r\n\t\tvar Z = this;\r\n\t\tif (parent === undefined) {\r\n\t\t\treturn Z._parent;\r\n\t\t}\r\n\t\tjslet.Checker.test('Field.parent', parent).isClass(this.className);\r\n\t\tZ._parent = parent;\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * Get or set child fields of this field.\r\n\t * \r\n\t * @param {jslet.data.Field[] or undefined} children Child field object.\r\n\t * @return {jslet.data.Field or this}\r\n\t */\r\n\tchildren: function (children) {\r\n\t\tvar Z = this;\r\n\t\tif (children === undefined) {\r\n\t\t\treturn Z._children;\r\n\t\t}\r\n\t\tjslet.Checker.test('Field.children', children).isArray();\r\n\t\tfor(var i = 0, len = children.length; i < len; i++) {\r\n\t\t\tjslet.Checker.test('Field.children#childField', children[i]).isClass(this.className);\r\n\t\t}\r\n\t\tZ._children = children;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Get or set field display order.\r\n\t * Dataset uses this property to resolve field order.\r\n\t * \r\n\t * @param {Integer or undefined} displayOrder Field display order.\r\n\t * @return {Integer or this}\r\n\t */\r\n\tdisplayOrder: function (displayOrder) {\r\n\t\tvar Z = this;\r\n\t\tif (displayOrder === undefined) {\r\n\t\t\treturn Z._displayOrder;\r\n\t\t}\r\n\t\tjslet.Checker.test('Field.displayOrder', displayOrder).isNumber();\r\n\t\tZ._displayOrder = parseInt(displayOrder);\r\n\t\tZ._fireGlobalMetaChangedEvent('displayOrder');\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * Get or set the edit control tab index of this field.\r\n\t * \r\n\t * @param {Integer or undefined} tabIndex the edit control tab index of this field.\r\n\t * @return {Integer or this}\r\n\t */\r\n\ttabIndex: function(tabIndex) {\r\n\t\tvar Z = this;\r\n\t\tif (tabIndex === undefined) {\r\n\t\t\t//If not set tabIndex property, use displayOrder instead.\r\n//\t\t\tif(Z._tabIndex === null || Z._tabIndex === undefined) {\r\n//\t\t\t\treturn Z._displayOrder + 1;\r\n//\t\t\t}\r\n\t\t\treturn Z._tabIndex;\r\n\t\t}\r\n\t\tjslet.Checker.test('Field.tabIndex', tabIndex).isNumber();\r\n\t\tZ._tabIndex = parseInt(tabIndex);\r\n\t\tZ._fireMetaChangedEvent('tabIndex');\r\n\t\tZ._fireGlobalMetaChangedEvent('tabIndex');\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Get or set field stored length.\r\n\t * If it's a database field, it's usually same as the length of database.  \r\n\t * \r\n\t * @param {Integer or undefined} len Field stored length.\r\n\t * @return {Integer or this}\r\n\t */\r\n\tlength: function (len) {\r\n\t\tvar Z = this;\r\n\t\tif (len === undefined) {\r\n\t\t\tif(Z._dataType == jslet.data.DataType.PROXY) {\r\n\t\t\t\treturn Z._getProxyPropValue('length') || 10;\r\n\t\t\t}\r\n\t\t\treturn Z._length || 10;\r\n\t\t}\r\n\t\tjslet.Checker.test('Field.length', len).isGTEZero();\r\n\t\tif(Z._dataType == jslet.data.DataType.PROXY) {\r\n\t\t\tZ._setProxyPropValue('length', parseInt(len));\r\n\t\t} else {\r\n\t\t\tZ._length = parseInt(len);\r\n\t\t}\r\n\t\tZ._fireGlobalMetaChangedEvent('length');\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Get edit length.\r\n\t * Edit length is used in editor to input data.\r\n\t * \r\n\t * @return {Integer}\r\n\t */\r\n\tgetEditLength: function () {\r\n\t\tvar Z = this,\r\n\t\t\tlkObj = Z.lookup(),\r\n\t\t\tlen = Z.length();\r\n\t\tif (lkObj) {\r\n\t\t\tvar codeFld = lkObj.codeField(),\r\n\t\t\t\tnameFld = lkObj.nameField(),\r\n\t\t\t\tlkds = lkObj.dataset();\r\n\t\t\tif (lkds && codeFld) {\r\n\t\t\t\tvar lkf = lkds.getField(codeFld);\r\n\t\t\t\tif (lkf) {\r\n\t\t\t\t\tlen = lkf.getEditLength();\r\n\t\t\t\t}\r\n\t\t\t\tif(nameFld) {\r\n\t\t\t\t\tlkf = lkds.getField(nameFld);\r\n\t\t\t\t\tif(lkf) {\r\n\t\t\t\t\t\tlen = Math.max(len, lkf.getEditLength());\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn len;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(Z.getType() === jslet.data.DataType.NUMBER && Z.scale() > 0) {\r\n\t\t\treturn len + 1; // 1 for decimal point\r\n\t\t}\r\n\t\treturn len > 0 ? len : 10;\r\n\t},\r\n\r\n\t/**\r\n\t * Get or set field decimal length.\r\n\t * \r\n\t * @param {Integer or undefined} scale Field decimal length.\r\n\t * @return {Integer or this}\r\n\t */\r\n\tscale: function (scale) {\r\n\t\tvar Z = this;\r\n\t\tif (scale === undefined) {\r\n\t\t\tif(Z._dataType == jslet.data.DataType.PROXY) {\r\n\t\t\t\treturn Z._getProxyPropValue('scale') || 0;\r\n\t\t\t}\r\n\t\t\treturn Z._scale;\r\n\t\t}\r\n\t\tjslet.Checker.test('Field.scale', scale).isGTEZero();\r\n\t\tif(Z._dataType == jslet.data.DataType.PROXY) {\r\n\t\t\tZ._setProxyPropValue('scale', parseInt(scale));\r\n\t\t} else {\r\n\t\t\tZ._scale = parseInt(scale);\r\n\t\t}\r\n\t\tZ._fireGlobalMetaChangedEvent('scale');\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * Get or set field alignment.\r\n\t * \r\n\t * @param {String or undefined} alignment Field alignment.\r\n\t * @return {String or this}\r\n\t */\r\n\talignment: function (alignment) {\r\n\t\tvar Z = this;\r\n\t\tif (alignment === undefined){\r\n\t\t\tvar align = Z._alignment;\r\n\t\t\tif(Z._dataType == jslet.data.DataType.PROXY) {\r\n\t\t\t\talign = Z._getProxyPropValue('alignment');\r\n\t\t\t}\r\n\t\t\tif(align) {\r\n\t\t\t\treturn align;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif(Z.lookup()) {\r\n\t\t\t\treturn 'left';\r\n\t\t\t}\r\n\t\t\tif(Z.getType() == jslet.data.DataType.NUMBER) {\r\n\t\t\t\treturn 'right';\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif(Z.getType() == jslet.data.DataType.BOOLEAN) {\r\n\t\t\t\treturn 'center';\r\n\t\t\t}\r\n\t\t\treturn 'left';\r\n\t\t}\r\n\t\t\r\n\t\tjslet.Checker.test('Field.alignment', alignment).isString();\r\n\t\tif(Z._dataType == jslet.data.DataType.PROXY) {\r\n\t\t\tZ._setProxyPropValue('alignment', jQuery.trim(alignment));\r\n\t\t} else {\r\n\t\t\tZ._alignment = jQuery.trim(alignment);\r\n\t\t}\r\n\t\tZ._fireColumnUpdatedEvent();\r\n\t\tZ._fireGlobalMetaChangedEvent('alignment');\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * Get or set the display text if the field value is null.\r\n\t * \r\n\t * @param {String or undefined} nullText Field null text.\r\n\t * @return {String or this}\r\n\t */\r\n\tnullText: function (nullText) {\r\n\t\tvar Z = this;\r\n\t\tif (nullText === undefined) {\r\n\t\t\treturn Z._nullText;\r\n\t\t}\r\n\t\tjslet.Checker.test('Field.nullText', nullText).isString();\r\n\t\tnullText = jQuery.trim(nullText);\r\n\t\tZ._nullText = nullText;\r\n\t\tZ._clearFieldCache();\r\n\t\tZ._fireColumnUpdatedEvent();\r\n\t\tZ._fireGlobalMetaChangedEvent('nullText');\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * Get or set field display width.\r\n\t * Display width is usually used in DBTable column.\r\n\t * \r\n\t * @param {Integer or undefined} displayWidth Field display width.\r\n\t * @return {Integer or this}\r\n\t */\r\n\tdisplayWidth: function (displayWidth) {\r\n\t\tvar Z = this;\r\n\t\tif (displayWidth === undefined) {\r\n\t\t\tif (Z._displayWidth <= 0) {\r\n\t\t\t\treturn Z._length > 0 ? Z._length : 12;\r\n\t\t\t} else {\r\n\t\t\t\treturn Z._displayWidth;\r\n\t\t\t}\r\n\t\t}\r\n\t\tjslet.Checker.test('Field.displayWidth', displayWidth).isGTEZero();\r\n\t\tZ._displayWidth = parseInt(displayWidth);\r\n\t\tZ._fireGlobalMetaChangedEvent('displayWidth');\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Get or set field default expression.\r\n\t * This expression will be calculated when inserting a record.\r\n\t * \r\n\t * @param {String or undefined} defaultExpr Field default expression.\r\n\t * @return {String or this}\r\n\t */\r\n\tdefaultExpr: function (defaultExpr) {\r\n\t\tvar Z = this;\r\n\t\tif (defaultExpr === undefined) {\r\n\t\t\treturn Z._defaultExpr;\r\n\t\t}\r\n\t\tjslet.Checker.test('Field.defaultExpr', defaultExpr).isString();\r\n\t\tZ._defaultExpr = defaultExpr;\r\n\t\tZ._fireGlobalMetaChangedEvent('defaultExpr');\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * Get or set field display format.\r\n\t * For number field like: #,##0.00\r\n\t * For date field like: yyyy/MM/dd\r\n\t * \r\n\t * @param {String or undefined} format Field display format.\r\n\t * @return {String or this}\r\n\t */\r\n\tdisplayFormat: function (format) {\r\n\t\tvar Z = this;\r\n\t\tif (format === undefined) {\r\n\t\t\tvar displayFmt = Z._displayFormat;\r\n\t\t\tif(Z._dataType == jslet.data.DataType.PROXY) {\r\n\t\t\t\tdisplayFmt = Z._getProxyPropValue('displayFormat');\r\n\t\t\t}\r\n\t\t\tif (displayFmt) {\r\n\t\t\t\treturn displayFmt;\r\n\t\t\t} else {\r\n\t\t\t\tif (Z.getType() == jslet.data.DataType.DATE) {\r\n\t\t\t\t\treturn jslet.locale.Date.format;\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn displayFmt;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tjslet.Checker.test('Field.displayFormat', format).isString();\r\n\t\tif(Z._dataType == jslet.data.DataType.PROXY) {\r\n\t\t\tZ._setProxyPropValue('displayFormat', jQuery.trim(format));\r\n\t\t} else {\r\n\t\t\tZ._displayFormat = jQuery.trim(format);\r\n\t\t}\r\n\t\tZ._dateFormat = null;\r\n\t\tZ._dateChar = null;\r\n\t\tZ._dateRegular = null;\r\n\t\tZ._clearFieldCache();\t\t\r\n\t\tZ._fireColumnUpdatedEvent();\r\n\t\tZ._fireGlobalMetaChangedEvent('displayFormat');\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * Get or set field default value.\r\n\t * The data type of default value must be same as Field's.\r\n\t * Example:\r\n\t *   Number field: fldObj.defauleValue(100);\r\n\t *   Date field: fldObj.defaultValue(new Date());\r\n\t *   String field: fldObj.defaultValue('test');\r\n\t * \r\n\t * @param {Object or undefined} dftValue Field default value.\r\n\t * @return {Object or this}\r\n\t */\r\n\tdefaultValue: function (dftValue) {\r\n\t\tvar Z = this;\r\n\t\tif (dftValue === undefined) {\r\n\t\t\treturn Z._defaultValue;\r\n\t\t}\r\n\t\tjslet.Checker.test('Field.defaultValue', Z.dftValue).isDataType(Z._dateType);\r\n\t\tZ._defaultValue = dftValue;\r\n\t\tZ._fireGlobalMetaChangedEvent('defaultValue');\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * Get or set field is unique or not.\r\n\t * \r\n\t * @param {Boolean or undefined} unique Field is unique or not.\r\n\t * @return {Boolean or this}\r\n\t */\r\n\tunique: function (unique) {\r\n\t\tvar Z = this;\r\n\t\tif (unique === undefined) {\r\n\t\t\treturn Z._unique;\r\n\t\t}\r\n\t\tZ._unique = unique ? true: false;\r\n\t\tZ._fireGlobalMetaChangedEvent('unique');\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Get or set field is required or not.\r\n\t * \r\n\t * @param {Boolean or undefined} required Field is required or not.\r\n\t * @return {Boolean or this}\r\n\t */\r\n\trequired: function (required) {\r\n\t\tvar Z = this;\r\n\t\tif (required === undefined) {\r\n\t\t\treturn Z._required;\r\n\t\t}\r\n\t\tZ._required = required ? true: false;\r\n\t\tZ._fireMetaChangedEvent('required');\r\n\t\tZ._fireGlobalMetaChangedEvent('required');\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Get or set field edit mask.\r\n\t * \r\n\t * @param {jslet.data.EditMask or undefined} mask Field edit mask.\r\n\t * @return {jslet.data.EditMask or this}\r\n\t */\r\n\teditMask: function (mask) {\r\n\t\tvar Z = this;\r\n\t\tif (mask === undefined) {\r\n\t\t\tif(Z._dataType == jslet.data.DataType.PROXY) {\r\n\t\t\t\treturn Z._getProxyPropValue('editMask');\r\n\t\t\t}\r\n\t\t\treturn Z._editMask;\r\n\t\t}\r\n\t\tif(mask) {\r\n\t\t\tif (jslet.isString(mask)) {\r\n\t\t\t\tmask = {mask: mask,keepChar:false};\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tmask = null;\r\n\t\t}\r\n\t\tif(Z._dataType == jslet.data.DataType.PROXY) {\r\n\t\t\tZ._setProxyPropValue('editMask', mask);\r\n\t\t} else {\r\n\t\t\tZ._editMask = mask;\r\n\t\t}\r\n\t\tZ._clearFieldCache();\t\t\r\n\t\tZ._fireMetaChangedEvent('editMask');\r\n\t\tZ._fireGlobalMetaChangedEvent('required');\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\tdateFormat: function(){\r\n\t\tvar Z = this;\r\n\t\tif (Z._dateFormat) {\r\n\t\t\treturn Z._dateFormat;\r\n\t\t}\r\n\t\tif (this.getType() != jslet.data.DataType.DATE) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\tvar displayFmt = this.displayFormat().toUpperCase();\r\n\t\tZ._dateFormat = '';\r\n\t\tvar c;\r\n\t\tfor(var i = 0, len = displayFmt.length; i < len; i++){\r\n\t\t\tc = displayFmt.charAt(i);\r\n\t\t\tif ('YMD'.indexOf(c) < 0) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tif (Z._dateFormat.indexOf(c) < 0) {\r\n\t\t\t\tZ._dateFormat += c;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn Z._dateFormat;\r\n\t},\r\n\t\r\n\tdateSeparator: function(){\r\n\t\tvar Z = this;\r\n\t\tif (Z._dateChar) {\r\n\t\t\treturn Z._dateChar;\r\n\t\t}\r\n\t\tif (this.getType() != jslet.data.DataType.DATE) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\tvar displayFmt = this.displayFormat().toUpperCase();\r\n\t\tfor(var i = 0, c, len = displayFmt.length; i < len; i++){\r\n\t\t\tc = displayFmt.charAt(i);\r\n\t\t\tif ('YMD'.indexOf(c) < 0){\r\n\t\t\t\tZ._dateChar = c;\r\n\t\t\t\treturn c;\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t\r\n\tdateRegular: function(){\r\n\t\tvar Z = this;\r\n\t\tif (Z._dateRegular) {\r\n\t\t\treturn Z._dateRegular;\r\n\t\t}\r\n\t\tvar dateFmt = this.dateFormat(),\r\n\t\t\tdateSeparator = this.dateSeparator(),\r\n\t\t\tresult = ['^'];\r\n\t\tfor(var i = 0, c; i < dateFmt.length; i++){\r\n\t\t\tif (i > 0){\r\n\t\t\t\tresult.push('\\\\');\r\n\t\t\t\tresult.push(dateSeparator);\r\n\t\t\t}\r\n\t\t\tc = dateFmt.charAt(i);\r\n\t\t\tif (c == 'Y') {\r\n\t\t\t\tresult.push('(\\\\d{4}|\\\\d{2})');\r\n\t\t\t} else if (c == 'M'){\r\n\t\t\t\tresult.push('(0?[1-9]|1[012])');\r\n\t\t\t} else {\r\n\t\t\t\tresult.push('(0?[1-9]|[12][0-9]|3[01])');\r\n\t\t\t}\r\n\t\t}\r\n\t\tresult.push('(\\\\s+\\\\d{2}:\\\\d{2}:\\\\d{2}(\\\\.\\\\d{3}){0,1}){0,1}');\r\n\t\tresult.push('$');\r\n\t\tZ._dateRegular = {expr: new RegExp(result.join(''), 'gim'), message: jslet.locale.Dataset.invalidDate};\r\n\t\treturn Z._dateRegular;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Get or set field formula. Example: \r\n\t * <pre><code>\r\n\t *  fldObj.formula('[price]*[num]');\r\n\t * </code></pre>\r\n\t * \r\n\t * @param {String or undefined} formula Field formula.\r\n\t * @return {String or this}\r\n\t */\r\n\tformula: function (formula) {\r\n\t\tvar Z = this;\r\n\t\tif (formula === undefined) {\r\n\t\t\treturn Z._formula;\r\n\t\t}\r\n\t\t\r\n\t\tjslet.Checker.test('Field.formula', formula).isString();\r\n\t\tZ._formula = jQuery.trim(formula);\r\n\t\tZ._clearFieldCache();\r\n\t\tvar dataset = Z.dataset(); \r\n\t\tif (dataset) {\r\n\t\t\tdataset.removeInnerFormulaField(Z._fieldName);\r\n\t\t\tdataset.addInnerFormulaField(Z._fieldName, Z._formula);\t\t\r\n\t\t\tZ._fireColumnUpdatedEvent();\r\n\t\t}\r\n\t\tZ._fireGlobalMetaChangedEvent('formula');\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * Get or set field is visible or not.\r\n\t * \r\n\t * @param {Boolean or undefined} visible Field is visible or not.\r\n\t * @return {Boolean or this}\r\n\t */\r\n\tvisible: function (visible) {\r\n\t\tvar Z = this;\r\n\t\tif (visible === undefined){\r\n\t\t\tif (Z._visible){\r\n\t\t\t\tvar p = this.parent();\r\n\t\t\t\twhile(p){\r\n\t\t\t\t\tif (!p.visible()) { //if parent is invisible\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tp = p.parent();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn Z._visible;\r\n\t\t}\r\n\t\tZ._visible = visible ? true: false;\r\n\t\tZ._fireMetaChangedEvent('visible');\r\n\t\tZ._fireGlobalMetaChangedEvent('visible');\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * Get or set field is disabled or not.\r\n\t * \r\n\t * @param {Boolean or undefined} disabled Field is disabled or not.\r\n\t * @return {Boolean or this}\r\n\t */\r\n\tdisabled: function (disabled) {\r\n\t\tvar Z = this;\r\n\t\tif (disabled === undefined) {\r\n\t\t\tif(Z._formula || Z._dataType === jslet.data.DataType.DATASET || Z._children) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\treturn Z._disabled;\r\n\t\t}\r\n\t\tZ._disabled = disabled ? true: false;\r\n\t\tZ._fireMetaChangedEvent('disabled');\r\n\t\tZ._fireGlobalMetaChangedEvent('disabled');\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * Get or set field is readOnly or not.\r\n\t * \r\n\t * @param {Boolean or undefined} readOnly Field is readOnly or not.\r\n\t * @return {Boolean or this}\r\n\t */\r\n\treadOnly: function (readOnly) {\r\n\t\tvar Z = this;\r\n\t\tif (readOnly === undefined){\r\n\t\t\tif (Z._dataType == jslet.data.DataType.DATASET) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\tvar children = Z.children();\r\n\t\t\tif (children && children.length === 0) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\r\n\t\t\treturn Z._readOnly || Z._dataset.readOnly();\r\n\t\t}\r\n\t\t\r\n\t\tZ._readOnly = readOnly? true: false;\r\n\t\tZ._fireMetaChangedEvent('readOnly');\r\n\t\tZ._fireGlobalMetaChangedEvent('readOnly');\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\tfieldReadOnly: function() {\r\n\t\tvar Z = this;\r\n\t\tif (Z._dataType == jslet.data.DataType.DATASET) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\tvar children = Z.children();\r\n\t\tif (children && children.length === 0) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\treturn Z._readOnly;\r\n\t},\r\n\t\r\n\tfieldDisabled: function() {\r\n\t\tvar Z = this;\r\n\t\treturn this._disabled;\r\n\t},\r\n\t\r\n\t_fireGlobalMetaChangedEvent: function(metaName) {\r\n\t\tvar dsObj = this.dataset();\r\n\t\tif (dsObj && dsObj.designMode() && dsObj.isFireGlobalEvent()) {\r\n\t\t\tvar handler = jslet.data.globalDataHandler.fieldMetaChanged();\r\n\t\t\tif(handler) {\r\n\t\t\t\thandler.call(this, dsObj, this._fieldName, metaName);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t\r\n\t_fireMetaChangedEvent: function(metaName) {\r\n\t\tvar ds = this.dataset();\r\n\t\tif (ds) {\r\n\t\t\tvar evt = jslet.data.RefreshEvent.changeMetaEvent(metaName, this._fieldName);\r\n\t\t\tds.refreshControl(evt);\r\n\t\t}\r\n\t},\r\n\t\r\n\t_fireColumnUpdatedEvent: function() {\r\n\t\tvar ds = this.dataset();\r\n\t\tif (ds) {\r\n\t\t\tvar evt = jslet.data.RefreshEvent.updateColumnEvent(this._fieldName);\r\n\t\t\tds.refreshControl(evt);\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * Get or set if field participates unit converting.\r\n\t * \r\n\t * @param {Boolean or undefined} unitConverted .\r\n\t * @return {Boolean or this}\r\n\t */\r\n\tunitConverted: function (unitConverted) {\r\n\t\tvar Z = this;\r\n\t\tif (unitConverted === undefined) {\r\n\t\t\treturn Z._dataType == jslet.data.DataType.NUMBER? Z._unitConverted:false;\r\n\t\t}\r\n\t\tZ._unitConverted = unitConverted ? true : false;\r\n\t\tvar ds = this.dataset();\r\n\t\tZ._clearFieldCache();\t\t\r\n\t\tif (Z._dataType == jslet.data.DataType.NUMBER && ds && ds.unitConvertFactor() != 1) {\r\n\t\t\tZ._fireColumnUpdatedEvent();\r\n\t\t}\r\n\t\tZ._fireGlobalMetaChangedEvent('unitConverted');\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * Get or set value style of this field. Optional value: 0 - Normal, 1 - Between style, 2 - Multiple value\r\n\t * \r\n\t * @param {Integer or undefined} mvalueStyle.\r\n\t * @return {Integer or this}\r\n\t */\r\n\tvalueStyle: function (mvalueStyle) {\r\n\t\tvar Z = this;\r\n\t\tif (mvalueStyle === undefined) {\r\n\t\t\tif(Z._dataType == jslet.data.DataType.DATASET ||  \r\n\t\t\t\t\tZ._children && Z._children.length > 0) \r\n\t\t\t\treturn jslet.data.FieldValueStyle.NORMAL;\r\n\t\t\tif(Z._dataType == jslet.data.DataType.PROXY) {\r\n\t\t\t\treturn Z._getProxyPropValue('valueStyle');\r\n\t\t\t}\r\n\r\n\t\t\treturn Z._valueStyle;\r\n\t\t}\r\n\r\n\t\tif(mvalueStyle) {\r\n\t\t\tmvalueStyle = parseInt(mvalueStyle);\r\n\t\t} else {\r\n\t\t\tmvalueStyle = 0;\r\n\t\t}\r\n\t\tjslet.Checker.test('Field.valueStyle', mvalueStyle).isNumber().inArray([0,1,2]);\r\n\t\tif(Z._dataType == jslet.data.DataType.PROXY) {\r\n\t\t\tZ._setProxyPropValue('valueStyle', mvalueStyle);\r\n\t\t} else {\r\n\t\t\tZ._valueStyle = mvalueStyle;\r\n\t\t}\r\n\t\tZ._clearFieldCache();\r\n\t\tZ._fireColumnUpdatedEvent();\r\n\t\tZ._fireMetaChangedEvent('valueStyle');\r\n\t\tZ._fireGlobalMetaChangedEvent('valueStyle');\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * Get or set allowed count when valueStyle is multiple.\r\n\t * \r\n\t * @param {String or undefined} count - maximum items for multiple value.\r\n\t * @return {String or this}\r\n\t */\r\n\tvalueCountLimit: function (count) {\r\n\t\tvar Z = this;\r\n\t\tif (count === undefined) {\r\n\t\t\tif(Z._dataType == jslet.data.DataType.PROXY) {\r\n\t\t\t\treturn Z._getProxyPropValue('valueCountLimit');\r\n\t\t\t}\r\n\t\t\treturn Z._valueCountLimit;\r\n\t\t}\r\n\t\tif(count) {\r\n\t\t\tjslet.Checker.test('Field.valueCountLimit', count).isNumber();\r\n\t\t} else {\r\n\t\t\tcount = 0;\r\n\t\t}\r\n\t\tif(Z._dataType == jslet.data.DataType.PROXY) {\r\n\t\t\tZ._setProxyPropValue('valueStyle', parseInt(count));\r\n\t\t} else {\r\n\t\t\tZ._valueCountLimit = parseInt(count);\r\n\t\t}\r\n\t\tZ._fireGlobalMetaChangedEvent('valueCountLimit');\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * Get or set field display control. It is similar as DBControl configuration.\r\n\t * Here you need not set 'dataset' and 'field' property.   \r\n\t * Example:\r\n\t * <pre><code>\r\n\t * //Normal DBControl configuration\r\n\t * //var normalCtrlCfg = {type:\"DBSpinEdit\",dataset:\"employee\",field:\"age\",minValue:10,maxValue:100,step:5};\r\n\t * \r\n\t * var displayCtrlCfg = {type:\"DBSpinEdit\",minValue:10,maxValue:100,step:5};\r\n\t * fldObj.displayControl(displayCtrlCfg);\r\n\t * </code></pre>\r\n\t * \r\n\t * @param {DBControl Config or String} dispCtrl If String, it will convert to DBControl Config.\r\n\t * @return {DBControl Config or this}\r\n\t */\r\n\tdisplayControl: function (dispCtrl) {\r\n\t\tvar Z = this;\r\n\t\tif (dispCtrl === undefined){\r\n\t\t\tvar result = Z._displayControl;\r\n\t\t\tif(Z._dataType == jslet.data.DataType.PROXY) {\r\n\t\t\t\tresult = Z._getProxyPropValue('displayControl');\r\n\t\t\t}\r\n\t\t\tif (Z.getType() == jslet.data.DataType.BOOLEAN && !result) {\r\n\t\t\t\treturn {\r\n\t\t\t\t\ttype: 'dbcheckbox'\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t\treturn result;\r\n\t\t}\r\n\t\tdispCtrl = jslet.isString(dispCtrl) ? { type: dispCtrl } : dispCtrl;\r\n\t\tif(Z._dataType == jslet.data.DataType.PROXY) {\r\n\t\t\tZ._setProxyPropValue('displayControl', dispCtrl);\r\n\t\t} else {\r\n\t\t\tZ._displayControl = dispCtrl;\r\n\t\t}\r\n\t\tZ._fireGlobalMetaChangedEvent('displayControl');\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * Get or set field edit control. It is similar as DBControl configuration.\r\n\t * Here you need not set 'dataset' and 'field' property.   \r\n\t * Example:\r\n\t * <pre><code>\r\n\t * //Normal DBControl configuration\r\n\t * //var normalCtrlCfg = {type:\"DBSpinEdit\",dataset:\"employee\",field:\"age\",minValue:10,maxValue:100,step:5};\r\n\t * \r\n\t * var editCtrlCfg = {type:\"DBSpinEdit\",minValue:10,maxValue:100,step:5};\r\n\t * fldObj.displayControl(editCtrlCfg);\r\n\t * </code></pre>\r\n\t * \r\n\t * @param {DBControl Config or String} editCtrl If String, it will convert to DBControl Config.\r\n\t * @return {DBControl Config or this}\r\n\t */\r\n\teditControl: function (editCtrl) {\r\n\t\tvar Z = this;\r\n\t\tif (editCtrl=== undefined){\r\n\t\t\tvar result = Z._editControl;\r\n\t\t\tif(Z._dataType == jslet.data.DataType.PROXY) {\r\n\t\t\t\tresult = Z._getProxyPropValue('editControl');\r\n\t\t\t}\r\n\t\t\tif (result) {\r\n\t\t\t\treturn result;\r\n\t\t\t}\r\n\r\n\t\t\tvar fldType = Z.getType();\r\n\t\t\tif (fldType == jslet.data.DataType.BOOLEAN) {\r\n\t\t\t\treturn {type: 'dbcheckbox'};\r\n\t\t\t}\r\n\t\t\tif (fldType == jslet.data.DataType.DATE) {\r\n\t\t\t\treturn {type: 'dbdatepicker'};\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\treturn Z.lookup()? {type: 'dbselect'}:{type: 'dbtext'};\r\n\t\t}\r\n\t\tif(jslet.isString(editCtrl)) {\r\n\t\t\teditCtrl = jQuery.trim(editCtrl);\r\n\t\t\tif(editCtrl) {\r\n\t\t\t\tif(editCtrl.indexOf(':') > 0) {\r\n\t\t\t\t\teditCtrl = jslet.JSON.parse(editCtrl);\r\n\t\t\t\t} else {\r\n\t\t\t\t\teditCtrl =  {type: editCtrl};\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\teditCtrl = null;\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar oldValue = Z._getProxyPropValue('editControl');\r\n\t\tif(oldValue && editCtrl && oldValue.type == editCtrl.type) {\r\n\t\t\treturn this;\r\n\t\t}\r\n\t\tif(Z._dataType == jslet.data.DataType.PROXY) {\r\n\t\t\tZ._setProxyPropValue('editControl', editCtrl);\r\n\t\t} else {\r\n\t\t\tZ._editControl = editCtrl;\r\n\t\t}\r\n\t\tZ._fireMetaChangedEvent('editControl');\r\n\t\tZ._fireGlobalMetaChangedEvent('editControl');\r\n\t\treturn this;\r\n\t},\r\n\r\n\t_addRelation: function() {\r\n\t\tvar Z = this, \r\n\t\t\tlkObj = Z.lookup(),\r\n\t\t\tlkDsName,\r\n\t\t\thostDsName = Z._datasetName;\r\n\t\tif(!hostDsName || (Z.getType() != jslet.data.DataType.DATASET && !lkObj)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tvar hostField = Z._fieldName,\r\n\t\t\trelationType;\r\n\t\tif(Z.getType() == jslet.data.DataType.DATASET) {\r\n\t\t\tif(Z._detailDataset) {\r\n\t\t\t\tlkDsName = Z._getDatasetName(Z._detailDataset);\r\n\t\t\t\trelationType = jslet.data.DatasetType.DETAIL;\r\n\t\t\t\tjslet.data.datasetRelationManager.addRelation(hostDsName, hostField, lkDsName, relationType);\r\n\t\t\t\tvar detailDsObj = jslet.data.getDataset(Z._detailDataset);\r\n\t\t\t\tif(detailDsObj) {\r\n\t\t\t\t\tdetailDsObj.masterDataset(hostDsName);\r\n\t\t\t\t\tdetailDsObj.masterField(hostField);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tlkDsName = Z._getDatasetName(lkObj._dataset);\r\n\t\t\trelationType = jslet.data.DatasetType.LOOKUP;\r\n\t\t\tjslet.data.datasetRelationManager.addRelation(hostDsName, hostField, lkDsName, relationType);\r\n\t\t}\r\n\t},\r\n\t\r\n\t_removeRelation: function() {\r\n\t\tvar Z = this,\r\n\t\t\tlkObj = Z.lookup(),\r\n\t\t\thostDsName = Z._datasetName;\r\n\t\tif(!hostDsName || (!Z._detailDataset && !lkObj)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar hostField = Z._fieldName,\r\n\t\t\trelationType, lkDsName;\r\n\r\n\t\tif(Z._detailDataset) {\r\n\t\t\tlkDsName = Z._getDatasetName(Z._detailDataset);\r\n\t\t\tvar detailDsObj = jslet.data.getDataset(Z._detailDataset);\r\n\t\t\tif(detailDsObj) {\r\n\t\t\t\tdetailDsObj.masterDataset(null);\r\n\t\t\t\tdetailDsObj.masterField(null);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tlkDsName = Z._getDatasetName(lkObj._dataset);\r\n\t\t}\r\n\t\tjslet.data.datasetRelationManager.removeRelation(hostDsName, hostField, lkDsName);\r\n\t},\r\n\t\t\r\n\t/**\r\n\t * Get or set lookup field object\r\n\t * \r\n\t * @param {jslet.data.FieldLookup or undefined} lkFld lookup field Object.\r\n\t * @return {jslet.data.FieldLookup or this}\r\n\t */\r\n\tlookup: function (lookupObj) {\r\n\t\tvar Z = this;\r\n\t\tif (lookupObj === undefined){\r\n\t\t\tif(Z._dataType == jslet.data.DataType.PROXY) {\r\n\t\t\t\treturn Z._getProxyPropValue('lookup');\r\n\t\t\t}\r\n\t\t\treturn Z._lookup;\r\n\t\t}\r\n\t\tjslet.Checker.test('Field.lookup', lookupObj).isClass(jslet.data.FieldLookup.className);\t\t\r\n\t\tZ._removeRelation();\r\n\t\t\r\n\t\tif(Z._dataType == jslet.data.DataType.PROXY) {\r\n\t\t\tZ._setProxyPropValue('lookup', lookupObj);\r\n\t\t} else {\r\n\t\t\tZ._lookup = lookupObj;\r\n\t\t}\r\n\t\tif(lookupObj) {\r\n\t\t\tlookupObj.hostField(Z);\r\n\t\t\tZ._addRelation();\r\n\t\t}\r\n\t\tZ._clearFieldCache();\t\t\r\n\t\tZ._fireColumnUpdatedEvent();\r\n\t\tZ._fireLookupChangedEvent();\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Fire lookup setting changed event.\r\n\t */\r\n\t_fireLookupChangedEvent: function() {\r\n\t\tvar Z = this;\r\n\t\tif(!Z._dataset) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar fldName = this.name();\r\n\t\tvar lookupEvt = jslet.data.RefreshEvent.lookupEvent(fldName, true);\r\n\t\tthis._dataset.refreshControl(lookupEvt);\r\n\t},\r\n\r\n\t_getDatasetName: function(dsObjOrName) {\r\n\t\treturn jslet.isString(dsObjOrName)? dsObjOrName: dsObjOrName.name();\r\n\t},\r\n\r\n\t/**\r\n\t * @deprecated\r\n\t * Use detailDataset instead.\r\n\t */\r\n\tsubDataset: function (subDataset) {\r\n\t\treturn this.detailDataset(subDataset);\r\n\t},\r\n\t\r\n\t/**\r\n\t * Set or get sub dataset.\r\n\t * \r\n\t * @param {jslet.data.Dataset or undefined} subdataset\r\n\t * @return {jslet.data.Dataset or this}\r\n\t */\r\n\tdetailDataset: function (detailDataset) {\r\n\t\tvar Z = this;\r\n\t\tif (detailDataset === undefined) {\r\n\t\t\tif(Z._detailDataset && jslet.isString(Z._detailDataset)) {\r\n\t\t\t\tZ.detailDataset(Z._detailDataset);\r\n\t\t\t\tif(jslet.isString(Z._detailDataset)) {\r\n\t\t\t\t\tthrow new Error(jslet.formatMessage(jslet.locale.Dataset.datasetNotFound, [Z._detailDataset]));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn Z._detailDataset;\r\n\t\t}\r\n\t\t\r\n\t\tZ._removeRelation();\r\n\t\tif (jslet.isString(detailDataset)) {\r\n\t\t\tvar dtlDsObj = jslet.data.getDataset(detailDataset);\r\n\t\t\tif(!dtlDsObj) {\r\n\t\t\t\tZ._detailDataset = detailDataset;\r\n\t\t\t\tif(jslet.data.onCreatingDataset) {\r\n\t\t\t\t\tjslet.data.onCreatingDataset(detailDataset, jslet.data.DatasetType.DETAIL, null, Z._datasetName);\r\n\t\t\t\t}\r\n\t\t\t\tZ._addRelation();\r\n\t\t\t\treturn this;\r\n\t\t\t}\r\n\t\t\tdetailDataset = dtlDsObj;\r\n\t\t} else {\r\n\t\t\tjslet.Checker.test('Field.detailDataset', detailDataset).isClass(jslet.data.Dataset.className);\r\n\t\t}\r\n\t\tZ._detailDataset = detailDataset;\r\n\t\tZ._addRelation();\r\n\t\treturn this;\r\n\t},\r\n\r\n\turlExpr: function (urlExpr) {\r\n\t\tvar Z = this;\r\n\t\tif (urlExpr === undefined) {\r\n\t\t\treturn Z._urlExpr;\r\n\t\t}\r\n\r\n\t\tjslet.Checker.test('Field.urlExpr', urlExpr).isString();\r\n\t\tZ._urlExpr = jQuery.trim(urlExpr);\r\n\t\tZ._innerUrlExpr = null;\r\n\t\tZ._clearFieldCache();\t\t\r\n\t\tZ._fireColumnUpdatedEvent();\r\n\t\tZ._fireGlobalMetaChangedEvent('urlExpr');\r\n\t\treturn this;\r\n\t},\r\n\r\n\turlTarget: function (target) {\r\n\t\tvar Z = this;\r\n\t\tif (target === undefined){\r\n\t\t\treturn !Z._urlTarget ? jslet.data.Field.URLTARGETBLANK : Z._urlTarget;\r\n\t\t}\r\n\r\n\t\tjslet.Checker.test('Field.urlTarget', target).isString();\r\n\t\tZ._urlTarget = jQuery.trim(target);\r\n\t\tZ._clearFieldCache();\r\n\t\tZ._fireColumnUpdatedEvent();\r\n\t\tZ._fireGlobalMetaChangedEvent('urlTarget');\r\n\t\treturn this;\r\n\t},\r\n\r\n\tcalcUrl: function () {\r\n\t\tvar Z = this;\r\n\t\tif (!this.dataset() || !Z._urlExpr) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\tif (!Z._innerUrlExpr) {\r\n\t\t\tZ._innerUrlExpr = new jslet.Expression(this.dataset(), Z._urlExpr);\r\n\t\t}\r\n\t\treturn Z._innerUrlExpr.eval();\r\n\t},\r\n\r\n\t/**\r\n\t * Get or set if field need be anti-xss.\r\n\t * If true, field value will be encoded.\r\n\t * \r\n\t * @param {Boolean or undefined} isXss.\r\n\t * @return {Boolean or this}\r\n\t */\r\n\tantiXss: function(isXss){\r\n\t\tvar Z = this;\r\n\t\tif (isXss === undefined) {\r\n\t\t\treturn Z._antiXss;\r\n\t\t}\r\n\t\tZ._antiXss = isXss ? true: false;\r\n\t\tZ._fireGlobalMetaChangedEvent('antiXss');\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * Get or set field rang.\r\n\t * Range is an object as: {min: x, max: y}. Example:\r\n\t * <pre><code>\r\n\t *\t//For String field\r\n\t *\tvar range = {min: 'a', max: 'z'};\r\n\t *  //For Date field\r\n\t *\tvar range = {min: new Date(2000,1,1), max: new Date(2010,12,31)};\r\n\t *  //For Number field\r\n\t *\tvar range = {min: 0, max: 100};\r\n\t *  fldObj.dataRange(range);\r\n\t * </code></pre>\r\n\t * \r\n\t * @param {Range or Json String} range Field range;\r\n\t * @return {Range or this}\r\n\t */\r\n\tdataRange: function (range) {\r\n\t\tvar Z = this;\r\n\t\tif (range === undefined) {\r\n\t\t\tif(Z._dataType == jslet.data.DataType.PROXY) {\r\n\t\t\t\treturn Z._getProxyPropValue('dataRange');\r\n\t\t\t}\r\n\t\t\treturn Z._dataRange;\r\n\t\t}\r\n\t\tif(range && jslet.isString(range)) {\r\n\t\t\trange = jslet.JSON.parse(range);\r\n\t\t}\r\n\t\tif(range) {\r\n\t\t\tjslet.Checker.test('Field.dataRange', range).isObject();\r\n\t\t\tif(range.min) {\r\n\t\t\t\tjslet.Checker.test('Field.dataRange.min', range.min).isDataType(Z._dateType);\r\n\t\t\t}\r\n\t\t\tif(range.max) {\r\n\t\t\t\tjslet.Checker.test('Field.dataRange.max', range.max).isDataType(Z._dateType);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(Z._dataType == jslet.data.DataType.PROXY) {\r\n\t\t\tZ._setProxyPropValue('dataRange', range);\r\n\t\t} else {\r\n\t\t\tZ._dataRange = range;\r\n\t\t}\r\n\t\tZ._fireGlobalMetaChangedEvent('dataRange');\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * Get or set regular expression.\r\n\t * You can specify your own validator with regular expression. If regular expression not specified, \r\n\t * The default regular expression for Date and Number field will be used. Example:\r\n\t * <pre><code>\r\n\t *\tfldObj.regularExpr(/(\\(\\d{3,4}\\)|\\d{3,4}-|\\s)?\\d{8}/ig, 'Invalid phone number!');//like: 0755-12345678\r\n\t * </code></pre>\r\n\t * \r\n\t * @param {String} expr Regular expression;\r\n\t * @param {String} message Message for invalid.\r\n\t * @return {Object} An object like: { expr: expr, message: message }\r\n\t */\r\n\tregularExpr: function (expr, message) {\r\n\t\tvar Z = this;\r\n\t\tvar argLen = arguments.length;\r\n\t\tif (argLen === 0){\r\n\t\t\tif(Z._dataType == jslet.data.DataType.PROXY) {\r\n\t\t\t\treturn Z._getProxyPropValue('regularExpr');\r\n\t\t\t}\r\n\t\t\treturn Z._regularExpr;\r\n\t\t}\r\n\t\tif(argLen > 1) {\r\n\t\t\texpr = { expr: expr, message: message };\r\n\t\t}\r\n\t\tif(Z._dataType == jslet.data.DataType.PROXY) {\r\n\t\t\tZ._setProxyPropValue('regularExpr', expr);\r\n\t\t} else {\r\n\t\t\tZ._regularExpr = expr;\r\n\t\t}\r\n\t\tZ._fireGlobalMetaChangedEvent('regularExpr');\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Get or set customized field value accessor, pattern:\r\n\t * var accessor = {\r\n\t * \t\tgetValue: function(dataRec, fldName) {},\r\n\t * \t\tsetValue: function(dataRec, fldName, fldValue) {}\r\n\t * };\r\n\t * fldObj.customValueAccessor(accessor);\r\n\t * \r\n\t * @param {Object} accessor Field raw value accessor.\r\n\t */\r\n\tcustomValueAccessor: function(accessor) {\r\n\t\tvar Z = this;\r\n\t\tif (accessor === undefined) {\r\n\t\t\treturn Z._customValueAccessor;\r\n\t\t}\r\n\t\tZ._customValueAccessor = accessor;\r\n\t\tZ._clearFieldCache();\r\n\t\tZ._fireColumnUpdatedEvent();\r\n\t\tZ._fireGlobalMetaChangedEvent('customValueAccessor');\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Get or set customized field value converter.\r\n\t * \r\n\t * @param {jslet.data.FieldValueConverter} converter converter object, sub class of jslet.data.FieldValueConverter.\r\n\t */\r\n\tcustomValueConverter: function (converter) {\r\n\t\tvar Z = this;\r\n\t\tif (converter === undefined) {\r\n\t\t\treturn Z._customValueConverter;\r\n\t\t}\r\n\t\tZ._customValueConverter = converter;\r\n\t\tZ._clearFieldCache();\r\n\t\tZ._fireColumnUpdatedEvent();\r\n\t\tZ._fireGlobalMetaChangedEvent('customValueConverter');\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * Get or set customized validator.\r\n\t * \r\n\t * @param {Function} validator Validator function.\r\n\t * Pattern:\r\n\t *   function(fieldObj, fldValue, validateAjax){}\r\n\t *   //fldObj: jslet.data.Field, Field object\r\n\t *   //fldValue: Object, Field value\r\n\t *   //serverValidateFn: the function which can post data to server for validating.\r\n\t *   //return: String, if validate failed, return error message, otherwise return null; \r\n\t *   \r\n\t *   For example: \r\n\t *   fldObj.customValidator(function(fldObj, fldValue, serverValidateFn) {\r\n\t *   \treturn serverValidateFn('/xx/check.do', {fieldValue: fldValue});\r\n\t *   });\r\n\t */\r\n\tcustomValidator: function (validator) {\r\n\t\tvar Z = this;\r\n\t\tif (validator === undefined) {\r\n\t\t\tif(Z._dataType == jslet.data.DataType.PROXY) {\r\n\t\t\t\treturn Z._getProxyPropValue('customValidator');\r\n\t\t\t}\r\n\t\t\treturn Z._customValidator;\r\n\t\t}\r\n\t\tif(validator) {\r\n\t\t\tjslet.Checker.test('Field.customValidator', validator).isFunction();\r\n\t\t}\r\n\t\tif(Z._dataType == jslet.data.DataType.PROXY) {\r\n\t\t\tZ._setProxyPropValue('customValidator', validator);\r\n\t\t} else {\r\n\t\t\tZ._customValidator = validator;\r\n\t\t}\r\n\t\tZ._fireGlobalMetaChangedEvent('customValidator');\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Valid characters for this field.\r\n\t */\r\n\tvalidChars: function(chars){\r\n\t\tvar Z = this;\r\n\t\tif (chars === undefined){\r\n\t\t\tvar result = Z._validChars;\r\n\t\t\tif(Z._dataType == jslet.data.DataType.PROXY) {\r\n\t\t\t\tresult = Z._getProxyPropValue('validChars');\r\n\t\t\t}\r\n\t\t\tif (result) {\r\n\t\t\t\treturn result;\r\n\t\t\t}\r\n\t\t\tif (Z.getType() == jslet.data.DataType.NUMBER){\r\n\t\t\t\treturn Z._scale ? '+-0123456789.' : '+-0123456789';\r\n\t\t\t}\r\n\t\t\tif (Z.getType() == jslet.data.DataType.DATE){\r\n\t\t\t\tvar displayFormat = Z.displayFormat();\r\n\t\t\t\tchars = '0123456789';\r\n\t\t\t\tfor(var i = 0, len = displayFormat.length; i < len; i++) {\r\n\t\t\t\t\tvar c = displayFormat.charAt(i);\r\n\t\t\t\t\tif(c === 'y' || c === 'M' || c === 'd' || c === 'h' || c === 'm' || c === 's') {\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tchars += c;\r\n\t\t\t\t}\r\n\t\t\t\treturn chars;\r\n\t\t\t}\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\t\r\n\t\tif(Z._dataType == jslet.data.DataType.PROXY) {\r\n\t\t\tZ._setProxyPropValue('validChars', chars);\r\n\t\t} else {\r\n\t\t\tZ._validChars = chars;\r\n\t\t}\r\n\t\tZ._fireGlobalMetaChangedEvent('validChars');\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Use for Boolean field, actual value for 'true'\r\n\t */\r\n\ttrueValue: function(value) {\r\n\t\tvar Z = this;\r\n\t\tif (value === undefined) {\r\n\t\t\tif(Z._dataType == jslet.data.DataType.PROXY) {\r\n\t\t\t\treturn Z._getProxyPropValue('trueValue');\r\n\t\t\t}\r\n\t\t\treturn Z._trueValue;\r\n\t\t}\r\n\t\tif(Z._dataType == jslet.data.DataType.PROXY) {\r\n\t\t\tZ._setProxyPropValue('trueValue', value);\r\n\t\t} else {\r\n\t\t\tZ._trueValue = value;\r\n\t\t}\r\n\t\treturn this;\t\t\r\n\t},\r\n\t\r\n\t/**\r\n\t * Use for Boolean field, actual value for 'false'\r\n\t */\r\n\tfalseValue: function(value) {\r\n\t\tvar Z = this;\r\n\t\tif (value === undefined) {\r\n\t\t\tif(Z._dataType == jslet.data.DataType.PROXY) {\r\n\t\t\t\treturn Z._getProxyPropValue('falseValue');\r\n\t\t\t}\r\n\t\t\treturn Z._falseValue;\r\n\t\t}\r\n\t\tif(Z._dataType == jslet.data.DataType.PROXY) {\r\n\t\t\tZ._setProxyPropValue('falseValue', value);\r\n\t\t} else {\r\n\t\t\tZ._falseValue = value;\r\n\t\t}\r\n\t\treturn this;\t\t\r\n\t},\r\n\t\r\n\t/**\r\n\t * Use for Boolean field, display text for 'true'\r\n\t */\r\n\ttrueText: function(trueText) {\r\n\t\tvar Z = this;\r\n\t\tif (trueText === undefined) {\r\n\t\t\tvar result = Z._trueText;\r\n\t\t\tif(Z._dataType == jslet.data.DataType.PROXY) {\r\n\t\t\t\tresult = Z._getProxyPropValue('trueText');\r\n\t\t\t}\r\n\t\t\treturn result || jslet.locale.Dataset.trueText;\r\n\t\t}\r\n\t\tif(Z._dataType == jslet.data.DataType.PROXY) {\r\n\t\t\tZ._setProxyPropValue('trueText', trueText);\r\n\t\t} else {\r\n\t\t\tZ._trueText = trueText;\r\n\t\t}\r\n\t\treturn this;\t\t\r\n\t},\r\n\t\r\n\t/**\r\n\t * Use for Boolean field, display text for 'false'\r\n\t */\r\n\tfalseText: function(falseText) {\r\n\t\tvar Z = this;\r\n\t\tif (falseText === undefined) {\r\n\t\t\tvar result = Z._falseText;\r\n\t\t\tif(Z._dataType == jslet.data.DataType.PROXY) {\r\n\t\t\t\tresult = Z._getProxyPropValue('falseText');\r\n\t\t\t}\r\n\t\t\treturn result || jslet.locale.Dataset.falseText;\r\n\t\t}\r\n\t\tif(Z._dataType == jslet.data.DataType.PROXY) {\r\n\t\t\tZ._setProxyPropValue('falseText', falseText);\r\n\t\t} else {\r\n\t\t\tZ._falseText = falseText;\r\n\t\t}\r\n\t\treturn this;\t\t\r\n\t},\r\n\t\r\n\t/**\r\n\t * Get or set if the same field value will be merged.\r\n\t * \r\n\t * @param {Boolean or undefined} mergeSame.\r\n\t * @return {Boolean or this}\r\n\t */\r\n\tmergeSame: function(mergeSame){\r\n\t\tvar Z = this;\r\n\t\tif (mergeSame === undefined) {\r\n\t\t\treturn Z._mergeSame;\r\n\t\t}\r\n\t\tZ._mergeSame = mergeSame ? true: false;\r\n\t\tZ._fireGlobalMetaChangedEvent('mergeSame');\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * Get or set the field names to \"mergeSame\".\r\n\t * Multiple field names are separated by ','.\r\n\t * \r\n\t * @param {String or undefined} mergeSameBy.\r\n\t * @return {String or this}\r\n\t */\r\n\tmergeSameBy: function(mergeSameBy){\r\n\t\tvar Z = this;\r\n\t\tif (mergeSameBy === undefined) {\r\n\t\t\treturn Z._mergeSameBy;\r\n\t\t}\r\n\t\tjslet.Checker.test('Field.mergeSameBy', mergeSameBy).isString();\r\n\t\tZ._mergeSameBy = jQuery.trim(mergeSameBy);\r\n\t\tZ._fireGlobalMetaChangedEvent('mergeSameBy');\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Get or set if the field is following the value which append before.\r\n\t * \r\n\t * @param {Boolean or undefined} valueFollow true - the default value is same as the value which appended before, false -otherwise.\r\n\t * @return {Boolean or this}\r\n\t */\r\n\tvalueFollow: function(valueFollow) {\r\n\t\tvar Z = this;\r\n\t\tif(valueFollow === undefined) {\r\n\t\t\tif(Z._formula) { //Formula field can't set value followed or it will cause unpredictable issue.\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\treturn Z._valueFollow;\r\n\t\t}\r\n\t\tZ._valueFollow = valueFollow? true: false;\r\n\t\tif(!Z._valueFollow && Z._dataset) {\r\n\t\t\tZ._dataset.clearFollowedValues();\r\n\t\t}\r\n\t\tZ._fireGlobalMetaChangedEvent('valueFollow');\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * Get or set if the field is focused or not.\r\n\t * If a field is focused, the input focus will be jumped in them.\r\n\t * \r\n\t * @param {Boolean or undefined} focused true - the field is focused, false -otherwise.\r\n\t * @return {Boolean or this}\r\n\t */\r\n\tfocused: function(focused) {\r\n\t\tvar Z = this;\r\n\t\tif(focused === undefined) {\r\n\t\t\treturn Z._focused;\r\n\t\t}\r\n\t\tZ._focused = focused? true: false;\r\n\t\tif(Z._dataset) {\r\n\t\t\tZ._dataset.calcFocusedFields();\r\n\t\t}\r\n\t\tZ._fireGlobalMetaChangedEvent('focused');\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * Get or set the type of aggraded value.\r\n\t * \r\n\t * @param {String or undefined} aggraded optional value is: count,sum,avg.\r\n\t * @return {String or this}\r\n\t */\r\n\taggraded: function (aggraded) {\r\n\t\tvar Z = this;\r\n\t\tif (aggraded === undefined){\r\n\t\t\treturn Z._aggraded;\r\n\t\t}\r\n\t\t\r\n\t\tZ._aggraded = aggraded? true: false;\r\n\t\tif(Z._dataset) {\r\n\t\t\tZ._dataset.refreshAggradedFields();\r\n\t\t}\r\n\t\tZ._fireGlobalMetaChangedEvent('aggraded');\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * Get or set the field names to aggrade field value. \r\n\t * Multiple field names are separated by ','.\r\n\t * \r\n\t * \r\n\t * @param {String or undefined} aggrBy.\r\n\t * @return {String or this}\r\n\t */\r\n\taggradedBy: function(aggradedBy){\r\n\t\tvar Z = this;\r\n\t\tif (aggradedBy === undefined) {\r\n\t\t\treturn Z._aggradedBy;\r\n\t\t}\r\n\t\tjslet.Checker.test('Field.aggradedBy', aggradedBy).isString();\r\n\t\tZ._aggradedBy = jQuery.trim(aggradedBy);\r\n\t\tZ._fireGlobalMetaChangedEvent('aggradedBy');\r\n\t\treturn this;\r\n\t},\r\n\r\n\tcrossSource: function(crossSource) {\r\n\t\tvar Z = this;\r\n\t\tif(crossSource === undefined) {\r\n\t\t\treturn Z._crossSource;\r\n\t\t}\r\n\t\tjslet.Checker.test('Field.crossSource', crossSource).isClass(jslet.data.CrossFieldSource.className);\r\n\t\tZ._crossSource = crossSource;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Get or set fixed field value, if field value not specified, fixed field value used.\r\n\t * \r\n\t * @param {String or undefined} fixedValue.\r\n\t * @return {String or this}\r\n\t */\r\n\tfixedValue: function(fixedValue){\r\n\t\tvar Z = this;\r\n\t\tif (fixedValue === undefined) {\r\n\t\t\treturn Z._fixedValue;\r\n\t\t}\r\n\t\tjslet.Checker.test('Field.fixedValue', fixedValue).isString();\r\n\t\tZ._fixedValue = jQuery.trim(fixedValue);\r\n\t\tZ._fireGlobalMetaChangedEvent('fixedValue');\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\tgetValue: function(valueIndex) {\r\n\t\treturn this._dataset.getFieldValue(this._fieldName, valueIndex);\r\n\t},\r\n\t\r\n\tsetValue: function(value, valueIndex) {\r\n\t\tthis._dataset.setFieldValue(this._fieldName, value, valueIndex);\r\n\t},\r\n\r\n\tgetTextValue: function(isEditing, valueIndex) {\r\n\t\treturn this._dataset.getFieldText(this._fieldName, isEditing, valueIndex);\r\n\t},\r\n\t\r\n\tsetTextValue: function(inputText, valueIndex) {\r\n\t\tthis._dataset.setFieldText(this._fieldName, inputText, valueIndex);\r\n\t},\r\n\t\r\n\tclone: function(fldName, newDataset){\r\n\t\tvar Z = this;\r\n\t\tjslet.Checker.test('Field.clone#fldName', fldName).required().isString();\r\n\t\tvar result = new jslet.data.Field(fldName, Z._dataType);\r\n\t\tnewDataset = newDataset || this.dataset();\r\n\t\tresult.dataset(newDataset);\r\n\t\tresult.visible(Z._visible);\r\n\t\tif (Z._parent) {\r\n\t\t\tresult.parent(Z._parent.clone(newDataset));\r\n\t\t}\r\n\t\tif (Z._children && Z._children.length > 0){\r\n\t\t\tvar childFlds = [];\r\n\t\t\tfor(var i = 0, cnt = Z._children.length; i < cnt; i++){\r\n\t\t\t\tchildFlds.push(Z._children[i].clone(newDataset));\r\n\t\t\t}\r\n\t\t\tresult.children(childFlds);\r\n\t\t}\r\n\t\t\r\n\t\tresult.length(Z._length);\r\n\t\tresult.scale(Z._scale);\r\n\t\tresult.alignment(Z._alignment);\r\n\t\tresult.defaultExpr(Z._defaultExpr);\r\n\t\tresult.defaultValue(Z._defaultValue);\r\n\t\tresult.label(Z._label);\r\n\t\tresult.displayLabel(Z._displayLabel);\r\n\t\t\r\n\t\tresult.shortName(Z._shortName);\r\n\t\tresult.tip(Z._tip);\r\n\t\tresult.displayWidth(Z._displayWidth);\r\n\t\tif (Z._editMask) {\r\n\t\t\tresult.editMask(Z._editMask.clone());\r\n\t\t}\r\n\t\tresult.displayOrder(Z._displayOrder);\r\n\t\tresult.tabIndex(Z._tabIndex);\r\n\t\tresult.displayFormat(Z._displayFormat);\r\n\t\tresult.formula(Z._formula);\r\n\t\tresult.unique(Z._unique);\r\n\t\tresult.required(Z._required);\r\n\t\tresult.readOnly(Z._readOnly);\r\n\t\tresult.disabled(Z._disabled);\r\n\t\tresult.unitConverted(Z._underted);\r\n\t\tif (Z._lookup) {\r\n\t\t\tresult.lookup(Z._lookup.clone(newDataset.name()));\r\n\t\t}\r\n\t\tif(Z._detailDataset) {\r\n\t\t\tresult.detailDataset(Z._subDataset);\r\n\t\t}\r\n\t\tresult.displayControl(Z._displayControl);\r\n\t\tresult.editControl(Z._editControl);\r\n\t\tresult.urlExpr(Z._urlExpr);\r\n\t\tresult.urlTarget(Z._urlTarget);\r\n\t\tresult.valueStyle(Z._valueStyle);\r\n\t\tresult.valueCountLimit(Z._valueCountLimit);\r\n\t\tresult.nullText(Z._nullText);\r\n\t\tresult.dataRange(Z._dataRange);\r\n\t\tif (Z._regularExpr) {\r\n\t\t\tresult.regularExpr(Z._regularExpr);\r\n\t\t}\r\n\t\tresult.antiXss(Z._antiXss);\r\n\t\tresult.customValidator(Z._customValidator);\r\n\t\tresult.customValueConverter(Z._customValueConverter);\r\n\t\tresult.customValueAccessor(Z._customValueAccessor);\r\n\t\tresult.validChars(Z._validChars);\r\n\t\t\r\n\t\tresult.mergeSame(Z._mergeSame);\r\n\t\tresult.mergeSameBy(Z._mergeSameBy);\r\n\t\tresult.fixedValue(Z._fixedValue);\r\n\t\t\r\n\t\tresult.valueFollow(Z._valueFollow);\r\n\t\tresult.focused(Z._focused);\r\n\t\tresult.aggraded(Z._aggraded);\r\n\t\tresult.aggradedBy(Z._aggradedBy);\r\n\r\n\t\tresult.trueValue(Z._trueValue);\r\n\t\tresult.falseValue(Z._falseValue);\r\n\t\tresult.trueText(Z._trueText);\r\n\t\tresult.falseText(Z._falseText);\r\n\t\tresult._addRelation();\r\n\t\treturn result;\r\n\t},\r\n\t\r\n\t_clearFieldCache: function() {\r\n\t\tvar Z = this;\r\n\t\tif(Z._dataset && Z._fieldName) {\r\n\t\t\tjslet.data.FieldValueCache.clearAll(Z._dataset, Z._fieldName);\r\n\t\t}\r\n\t}\r\n\t\r\n};\r\n\r\njslet.data.Field.URLTARGETBLANK = '_blank';\r\n\r\n/**\r\n * Create field object. Example:\r\n * <pre><code>\r\n * var fldObj = jslet.data.createField({name:'field1', type:'N', label: 'field1 label'});\r\n * </code></pre>\r\n * \r\n * @param {Json Object} fieldConfig A json object which property names are same as jslet.data.Field. Example: {name: 'xx', type: 'N', ...}\r\n * @param {jslet.data.Field} parent Parent field object.\r\n * @return {jslet.data.Field}\r\n */\r\njslet.data.createField = function (fieldConfig, parent) {\r\n\tjslet.Checker.test('createField#fieldConfig', fieldConfig).required().isObject();\r\n\tvar cfg = fieldConfig,\r\n\t\tfldName = cfg.name;\r\n\tif (!fldName) {\r\n\t\tconsole.error(cfg);\r\n\t\tthrow new Error(jslet.formatMessage(jslet.locale.Dataset.fieldNameRequired));\r\n\t}\r\n\tvar dtype = cfg.type || cfg.dataType;\r\n\tif (dtype === null || dtype === undefined) {\r\n\t\tdtype = jslet.data.DataType.STRING;\r\n\t} else {\r\n\t\tdtype = dtype.toUpperCase();\r\n\t\tif (dtype != jslet.data.DataType.STRING && \r\n\t\t\t\tdtype != jslet.data.DataType.NUMBER && \r\n\t\t\t\tdtype != jslet.data.DataType.DATE && \r\n\t\t\t\tdtype != jslet.data.DataType.BOOLEAN && \r\n\t\t\t\tdtype != jslet.data.DataType.CROSS && \r\n\t\t\t\tdtype != jslet.data.DataType.PROXY && \r\n\t\t\t\tdtype != jslet.data.DataType.DATASET)\r\n\t\tdtype = jslet.data.DataType.STRING;\r\n\t}\r\n\t\r\n\tvar fldObj = new jslet.data.Field(cfg.shortName || fldName, dtype);\r\n\t\r\n\tif(fieldConfig.datasetName) {\r\n\t\tfldObj._datasetName = fieldConfig.datasetName;\r\n\t}\r\n\tfunction setPropValue(propName) {\r\n\t\tvar propValue = cfg[propName];\r\n\t\tif (propValue !== undefined) {\r\n\t\t\tfldObj[propName](propValue);\r\n\t\t}\r\n\t}\r\n\t\r\n\tfldObj.parent(parent);\r\n\tif(parent) {\r\n\t\tfldObj.dataset(parent.dataset());\r\n\t}\r\n\t\r\n\tif(cfg.crossSource) {\r\n \t\tvar crossSrc = jslet.data.createCrossFieldSource(cfg.crossSource);\r\n \t\tfldObj.crossSource(crossSrc);\r\n\t}\r\n\tsetPropValue('tabIndex');\r\n\tsetPropValue('displayOrder');\r\n\tsetPropValue('label');\r\n\tsetPropValue('displayLabel');\r\n\tsetPropValue('shortName');\r\n\tsetPropValue('tip');\r\n\r\n\tif(dtype === jslet.data.DataType.PROXY) {\r\n\t\tjslet.Checker.test('Field.proxyHostFieldName', cfg.proxyHostFieldName).required().isString();\r\n\t\tjslet.Checker.test('Field.proxyFieldChanged', cfg.proxyFieldChanged).required().isFunction();\r\n\t\tsetPropValue('proxyHostFieldName');\r\n\t\tsetPropValue('proxyFieldChanged');\r\n\t\treturn fldObj;\r\n\t}\r\n\tif (dtype == jslet.data.DataType.DATASET){\r\n\t\tvar detailDs = cfg.detailDataset || cfg.subDataset || cfg.subdataset;\r\n\t\tif (detailDs) {\r\n\t\t\tfldObj.detailDataset(detailDs);\r\n\t\t} else {\r\n\t\t\tthrow new Error(jslet.formatMessage(jslet.locale.Dataset.invalidDatasetField, [fldName]));\r\n\t\t}\r\n\t\tfldObj.visible(false);\r\n\t\treturn fldObj;\r\n\t}\r\n\t\r\n\tsetPropValue('visible');\r\n\t\r\n\tsetPropValue('unique');\r\n\tsetPropValue('required');\r\n\tsetPropValue('readOnly');\r\n\tsetPropValue('disabled');\r\n\tsetPropValue('length');\r\n\tsetPropValue('scale');\r\n\tsetPropValue('alignment');\r\n\tsetPropValue('formula');\r\n\tsetPropValue('defaultExpr');\r\n\tsetPropValue('defaultValue');\r\n\tsetPropValue('displayWidth');\r\n\tsetPropValue('editMask');\r\n\tsetPropValue('displayFormat');\r\n\tsetPropValue('nullText');\r\n\tsetPropValue('unitConverted');\r\n\tsetPropValue('editControl');\r\n\tsetPropValue('urlExpr');\r\n\tsetPropValue('urlTarget');\r\n\tsetPropValue('valueStyle');\r\n\t\r\n\tsetPropValue('valueCountLimit');\r\n\tsetPropValue('dataRange');\r\n\tsetPropValue('customValidator');\r\n\tsetPropValue('customValueConverter');\r\n\tsetPropValue('customValueAccessor');\r\n\t\r\n\tsetPropValue('trueValue');\r\n\tsetPropValue('falseValue');\r\n\tsetPropValue('mergeSame');\r\n\tsetPropValue('mergeSameBy');\r\n\tsetPropValue('aggraded');\r\n\r\n\tsetPropValue('valueFollow');\r\n\tsetPropValue('focused');\r\n\tsetPropValue('aggradedBy');\r\n\tsetPropValue('mergeSameBy');\r\n\tsetPropValue('fixedValue');\r\n\tsetPropValue('antiXss');\r\n\tsetPropValue('validChars');\r\n\t\r\n\tsetPropValue('trueValue');\r\n\tsetPropValue('falseValue');\r\n\tsetPropValue('trueText');\r\n\tsetPropValue('falseText');\r\n\r\n\tvar regularExpr = cfg.regularExpr;\r\n\tvar regularMessage = cfg.regularMessage;\r\n\tif(regularExpr) {\r\n\t\tfldObj.regularExpr(regularExpr, regularMessage);\r\n\t}\r\n\t\r\n\tvar lkfCfg = cfg.lookup;\r\n\tif(lkfCfg === undefined) {\r\n\t\tvar lkDataset = cfg.lookupSource || cfg.lookupsource || cfg.lookupDataset || cfg.lookupdataset,\r\n\t\t\tlkParam = cfg.lookupParam || cfg.lookupparam,\r\n\t\t\trealDataset = cfg.realSource || cfg.realsource || cfg.realDataset || cfg.realdataset;\r\n\t\tif(lkDataset) {\r\n\t\t\tif(lkParam) {\r\n\t\t\t\tif (jslet.isString(lkParam)) {\r\n\t\t\t\t\tlkfCfg = jslet.JSON.parse(lkParam);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tlkfCfg = lkParam;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tlkfCfg = {};\r\n\t\t\t}\r\n\t\t\tlkfCfg.dataset = lkDataset;\r\n\t\t\tif(realDataset) {\r\n\t\t\t\tlkfCfg.realDataset = realDataset;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tif (lkfCfg !== undefined && lkfCfg) {\r\n\t\tif (jslet.isString(lkfCfg)) {\r\n\t\t\tlkfCfg = lkfCfg.trim();\r\n\t\t\tif(lkfCfg) {\r\n\t\t\t\tif(lkfCfg.trim().startsWith('{')) {\r\n\t\t\t\t\tlkfCfg = jslet.JSON.parse(lkfCfg);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tlkfCfg = {dataset: lkfCfg};\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tfldObj.lookup(jslet.data.createFieldLookup(lkfCfg, fldObj._datasetName));\r\n\t}\r\n\tif (cfg.children){\r\n\t\tvar fldChildren = [], \r\n\t\t\tchildFldObj;\r\n\t\tfor(var i = 0, cnt = cfg.children.length; i < cnt; i++){\r\n\t\t\tchildFldObj = jslet.data.createField(cfg.children[i], fldObj);\r\n\t\t\tchildFldObj.displayOrder(i);\r\n\t\t\tfldChildren.push(childFldObj);\r\n\t\t}\r\n\t\tfldObj.children(fldChildren);\r\n\t\tfldObj.alignment('center');\r\n\t}\r\n\t\r\n\treturn fldObj;\r\n};\r\n\r\n/**\r\n * Create string field object.\r\n * \r\n * @param {String} fldName Field name.\r\n * @param {Integer} length Field length.\r\n * @param {jslet.data.Field} parent (Optional)Parent field object.\r\n * @return {jslet.data.Field}\r\n */\r\njslet.data.createStringField = function(fldName, length, parent) {\r\n\tvar fldObj = new jslet.data.Field(fldName, jslet.data.DataType.STRING, parent);\r\n\tfldObj.length(length);\r\n\treturn fldObj;\r\n};\r\n\r\n/**\r\n * Create number field object.\r\n * \r\n * @param {String} fldName Field name.\r\n * @param {Integer} length Field length.\r\n * @param {Integer} scale Field scale.\r\n * @param {jslet.data.Field} parent (Optional)Parent field object. It must be a 'Group' field.\r\n * @return {jslet.data.Field}\r\n */\r\njslet.data.createNumberField = function(fldName, length, scale, parent) {\r\n\tvar fldObj = new jslet.data.Field(fldName, jslet.data.DataType.NUMBER, parent);\r\n\tfldObj.length(length);\r\n\tfldObj.scale(scale);\r\n\treturn fldObj;\r\n};\r\n\r\n/**\r\n * Create boolean field object.\r\n * \r\n * @param {String} fldName Field name.\r\n * @param {jslet.data.Field} parent (Optional)Parent field object. It must be a 'Group' field.\r\n * @return {jslet.data.Field}\r\n */\r\njslet.data.createBooleanField = function(fldName, parent) {\r\n\treturn new jslet.data.Field(fldName, jslet.data.DataType.BOOLEAN, parent);\r\n};\r\n\r\n/**\r\n * Create date field object.\r\n * \r\n * @param {String} fldName Field name.\r\n * @param {jslet.data.Field} parent (Optional)Parent field object. It must be a 'Group' field.\r\n * @return {jslet.data.Field}\r\n */\r\njslet.data.createDateField = function(fldName, parent) {\r\n\tvar fldObj = new jslet.data.Field(fldName, jslet.data.DataType.DATE, parent);\r\n\treturn fldObj;\r\n};\r\n\r\n/**\r\n * Create dataset field object.\r\n * \r\n * @param {String} fldName Field name.\r\n * @param {jslet.data.Dataset} detailDataset Detail dataset object.\r\n * @param {jslet.data.Field} parent (Optional)Parent field object. It must be a 'Group' field.\r\n * @return {jslet.data.Field}\r\n */\r\njslet.data.createDatasetField = function(fldName, detailDataset, parent) {\r\n\tjslet.Checker.test('createDatasetField#detailDataset', detailDataset).required();\r\n\r\n\tvar fldObj = new jslet.data.Field(fldName, jslet.data.DataType.DATASET, parent);\r\n\tfldObj.detailDataset(detailDataset);\r\n\tfldObj.visible(false);\r\n\treturn fldObj;\r\n};\r\n\r\n/**\r\n * Create group field object.\r\n * \r\n * @param {String} fldName Field name.\r\n * @param {String} fldName Field label.\r\n * @param {jslet.data.Field} parent (Optional)Parent field object. It must be a 'Group' field.\r\n * @return {jslet.data.Field}\r\n */\r\n//jslet.data.createGroupField = function(fldName, label, parent) {\r\n//\tvar fldObj = new jslet.data.Field(fldName, jslet.data.DataType.GROUP, parent);\r\n//\tfldObj.label(label);\r\n//\treturn fldObj;\r\n//};\r\n\r\njslet.data.createCrossField = function(fldName, crossSource, parent) {\r\n\tvar fldObj = new jslet.data.Field(fldName, jslet.data.DataType.CROSS, parent);\r\n\tfldObj.crossSource(crossSource);\r\n};\r\n\r\n/**\r\n * @class FieldLookup\r\n * \r\n * A lookup field represents a field value is from another dataset named \"Lookup Dataset\";\r\n */\r\njslet.data.FieldLookup = function() {\r\n\tvar Z = this;\r\n\tZ._hostDatasetName = null;\r\n\tZ._hostField = null;//The field which contains this lookup field object.\r\n\tZ._dataset = null;\r\n\tZ._realDataset = null;\r\n\tZ._dsParsed = false;\r\n\tZ._keyField = null;\r\n\tZ._codeField = null;\r\n\tZ._nameField = null;\r\n\tZ._codeFormat = null;\r\n\tZ._displayFields = null;\r\n\tZ._innerdisplayFields = null;\r\n\tZ._parentField = null;\r\n\tZ._onlyLeafLevel = true;\r\n\tZ._returnFieldMap = null;\r\n\tZ._editFilter = null;\r\n\tZ._editItemDisabled = false;\r\n};\r\njslet.data.FieldLookup.className = 'jslet.data.FieldLookup';\r\n\r\njslet.data.FieldLookup.prototype = {\r\n\tclassName: jslet.data.FieldLookup.className,\r\n\t\r\n\tclone: function(hostDsName){\r\n\t\tvar Z = this, \r\n\t\t\tresult = new jslet.data.FieldLookup();\r\n\t\tresult._hostDatasetName = hostDsName;\r\n\t\tresult.dataset(Z._dataset);\r\n\t\tresult.keyField(Z._keyField);\r\n\t\tresult.codeField(Z._codeField);\r\n\t\tresult.nameField(Z._nameField);\r\n\t\tresult.displayFields(Z._displayFields);\r\n\t\tresult.parentField(Z._parentField);\r\n\t\tresult.onlyLeafLevel(Z._onlyLeafLevel);\r\n\t\tresult.returnFieldMap(Z._returnFieldMap);\r\n\t\tresult.editFilter(Z._editFilter);\r\n\t\tresult.editItemDisabled(Z._editItemDisabled);\r\n\t\treturn result;\r\n\t},\r\n\t\r\n\thostField: function(fldObj) {\r\n\t\tvar Z = this;\r\n\t\tif (fldObj === undefined) {\r\n\t\t\treturn Z._hostField;\r\n\t\t}\r\n\t\tjslet.Checker.test('FieldLookup.hostField', fldObj).isClass(jslet.data.Field.className);\r\n\t\tZ._hostField = fldObj;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Fire lookup setting changed event.\r\n\t */\r\n\t_fireLookupChangedEvent: function() {\r\n\t\tvar Z = this;\r\n\t\tif(!Z._hostField) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tZ._hostField._fireLookupChangedEvent();\r\n\t},\r\n\r\n\t/**\r\n\t * Get or set lookup dataset.\r\n\t * \r\n\t * @param {jslet.data.Dataset or undefined} dataset Lookup dataset.\r\n\t * @return {jslet.data.Dataset or this}\r\n\t */\r\n\tdataset: function(lkdataset) {\r\n\t\tvar Z = this;\r\n\t\tif (lkdataset === undefined) {\r\n\t\t\tif(!Z._dsParsed) {\r\n\t\t\t\tZ.dataset(Z._dataset);\r\n\t\t\t\tif(!Z._dsParsed) {\r\n\t\t\t\t\tthrow new Error('Not found lookup dataset: ' + Z._dataset);\r\n\t\t\t\t}\t\t\t}\r\n\t\t\t\r\n\t\t\treturn Z._dataset;\r\n\t\t}\r\n\t\tvar lkDsName;\r\n\t\tif(lkdataset) {\r\n\t\t\tif (typeof(lkdataset) == 'string') {\r\n\t\t\t\tlkDsName = lkdataset;\r\n\t\t\t} else {\r\n\t\t\t\tlkDsName = lkdataset.name();\r\n\t\t\t}\r\n\t\t\tif(lkDsName == Z._hostDatasetName) {\r\n\t\t\t\tthrow new Error(jslet.locale.Dataset.LookupDatasetNotSameAsHost);\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar lkDsObj = lkdataset;\r\n\t\tif (typeof(lkDsObj) == 'string') {\r\n\t\t\tlkDsObj = jslet.data.getDataset(lkDsObj);\r\n\t\t\tif(!lkDsObj && jslet.data.onCreatingDataset) {\r\n\t\t\t\tjslet.data.onCreatingDataset(lkdataset, jslet.data.DatasetType.LOOKUP, Z._realDataset, Z._hostDatasetName); //1 - lookup dataset, 2 - detailDataset\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(lkDsObj) {\r\n\t\t\tZ._dataset = lkDsObj;\r\n\t\t\tZ._dataset.autoRefreshHostDataset(true);\r\n\t\t\tZ._dsParsed = true;\r\n\t\t\tZ._fireLookupChangedEvent();\r\n\t\t} else {\r\n\t\t\tZ._dataset = lkdataset;\r\n\t\t\tZ._dsParsed = false;\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * Get or set key field.\r\n\t * Key field is optional, if it is null, it will use LookupDataset.keyField instead. \r\n\t * \r\n\t * @param {String or undefined} keyFldName Key field name.\r\n\t * @return {String or this}\r\n\t */\r\n\trealDataset: function(realDataset) {\r\n\t\tvar Z = this;\r\n\t\tif (realDataset === undefined){\r\n\t\t\treturn Z._realDataset;\r\n\t\t}\r\n\r\n\t\tjslet.Checker.test('FieldLookup.realDataset', realDataset).isString();\r\n\t\tZ._realDataset = realDataset;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Get or set key field.\r\n\t * Key field is optional, if it is null, it will use LookupDataset.keyField instead. \r\n\t * \r\n\t * @param {String or undefined} keyFldName Key field name.\r\n\t * @return {String or this}\r\n\t */\r\n\tkeyField: function(keyFldName) {\r\n\t\tvar Z = this;\r\n\t\tif (keyFldName === undefined){\r\n\t\t\treturn Z._keyField || Z.dataset().keyField();\r\n\t\t}\r\n\r\n\t\tjslet.Checker.test('FieldLookup.keyField', keyFldName).isString();\r\n\t\tZ._keyField = jQuery.trim(keyFldName);\r\n\t\tZ._fireLookupChangedEvent();\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * Get or set code field.\r\n\t * Code field is optional, if it is null, it will use LookupDataset.codeField instead. \r\n\t * \r\n\t * @param {String or undefined} codeFldName Code field name.\r\n\t * @return {String or this}\r\n\t */\r\n\tcodeField: function(codeFldName) {\r\n\t\tvar Z = this;\r\n\t\tif (codeFldName === undefined){\r\n\t\t\treturn Z._codeField || Z.dataset().codeField();\r\n\t\t}\r\n\r\n\t\tjslet.Checker.test('FieldLookup.codeField', codeFldName).isString();\r\n\t\tZ._codeField = jQuery.trim(codeFldName);\r\n\t\tZ._fireLookupChangedEvent();\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\tcodeFormat: function(format) {\r\n\t\tvar Z = this;\r\n\t\tif (format === undefined) {\r\n\t\t\treturn Z._codeFormat;\r\n\t\t}\r\n\r\n\t\tjslet.Checker.test('FieldLookup.codeFormat', format).isString();\r\n\t\tZ._codeFormat = jQuery.trim(format);\r\n\t\tZ._fireLookupChangedEvent();\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * Get or set name field.\r\n\t * Name field is optional, if it is null, it will use LookupDataset.nameField instead. \r\n\t * \r\n\t * @param {String or undefined} nameFldName Name field name.\r\n\t * @return {String or this}\r\n\t */\r\n\tnameField: function(nameFldName) {\r\n\t\tvar Z = this;\r\n\t\tif (nameFldName === undefined){\r\n\t\t\treturn Z._nameField || Z.dataset().nameField();\r\n\t\t}\r\n\r\n\t\tjslet.Checker.test('FieldLookup.nameField', nameFldName).isString();\r\n\t\tZ._nameField = jQuery.trim(nameFldName);\r\n\t\tZ._fireLookupChangedEvent();\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * Get or set parent field.\r\n\t * Parent field is optional, if it is null, it will use LookupDataset.parentField instead. \r\n\t * \r\n\t * @param {String or undefined} parentFldName Parent field name.\r\n\t * @return {String or this}\r\n\t */\r\n\tparentField: function(parentFldName) {\r\n\t\tvar Z = this;\r\n\t\tif (parentFldName === undefined){\r\n\t\t\treturn Z._parentField || Z.dataset().parentField();\r\n\t\t}\r\n\r\n\t\tjslet.Checker.test('FieldLookup.parentField', parentFldName).isString();\r\n\t\tZ._parentField = jQuery.trim(parentFldName);\r\n\t\tZ._fireLookupChangedEvent();\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * An expression for display field value. Example:\r\n\t * <pre><code>\r\n\t * lookupFldObj.displayFields('[code]-[name]'); \r\n\t * </code></pre>\r\n\t */\r\n\tdisplayFields: function(fieldExpr) {\r\n\t\tvar Z = this;\r\n\t\tif (fieldExpr === undefined) {\r\n\t\t\treturn Z._displayFields? Z._displayFields: this.getDefaultDisplayFields();\r\n\t\t}\r\n\t\tjslet.Checker.test('FieldLookup.displayFields', fieldExpr).isString();\r\n\t\tfieldExpr = jQuery.trim(fieldExpr);\r\n\t\tif (Z._displayFields != fieldExpr) {\r\n\t\t\tZ._displayFields = fieldExpr;\r\n\t\t\tZ._innerdisplayFields = null;\r\n\t\t\tif(Z._hostField) {\r\n\t\t\t\tZ._hostField._clearFieldCache();\r\n\t\t\t}\r\n\t\t}\r\n\t\tZ._fireLookupChangedEvent();\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Return extra field values of lookup dataset into main dataset:\r\n\t * <pre><code>\r\n\t * lookupFldObj.returnFieldMap({\"main dataset field name\":\"lookup dataset field name\", ...}); \r\n\t * </code></pre>\r\n\t */\r\n\treturnFieldMap: function(returnFieldMap) {\r\n\t\tif(returnFieldMap === undefined) {\r\n\t\t\treturn this._returnFieldMap;\r\n\t\t}\r\n\t\tjslet.Checker.test('FieldLookup.returnFieldMap', returnFieldMap).isObject();\r\n\t\tthis._returnFieldMap = returnFieldMap;\r\n\t},\r\n\t\r\n\t/**\r\n\t * @private\r\n\t */\r\n\tgetDefaultDisplayFields: function() {\r\n//\t\tvar expr = '[',fldName = this.codeField();\r\n//\t\tif (fldName) {\r\n//\t\t\texpr += fldName + ']';\r\n//\t\t}\r\n//\t\tfldName = this.nameField();\r\n//\r\n//\t\tif (fldName) {\r\n//\t\t\texpr += '+\"-\"+[';\r\n//\t\t\texpr += fldName + ']';\r\n//\t\t}\r\n//\t\tif (expr === '') {\r\n//\t\t\texpr = '\"Not set displayFields\"';\r\n//\t\t}\r\n//\t\t\r\n\t\tvar expr = '[' + (this.nameField() || this.codeField() || this.keyField()) + ']';\r\n\t\treturn expr;\r\n\t},\r\n\r\n\t/**\r\n\t * @private\r\n\t */\r\n\tgetCurrentDisplayValue: function() {\r\n\t\tvar Z = this;\r\n\t\tif (Z._displayFields === null) {\r\n\t\t\tthis.displayFields(this.getDefaultDisplayFields());\r\n\t\t}\r\n\t\tif(!Z._innerdisplayFields) {\r\n\t\t\tZ._innerdisplayFields = new jslet.Expression(Z.dataset(), Z.displayFields());\r\n\t\t}\r\n\t\t\r\n\t\treturn Z._innerdisplayFields.eval();\r\n\t},\r\n\r\n\t/**\r\n\t * Identify whether user can select leaf level item if lookup dataset is a tree-style dataset.\r\n\t * \r\n\t * @param {Boolean or undefined} flag True - Only leaf level item user can selects, false - otherwise.\r\n\t * @return {Boolean or this}\r\n\t */\r\n\tonlyLeafLevel: function(flag) {\r\n\t\tvar Z = this;\r\n\t\tif (flag === undefined) {\r\n\t\t\treturn Z._onlyLeafLevel;\r\n\t\t}\r\n\t\tZ._onlyLeafLevel = flag ? true: false;\r\n\t\tZ._fireLookupChangedEvent();\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * An expression for display field value. Example:\r\n\t * <pre><code>\r\n\t * lookupFldObj.editFilter('like([code], \"101%\" '); \r\n\t * </code></pre>\r\n\t * \r\n\t * @param {String or undefined} flag True - Only leaf level item user can selects, false - otherwise.\r\n\t * @return {String or this}\r\n\t */\r\n\teditFilter: function(editFilter) {\r\n\t\tvar Z = this;\r\n\t\tif (editFilter === undefined) {\r\n\t\t\treturn Z._editFilter;\r\n\t\t}\r\n\t\tjslet.Checker.test('FieldLookup.editFilter', editFilter).isString();\r\n\t\t\r\n\t\tif (Z._editFilter != editFilter) {\r\n\t\t\tZ._editFilter = editFilter;\r\n\t\t}\r\n\t\tZ._fireLookupChangedEvent();\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Disable or hide the edit item which not match the 'editFilter'.\r\n\t * editItemDisabled is true, the non-matched item will be disabled, not hidden.\r\n\t * \r\n\t * @param {Boolean or undefined} editItemDisabled - true: disable edit item, false: hide edit item, default is true.\r\n\t * @return {Boolean or this}\r\n\t */\r\n\teditItemDisabled: function(editItemDisabled) {\r\n\t\tvar Z = this;\r\n\t\tif (editItemDisabled === undefined) {\r\n\t\t\treturn Z._editItemDisabled;\r\n\t\t}\r\n\t\t\r\n\t\tZ._editItemDisabled = editItemDisabled? true: false;\r\n\t\tZ._fireLookupChangedEvent();\r\n\t\treturn this;\r\n\t}\r\n\t\r\n};\r\n\r\n/**\r\n * Create lookup field object.\r\n * \r\n * @param {Json Object} param A json object which property names are same as jslet.data.FieldLookup. Example: {dataset: fooDataset, keyField: 'xxx', ...}\r\n * @return {jslet.data.FieldLookup}\r\n */\r\njslet.data.createFieldLookup = function(param, hostDsName) {\r\n\tjslet.Checker.test('createFieldLookup#param', param).required().isObject();\r\n\tvar lkds = param.dataset;\r\n\tif (!lkds) {\r\n\t\tthrow new Error('Property: dataset required!');\r\n\t}\r\n\tvar lkFldObj = new jslet.data.FieldLookup();\r\n\t\tlkFldObj._hostDatasetName = hostDsName;\r\n\tif (param.realDataset !== undefined) {\r\n\t\tlkFldObj.realDataset(param.realDataset);\r\n\t}\r\n\tlkFldObj.dataset(lkds);\r\n\tif (param.keyField !== undefined) {\r\n\t\tlkFldObj.keyField(param.keyField);\r\n\t}\r\n\tif (param.codeField !== undefined) {\r\n\t\tlkFldObj.codeField(param.codeField);\r\n\t}\r\n\tif (param.nameField !== undefined) {\r\n\t\tlkFldObj.nameField(param.nameField);\r\n\t}\r\n\tif (param.codeFormat !== undefined) {\r\n\t\tlkFldObj.codeFormat(param.codeFormat);\r\n\t}\r\n\tif (param.displayFields !== undefined) {\r\n\t\tlkFldObj.displayFields(param.displayFields);\r\n\t}\r\n\tif (param.parentField !== undefined) {\r\n\t\tlkFldObj.parentField(param.parentField);\r\n\t}\r\n\tif (param.onlyLeafLevel !== undefined) {\r\n\t\tlkFldObj.onlyLeafLevel(param.onlyLeafLevel);\r\n\t}\r\n\tif (param.returnFieldMap !== undefined) {\r\n\t\tlkFldObj.returnFieldMap(param.returnFieldMap);\r\n\t}\r\n\tif (param.editFilter !== undefined) {\r\n\t\tlkFldObj.editFilter(param.editFilter);\r\n\t}\r\n\tif (param.editItemDisabled !== undefined) {\r\n\t\tlkFldObj.editItemDisabled(param.editItemDisabled);\r\n\t}\r\n\t\r\n\treturn lkFldObj;\r\n};\r\n\r\njslet.data.CrossFieldSource = function() {\r\n\tvar Z = this;\r\n\t\r\n\tZ._sourceType = 0; //Optional value: 0-field, 1-custom'\r\n\tZ._sourceField = null;\r\n\tZ._lookupLevel = 1;\r\n\t\r\n\tZ._labels = null;\r\n\tZ._values = null;\r\n\tZ._matchExpr = null;\r\n\t\r\n\tZ._hideEmptyValue = false;\r\n\tZ._hasSubtotal = true;\r\n\tZ._subtotalPosition = 1; //Optional value: 0-first, 1-end\r\n\tZ._subtotalLabel = null;\t\t\r\n};\r\njslet.data.CrossFieldSource.className = 'jslet.data.CrossFieldSource';\r\n\r\njslet.data.CrossFieldSource.prototype = {\r\n\tclassName: jslet.data.CrossFieldSource.className,\r\n\t\r\n\tclone: function(){\r\n\t\tvar Z = this, \r\n\t\t\tresult = new jslet.data.CrossFieldSource();\r\n\t\tresult.sourceType(Z._sourceType);\r\n\t\tresult.sourceField(Z._sourceField);\r\n\t\tresult.lookupLevel(Z._lookupLevel);\r\n\t\tresult.labels(Z._labels);\r\n\t\tresult.values(Z._values);\r\n\t\tresult.matchExpr(Z._matchExpr);\r\n\t\tresult.hideEmptyValue(Z._hideEmptyValue);\r\n\t\tresult.hasSubtotal(Z._hasSubtotal);\r\n\t\tresult.subtotalPosition(Z._subtotalPosition);\r\n\t\tresult.subtotalLabel(Z._subtotalLabel);\r\n\t\treturn result;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Cross source type, optional value: 0 - field, 1 - custom.\r\n\t * \r\n\t * @param {Number or undefined} sourceType Cross source type.\r\n\t * @return {Number or this}\r\n\t */\r\n\tsourceType: function(sourceType) {\r\n\t\tvar Z = this;\r\n\t\tif (sourceType === undefined) {\r\n\t\t\treturn Z._sourceType;\r\n\t\t}\r\n\t\tjslet.Checker.test('CrossFieldSource.sourceType', sourceType).isNumber();\r\n\t\tZ._sourceType = sourceType;\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * Identify the field name which is used to create cross field. Avaliable when crossType is 0-Field.\r\n\t * sourceField must be a lookup field and required. \r\n\t * \r\n\t * @param {String or undefined} sourceField The field name which is used to create cross field.\r\n\t * @return {String or this}\r\n\t */\r\n\tsourceField: function(sourceField) {\r\n\t\tvar Z = this;\r\n\t\tif (sourceField === undefined) {\r\n\t\t\treturn Z._sourceField;\r\n\t\t}\r\n\t\tjslet.Checker.test('CrossFieldSource.sourceField', sourceField).isString();\r\n\t\tZ._sourceField = sourceField;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Identify cross field labels. Avaliable when crossType is 1-Field.\r\n\t * If labels is null, use \"values\" as \"labels\" instead.\r\n\t * \r\n\t * @param {String[] or undefined} labels The cross field labels.\r\n\t * @return {String[] or this}\r\n\t */\r\n\tlabels: function(labels) {\r\n\t\tvar Z = this;\r\n\t\tif (labels === undefined) {\r\n\t\t\treturn Z._labels;\r\n\t\t}\r\n\t\tjslet.Checker.test('CrossFieldSource.labels', labels).isArray();\r\n\t\tZ._labels = labels;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Identify cross field cross values. Avaliable when crossType is 1-Field.\r\n\t * If crossType is 1-Field, \"values\" is reqired.\r\n\t * \r\n\t * @param {Object[] or undefined} values The cross field source values.\r\n\t * @return {Object[] or this}\r\n\t */\r\n\tvalues: function(values) {\r\n\t\tvar Z = this;\r\n\t\tif (values === undefined) {\r\n\t\t\treturn Z._values;\r\n\t\t}\r\n\t\tjslet.Checker.test('CrossFieldSource.values', values).isArray();\r\n\t\tZ._values = values;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Identify the field name which is used to create cross field. Avaliable when crossType is 1-Custom.\r\n\t * If crossType is 1-Custom, matchExpr is required. \r\n\t * \r\n\t * @param {String or undefined} matchExpr The expression which use to match value.\r\n\t * @return {String or this}\r\n\t */\r\n\tmatchExpr: function(matchExpr) {\r\n\t\tvar Z = this;\r\n\t\tif (matchExpr === undefined) {\r\n\t\t\treturn Z._matchExpr;\r\n\t\t}\r\n\t\tjslet.Checker.test('CrossFieldSource.matchExpr', matchExpr).isString();\r\n\t\tZ._matchExpr = matchExpr;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Identify it has subtotal column or not.\r\n\t * \r\n\t * @param {Boolean or undefined} hasSubtotal True - has subtotal, false otherwise.\r\n\t * @return {Boolean or this}\r\n\t */\r\n\thasSubtotal: function(hasSubtotal) {\r\n\t\tvar Z = this;\r\n\t\tif (hasSubtotal === undefined) {\r\n\t\t\treturn Z._hasSubtotal;\r\n\t\t}\r\n\t\tjslet.Checker.test('CrossFieldSource.hasSubtotal', hasSubtotal).isString();\r\n\t\tZ._hasSubtotal = hasSubtotal;\r\n\t\treturn this;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Identify the \"subtotal\" column position. Avaliable when \"hasSubtotal\" is true;\r\n\t * Optional Value: 0 - At first column, 1 - At last column.\r\n\t * \r\n\t * @param {Number or undefined} subtotalPosition subtotal column position.\r\n\t * @return {Number or this}\r\n\t */\r\n\tsubtotalPosition: function(subtotalPosition) {\r\n\t\tvar Z = this;\r\n\t\tif (subtotalPosition === undefined) {\r\n\t\t\treturn Z._subtotalPosition;\r\n\t\t}\r\n\t\tjslet.Checker.test('CrossFieldSource.subtotalPosition', subtotalPosition).isNumber();\r\n\t\tZ._subtotalPosition = subtotalPosition;\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * Subtotal label. Avaliable when \"hasSubtotal\" is true;\r\n\t * \r\n\t * @param {String or undefined} subtotalLabel Subtotal label.\r\n\t * @return {String or this}\r\n\t */\r\n\tsubtotalLabel: function(subtotalLabel) {\r\n\t\tvar Z = this;\r\n\t\tif (subtotalLabel === undefined) {\r\n\t\t\treturn Z._subtotalLabel;\r\n\t\t}\r\n\t\tjslet.Checker.test('CrossFieldSource.subtotalLabel', subtotalLabel).isString();\r\n\t\tZ._subtotalLabel = subtotalLabel;\r\n\t\treturn this;\r\n\t}\r\n};\r\n\r\njslet.data.createCrossFieldSource = function(cfg) {\r\n\tvar result = new jslet.data.CrossFieldSource();\r\n\tvar srcType = cfg.sourceType || 0;\r\n\tresult.sourceType(srcType);\r\n\tif(cfg.hasSubtotal !== undefined) {\r\n\t\tresult.hasSubtotal(cfg.hasSubtotal);\r\n\t}\r\n\t\r\n\tif(cfg.subtotalPosition !== undefined) {\r\n\t\tresult.subtotalPosition(cfg.subtotalPosition);\r\n\t}\r\n\t\r\n\tif(cfg.subtotalLabel !== undefined) {\r\n\t\tresult.subtotalLabel(cfg.subtotalLabel);\r\n\t}\r\n\t\r\n\tif(srcType === 0) {\r\n\t\tresult.sourceField(cfg.sourceField);\r\n\t} else {\r\n\t\tresult.labels(cfg.labels);\r\n\t\tresult.values(cfg.values);\r\n\t\tresult.matchExpr(cfg.matchExpr);\r\n\t}\r\n\treturn result;\r\n};\r\n\n/*!\r\n * Jslet Javascript Framework v4.0.0\r\n * https://github.com/jslet/jslet/\r\n *\r\n * Copyright 2016 Jslet Team and other contributors\r\n * Released under the MIT license\r\n */\r\n\r\n\"use strict\";\r\njslet.data.FilterDataset = function(hostDataset) {\r\n\tif(!jslet.data.getDataset('ds_logical_opr_')) {\r\n\t\tvar dsObj = jslet.data.createEnumDataset('ds_logical_opr_', {'and': jslet.locale.FilterDataset.and, 'or': jslet.locale.FilterDataset.or});\r\n\t\tdsObj.isFireGlobalEvent(false);\r\n\t}\r\n\t\r\n\tif(!jslet.data.getDataset('ds_operator_')) {\r\n\t\tvar fldCfg = [{name: 'code', type: 'S', length: 10, label:'code'},\r\n\t                  {name: 'name', type: 'S', length: 30, label:'name'},\r\n\t                  {name: 'range', type: 'S', length: 30, label:'range'}];\r\n\t\t\r\n\t\tvar dsOperator = jslet.data.createDataset('ds_operator_', fldCfg, \r\n\t\t\t\t{keyField: 'code', codeField: 'code', nameField: 'name', autoRefreshHostDataset: true, isFireGlobalEvent: false});\r\n\t\tdsOperator.dataList([{code: '==', name: jslet.locale.FilterDataset.equal, range: 'NDSB'},\r\n\t\t                     {code: '!=', name: jslet.locale.FilterDataset.notEqual, range: 'NDS'},\r\n\t\t                     {code: '>', name: jslet.locale.FilterDataset.greatThan, range: 'ND'},\r\n\t\t                     {code: '>=', name: jslet.locale.FilterDataset.greatThanAndEqual, range: 'ND'},\r\n\t\t                     {code: '<', name: jslet.locale.FilterDataset.lessThan, range: 'ND'},\r\n\t\t                     {code: '<=', name: jslet.locale.FilterDataset.lessThanAndEqual, range: 'ND'},\r\n\t\t                     \r\n\t\t                     {code: 'likeany', name: jslet.locale.FilterDataset.likeany, range: 'S'},\r\n\t\t                     {code: 'likefirst', name: jslet.locale.FilterDataset.likefirst, range: 'S'},\r\n\t\t                     {code: 'likelast', name: jslet.locale.FilterDataset.likelast, range: 'S'},\r\n\t\t                     {code: 'between', name: jslet.locale.FilterDataset.between, range: 'NDS'},\r\n\t\r\n\t\t                     {code: 'select', name: jslet.locale.FilterDataset.select, range: 'LH'},\r\n\t\t                     {code: 'selfchildren0', name: jslet.locale.FilterDataset.selfchildren0, range: 'H'},\r\n\t\t                     {code: 'children0', name: jslet.locale.FilterDataset.children0, range: 'H'},\r\n\t\t                     {code: 'selfchildren1', name: jslet.locale.FilterDataset.selfchildren1, range: 'H'},\r\n\t\t                     {code: 'children1', name: jslet.locale.FilterDataset.children1, range: 'H'}\r\n\t\t                     ]);\r\n\t}\r\n\tthis._hostDataset = hostDataset;\r\n\tthis._filterDataset = null;\r\n\tthis._varValues = null;\r\n};\r\n\r\njslet.data.FilterDataset.prototype = {\r\n\t/**\r\n\t * Get filter dataset, if not found, generate it.\r\n\t * \r\n\t * @return {jslet.data.Dataset}\r\n\t */\r\n\tfilterDataset: function() {\r\n\t\tvar Z = this;\r\n\t\tif(Z._filterDataset) {\r\n\t\t\treturn Z._filterDataset;\r\n\t\t}\r\n\t\t\r\n\t\tvar id =  jslet.nextId();\r\n\t\tvar fldCfg = [\r\n            {name: 'name', type: 'S', length: 30, label: 'Field Code'}, \r\n            {name: 'label', type: 'S', length: 50, label: 'Field Name'}, \r\n            {name: 'dataType', type: 'S', length: 2, label: 'Data Type'}, \r\n            {name: 'parentName', type: 'S', length: 30, label: 'Parent Field Code'}, \r\n\t\t];\r\n\t\tvar dsFields = jslet.data.createDataset('ds_fields_' + id, fldCfg, \r\n\t\t\t\t{keyField: 'name', codeField: 'name', nameField: 'label', parentField: 'parentName', autoRefreshHostDataset: true, isFireGlobalEvent: false});\r\n\t\t\r\n\t\tvar fieldLabels = [];\r\n\t\tZ._appendFields(Z._hostDataset, fieldLabels);\r\n\t\tdsFields.dataList(fieldLabels);\r\n\t\t\r\n\t\tfunction doProxyFieldChanged(dataRec, proxyFldName, proxyFldObj) {\r\n\t\t\tvar hostFldObj = jslet.data.getDataset(Z._hostDataset).getField(proxyFldName);\r\n\t\t\tproxyFldObj.dataType(hostFldObj.dataType());\r\n\t\t\tproxyFldObj.length(hostFldObj.length());\r\n\t\t\tproxyFldObj.scale(hostFldObj.scale());\r\n\t\t\tproxyFldObj.editMask(hostFldObj.editMask());\r\n\r\n\t\t\tproxyFldObj.displayFormat(hostFldObj.displayFormat());\r\n\t\t\tproxyFldObj.dateFormat(hostFldObj.dateFormat());\r\n\t\t\tproxyFldObj.displayControl(hostFldObj.displayControl());\r\n\t\t\tproxyFldObj.validChars(hostFldObj.validChars());\r\n\t\t\tif(hostFldObj.lookup()) {\r\n\t\t\t\tvar hostLkObj = hostFldObj.lookup();\r\n\t\t\t\tvar lkObj = new jslet.data.FieldLookup();\r\n\t\t\t\tlkObj.dataset(hostLkObj.dataset());\r\n\t\t\t\tlkObj.keyField(hostLkObj.keyField());\r\n\t\t\t\tlkObj.codeField(hostLkObj.codeField());\r\n\t\t\t\tlkObj.nameField(hostLkObj.nameField());\r\n\t\t\t\tlkObj.displayFields(hostLkObj.displayFields());\r\n\t\t\t\tlkObj.parentField(hostLkObj.parentField());\r\n\t\t\t\tlkObj.onlyLeafLevel(false);\r\n\t\t\t\tproxyFldObj.lookup(lkObj);\r\n\t\t\t\tproxyFldObj.editControl('DBComboSelect');\r\n\t\t\t} else {\r\n\t\t\t\tproxyFldObj.lookup(null);\r\n\t\t\t\tvar editorObj = hostFldObj.editControl();\r\n\t\t\t\tif(jslet.compareValue(editorObj.type,'DBTextArea') === 0) {\r\n\t\t\t\t\teditorObj = {type: 'DBText'};\r\n\t\t\t\t}\r\n\t\t\t\tproxyFldObj.editControl(editorObj);\r\n\t\t\t}\r\n\t\t\tvar operator = dataRec.operator;\r\n\t\t\tvar valueStyle = jslet.data.FieldValueStyle.NORMAL;\r\n\t\t\tif(operator == 'between') {\r\n\t\t\t\tvalueStyle = jslet.data.FieldValueStyle.BETWEEN;\r\n\t\t\t} else if(operator == 'select') {\r\n\t\t\t\tvalueStyle = jslet.data.FieldValueStyle.MULTIPLE;\r\n\t\t\t}\r\n\t\t\tproxyFldObj.valueStyle(valueStyle);\r\n\t\t}\r\n\t\t\r\n\t\tvar filterFldCfg = [ \r\n             {name: 'lParenthesis', type: 'S', length: 10, label: jslet.locale.FilterDataset.lParenthesis, validChars:'(', tabIndex: 90980}, \r\n\t         {name: 'hostField', type: 'S', length: 30, label: 'Host Field', visible: false},\r\n\t         {name: 'field', type: 'S', length: 200, displayWidth:30, label: jslet.locale.FilterDataset.field, tabIndex: 90981, \r\n\t        \t lookup: {dataset: dsFields, onlyLeafLevel: false}, editControl: {type: 'DBComboSelect', textReadOnly: true}, required: true},\r\n\t         {name: 'dataType', type: 'S', length: 10, label: jslet.locale.FilterDataset.dataType, visible: false},\r\n\t         {name: 'operator', type: 'S',length: 50, displayWidth:20, label: jslet.locale.FilterDataset.operator, \r\n\t        \t lookup: {dataset:\"ds_operator_\"}, required: true, tabIndex: 90982},\r\n\t         {name: 'value', type: 'P', length: 200, displayWidth:30, label: jslet.locale.FilterDataset.value, tabIndex: 90983, \r\n\t        \t\t proxyHostFieldName: 'field', proxyFieldChanged: doProxyFieldChanged, visible: false},\r\n\t         {name: 'valueExpr', type: 'S', length: 30, visible: false},\r\n\t         {name: 'valueExprInput', type: 'S', length: 2, label: ' ', readOnly: true, visible: false,\r\n\t        \t fixedValue: '<button class=\"btn btn-defualt btn-xs\">...</button>', tabIndex: 90984},\r\n             {name: 'rParenthesis', type: 'S', length: 10, label: jslet.locale.FilterDataset.rParenthesis, validChars:')', tabIndex: 90985}, \r\n             {name: 'logicalOpr', type: 'S', length: 10, label: jslet.locale.FilterDataset.logicalOpr, \r\n            \t lookup: {dataset:\"ds_logical_opr_\"}, required: true, defaultValue: 'and', tabIndex: 90986} \r\n\t\t];\r\n\t\tvar dsFilter = jslet.data.createDataset('dsFilter_' + id, filterFldCfg, {isFireGlobalEvent: false});\r\n\t\tvar rule1 = {condition: '[field]', rules: [{field: 'value', customized: function(fldObj, changingFldName){\r\n\t\t\tvar fldName = dsFilter.getFieldValue('field');\r\n\t\t\tif(!fldName) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tvar valueFldObj = dsFilter.getField('value', true);\r\n\t\t\tvar hostFldObj = jslet.data.getDataset(Z._hostDataset).getField(fldName), \r\n\t\t\t\tfldType;\r\n\t\t\tif(hostFldObj) {\r\n\t\t\t\tvar lkObj = hostFldObj.lookup();\r\n\t\t\t\tif(lkObj) {\r\n\t\t\t\t\tfldType = (lkObj.dataset().parentField()) ? 'H': 'L';\r\n\t\t\t\t} else {\r\n\t\t\t\t\tfldType = hostFldObj.getType();\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t} else {\r\n\t\t\t\tfldType = dsFields.getFieldValue('dataType');\r\n\t\t\t}\r\n\t\t\tif(changingFldName) {\r\n\t\t\t\tdsFilter.setFieldValue('dataType', fldType);\r\n\t\t\t}\r\n\t\t\t}}\r\n\t\t]};\r\n\t\t\r\n\t\tvar rule2 = {\r\n\t\t\tcondition: '[dataType]',\r\n\t\t\trules: [{field: 'operator', customized: function(fldObj, changingFldName){\r\n\t\t\t\tvar dataType = dsFilter.getFieldValue('dataType');\r\n\t\t\t\tif(!dataType) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tfldObj = dsFilter.getField('operator');\r\n\t\t\t\tvar lkDs = fldObj.lookup().dataset();\r\n\t\t\t\tlkDs.filter('[range].indexOf(\"' + dataType + '\") >= 0');\r\n\t\t\t\tlkDs.filtered(true);\r\n\t\t\t\tlkDs.first();\r\n\t\t\t\tif(changingFldName) {\r\n\t\t\t\t\tvar firstValue = lkDs.getFieldValue('code');\r\n\t\t\t\t\tdsFilter.setFieldValue('operator', firstValue);\r\n\t\t\t\t}\r\n\t\t\t\t}}\r\n\t\t\t]};\r\n\r\n\t\tvar rule3 = {condition: '[operator]', rules: [{field: 'value', customized: function(fldObj, changingFldName){\r\n\t\t\tif(!changingFldName) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tvar oldValueStyle = dsFilter.getField('value').valueStyle();\r\n\t\t\tvar operator = dsFilter.getFieldValue('operator');\r\n\t\t\tvar valueStyle = jslet.data.FieldValueStyle.NORMAL;\r\n\t\t\tif(operator == 'between') {\r\n\t\t\t\tvalueStyle = jslet.data.FieldValueStyle.BETWEEN;\r\n\t\t\t} else if(operator == 'select') {\r\n\t\t\t\tvalueStyle = jslet.data.FieldValueStyle.MULTIPLE;\r\n\t\t\t}\r\n\t\t\tif(oldValueStyle != valueStyle) {\r\n\t\t\t\tfldObj.valueStyle(valueStyle);\r\n\t\t\t}\r\n\t\t\t}}\r\n\t\t]};\r\n\t\t\r\n\t\tdsFilter.contextRules([rule1, rule2, rule3]);\r\n\t\tdsFilter.enableContextRule();\r\n\t\tdsFilter.onFieldChanged(function(fldName, fldValue) {\r\n\t\t\tif(fldName == 'field' || fldName == 'operator') {\r\n\t\t\t\tthis.setFieldValue('value', null);\r\n\t\t\t\tthis.focusEditControl('value');\r\n\t\t\t}\r\n\t\t});\r\n\t\tthis._filterDataset = dsFilter;\r\n\t\treturn dsFilter;\r\n\r\n\t},\r\n\t\r\n\t/**\r\n\t * Get filter expression text.\r\n\t * \r\n\t * @return {String} Filter expression text.\r\n\t */\r\n\tgetFilterExprText: function() {\r\n\t\tvar Z = this,\r\n\t\t\tdsFilter = Z._filterDataset;\r\n\t\tif(!dsFilter || dsFilter.recordCount() === 0) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\tthis.validate();\r\n\t\tvar result = '', recno,\r\n\t\t\tlastRecno = dsFilter.recordCount() - 1;\r\n\t\t\r\n\t\tdsFilter.iterate(function() {\r\n\t\t\trecno = this.recno();\r\n\t\t\tresult += this.getFieldValue('lParenthesis') || '';\r\n\t\t\tresult += this.getFieldText('field') + ' ';\r\n\t\t\tresult += this.getFieldText('operator') + ' ';\r\n\t\t\tresult += this.getFieldText('value');\r\n\t\t\tresult += this.getFieldText('valueExpr');\r\n\t\t\tresult += this.getFieldValue('rParenthesis') || '';\r\n\t\t\tif(recno != lastRecno) {\r\n\t\t\t\tresult += ' ' + this.getFieldText('logicalOpr') + ' ';\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn result;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Get filter expression.\r\n\t * \r\n\t * @return {String} Filter expression.\r\n\t */\r\n\tgetFilterExpr: function() {\r\n\t\tvar Z = this,\r\n\t\t\tdsFilter = Z._filterDataset;\r\n\t\tif(!dsFilter || dsFilter.recordCount() === 0) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\tthis.validate();\r\n\t\tvar result = '', recno,\r\n\t\t\tlastRecno = dsFilter.recordCount() - 1;\r\n\t\t\r\n\t\tdsFilter.iterate(function() {\r\n\t\t\trecno = this.recno();\r\n\t\t\tvar dataType = this.getFieldValue('dataType');\r\n\t\t\tresult += this.getFieldValue('lParenthesis') || '';\r\n\t\t\t\r\n\t\t\tresult += Z._getFieldFilter(this);\r\n\t\t\tresult += this.getFieldValue('rParenthesis') || '';\r\n\t\t\tif(recno != lastRecno) {\r\n\t\t\t\tresult += ' ' + (this.getFieldValue('logicalOpr') == 'or' ?  '||': '&&') + ' ';\r\n\t\t\t}\r\n\t\t\t\r\n\t\t});\r\n\t\treturn result;\r\n\t},\r\n\t\r\n\t_appendFields: function(hostDataset, fieldLabels, hostFldName, hostFldLabel) {\r\n\t\tvar fields = jslet.data.getDataset(hostDataset).getNormalFields(),\r\n\t\t\tfldObj;\r\n\t\tfor(var i = 0, len = fields.length; i < len; i++) {\r\n\t\t\tfldObj = fields[i];\r\n\t\t\t//Hidden fields, fixed value fields and dataset fieldS do not need to filter.\r\n\t\t\tif(!fldObj.visible() || fldObj.fixedValue() || fldObj.getType() === jslet.data.Dataset.DATASET) { \r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tvar fldCode = fldObj.name(),\r\n\t\t\t\tfldLabel = fldObj.label(),\r\n\t\t\t\tfldDataType = fldObj.getType();\r\n\t\t\tif(hostFldName) {\r\n\t\t\t\tfldCode = hostFldName + '.' + fldCode;\r\n\t\t\t\tfldLabel = hostFldLabel + '.' + fldLabel;\r\n\t\t\t}\r\n\t\t\tvar fldCfg = {name: fldCode, label: fldLabel, dataType: fldDataType};\r\n\t\t\tif(hostFldName) {\r\n\t\t\t\tfldCfg.parentName = hostFldName;\r\n\t\t\t}\r\n\t\t\tfieldLabels.push(fldCfg);\r\n\t\t\tif(fldDataType === jslet.data.DataType.DATE) {\r\n\t\t\t\tfieldLabels.push({name: fldCode + '.Y', label: fldLabel + '.' + jslet.locale.FilterDataset.year, dataType: 'N', parentName: fldCode});\r\n\t\t\t\tfieldLabels.push({name: fldCode + '.M', label: fldLabel + '.' + jslet.locale.FilterDataset.month, dataType: 'N', parentName: fldCode});\r\n\t\t\t\tfieldLabels.push({name: fldCode + '.YM', label: fldLabel + '.' + jslet.locale.FilterDataset.yearMonth, dataType: 'N', parentName: fldCode});\r\n\t\t\t}\r\n\t\t\tvar lkObj = fldObj.lookup();\r\n\t\t\tif(lkObj) {\r\n\t\t\t\tthis._appendFields(lkObj.dataset(), fieldLabels, fldCode, fldLabel);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t_getFieldFilter: function(dsFilter) {\r\n\t\tvar\tfldName = dsFilter.getFieldValue('field'),\r\n\t\t\tdataType = dsFilter.getFieldValue('dataType'),\r\n\t\t\toperator = dsFilter.getFieldValue('operator'),\r\n\t\t\tvalue = dsFilter.getFieldValue('value'),\r\n\t\t\tvalueExpr = dsFilter.getFieldValue('valueExpr'),\r\n\t\t\tresult = '';\r\n\t\t//Boolean value\r\n\t\tif(dataType == 'B') { \r\n\t\t\tresult =  '[' + fldName + ']';\r\n\t\t\tif(!value) {\r\n\t\t\t\tresult =  '!' + result;\r\n\t\t\t}\r\n\t\t\treturn result;\r\n\t\t}\r\n\t\tvar fldNameStr = '[' + fldName + ']';\r\n\t\t//Extend date field\r\n\t\tif(dataType === 'N') {\r\n\t\t\tif(fldName.endsWith('.Y')) {\r\n\t\t\t\tfldNameStr = '[' + fldName.substring(0, fldName.length - 2) + ']';\r\n\t\t\t\tfldNameStr = 'jslet.getYear(' + fldNameStr + ')';\r\n\t\t\t} else\tif(fldName.endsWith('.M')) {\r\n\t\t\t\tfldNameStr = '[' + fldName.substring(0, fldName.length - 2) + ']';\r\n\t\t\t\tfldNameStr = 'jslet.getMonth(' + fldNameStr + ')';\r\n\t\t\t} else if(fldName.endsWith('.YM')) {\r\n\t\t\t\tfldNameStr = '[' + fldName.substring(0, fldName.length - 3) + ']';\r\n\t\t\t\tfldNameStr = 'jslet.getYearMonth(' + fldNameStr + ')';\r\n\t\t\t}\r\n\t\t}\r\n\t\tfunction getValue(dataType, value) {\r\n\t\t\tif(dataType === 'D') {\r\n\t\t\t\treturn 'new Date(' + value.getTime() + ')';\r\n\t\t\t}\r\n\t\t\tif(dataType === 'S') {\r\n\t\t\t\treturn '\"' + value + '\"';\r\n\t\t\t}\r\n\t\t\treturn value;\r\n\t\t}\r\n\t\t//Operator: ==, !=, >, >=, <, <=\r\n\t\tif(operator == '==' || operator == '!=' ||\r\n\t\t   operator == '>' || operator == '>=' || \r\n\t\t   operator == '<' || operator == '<=') {\r\n\t\t\tresult = 'jslet.compareValue(' + fldNameStr + ', ' + getValue(dataType, value) + ')';\r\n\t\t\tresult += operator + '0';\r\n\t\t\treturn result;\r\n\t\t}\r\n\t\t//Operator: between\r\n\t\tif(operator == 'between') {\r\n\t\t\tvar value1 = value[0], value2 = null;\r\n\t\t\tif(value.length > 1) {\r\n\t\t\t\tvalue2 = value[1];\r\n\t\t\t}\r\n\t\t\tif(value1 !== null && value1 !== undefined) {\r\n\t\t\t\tresult += 'jslet.compareValue(' + fldNameStr + ', ' + getValue(dataType, value1) + ') >=0';\r\n\t\t\t}\r\n\t\t\tif(value2 !== null && value2 !== undefined) {\r\n\t\t\t\tif(result.length > 0) {\r\n\t\t\t\t\tresult += ' && ';\r\n\t\t\t\t}\r\n\t\t\t\tresult += 'jslet.compareValue(' + fldNameStr + ', ' + getValue(dataType, value2) + ') <=0';\r\n\t\t\t}\r\n\t\t\treturn '(' + result + ')';\r\n\t\t}\r\n\t\t//Operator: likeany, likefirst, likelast\r\n\t\tif(operator == 'likeany' || operator == 'likefirst' || operator == 'likelast') {\r\n\t\t\tresult = 'like(' + fldNameStr + ', \"';\r\n\t\t\tif(operator == 'likeany' || operator == 'likelast') {\r\n\t\t\t\tresult += '%';\r\n\t\t\t}\r\n\t\t\tresult += value;\r\n\t\t\tif(operator == 'likeany' || operator == 'likefirst') {\r\n\t\t\t\tresult += '%';\r\n\t\t\t}\r\n\t\t\tresult += '\")';\r\n\t\t\treturn result;\r\n\t\t}\r\n\t\t//Operator: select\r\n\t\tif(operator == 'select') {\r\n\t\t\tdataType = this._hostDataset.getField(fldName).getType();\r\n\t\t\tresult = 'inlist(' + fldNameStr ; \r\n\t\t\tfor(var i = 0, len = value.length; i < len; i++) {\r\n\t\t\t\tresult += ',' + getValue(dataType, value[i]);\r\n\t\t\t}\r\n\t\t\tresult += ')';\r\n\t\t\treturn result;\r\n\t\t}\r\n\t\t//Operator: selfchildren0, children0, selfchildren1, children1\r\n\t\tif(operator == 'selfchildren0' || operator == 'children0' || \r\n\t\t\toperator == 'selfchildren1' || operator == 'children1') {\r\n\t\t\tvar funcStr = 'inChildren';\r\n\t\t\tif(operator == 'selfchildren0' || operator == 'selfchildren1') {\r\n\t\t\t\tfuncStr = 'inChildrenAndSelf';\r\n\t\t\t} else {\r\n\t\t\t\tresult = 'inChildren';\r\n\t\t\t}\r\n\t\t\tdataType = this._hostDataset.getField(fldName).getType();\r\n\t\t\tresult = funcStr + '(\"' + fldName + '\", ' + getValue(dataType, value) + ',';\r\n\t\t\tif(operator == 'selfchildren0' || operator == 'children0') {\r\n\t\t\t\tresult += 'false)';\r\n\t\t\t} else {\r\n\t\t\t\tresult += 'true)';\r\n\t\t\t}\r\n\t\t\treturn result;\r\n\t\t}\r\n\t\treturn result;\r\n\t},\r\n\t\r\n\t_getFilterValue: function(dsFilter) {\r\n\t\treturn dsFilter.getFieldValue('value');\r\n\t},\r\n\t\r\n\tvalidate: function() {\r\n\t\tvar dsFilter = this._filterDataset,\r\n\t\t\tparenthesisCount = 0,\r\n\t\t\terrMsg = null;\r\n\t\tdsFilter.iterate(function() {\r\n\t\t\tparenthesisCount = (this.getFieldValue('lParenthesis') || '').length - (this.getFieldValue('rParenthesis') || '').length;\r\n\t\t\tif(this.getFieldValue('value') === null && this.getFieldValue('valueExpr') === null) {\r\n\t\t\t\terrMsg = jslet.locale.FilterDataset.valueRequired;\r\n\t\t\t\treturn true; //Exists invalidate record, break iterating.\r\n\t\t\t}\r\n\t\t});\r\n\t\tif(!errMsg && parenthesisCount !== 0) {\r\n\t\t\terrMsg = jslet.locale.FilterDataset.parenthesisNotMatched;\r\n\t\t}\r\n\t\tif(errMsg) {\r\n\t\t\tconsole.error(errMsg);\r\n\t\t}\r\n\t\treturn errMsg;\r\n\t},\r\n\t\r\n\tdestroy: function() {\r\n\t\tvar lkdsField = this._filterDataset.getField('field').lookup().dataset();\r\n\t\tthis._filterDataset.destroy();\r\n\t\tlkdsField.destroy();\r\n\t}\r\n};\n/*!\r\n * Jslet Javascript Framework v4.0.0\r\n * https://github.com/jslet/jslet/\r\n *\r\n * Copyright 2016 Jslet Team and other contributors\r\n * Released under the MIT license\r\n */\r\n\r\n\"use strict\";\r\nif (!jslet.data) {\r\n\tjslet.data = {};\r\n}\r\n\r\n/**\r\n * @static\r\n * @private\r\n * \r\n */\r\njslet.data.ApplyAction = {QUERY: 'query', SAVE: 'save', SELECTED: 'selected'};\r\n\r\n/**\r\n * @class jslet.data.DataProvider\r\n * \r\n * @required\r\n */\r\njslet.data.DataProvider = function() {\r\n\t\r\n\t/**\r\n\t * @param dataset jslet.data.Dataset;\r\n\t * @param url String the request url;\r\n\t * @param reqData String the request data which need to send to server.\r\n\t */\r\n\tthis.sendRequest = function(dataset, url, reqData) {\r\n\t\tvar settings;\r\n\t\tif(jslet.global.beforeSubmit) {\r\n\t\t\tsettings = jslet.global.beforeSubmit({url: url});\r\n\t\t}\r\n\t\tif(!settings) {\r\n\t\t\tsettings = {};\r\n\t\t}\r\n\t\tsettings.type = 'POST';\r\n\t\tsettings.contentType = 'application/json';\r\n\t\tsettings.mimeType = 'application/json';\r\n\t\tsettings.dataType = 'json';\r\n\t\tsettings.data = reqData;\r\n\t\tsettings.context = dataset;\r\n\t\tif(dataset.csrfToken) {\r\n\t\t\tvar headers = settings.headers || {};\r\n\t\t\theaders.csrfToken = dataset.csrfToken;\r\n\t\t\tsettings.headers = headers;\r\n\t\t}\r\n\t\t\r\n\t\tvar defer = jQuery.Deferred();\r\n\t\tjQuery.ajax(url, settings)\r\n\t\t.done(function(data, textStatus, jqXHR) {\r\n\t\t\tif(data) {\r\n\t\t\t\tif(data.csrfToken) {\r\n\t\t\t\t\tthis.csrfToken = data.csrfToken;\r\n\t\t\t\t}\r\n\t\t\t\tvar errorCode = data.errorCode;\r\n\t\t\t\tif (errorCode) {\r\n\t\t\t\t\tdefer.reject(data, this);\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tdefer.resolve(data, this);\r\n\t\t})\r\n\t\t.fail(function( jqXHR, textStatus, errorThrown ) {\r\n\t\t\tvar data = jqXHR.responseJSON,\r\n\t\t\t\tresult;\r\n\t\t\tif(data && data.errorCode) {\r\n\t\t\t\tresult = {errorCode: data.errorCode, errorMessage: data.errorMessage};\r\n\t\t\t} else {\r\n\t\t\t\tvar errorCode = textStatus,\r\n\t\t\t\t\terrorMessage = textStatus;\r\n\t\t\t\tif(textStatus == 'error') {\r\n\t\t\t\t\terrorCode = '0000';\r\n\t\t\t\t\terrorMessage = jslet.locale.Common.ConnectError;\r\n\t\t\t\t}\r\n\t\t\t\tresult = {errorCode: errorCode, errorMessage: errorMessage};\r\n\t\t\t}\r\n\t\t\tdefer.reject(result, this);\r\n\t\t})\r\n\t\t.always(function(dataOrJqXHR, textStatus, jqXHRorErrorThrown) {\r\n\t\t\tif(dataOrJqXHR && jQuery.isFunction(dataOrJqXHR.done)) { //fail\r\n\t\t\t\tvar data = dataOrJqXHR.responseJSON,\r\n\t\t\t\t\tresult;\r\n\t\t\t\tif(data && data.errorCode) {\r\n\t\t\t\t\tresult = {errorCode: data.errorCode, errorMessage: data.errorMessage};\r\n\t\t\t\t} else {\r\n\t\t\t\t\tresult = {errorCode: textStatus, errorMessage: jqXHRorErrorThrown};\r\n\t\t\t\t}\r\n\t\t\t\tdefer.always(result, this);\r\n\t\t\t} else {\r\n\t\t\t\tdefer.always(dataOrJqXHR, this);\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn defer.promise();\r\n\t};\r\n};\r\n\n/*!\r\n * Jslet Javascript Framework v4.0.0\r\n * https://github.com/jslet/jslet/\r\n *\r\n * Copyright 2016 Jslet Team and other contributors\r\n * Released under the MIT license\r\n */\r\n\r\n\"use strict\";\r\nif (!jslet.data) {\r\n\tjslet.data = {};\r\n}\r\n\r\njslet.data.XLSXXPorter = {\r\n\t/**\r\n\t * Import data into the specifed dataset from Excel file.\r\n\t * @param {jslet.data.Dataset or String} dataset - Dataset object or dataset name.\r\n\t * @param {String} fileContent - Excel file content.\r\n\t */\r\n\timportData: function(dataset, fileContent) {\r\n\t\tfunction getHeader(sheet) {\r\n\t\t    var headers = [];\r\n\t\t    if (!sheet['!ref']) return;\r\n\t\t    var range = XLSX.utils.decode_range(sheet['!ref']);\r\n\t\t    var C, R = range.s.r; /* start in the first row */\r\n\t\t    /* walk every column in the range */\r\n\t\t    for(C = range.s.c; C <= range.e.c; ++C) {\r\n\t\t        var cell = sheet[XLSX.utils.encode_cell({c:C, r:R})] /* find the cell in the first row */\r\n\r\n\t\t        var hdr = \"UNKNOWN \" + C; // <-- replace with your desired default \r\n\t\t        if(cell && cell.t) hdr = XLSX.utils.format_cell(cell);\r\n\r\n\t\t        headers.push(hdr);\r\n\t\t    }\r\n\t\t    return headers;\r\n\t\t}\r\n\r\n\r\n\t\tif(!XLSX) {\r\n\t\t\tthrow new Error('js-xlsx.js(https://github.com/SheetJS/js-xlsx) NOT loaded!');\r\n\t\t}\r\n\t\tvar workbook = XLSX.read(fileContent, {type: 'binary'});\r\n\t\tvar result = {};\r\n\t\tif(workbook.SheetNames.length === 0) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\tvar sheetName = workbook.SheetNames[0],\r\n\t\t\tsheet = workbook.Sheets[sheetName],\r\n\t\t\theader = getHeader(sheet),\r\n\t\t\troa = XLSX.utils.sheet_to_row_object_array(sheet);\r\n\t\tresult.data = roa;\r\n\t\tresult.header = header;\r\n\t\treturn result;\r\n\r\n\t},\r\n\t\r\n\t/**\r\n\t * Export dataset data to the specified Excel file.\r\n\t * \r\n\t * @param {jslet.data.Dataset or String} dataset - Dataset object or dataset name.\r\n\t * @param {String} fileName - Excel file name.\r\n\t * @param {Object} exportOption - Export option.\r\n\t * Export option pattern:\r\n\t * {exportHeader: true|false, //export with field labels\r\n\t *  exportDisplayValue: true|false, //true: export display value of field, false: export actual value of field\r\n\t *  onlySelected: true|false, //export selected records or not\r\n\t *  includeFields: ['fldName1', 'fldName2',...], //Array of field names which to be exported\r\n\t *  excludeFields: ['fldName1', 'fldName2',...]  //Array of field names which not to be exported\r\n\t *  }\r\n\t */\r\n\texportData: function(dataset, fileName, exportOption) {\r\n\t\tif(!XLSX) {\r\n\t\t\tthrow new Error('js-xlsx.js(https://github.com/SheetJS/js-xlsx) NOT loaded!');\r\n\t\t}\r\n\t\tfunction convertToXLSXFormat(worksheet, row, col, type, value) {\r\n\t\t\tvar cell_ref = XLSX.utils.encode_cell({c: col,r: row}), \r\n\t\t\t\tcell = {t: type, v: value};\r\n\t\t\tworksheet[cell_ref] = cell;\r\n\t\t}\r\n\t\t\r\n\t\tdataset.confirm();\r\n\t\tif(dataset.existDatasetError()) {\r\n\t\t\tconsole.warn(jslet.locale.Dataset.cannotConfirm);\r\n\t\t}\r\n\r\n\t\tvar exportHeader = true,\r\n\t\t\texportDisplayValue = true,\r\n\t\t\tonlySelected = false,\r\n\t\t\tincludeFields = null,\r\n\t\t\texcludeFields = null,\r\n\t\t\tescapeDate = true;\r\n\t\t\r\n\t\tif(exportOption && jQuery.isPlainObject(exportOption)) {\r\n\t\t\tif(exportOption.exportHeader !== undefined) {\r\n\t\t\t\texportHeader = exportOption.exportHeader? true: false;\r\n\t\t\t}\r\n\t\t\tif(exportOption.onlySelected !== undefined) {\r\n\t\t\t\tonlySelected = exportOption.onlySelected? true: false;\r\n\t\t\t}\r\n\t\t\tif(exportOption.includeFields !== undefined) {\r\n\t\t\t\tincludeFields = exportOption.includeFields;\r\n\t\t\t\tjslet.Checker.test('Dataset.exportCsv#exportOption.includeFields', includeFields).isArray();\r\n\t\t\t}\r\n\t\t\tif(exportOption.excludeFields !== undefined) {\r\n\t\t\t\texcludeFields = exportOption.excludeFields;\r\n\t\t\t\tjslet.Checker.test('Dataset.exportCsv#exportOption.excludeFields', excludeFields).isArray();\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar fields = dataset.getNormalFields(),\r\n\t\t\ti, fldCnt = fields.length, \r\n\t\t\tfldObj, fldName, value,\r\n\t\t\texportFields = [];\r\n\t\tfor(i = 0; i < fldCnt; i++) {\r\n\t\t\tfldObj = fields[i];\r\n\t\t\tfldName = fldObj.name();\r\n\t\t\tif(includeFields && includeFields.length > 0) {\r\n\t\t\t\tif(includeFields.indexOf(fldName) < 0) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tif(!fldObj.visible()) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif(excludeFields && excludeFields.length > 0) {\r\n\t\t\t\tif(excludeFields.indexOf(fldName) >= 0) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t} \r\n\t\t\texportFields.push(fldObj);\r\n\t\t}\r\n\t\tvar workSheet = {},\r\n\t\t\trow = 0, lastRow, lastCol,\r\n\t\t\tstartCell = null, \r\n\t\t\tendCell = null;\r\n\t\tfldCnt = exportFields.length;\r\n\t\tif (exportHeader) {\r\n\t\t\tfor(i = 0; i < fldCnt; i++) {\r\n\t\t\t\tfldObj = exportFields[i];\r\n\t\t\t\tconvertToXLSXFormat(workSheet, row, i, 's', fldObj.label());\r\n\t\t\t}\r\n\t\t\trow++;\r\n\t\t\tif(!startCell) {\r\n\t\t\t\tstartCell = {r: 0, c: 0};\r\n\t\t\t}\r\n\t\t\tlastRow = 0, lastCol = fldCnt - 1;\r\n\t\t}\r\n\r\n\t\tvar context = dataset.startSilenceMove(), value, dataType,\r\n\t\t\thtmlTagRegarExpr = /<\\/?[^>]*>/g;\r\n\t\ttry{\r\n\t\t\tdataset.first();\r\n\t\t\twhile(!dataset.isEof()) {\r\n\t\t\t\tif (onlySelected && !dataset.selected()) {\r\n\t\t\t\t\tdataset.next();\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\tfor(i = 0; i < fldCnt; i++) {\r\n\t\t\t\t\tfldObj = exportFields[i];\r\n\t\t\t\t\tvalue = fldObj.getValue();\r\n\t\t\t\t\tif(value === null || value === undefined) {\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tfldName = fldObj.name();\r\n\t\t\t\t\t//If Number field does not have lookup field, return field value, not field text. \r\n\t\t\t\t\t//Example: 'amount' field\r\n\t\t\t\t\tdataType = fldObj.getType();\r\n\t\t\t\t\tif(dataType === jslet.data.DataType.NUMBER && !fldObj.lookup()) {\r\n\t\t\t\t\t\tconvertToXLSXFormat(workSheet, row, i, 'n', value);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tvalue = dataset.getFieldText(fldName);\r\n\t\t\t\t\t\tif(value === null || value === undefined) {\r\n\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif(value && dataType === jslet.data.DataType.STRING) {\r\n\t\t\t\t\t\t\tvar replaceFn = value.replace;\r\n\t\t\t\t\t\t\tif(replaceFn) {\r\n\t\t\t\t\t\t\t\tvalue = replaceFn.call(value, htmlTagRegarExpr, ''); //Get rid of HTML tag\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tvalue += '';\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tconvertToXLSXFormat(workSheet, row, i, 's', value);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif(!startCell) {\r\n\t\t\t\t\t\tstartCell = {r: row, c: i};\r\n\t\t\t\t\t}\r\n\t\t\t\t\tlastRow = row;\r\n\t\t\t\t} //end for i\r\n\t\t\t\trow++;\r\n\t\t\t\tdataset.next();\r\n\t\t\t} // end while\r\n\t\t\tendCell = {r: lastRow, c: lastCol};\r\n\t\t}finally{\r\n\t\t\tdataset.endSilenceMove(context);\r\n\t\t}\r\n\t\tworkSheet['!ref'] = XLSX.utils.encode_range({s: startCell, e: endCell});\r\n\t\t\r\n\t\tvar ws_name = 'Sheet1';\r\n\t\tvar wb = {SheetNames: [], Sheets: {}};\r\n\t\twb.SheetNames.push(ws_name);\r\n\t\twb.Sheets[ws_name] = workSheet;\r\n\t\tvar xlsxOpt = {bookType:'xlsx', bookSST:true, type: 'binary'};\r\n\t\tvar wbout = XLSX.write(wb, xlsxOpt);\r\n\t\t\r\n\t\tfunction convertToUnitArray(workBook) {\r\n\t\t\tvar len = workBook.length,\r\n\t\t\t\tbuf = new ArrayBuffer(len),\r\n\t\t\t\tview = new Uint8Array(buf);\r\n\t\t\tfor (var k = 0; k != len; ++k) {\r\n\t\t\t\tview[k] = workBook.charCodeAt(k) & 0xFF;\r\n\t\t\t}\r\n\t\t\treturn buf;\r\n\t\t}\r\n\r\n\t\tsaveAs(new Blob([convertToUnitArray(wbout)], {type:\"application/octet-stream\"}), fileName);\r\n\t\t\r\n\t\treturn wbout;\r\n\t}\r\n};\r\n\n/*!\r\n * Jslet Javascript Framework v4.0.0\r\n * https://github.com/jslet/jslet/\r\n *\r\n * Copyright 2016 Jslet Team and other contributors\r\n * Released under the MIT license\r\n */\r\n\r\n\"use strict\";\r\nif (!jslet.data) {\r\n\tjslet.data = {};\r\n}\r\n\r\njslet.data.XPorter = function() {\r\n\tthis._excelXPorter = null;\r\n\t\r\n}\r\n\r\njslet.data.XPorter.prototype = {\r\n\texcelXPorter: function(xporter) {\r\n\t\tif(xporter === undefined) {\r\n\t\t\treturn this._excelXPorter || jslet.data.XLSXXPorter;\r\n\t\t}\r\n\t\tthis._excelXPorter = xporter;\r\n\t}\r\n\t\r\n};\r\n\r\njslet.data.defaultXPorter = new jslet.data.XPorter();\n/* jshint ignore:start */\r\n\treturn jslet;\r\n});//end define\r\n/* jshint ignore:end */\r\n"],"sourceRoot":"/source/"}