if(!jslet.ui){jslet.ui={}}jslet.ui.htmlclass={};jslet.ui.GlobalZIndex=100;jslet.ui.KeyCode={UP:38,DOWN:40,LEFT:37,RIGHT:39,TAB:9,ENTER:13};jslet.ui.PopupPanel=function(){this.onHidePopup=null;this.isShowing=false;this.documentClickHandler=function(b){b=jQuery.event.fix(b||window.event);var a=b.target;if(jslet.ui.isChild(jslet.ui.PopupPanel.excludedElement,a)||jslet.ui.inPopupPanel(a)){return}if(jslet.ui._activePopup){jslet.ui._activePopup.hide()}};this._stopMouseEvent=function(a){a.stopImmediatePropagation();a.preventDefault()};this._createPanel=function(){if(!jslet.ui._popupPanel){var a=document.createElement("div");a.style.display="none";a.className="jl-popup-panel jl-opaque jl-border-box dropdown-menu";a.style.position="absolute";a.style.zIndex=99000;document.body.appendChild(a);jQuery(document).on("click",this.documentClickHandler);jslet.ui._popupPanel=a}};this.show=function(c,g,b,o,m,k){this._createPanel();c=parseInt(c);g=parseInt(g);if(o){jslet.ui._popupPanel.style.height=parseInt(o)+"px"}if(b){jslet.ui._popupPanel.style.width=parseInt(b)+"px"}var n=jQuery(window),d=n.scrollLeft()+n.width(),e=n.scrollTop()+n.height(),a=jQuery(jslet.ui._popupPanel),i=a.outerWidth(),f=a.outerHeight();if(jslet.locale.isRtl){c-=i}if(c+i>d){c+=d-c-i-1}if(g+f>e){g-=(f+k)}if(c<0){c=1}if(g<0){g=1}if(g){jslet.ui._popupPanel.style.top=g+"px"}if(c){jslet.ui._popupPanel.style.left=c+"px"}jslet.ui._popupPanel.style.display="block";var l=jslet.ui._popupShadow;if(l){l.style.width=i+"px";l.style.height=f+"px";l.style.top=g+2+"px";l.style.left=c+2+"px";l.style.display="block"}jslet.ui._activePopup=this;this.isShowing=true};this.setContent=function(d,c,a){this._createPanel();var b=jslet.ui._popupPanel.childNodes[0];if(b){jslet.ui._popupPanel.removeChild(b)}jslet.ui._popupPanel.appendChild(d);d.style.border="none";if(c){d.style.width=c}if(a){d.style.height=a}};this.getPopupPanel=function(){this._createPanel();return jslet.ui._popupPanel};this.destroy=function(){if(!jslet.ui._popupPanel){return}this.isShowing=false;document.body.removeChild(jslet.ui._popupPanel);if(jslet.ui._popupShadow){document.body.removeChild(jslet.ui._popupShadow)}jQuery(this._popupPanel).off();jslet.ui._popupPanel=null;jslet.ui._popupShadow=null;this.onHidePopup=null;jQuery(document).off("click",this.documentClickHandler)};this.hide=function(){if(jslet.ui._popupPanel){jslet.ui._popupPanel.style.display="none";if(jslet.ui._popupShadow){jslet.ui._popupShadow.style.display="none"}}if(this.onHidePopup){this.onHidePopup()}this.isShowing=false;delete jslet.ui._activePopup}};jslet.ui.inPopupPanel=function(a){if(!a||a==document){return false}if(jQuery(a).hasClass("jl-popup-panel")){return true}else{return jslet.ui.inPopupPanel(a.parentNode)}};jslet.ui.getParentElement=function(d,e){if(!e){e=1}var b=d.parentElement?true:false,a=d;for(var c=0;c<e;c++){if(b){a=a.parentElement}else{a=a.parentNode}if(!a){return null}}return a};jslet.ui.findFirstParent=function(c,a,d){var b=c;if(!b){return null}if(!a){return b.parentNode}if(a(b)){return b}else{if(d&&d(b.parentNode)){return null}return jslet.ui.findFirstParent(b.parentNode,a,d)}};jslet.ui.findJsletParent=function(a){return jslet.ui.findFirstParent(a,function(b){return b.jslet?true:false})};jslet.ui.isChild=function(a,b){if(!a||!b){return false}var c=b;while(c){if(c==a){return true}c=c.parentNode}return false};jslet.ui.TextMeasurer=function(){var c,f=document.body,a;var d=null;var e=function(){if(!c){c=document.createElement("div");document.body.appendChild(c);c.style.position="absolute";c.style.left="-9999px";c.style.top="-9999px";c.style.display="none";c.style.margin="0px";c.style.padding="0px";c.style.overflow="hidden"}if(!f){f=document.body}};this.setElement=function(g){f=g;if(!f){return}e();c.style.fontSize=f.style.fontSize;c.style.fontStyle=f.style.fontStyle;c.style.fontWeight=f.style.fontWeight;c.style.fontFamily=f.style.fontFamily;c.style.lineHeight=f.style.lineHeight;c.style.textTransform=f.style.textTransform;c.style.letterSpacing=f.style.letterSpacing};this.setElementWidth=function(g){a=g;if(!f){return}if(g){f.style.width=g}else{f.style.width=""}};function b(g){if(d!=g){c.innerHTML=g}}this.getSize=function(h){e();b(h);var g=jQuery(c);return{width:g.width(),height:g.height()}};this.getWidth=function(g){return this.getSize(g).width};this.getHeight=function(g){return this.getSize(g).height}};jslet.ui.textMeasurer=new jslet.ui.TextMeasurer();jslet.ui.getCssValue=function(c,b){var d=document.createElement("div");d.className=c;d.style.display="none";document.body.appendChild(d);var a=jQuery(d).css(b);document.body.removeChild(d);return a};jslet.ui.setEditableStyle=function(c,b,e,a){if(!a){c.disabled=b;c.readOnly=e}var d=jQuery(c);if(b||e){if(!d.hasClass("jl-readonly")){d.addClass("jl-readonly")}}else{d.removeClass("jl-readonly")}};jslet.scrollbarSize=function(){var c,d,b,a;if(b===undefined){c=jQuery('<div style="width:50px;height:50px;overflow:auto"><div/></div>').appendTo("body");d=c.children();b=d.innerWidth()-d.height(99).innerWidth();c.remove()}return b};if(!jslet.ui){jslet.ui={}}jslet.ui.Control=jslet.Class.create({initialize:function(b,c){this.el=b;this.allProperties=null;c=jslet.ui._evalParams(c);if(this.isValidTemplateTag&&!this.isValidTemplateTag(this.el)){var d=jslet.ui.getControlClass(c.type),a;if(d){a=d.htmlTemplate}else{a=""}throw new Error(jslet.formatString(jslet.locale.DBControl.invalidHtmlTag,a))}this.setParams(c);this.checkRequiredProperty();this.el.jslet=this;this.beforeBind();this.bind();this.afterBind()},beforeBind:function(){},bind:function(){},afterBind:function(){},setParams:function(b){if(!b){return}for(var a in b){var c=this[a];if(a=="type"){continue}if(c&&c.call){c.call(this,b[a])}else{throw new Error("Not support control property: "+a)}}},checkRequiredProperty:function(){if(!this.requiredProperties){return}var d=this.requiredProperties.split(","),c=d.length,a;for(var b=0;b<c;b++){a=d[b].trim();if(!this[a]){throw new Error(jslet.formatString(jslet.locale.DBControl.expectedProperty,[a]))}}},destroy:function(){this.el.jslet=null;this.el=null}});jslet.ui.DBControl=jslet.Class.create(jslet.ui.Control,{initialize:function($super,a,b){$super(a,b)},_dataset:undefined,_currRecno:-1,dataset:function(a){if(a===undefined){return this._dataset}if(jslet.isString(a)){a=jslet.data.dataModule.get(jQuery.trim(a))}jslet.Checker.test("DBControl.dataset",a).required().isClass(jslet.data.Dataset.className);this._dataset=a},currRecno:function(a){if(a===undefined){return this._currRecno}jslet.Checker.test("DBControl.currRecno",a).isGTEZero();this._currRecno=a},setParams:function($super,a){$super(a);if(!this._dataset){var b=this.getDatasetInParentElement();this.dataset(b)}},beforeBind:function($super){$super();this._dataset.addLinkedControl(this)},checkRequiredProperty:function($super){jslet.Checker.test("DBControl.dataset",this._dataset).required();$super()},refreshControl:function(a,c){var b=this;if(!c&&!b.isActiveRecord()){return false}var d=a.eventType;if(d==jslet.data.RefreshEvent.SCROLL||d==jslet.data.RefreshEvent.INSERT||d==jslet.data.RefreshEvent.DELETE){b.doValueChanged();return true}if((d==jslet.data.RefreshEvent.UPDATERECORD||d==jslet.data.RefreshEvent.UPDATECOLUMN)&&a.fieldName==b._field){b.doValueChanged();return true}if(d==jslet.data.RefreshEvent.CHANGEMETA&&b._field==a.fieldName){b.doMetaChanged(a.metaName);return true}if(d==jslet.data.RefreshEvent.UPDATELOOKUP&&a.fieldName==b._field){b.doLookupChanged();return true}if(d==jslet.data.RefreshEvent.UPDATEALL){b.doMetaChanged();b.doLookupChanged();b.doValueChanged();return true}return true},doMetaChanged:function(a){},doValueChanged:function(){},doLookupChanged:function(){},getDatasetInParentElement:function(){var a=this.el,b=null;while(true){b=jslet.ui.getParentElement(a,1);if(!b){break}if(b.jslet){return b.jslet.dataset}a=b}return null},isActiveRecord:function(){return this._currRecno<0||this._currRecno==this._dataset.recno()},forceRefreshControl:function(){this.refreshControl(jslet.data.RefreshEvent.updateRecordEvent(this._field),true)},destroy:function($super){if(this._dataset){this._dataset.removeLinkedControl(this)}this._dataset=null;$super()}});jslet.ui.DBFieldControl=jslet.Class.create(jslet.ui.DBControl,{initialize:function($super,a,b){$super(a,b)},_field:undefined,_valueIndex:undefined,_enableInvalidTip:true,field:function(a){if(a===undefined){return this._field}a=jQuery.trim(a);jslet.Checker.test("DBControl.field",a).isString().required();var b=a.lastIndexOf("#");if(b>0){this._fieldMeta=a.substring(b+1);a=a.substring(0,b)}this._field=a},fieldMeta:function(){return this._fieldMeta},valueIndex:function(a){if(a===undefined){return this._valueIndex}jslet.Checker.test("DBControl.valueIndex",a).isNumber();this._valueIndex=parseInt(a)},setParams:function($super,a){$super(a);value=a.valueIndex;if(value!==undefined){this.valueIndex(value)}},checkRequiredProperty:function($super){$super();jslet.Checker.test("DBControl.field",this._field).required();this.existField(this._field)},doMetaChanged:function($super,b){$super(b);if(!b||b=="tip"){var c=this._dataset.getField(this._field);if(!c){throw new Error("Field: "+this._field+" NOT exist!")}var a=c.tip();a=a?a:"";this.el.title=a}},existField:function(a){fldObj=this._dataset.getField(a);return fldObj?true:false},renderInvalid:function(){var b=this;if(!b._field){return}var c=b.dataset().getField(b._field);var a=c.message(b._valueIndex);if(a){jQuery(b.el).parent().addClass("has-error")}else{jQuery(b.el).parent().removeClass("has-error")}if(!jslet.ui.globalTip){b.el.title=a||""}},destroy:function($super){this._field=null;$super()}});jslet.ui._evalParams=function(a){jslet.Checker.test("evalParams#ctrlParams",a).required();if(jslet.isString(a)){var c=jQuery.trim(a);if(!c.startsWith("{")&&c.indexOf(":")>0){c="{"+c+"}"}try{a=new Function("return "+c)();if(a["var"]){a=a["var"]}return a}catch(b){throw new Error(jslet.formatString(jslet.locale.DBControl.invalidJsletProp,[a]))}}return a};jslet.ui.controls=new jslet.SimpleMap();jslet.ui.register=function(a,b){jslet.ui.controls.set(a.toLowerCase(),b)};jslet.ui.createControl=function(i,k,e,l){var h=false,g=k,d=document.createElement("div"),a=jslet.ui._evalParams(i),c=a.type;if(!c){c=jslet.ui.controls.DBTEXT}var b=jslet.ui.controls.get(c.toLowerCase());if(!b){throw new Error("NOT found control type: "+c)}d.innerHTML=b.htmlTemplate;var f=d.firstChild;d.removeChild(f);if(k){k.appendChild(f)}else{document.body.appendChild(f)}if(e){if(parseInt(e)==e){e=e+"px"}f.style.width=e}if(l){if(parseInt(l)==l){l=l+"px"}f.style.height=l}return new b(f,a)};jslet.ui.getControlClass=function(a){return jslet.ui.controls.get(a.toLowerCase())};jslet.ui.bindControl=function(b,a){if(!a){a=jQuery(b).attr("data-jslet")}var e=jslet.ui._evalParams(a);var d=e.type;if(!d){b.jslet=e;return}var c=jslet.ui.controls.get(d.toLowerCase());if(!c){throw new Error("NOT found control type: "+d)}new c(b,e)};jslet.ui.install=function(b,a){if(b&&(a===undefined)){if(jQuery.isFunction(b)){a=b;b=null}}if(!b&&jslet.locale.isRtl){var g=jQuery(document.body);if(!g.hasClass("jl-rtl")){g.addClass("jl-rtl")}}var e;if(!b){b=document.body}e=jQuery(b).find("*[data-jslet]");var d=e.length,f;for(var c=0;c<d;c++){f=e[c];jslet.ui.bindControl(f)}if(a){a()}};jslet.ui.uninstall=function(a){var d;if(!a){d=jQuery("*[data-jslet]")}else{d=jQuery(a).find("*[data-jslet]")}var e;for(var c=0,b=d.length;c<b;c++){e=d[c];if(e.jslet&&e.jslet.destroy){e.jslet.destroy()}e.jslet=null}if(jslet.ui.menuManager){jQuery(document).off("mousedown",jslet.ui.menuManager.hideAll)}};if(!jslet.ui){jslet.ui={}}jslet.ui.DnD=function(){var k,i,h,f,b,a,e=2,g=false,d,c=true,l=this;this._docMouseDown=function(m){m=jQuery.event.fix(m||window.event);c=true;b=0;a=0;k=m.pageX;i=m.pageY;g=false;if(d&&d._doMouseDown){d._doMouseDown(k,i,h,f,b,a)}};this._docMouseMove=function(m){if(!c){return}m=jQuery.event.fix(m||window.event);h=m.pageX;f=m.pageY;if(!g){if(Math.abs(b)>e||Math.abs(a)>e){g=true;k=h;i=f;if(d&&d._doDragStart){d._doDragStart(k,i)}return}}b=h-k;a=f-i;if(g){if(d&&d._doDragging){d._doDragging(k,i,h,f,b,a)}}else{if(d&&d._doMouseMove){d._doMouseMove(k,i,h,f,b,a)}k=h;i=f}};this._docMouseUp=function(m){c=false;if(g){g=false;if(d&&d._doDragEnd){d._doDragEnd(k,i,h,f,b,a)}}else{if(d&&d._doMouseUp){d._doMouseUp(k,i,h,f,b,a)}}l.unbindControl()};this._docKeydown=function(m){m=jQuery.event.fix(m||window.event);if(m.which==27){if(g){g=false;if(d&&d._doDragCancel){d._doDragCancel();l.unbindControl()}}}};this._docSelectStart=function(m){m=jQuery.event.fix(m||window.event);m.preventDefault();return false};this.bindControl=function(m){d=m;var n=jQuery(document);n.on("mousedown",this._docMouseDown);n.on("mouseup",this._docMouseUp);n.on("mousemove",this._docMouseMove);n.on("selectstart",this._docSelectStart);n.on("keydown",this._docKeydown)};this.unbindControl=function(){var m=jQuery(document);m.off("mousedown",this._docMouseDown);m.off("mouseup",this._docMouseUp);m.off("mousemove",this._docMouseMove);m.off("selectstart",this._docSelectStart);m.off("keydown",this._docKeydown);d=null}};jslet.ui.dnd=new jslet.ui.DnD();if(!jslet.ui){jslet.ui={}}jslet.ui.EditMask=function(){this._mask=null;this._keepChar=true;this._transform=null;this._literalChars=null;this._parsedMask=null;this._format=null;this._target=null;this._buffer=null};jslet.ui.EditMask.prototype={maskChars:{"#":{regexpr:new RegExp("[0-9\\-]"),required:false},"0":{regexpr:new RegExp("[0-9]"),required:true},"9":{regexpr:new RegExp("[0-9]"),required:false},L:{regexpr:new RegExp("[A-Za-z]"),required:true},l:{regexpr:new RegExp("[A-Za-z]"),required:false},A:{regexpr:new RegExp("[0-9a-zA-Z]"),required:true},a:{regexpr:new RegExp("[0-9a-zA-Z]"),required:false},C:{regexpr:null,required:true},c:{regexpr:null,required:false}},transforms:["upper","lower"],setMask:function(a,d,c){a=jQuery.trim(a);jslet.Checker.test("EditMask#mask",a).isString();this._mask=a;this._keepChar=d?true:false;this._transform=null;if(c){var b=jslet.Checker.test("EditMask#transform",c).isString();c=jQuery.trim(c);c=c.toLowerCase();b.inArray(this.transforms);this._transform=c}this._parseMask()},attach:function(c){jslet.Checker.test("EditMask.attach#target",c).required();var b=this,a=jQuery(c);b._target=c;a.on("keypress.editmask",function(d){if(this.readOnly||!b._mask){return true}var e=d.which;if(e===0){return true}if(!b._doKeypress(e)){d.preventDefault()}else{return true}});a.on("keydown.editmask",function(d){if(this.readOnly||!b._mask){return true}if(!b._doKeydown(d.which)){d.preventDefault()}else{return true}});a.on("blur.editmask",function(d){if(this.readOnly||!b._mask){return true}if(!b._doBur()){d.preventDefault();d.currentTarget.focus()}else{return true}});a.on("cut.editmask",function(d){if(this.readOnly||!b._mask){return true}b._doCut(d.originalEvent.clipboardData||window.clipboardData);d.preventDefault();return false});a.on("paste.editmask",function(d){if(this.readOnly||!b._mask){return true}if(!b._doPaste(d.originalEvent.clipboardData||window.clipboardData)){d.preventDefault()}})},detach:function(){var a=jQuery(this._target);a.off("keypress.editmask");a.off("keydown.editmask");a.off("blur.editmask");a.off("cut.editmask");a.off("paste.editmask");this._target=null},setValue:function(o){o=jQuery.trim(o);jslet.Checker.test("EditMask.setValue#value",o).isString();o=o?o:"";if(!this._mask){this._target.value=o;return}var b=this;b._clearBuffer(0);var r=0,n,q=0,f,g,a,m,p=0,d,h=b._parsedMask.length;while(true){d=b._getFixedCharAndPos(r);n=d.pos;a=d.ch;if(n<0){n=r}if(a){p=o.indexOf(a,q);if(p<0){p=o.length}f=-1;for(g=p-1;g>=q;g--){m=o.charAt(g);b._buffer[f+n]=m;f--}q=p+1}else{f=0;var l,e=b._buffer.length;for(g=r;g<e;g++){l=o.charAt(q+f);if(!l){break}b._buffer[g]=l;f++}break}r=n+1}b._showValue()},getValue:function(){var e=this._target.value;if(this._keepChar){return e}else{var a=[],b;for(var d=0,c=e.length;d<c;d++){b=this._parsedMask[d];if(b.isMask){a.push(e.charAt(d))}}return a.join("")}},validateValue:function(){var d=this,a=d._parsedMask.length,b;for(var c=0;c<a;c++){b=d._parsedMask[c];if(b.isMask&&d.maskChars[b.ch].required){if(d._buffer[c]==d._format[c]){return false}}}return true},_getFixedCharAndPos:function(e){var f=this;if(!f._literalChars||f._literalChars.length===0){return{pos:0,ch:null}}if(!e){e=0}var d,a;for(var c=e,b=f._parsedMask.length;c<b;c++){a=f._parsedMask[c];if(a.isMask){continue}d=a.ch;if(f._literalChars.indexOf(d)>=0){return{ch:d,pos:c}}}return{pos:-1,ch:null}},_parseMask:function(){var a=this;if(!a._mask){a._parsedMask=null;return}a._parsedMask=[];a._format=[];var h,m=null,g;for(var f=0,d=a._mask.length;f<d;f++){h=a._mask.charAt(f);if(h=="\\"){m=h;continue}g=false;if(a.maskChars[h]===undefined){if(m){a._parsedMask.push({ch:m,isMask:g})}a._parsedMask.push({ch:h,isMask:g})}else{g=m?false:true;a._parsedMask.push({ch:h,isMask:g})}if(a._keepChar&&!g){if(!a._literalChars){a._literalChars=[]}var l=true;for(var e=0,b=a._literalChars.length;e<b;e++){if(a._literalChars[e]==h){l=false;break}}if(l){a._literalChars.push(h)}}m=null;a._format.push(g?"_":h)}a._buffer=a._format.slice(0);if(a._target){a._target.value=a._format.join("")}},_validateChar:function(b,a){var c=this.maskChars[b];var d=c.regexpr;if(d){return d.test(a)}else{return true}},_getValidPos:function(e,c){var d=this,b=d._parsedMask.length,a;if(e>=b){return b-1}if(!c){for(a=e;a<b;a++){if(d._parsedMask[a].isMask){return a}}for(a=e;a>=0;a--){if(d._parsedMask[a].isMask){return a}}}else{for(a=e;a>=0;a--){if(d._parsedMask[a].isMask){return a}}for(a=e;a<b;a++){if(d._parsedMask[a].isMask){return a}}}return -1},_clearBuffer:function(c,a){if(!this._buffer){return}if(!a){a=this._buffer.length-1}for(var b=c;b<=a;b++){this._buffer[b]=this._format[b]}},_packEmpty:function(f,b){var l,d=0,g=this,e;for(e=f;e>=0;e--){l=g._format[e];if(g._literalChars&&g._literalChars.indexOf(l)>=0){d=e;break}}f=d;var h=[];for(e=f;e<b;e++){l=g._buffer[e];if(l!=g._format[e]){h.push(l)}}var a=h.length-1;for(e=b-1;e>=f;e--){if(a>=0){g._buffer[e]=h[a];a--}else{g._buffer[e]=g._format[e]}}},_updateBuffer:function(h,f){var e=h.begin,a=h.end,g=this;e=g._getValidPos(e);if(e<0){return -1}g._clearBuffer(e+1,a);if(g._literalChars&&g._literalChars.indexOf(f)>=0){for(var d=e,c=g._parsedMask.length;d<c;d++){if(g._parsedMask[d].ch==f){g._packEmpty(e,d);return d}}}else{var b=g._parsedMask[e];if(g._validateChar(b.ch,f)){g._buffer[e]=f;return e}else{return -1}}},_moveCursor:function(a,b){a=this._getValidPos(a,b);if(a>=0){jslet.ui.textutil.setCursorPos(this._target,a)}},_showValue:function(){this._target.value=this._buffer.join("")},_doKeypress:function(a){if(a==13){return true}var c=String.fromCharCode(a),d=this;if(d._transform=="upper"){c=c.toUpperCase()}else{if(d._transform=="lower"){c=c.toLowerCase()}}var e=jslet.ui.textutil.getCursorPos(d._target);var b=d._updateBuffer(e,c);d._showValue();if(b>=0){d._moveCursor(b+1)}else{d._moveCursor(e.begin)}return false},_doKeydown:function(d){var g=this,i=jslet.ui.textutil.getCursorPos(g._target),f=i.begin,b=i.end;if(d==229){var a=(g._parsedMask.legnth>f);if(a){var e=g._parsedMask[f];a=e.isMask;if(a){var h=e.ch;a=(h=="c"||h=="C")}}if(!a){window.setTimeout(function(){g._showValue();g._moveCursor(f)},50)}}if(d==13){return true}if(d==8){if(f==b){f=g._getValidPos(--f,true);b=f}g._clearBuffer(f,b);g._showValue();g._moveCursor(f,true);return false}if(d==27){return false}if(d==39){}if(d==46){g._clearBuffer(f,b-1);g._showValue();g._moveCursor(f);return false}return true},_doBur:function(){var a,f,e=this;for(var d=0,b=e._parsedMask.length;d<b;d++){a=e._parsedMask[d];if(!a.isMask){continue}f=a.ch;if(e.maskChars[f].required){if(e._buffer[d]==e._format[d]){return true}}}return true},_doCut:function(e){var d=this,c=jslet.ui.textutil.getSelectedText(d._target),a=jslet.ui.textutil.getCursorPos(d._target),b=a.begin;d._clearBuffer(b,a.end-1);d._showValue();d._moveCursor(b,true);e.setData("Text",c);return false},_doPaste:function(f){var a=f.getData("Text");if(!a){return false}var e=jslet.ui.textutil.getCursorPos(this._target),d=0,c;e.end=e.begin;for(var b=0;b<a.length;b++){c=a.charAt(b);d=this._updateBuffer(e,c);e.begin=b;e.end=e.begin}this._showValue();if(d>=0){this._moveCursor(d+1)}return true}};jslet.ui.textutil={selectText:function(a,e,b){var d=a.value;if(d.length>0){e=e===undefined?0:e;b=b===undefined?d.length:b;if(a.setSelectionRange){a.setSelectionRange(e,b)}else{if(a.createTextRange){var c=a.createTextRange();c.moveStart("character",e);c.moveEnd("character",b-d.length);c.select()}}}},getSelectedText:function(a){if(a.setSelectionRange){var c=a.selectionStart;var b=a.selectionEnd;return a.value.substring(c,b)}if(document.selection&&document.selection.createRange){return document.selection.createRange().text}},getCursorPos:function(b){var a={begin:0,end:0};if(b.setSelectionRange){a.begin=b.selectionStart;a.end=b.selectionEnd}else{if(document.selection&&document.selection.createRange){var c=document.selection.createRange();a.begin=0-c.duplicate().moveStart("character",-100000);a.end=a.begin+c.text.length}}return a},setCursorPos:function(a,c){if(a.setSelectionRange){a.focus();a.setSelectionRange(c,c)}else{if(a.createTextRange){var b=a.createTextRange();b.collapse(true);b.moveEnd("character",c);b.moveStart("character",c);b.select()}}}};jslet.ResizeEventBus=function(){var a=null;this.resize=function(b){if(a){window.clearTimeout(a)}a=setTimeout(function(){var c,f,g;if(b){c=jQuery(b).find("*[data-jslet-resizable]")}else{c=jQuery("*[data-jslet-resizable]")}if(jslet.ui._activePopup){jslet.ui._activePopup.hide()}for(var e=0,d=c.length;e<d;e++){f=c[e];if(f){g=f.jslet;if(g&&g.checkSizeChanged){g.checkSizeChanged()}}}a=null},100)};this.subscribe=function(b){if(!b||!b.el){throw new Error("ctrlObj required!")}jQuery(b.el).attr(jslet.ResizeEventBus.RESIZABLE,true)};this.unsubscribe=function(b){if(!b||!b.el){throw new Error("ctrlObj required!")}jQuery(b.el).removeAttr(jslet.ResizeEventBus.RESIZABLE)}};jslet.ResizeEventBus.RESIZABLE="data-jslet-resizable";jslet.resizeEventBus=new jslet.ResizeEventBus();jQuery(window).on("resize",function(){jslet.resizeEventBus.resize()});jslet.ui.Accordion=jslet.Class.create(jslet.ui.Control,{initialize:function($super,a,c){var b=this;b.el=a;b.allProperties="selectedIndex,onChanged,items";b._selectedIndex=0;b._onChanged=null;b._items=null;$super(a,c)},selectedIndex:function(a){if(a===undefined){return this._selectedIndex}jslet.Checker.test("Accordion.selectedIndex",a).isGTEZero();this._selectedIndex=a},onChanged:function(a){if(a===undefined){return this._onChanged}jslet.Checker.test("Accordion.onChanged",a).isFunction();this._onChanged=a},items:function(b){if(b===undefined){return this._items}jslet.Checker.test("Accordion.items",b).isArray();var d;for(var c=0,a=b.length;c<a;c++){d=b[c];jslet.Checker.test("Accordion.items.caption",d.caption).isString().required()}this._items=b},bind:function(){this.renderAll()},renderAll:function(){var a=this;var c=jQuery(a.el);if(!c.hasClass("jl-accordion")){c.addClass("jl-accordion jl-border-box jl-round5")}var f=c.find(">div"),b,d=0,i;var e=a._items?a._items.length-1:-1,k;f.before(function(l){if(l<=e){k=a._items[l].caption}else{k="caption"+l}return'<button class="btn btn-default jl-accordion-head" jsletindex = "'+l+'">'+k+"</button>"});var h=c.find(">.jl-accordion-head");h.click(a._doCaptionClick);d=h.outerHeight()*f.length;var g=c.innerHeight()-d-1;f.wrap('<div class="jl-accordion-body" style="height:'+g+'px;display:none"></div>');a.setSelectedIndex(a._selectedIndex,true)},_doCaptionClick:function(c){var b=jQuery(c.currentTarget),d=jslet.ui.findJsletParent(b[0]).jslet,a=parseInt(b.attr("jsletindex"));d.setSelectedIndex(a)},setSelectedIndex:function(b,a){if(!b){b=0}var e=this;var c=jQuery(e.el).find(">.jl-accordion-body");var d=c.length-1;if(b>d){return}if(e._selectedIndex==b&&b<d){jQuery(c[b]).slideUp("fast");if(!a||a&&b>0){b++}jQuery(c[b]).slideDown("fast");e._selectedIndex=b;if(e._onChanged){e._onChanged.call(this,b)}return}if(e._selectedIndex>=0&&e._selectedIndex!=b){jQuery(c[e._selectedIndex]).slideUp("fast")}jQuery(c[b]).slideDown("fast");e._selectedIndex=b;if(e._onChanged){e._onChanged.call(this,b)}},destroy:function($super){var a=jQuery(this.el);a.find(">.jl-accordion-head").off();$super()}});jslet.ui.register("Accordion",jslet.ui.Accordion);jslet.ui.Accordion.htmlTemplate="<div></div>";jslet.ui.Calendar=jslet.Class.create(jslet.ui.Control,{initialize:function($super,a,c){var b=this;b.el=a;b.allProperties="value,onDateSelected,minDate,maxDate";b._value=null;b._onDateSelected=null;b._minDate=null;b._maxDate=null;b._currYear=0;b._currMonth=0;b._currDate=0;$super(a,c)},value:function(a){if(a===undefined){return this._value}jslet.Checker.test("Calendar.value",a).isDate();this._value=a},minDate:function(a){if(a===undefined){return this._minDate}jslet.Checker.test("Calendar.minDate",a).isDate();this._minDate=a},maxDate:function(a){if(a===undefined){return this._maxDate}jslet.Checker.test("Calendar.maxDate",a).isDate();this._maxDate=a},onDateSelected:function(a){if(a===undefined){return this._onDateSelected}jslet.Checker.test("Calendar.onDateSelected",a).isFunction();this._onDateSelected=a},bind:function(){this.renderAll()},renderAll:function(){var d=this;jqEl=jQuery(d.el);if(!jqEl.hasClass("jl-calendar")){jqEl.addClass("jl-calendar jl-border-box jl-round4")}var b=['<div class="jl-cal-header">','<a class="jl-cal-btn jl-cal-yprev" title="',jslet.locale.Calendar.yearPrev,'" href="javascript:;">&lt;&lt;</a><a href="javascript:;" class="jl-cal-btn jl-cal-mprev" title="',jslet.locale.Calendar.monthPrev,'">&lt;','</a><a href="javascript:;" class="jl-cal-title"></a><a href="javascript:;" class="jl-cal-btn jl-cal-mnext" title="',jslet.locale.Calendar.monthNext,'">&gt;','</a><a href="javascript:;" class="jl-cal-btn jl-cal-ynext" title="',jslet.locale.Calendar.yearNext,'">&gt;&gt;</a>',"</div>",'<div class="jl-cal-body">','<table cellpadding="0" cellspacing="0">','<thead><tr><th class="jl-cal-weekend">',jslet.locale.Calendar.Sun,"</th><th>",jslet.locale.Calendar.Mon,"</th><th>",jslet.locale.Calendar.Tue,"</th><th>",jslet.locale.Calendar.Wed,"</th><th>",jslet.locale.Calendar.Thu,"</th><th>",jslet.locale.Calendar.Fri,'</th><th class="jl-cal-weekend">',jslet.locale.Calendar.Sat,"</th></tr></thead><tbody>",'<tr><td class="jl-cal-weekend"><a href="javascript:;"></a></td><td><a href="javascript:;"></a></td><td><a href="javascript:;"></a></td><td><a href="javascript:;"></a></td><td><a href="javascript:;"></a></td><td><a href="javascript:;"></a></td><td class="jl-cal-weekend"><a href="javascript:;"></a></td></tr>','<tr><td class="jl-cal-weekend"><a href="javascript:;"></a></td><td><a href="javascript:;"></a></td><td><a href="javascript:;"></a></td><td><a href="javascript:;"></a></td><td><a href="javascript:;"></a></td><td><a href="javascript:;"></a></td><td class="jl-cal-weekend"><a href="javascript:;"></a></td></tr>','<tr><td class="jl-cal-weekend"><a href="javascript:;"></a></td><td><a href="javascript:;"></a></td><td><a href="javascript:;"></a></td><td><a href="javascript:;"></a></td><td><a href="javascript:;"></a></td><td><a href="javascript:;"></a></td><td class="jl-cal-weekend"><a href="javascript:;"></a></td></tr>','<tr><td class="jl-cal-weekend"><a href="javascript:;"></a></td><td><a href="javascript:;" class="jl-cal-disable"></a></td><td><a href="javascript:;"></a></td><td><a href="javascript:;"></a></td><td><a href="javascript:;"></a></td><td><a href="javascript:;"></a></td><td class="jl-cal-weekend"><a href="javascript:;"></a></td></tr>','<tr><td class="jl-cal-weekend"><a href="javascript:;"></a></td><td><a href="javascript:;" class="jl-cal-disable"></a></td><td><a href="javascript:;"></a></td><td><a href="javascript:;"></a></td><td><a href="javascript:;"></a></td><td><a href="javascript:;"></a></td><td class="jl-cal-weekend"><a href="javascript:;"></a></td></tr>','<tr><td class="jl-cal-weekend"><a href="javascript:;"></a></td><td><a href="javascript:;"></a></td><td><a href="javascript:;"></a></td><td><a href="javascript:;"></a></td><td><a href="javascript:;"></a></td><td><a href="javascript:;"></a></td><td class="jl-cal-weekend"><a href="javascript:;"></a></td></tr>','</tbody></table></div><div class="jl-cal-footer"><a class="jl-cal-today" href="javascript:;">',jslet.locale.Calendar.today,"</a></div>"];jqEl.html(b.join(""));var a=jqEl.find(".jl-cal-body table");d._currYear=-1;a.on("click",d._doTableClick);var c=d._value&&jslet.isDate(d._value)?d._value:new Date();this.setValue(c);jqEl.find(".jl-cal-today").click(function(e){var f=new Date();d.setValue(new Date(f.getFullYear(),f.getMonth(),f.getDate()));d._fireSelectedEvent()});jqEl.find(".jl-cal-yprev").click(function(e){d.incYear(-1)});jqEl.find(".jl-cal-mprev").click(function(e){d.incMonth(-1)});jqEl.find(".jl-cal-ynext").click(function(e){d.incYear(1)});jqEl.find(".jl-cal-mnext").click(function(e){d.incMonth(1)});jqEl.on("keydown",function(e){var g=e.ctrlKey,f=e.keyCode;var h=0;if(f==jslet.ui.KeyCode.UP){if(g){d.incYear(-1)}else{d.incDate(-7)}e.preventDefault();return}if(f==jslet.ui.KeyCode.DOWN){if(g){d.incYear(1)}else{d.incDate(7)}e.preventDefault();return}if(f==jslet.ui.KeyCode.LEFT){if(g){d.incMonth(-1)}else{d.incDate(-1)}e.preventDefault();return}if(f==jslet.ui.KeyCode.RIGHT){if(g){d.incMonth(1)}else{d.incDate(1)}e.preventDefault();return}})},_getNotNullDate:function(){var a=this._value;if(!a){a=new Date()}return a},incDate:function(a){var b=this._getNotNullDate();b.setDate(b.getDate()+a);this.setValue(b)},incMonth:function(b){var a=this._getNotNullDate();a.setMonth(a.getMonth()+b);this.setValue(a)},incYear:function(b){var a=this._getNotNullDate();a.setFullYear(a.getFullYear()+b);this.setValue(a)},setValue:function(b){if(!b){return}var c=this;if(c._minDate&&b<c._minDate){b=new Date(c._minDate.getTime())}if(c._maxDate&&b>c._maxDate){b=new Date(c._maxDate.getTime())}c._value=b;var d=b.getFullYear(),a=b.getMonth();if(c._currYear==d&&c._currMonth==a){c._setCurrDateCls()}else{c._refreshDateCell(d,a)}},_checkNaviState:function(){var b=this,e=jQuery(b.el),i,g;if(b._minDate){var f=b._minDate.getFullYear(),k=b._minDate.getMonth(),m=e.find(".jl-cal-yprev")[0];i=(b._currYear<=f);m.style.visibility=(i?"hidden":"visible");i=(b._currYear==f&&b._currMonth<=k);var l=e.find(".jl-cal-mprev")[0];l.style.visibility=(i?"hidden":"visible");i=(b._minDate>new Date());g=e.find(".jl-cal-today")[0];g.style.visibility=(i?"hidden":"visible")}if(b._maxDate){var a=b._maxDate.getFullYear(),h=b._maxDate.getMonth(),d=e.find(".jl-cal-ynext")[0];i=(b._currYear>=a);d.jslet_disabled=i;d.style.visibility=(i?"hidden":"visible");i=(b._currYear==a&&b._currMonth>=h);var c=e.find(".jl-cal-mnext")[0];c.jslet_disabled=i;c.style.visibility=(i?"hidden":"visible");i=(b._maxDate<new Date());g=e.find(".jl-cal-today")[0];g.style.visibility=(i?"hidden":"visible")}},_refreshDateCell:function(l,x){var a=this,n=jQuery(a.el),b=jslet.locale.Calendar.monthNames,c=b[x],p=n.find(".jl-cal-title")[0];p.innerHTML=c+","+l;var f=n.find(".jl-cal-body table")[0],e=f.tBodies[0].rows,k=new Date(l,x,1),h=k.getDay(),v=86400000,w=new Date(k.getTime()-(h+1)*v);w=new Date(w.getFullYear(),w.getMonth(),w.getDate());var d=e.length,g,u,q,r;for(var t=1;t<=d;t++){g=e[t-1];for(var s=1,o=g.cells.length;s<=o;s++){u=g.cells[s-1];w=new Date(w.getTime()+v);r=u.firstChild;if(a._minDate&&w<a._minDate||a._maxDate&&w>a._maxDate){r.innerHTML="";u.jslet_date_value=null;continue}else{r.innerHTML=w.getDate();u.jslet_date_value=w}q=w.getMonth();if(q!=x){jQuery(u).addClass("jl-cal-disable")}else{jQuery(u).removeClass("jl-cal-disable")}}}a._currYear=l;a._currMonth=x;a._setCurrDateCls();a._checkNaviState()},_fireSelectedEvent:function(){var a=this;if(a._onDateSelected){a._onDateSelected.call(a,a._value)}},_doTableClick:function(d){d=jQuery.event.fix(d||window.event);var c=d.target,b=c.parentNode;if(b&&b.tagName&&b.tagName.toLowerCase()=="td"){if(!b.jslet_date_value){return}var a=jslet.ui.findFirstParent(b,function(e){return e.jslet});var g=a.jslet;g._value=b.jslet_date_value;g._setCurrDateCls();try{b.firstChild.focus()}catch(f){}g._fireSelectedEvent()}},_setCurrDateCls:function(){var a=this;if(!jslet.isDate(a._value)){return}var p=a._value.getMonth(),l=a._value.getFullYear(),w=a._value.getDate(),h=jqEl.find(".jl-cal-body table")[0],g=h.tBodies[0].rows,b=g.length,k,r,o,u,f,v,c;for(var s=0;s<b;s++){k=g[s];for(var q=0,n=k.cells.length;q<n;q++){r=k.cells[q];v=r.jslet_date_value;if(!v){continue}o=v.getMonth();f=v.getFullYear();u=v.getDate();c=jQuery(r.firstChild);if(f==l&&o==p&&u==w){if(!c.hasClass("jl-cal-current")){c.addClass("jl-cal-current")}try{r.firstChild.focus()}catch(t){}}else{c.removeClass("jl-cal-current")}}}},destroy:function($super){var a=jQuery(this.el);a.off();a.find(".jl-cal-body table").off();a.find(".jl-cal-today").off();a.find(".jl-cal-yprev").off();a.find(".jl-cal-mprev").off();a.find(".jl-cal-mnext").off();a.find(".jl-cal-ynext").off();$super()}});jslet.ui.register("Calendar",jslet.ui.Calendar);jslet.ui.Calendar.htmlTemplate="<div></div>";jslet.ui.FieldSet=jslet.Class.create(jslet.ui.Control,{initialize:function($super,a,c){var b=this;b.el=a;b.allProperties="caption,collapsed";b._caption=null;b._collapsed=false;$super(a,c)},caption:function(a){if(a===undefined){return this._caption}jslet.Checker.test("FieldSet.caption",a).isString();this._caption=a},collapsed:function(a){if(a===undefined){return this._collapsed}this._collapsed=a?true:false},bind:function(){this.renderAll()},renderAll:function(){var h=this,g=jQuery(h.el);if(!g.hasClass("jl-fieldset")){g.addClass("jl-fieldset jl-round5")}var b=['<legend class="jl-fieldset-legend">'];b.push('<span class="jl-fieldset-title"><i class="fa fa-chevron-circle-up jl-fieldset-btn">');b.push("<span>");b.push(h._caption);b.push('</span></span></legend><div class="jl-fieldset-body"></div>');var a=h.el.childNodes,e=[],d,c;c=a.length;for(d=0;d<c;d++){e.push(a[d])}g.html(b.join(""));var f=jQuery(h.el).find(".jl-fieldset-body")[0];c=e.length;for(d=0;d<c;d++){f.appendChild(e[d])}g.find(".jl-fieldset-btn").click(jQuery.proxy(h._doExpandBtnClick,this))},_doExpandBtnClick:function(){var c=this,b=jQuery(c.el);var a=b.find(".jl-fieldset-body");if(!c._collapsed){a.slideUp();b.addClass("jl-fieldset-collapse");b.find(".jl-fieldset-btn").addClass("fa-chevron-circle-down")}else{a.slideDown();b.removeClass("jl-fieldset-collapse");b.find(".jl-fieldset-btn").removeClass("fa-chevron-circle-down")}a[0].focus();c._collapsed=!c._collapsed},destroy:function($super){var a=jQuery(this.el);a.find("input.jl-fieldset-btn").off();$super()}});jslet.ui.register("FieldSet",jslet.ui.FieldSet);jslet.ui.FieldSet.htmlTemplate="<fieldset></fieldset>";jslet.ui.OverlayPanel=function(a,e){var b=document.createElement("div");jQuery(b).addClass("jl-overlay").on("click",function(k){k.stopPropagation();k.preventDefault()});if(e){b.style.backgroundColor=e}var d,h,c,i;if(!a){var g=jQuery(document.body);d=0;h=0;c=g.width();i=g.height()}else{c=jQuery(a).width();i=jQuery(a).height()}b.style.left="0px";b.style.top="0px";b.style.width=c+"px";b.style.height=i+"px";if(!a){document.body.appendChild(b)}else{a.appendChild(b)}b.style.display="none";var f=null;if(!a){f=window.onresize;window.onresize=function(){b.style.width=document.body.scrollWidth+"px";b.style.height=document.body.scrollHeight+"px"}}else{f=a.onresize;a.onresize=function(){var l=jQuery(a).width()-12;var k=jQuery(a).height()-12;b.style.width=l+"px";b.style.height=k+"px"}}this.overlayPanel=b;this.show=function(){b.style.display="block";return b};this.hide=function(){b.style.display="none";return b};this.setZIndex=function(k){this.overlayPanel.style.zIndex=k};this.destroy=function(){this.hide();if(!a){window.onresize=f;document.body.removeChild(b)}else{a.onresize=f;a.removeChild(b)}jQuery(this.overlayPanel).off()}};jslet.ui.menuManager={};jslet.ui.menuManager._menus=[];jslet.ui.menuManager.register=function(a){jslet.ui.menuManager._menus.push(a)};jslet.ui.menuManager.unregister=function(c){for(var b=0,a=this._menus.length;b<a;b++){jslet.ui.menuManager._menus.splice(b,1)}};jslet.ui.menuManager.hideAll=function(c){var f,e,d=jslet.ui.menuManager._menus;for(var b=0,a=d.length;b<a;b++){f=d[b];e=jslet("#"+f);if(e){e.hide()}}jslet.ui.menuManager.menuBarShown=false;jslet.ui.menuManager._contextObject=null};jQuery(document).on("mousedown",jslet.ui.menuManager.hideAll);jslet.ui.MenuBar=jslet.Class.create(jslet.ui.Control,{initialize:function($super,a,c){var b=this;b.el=a;b.allProperties="onItemClick,items";b._onItemClick=null;b._items=null;$super(a,c)},onItemClick:function(a){if(a===undefined){return this._onItemClick}jslet.Checker.test("MenuBar.onItemClick",a).isFunction();this._onItemClick=a},items:function(b){if(b===undefined){return this._items}jslet.Checker.test("MenuBar.items",b).isArray();var d;for(var c=0,a=b.length;c<a;c++){d=b[c];jslet.Checker.test("MenuBar.items.name",d.name).isString().required()}this._items=b},bind:function(){this.renderAll()},renderAll:function(){var b=this;var a=jQuery(b.el);if(!a.hasClass("jl-menubar")){a.addClass("jl-menubar jl-unselectable jl-bgcolor jl-round5")}b._createMenuBar();a.on("mouseout",function(c){if(b._preHoverItem&&!jslet.ui.menuManager.menuBarShown){jQuery(b._preHoverItem).removeClass("jl-menubar-item-hover")}})},_createMenuBar:function(){var d=this;if(d.isPopup){return}for(var b=0,a=d._items.length,c;b<a;b++){c=d._items[b];d._createBarItem(d.el,c,d._menubarclick)}},_showSubMenu:function(h){var b=h.parentNode.jslet,k=h.jsletvar;if(!k.items){return}if(!k.subMenu){var c=document.createElement("div");document.body.appendChild(c);k.subMenu=new jslet.ui.Menu(c,{onItemClick:b._onItemClick,items:k.items})}var f=jQuery(document.body),e=parseInt(f.css("margin-top")),d=parseInt(f.css("margin-left")),g=jQuery(h),i=g.offset(),a=i.left;if(jslet.locale.isRtl){a+=g.width()+10}k.subMenu.show(a,i.top+g.height());jslet.ui.menuManager.menuBarShown=true;b._activeMenuItem=h},_createBarItem:function(a,d){if(d.visible!==undefined&&!d.visible){return}var f=document.createElement("div");jQuery(f).addClass("jl-menubar-item");f.jsletvar=d;var e=this,b=jQuery(f);b.on("click",function(h){var g=this.jsletvar;if(!g.items){if(g.onClick){g.onClick.call(e,g.id||g.name)}else{if(e._onItemClick){e._onItemClick.call(e,g.id||g.name)}}jslet.ui.menuManager.hideAll()}else{e._showSubMenu(this)}h.stopPropagation();h.preventDefault()});b.on("mouseover",function(g){if(e._preHoverItem){jQuery(e._preHoverItem).removeClass("jl-menubar-item-hover")}e._preHoverItem=this;jQuery(this).addClass("jl-menubar-item-hover");if(jslet.ui.menuManager.menuBarShown){jslet.ui.menuManager.hideAll();e._showSubMenu(this);jslet.ui.menuManager._inPopupMenu=true}});var c=[];c.push('<a class="jl-focusable-item" href="javascript:void(0)">');c.push(d.name);c.push("</a>");f.innerHTML=c.join("");a.appendChild(f)},destroy:function($super){var b=this;b._activeMenuItem=null;b._preHoverItem=null;b._menubarclick=null;b._onItemClick=null;var a=jQuery(b.el);a.off();a.find(".jl-menubar-item").off();a.find(".jl-menubar-item").each(function(){var c=this;if(c.jsletvar){c.jsletvar.subMenu=null;c.jsletvar=null}});$super()}});jslet.ui.register("MenuBar",jslet.ui.MenuBar);jslet.ui.MenuBar.htmlTemplate="<div></div>";jslet.ui.Menu=jslet.Class.create(jslet.ui.Control,{_onItemClick:undefined,_items:undefined,_invoker:null,initialize:function($super,a,c){var b=this;b.el=a;b.allProperties="onItemClick,items,invoker";$super(a,c);b._activeSubMenu=null},onItemClick:function(a){if(a===undefined){return this._onItemClick}jslet.Checker.test("Menu.onItemClick",a).isFunction();this._onItemClick=a},items:function(b){if(b===undefined){return this._items}jslet.Checker.test("Menu.items",b).isArray();var d;for(var c=0,a=b.length;c<a;c++){d=b[c];jslet.Checker.test("Menu.items.name",d.name).isString().required()}this._items=b},invoker:function(a){if(a===undefined){return this._invoker}this._invoker=a},bind:function(){this.renderAll()},renderAll:function(){var c=this,b=jQuery(c.el),a=c.el;if(!b.hasClass("jl-menu")){b.addClass("jl-menu")}a.style.display="none";if(!a.id){a.id=jslet.nextId()}jslet.ui.menuManager.register(a.id);c._createMenuPopup();b.on("mousedown",function(d){d=jQuery.event.fix(d||window.event);d.stopPropagation();d.preventDefault();return false});b.on("mouseover",function(d){jslet.ui.menuManager._inPopupMenu=true;if(jslet.ui.menuManager.timerId){window.clearTimeout(jslet.ui.menuManager.timerId)}});b.on("mouseout",function(d){jslet.ui.menuManager._inPopupMenu=false;jslet.ui.menuManager.timerId=window.setTimeout(function(){if(!jslet.ui.menuManager._inPopupMenu){jslet.ui.menuManager.hideAll()}jslet.ui.menuManager.timerId=null},800)})},show:function(d,g){var a=this,c=jQuery(a.el),b=c.outerWidth(),i=c.outerHeight(),h=jQuery(window),e=h.scrollLeft()+h.width(),f=h.scrollTop()+h.height();d=d||a.left||10;g=g||a.top||10;if(jslet.locale.isRtl){d-=b}if(d+b>e){d+=e-d-b-1}if(g+i>f){g+=f-g-i-1}if(d<0){d=0}if(g<0){g=0}a.el.style.left=d+"px";a.el.style.top=parseInt(g)+"px";a.el.style.display="block";if(!a.shadow){a.shadow=document.createElement("div");jQuery(a.shadow).addClass("jl-menu-shadow");a.shadow.style.width=b+"px";a.shadow.style.height=i+"px";document.body.appendChild(a.shadow)}a.shadow.style.left=d+1+"px";a.shadow.style.top=g+1+"px";a.shadow.style.display="block"},hide:function(){this.ctxElement=null;this.el.style.display="none";if(this.shadow){this.shadow.style.display="none"}},showContextMenu:function(a,b){jslet.ui.menuManager.hideAll();a=jQuery.event.fix(a||window.event);jslet.ui.menuManager._contextObject=b;this.show(a.pageX,a.pageY);a.preventDefault()},_createMenuPopup:function(){var a=this.el,g=this._items,h,b,f,c;c=g.length;for(f=0;f<c;f++){h=g[f];if(!h.name){continue}b=h.name.trim();if(b!="-"){this._createMenuItem(a,h)}else{this._createLine(a,h)}}var k=jQuery(a).width()-2+"px",e=a.childNodes,d;c=e.length;for(f=0;f<c;f++){d=e[f];if(d.nodeType==1){d.style.width=k}}document.body.appendChild(a)},_ItemClick:function(b,a){if(a.items){this._showSubMenu(b,a);return}if(a.disabled){return}var c=jslet.ui.menuManager._contextObject||this;if(a.onClick){a.onClick.call(c,a.id||a.name,a.checked)}else{if(this._onItemClick){this._onItemClick.call(c,a.id||a.name,a.checked)}}if(a.itemType=="check"||a.itemType=="radio"){jslet.ui.Menu.setChecked(b,!a.checked)}jslet.ui.menuManager.hideAll()},_hideSubMenu:function(){var a=this;if(a._activeSubMenu){a._activeSubMenu._hideSubMenu();a._activeSubMenu.hide();a._activeSubMenu.el.style.zIndex=parseInt(jQuery(a.el).css("zIndex"))}},_showSubMenu:function(b,a,e){var d=this;var c=function(){d._hideSubMenu();if(!a.subMenu){return}var g=jQuery(b),h=g.offset(),f=h.left;if(!jslet.locale.isRtl){f+=g.width()}a.subMenu.show(f-2,h.top);a.subMenu.el.style.zIndex=parseInt(jQuery(d.el).css("zIndex"))+1;d._activeSubMenu=a.subMenu};if(e){window.setTimeout(c,e)}else{c()}},_ItemOver:function(b,a){if(this._activeSubMenu){this._showSubMenu(b,a,200)}},_createMenuItem:function(c,i,b){var e=false,l=false,h=i.itemType;if(h){e=(h=="check");l=(h=="radio")}if(e){i.iconClass="jl-menu-check";i.disabledIconClass="jl-menu-check-disabled"}if(l){i.iconClass="jl-menu-radio";i.disabledIconClass="jl-menu-radio-disabled"}if(i.items){i.disabled=false}var f=document.createElement("div"),a=this,g=jQuery(f);g.addClass("jl-menu-item "+(i.disabled?"jl-menu-disabled":"jl-menu-enabled"));if(!i.id){i.id=jslet.nextId()}f.id=i.id;f.jsletvar=i;g.on("click",function(m){a._ItemClick(this,this.jsletvar);m.stopPropagation();m.preventDefault()});g.on("mouseover",function(m){a._ItemOver(this,this.jsletvar);if(a._preHoverItem){jQuery(a._preHoverItem).removeClass("jl-menu-item-hover")}a._preHoverItem=this;if(!this.jsletvar.disabled){jQuery(this).addClass("jl-menu-item-hover")}});g.on("mouseout",function(m){if(!this.jsletvar.subMenu){jQuery(this).removeClass("jl-menu-item-hover")}});var k=[];k.push('<span class="jl-menu-icon-placeholder ');if((e||l)&&!i.checked){}else{if(i.iconClass){k.push((!i.disabled||!i.disabledIconClass)?i.iconClass:i.disabledIconClass)}}k.push('"></span>');if(i.items){k.push('<div class="jl-menu-arrow"></div>')}k.push('<a  href="javascript:void(0)" class="jl-focusable-item jl-menu-content ');k.push(" jl-menu-content-left jl-menu-content-right");k.push('">');k.push(i.name);k.push("</a>");f.innerHTML=k.join("");c.appendChild(f);if(i.items){var d=document.createElement("div");document.body.appendChild(d);i.subMenu=new jslet.ui.Menu(d,{onItemClick:a._onItemClick,items:i.items,invoker:f})}},_createLine:function(a,c){var b=document.createElement("div");jQuery(b).addClass("jl-menu-line");a.appendChild(b)},destroy:function($super){var b=this,a=jQuery(b.el);b._activeSubMenu=null;jslet.ui.menuManager.unregister(b.el.id);a.off();a.find(".jl-menu-item").each(function(){this.onmouseover=null;this.onclick=null;this.onmouseout=null});$super()}});jslet.ui.register("Menu",jslet.ui.Menu);jslet.ui.Menu.htmlTemplate="<div></div>";jslet.ui.Menu.setDisabled=function(d,c){var b;if(Object.isString(d)){b=jQuery("#"+d)}else{b=jQuery(d)}var a=b.context.jsletvar;if(a.items){return}if(c){b.removeClass("jl-menu-enabled");b.addClass("jl-menu-disabled")}else{b.removeClass("jl-menu-disabled");b.addClass("jl-menu-enabled")}a.disabled=c};jslet.ui.Menu.setChecked=function(l,o){var g;if(typeof(l)==="string"){g=jQuery("#"+l)}else{g=jQuery(l)}var f=g.context,h=f.jsletvar,k=h.itemType;if(k!="check"&&k!="radio"){return}if(k=="radio"){if(h.checked&&o||!o){return}var p=f.group;var e=f.parentNode.childNodes;for(var d=0,b,c,m,a=e.length;d<a;d++){b=e[d];if(b==f){continue}c=b.jsletvar;if(c&&c.itemType=="radio"&&c.group==p){m=b.childNodes[0];if(c.disabled){jQuery(m).removeClass(c.disabledIconClass)}else{jQuery(m).removeClass(c.iconClass)}c.checked=false}}}var n=jQuery(f.childNodes[0]);if(h.checked&&!o){if(h.disabled){n.removeClass(h.disabledIconClass)}else{n.removeClass(h.iconClass)}}if(!h.checked&&o){if(h.disabled){n.addClass(h.disabledIconClass)}else{n.addClass(h.iconClass)}}h.checked=o};jslet.ui.SplitPanel=jslet.Class.create(jslet.ui.Control,{directions:["hori","vert"],initialize:function($super,a,c){var b=this;b.el=a;b.allProperties="direction,floatIndex,onExpanded,onSize";b._direction="hori";b._floatIndex=1;b._onExpanded=null;b._onSize=null;b.panels=null;b.splitter=null;b._oldSize=0;jslet.resizeEventBus.subscribe(b);$super(a,c)},floatIndex:function(a){if(a===undefined){return this._floatIndex}jslet.Checker.test("SplitPanel.floatIndex",a).isGTEZero();this._floatIndex=a},direction:function(b){if(b===undefined){return this._direction}b=jQuery.trim(b);var a=jslet.Checker.test("SplitPanel.direction",b).required().isString();b=b.toLowerCase();a.inArray(this.directions);this._direction=b},onExpanded:function(a){if(a===undefined){return this._onExpanded}jslet.Checker.test("SplitPanel.onExpanded",a).isFunction();this._onExpanded=a},onSize:function(a){if(a===undefined){return this._onSize}jslet.Checker.test("SplitPanel.onSize",a).isFunction();this._onSize=a},bind:function(){this.renderAll()},renderAll:function(){var c=this,f=jQuery(c.el);if(!f.hasClass("jl-splitpanel")){f.addClass("jl-splitpanel jl-border-box jl-round5")}c.isHori=(c._direction=="hori");c.width=f.innerWidth();c.height=f.innerHeight();c._oldSize=c.isHori?c.width:c.height;var k=f.find(">div"),n=k.length-1;if(!c._floatIndex||c._floatIndex>n){c._floatIndex=n}if(c._floatIndex>n){c._floatIndex=n}if(!c.panels){c.panels=[]}var a=(c.isHori?c.width:c.height),g=0;k.each(function(i){var u=jQuery(k[i]),t=c.panels[i];if(!t){t={};c.panels[i]=t}var s=parseInt(u.css(c.isHori?"min-width":"min-height"));t.minSize=s?s:5;var v=parseInt(u.css(c.isHori?"max-width":"max-height"));t.maxSize=v?v:Infinity;t.expanded=u.css("display")!="none";var r=t.size;if(r===null||r===undefined){r=c.isHori?u.outerWidth():u.outerHeight()}else{if(c.isHori){u.width(r-5)}else{u.height(r-5)}}if(i!=c._floatIndex){g+=r;t.size=r}});c.panels[c._floatIndex].size=a-g;c.splitterTracker=document.createElement("div");var q=jQuery(c.splitterTracker);q.addClass("jl-sp-splitter-tracker");var b=0,h=c.isHori?"jl-sp-panel-hori":"jl-sp-panel-vert";c.splitterClsName=c.isHori?"jl-sp-splitter-hori":"jl-sp-splitter-vert";c.el.appendChild(c.splitterTracker);if(c.isHori){c.splitterTracker.style.height="100%"}else{c.splitterTracker.style.width="100%"}var p=parseInt(jslet.ui.getCssValue(c.splitterClsName,c.isHori?"width":"height"));k.after(function(s){var i=k[s],t=jQuery(i),r=c.panels[s].expanded;t.addClass(h);if(s==c._floatIndex){c.floatPanel=i}else{if(r){b+=p+c.panels[s].size}else{t.css("display","none");b+=p}}if(s==n){if(c.isHori){return'<div style="clear:both;width:0px"></div>'}return""}var v=jslet.nextId(),u=c.isHori?"jl-sp-button-left":"jl-sp-button-top";if(c._floatIndex<=s||!r){u+=c.isHori?" jl-sp-button-right":" jl-sp-button-bottom"}return'<div class="'+c.splitterClsName+' jl-unselectable" id = "'+v+'" jsletindex="'+(s>=c._floatIndex?s+1:s)+'"><div class="jl-sp-button '+u+'"'+(r?"":' jsletcollapsed="1"')+"></div></div>"});if(c.isHori){jQuery(c.floatPanel).width(f.innerWidth()-b-4)}else{jQuery(c.floatPanel).height(f.innerHeight()-b)}var m=f.find("."+c.splitterClsName);m.on("mousedown",c._splitterMouseDown);var d=m.children();d.on("mousedown",function(t){var i=jQuery(t.target),s=i.parent(),r=parseInt(s.attr("jsletindex"));c.expand(r);t.stopPropagation()});var o;for(var l=0,e=m.length;l<e;l++){o=m[l];o._doDragStart=c._splitterDragStart;o._doDragging=c._splitterDragging;o._doDragEnd=c._splitterDragEnd;o._doDragCancel=c._splitterDragCancel}},floatPanel:function(){return Z.panels[Z._floatIndex]},changeSize:function(a,b){},expand:function(h,i,g){var b=this,a,c=jQuery(b.el),e=c.find("."+b.splitterClsName);if(h<0||h>e.length){return}var d=jQuery(e[(h>=b._floatIndex?h-1:h)]),f=d.find(":first-child");if(i===undefined){i=f.attr("jsletcollapsed")=="1"}if(h<b._floatIndex){a=d.prev()}else{a=d.next()}if(b.isHori){if(f.hasClass("jl-sp-button-right")){f.removeClass("jl-sp-button-right")}else{f.addClass("jl-sp-button-right")}}else{if(f.hasClass("jl-sp-button-bottom")){f.removeClass("jl-sp-button-bottom")}else{f.addClass("jl-sp-button-bottom")}}if(i){a.css("display","block");f.attr("jsletcollapsed","0")}else{a.css("display","none");f.attr("jsletcollapsed","1")}if(g){return}var k=jQuery(b.floatPanel);if(b.isHori){k.width(k.width()+a.width()*(i?-1:1))}else{k.height(k.height()+a.height()*(i?-1:1))}b.panels[h].expanded=i;if(b._onExpanded){b._onExpanded.call(b,panelIndex)}jslet.resizeEventBus.resize(b.el)},_splitterMouseDown:function(b){var d=jQuery(this).position(),c=this.parentNode.jslet;c.splitterTracker.style.top=d.top+"px";c.splitterTracker.style.left=d.left+"px";c.draggingId=this.id;var a=jQuery("#"+c.draggingId);jqBtn=a.find(":first-child");if(jqBtn.attr("jsletcollapsed")=="1"){jqBtn.click();return}jslet.ui.dnd.bindControl(this)},_splitterDragStart:function(m,l,k,i,d,c){var a=this.parentNode.jslet,n=jQuery(a.splitterTracker),b=jQuery("#"+a.draggingId),f=parseInt(b.attr("jsletindex")),e=a.panels[f],h=jQuery(a.floatPanel);a.dragRangeMin=e.size-e.minSize;a.dragRangeMax=e.maxSize-e.size;var g=(a.isHori?h.width():h.height())-a.panels[a._floatIndex].minSize;if(a.dragRangeMax>g){a.dragRangeMax=g}n.show()},_splitterDragging:function(m,l,i,h,d,c){var a=this.parentNode.jslet,n=jQuery(a.splitterTracker),b=jQuery("#"+a.draggingId),f=parseInt(b.attr("jsletindex")),k=Math.abs(a.isHori?d:c),e;if(a.isHori){e=f<a._floatIndex&&d>=0||f>a._floatIndex&&d<0}else{e=f<a._floatIndex&&c>=0||f>a._floatIndex&&c<0}if(e&&k>a.dragRangeMax){a.endDelta=a.dragRangeMax;return}if(!e&&k>a.dragRangeMin){a.endDelta=a.dragRangeMin;return}a.endDelta=Math.abs(a.isHori?d:c);var g=n.offset();if(a.isHori){g.left=i}else{g.top=h}n.offset(g)},_splitterDragEnd:function(o,n,l,k,e,d){var b=this.parentNode.jslet,p=jQuery(b.splitterTracker),c=jQuery("#"+b.draggingId),h=parseInt(c.attr("jsletindex")),a=h<b._floatIndex?c.prev():c.next(),g,i=jQuery(b.floatPanel);if(b.isHori){g=h<b._floatIndex&&e>=0||h>b._floatIndex&&e<0}else{g=h<b._floatIndex&&d>=0||h>b._floatIndex&&d<0}var m=b.endDelta*(g?1:-1);var f=b.panels[h].size+m;b.panels[h].size=f;if(b.isHori){a.width(f);i.width(i.width()-m)}else{a.height(f);i.height(i.height()-m)}if(b._onSize){b._onSize.call(b,h,f)}jslet.resizeEventBus.resize(b.el);p.hide()},_splitterDragCancel:function(e,d,b,h,c,a){var f=this.parentNode.jslet,g=jQuery(f.splitterTracker);g.hide()},checkSizeChanged:function(){var e=this,d=jQuery(e.el),f=e.isHori?d.width():d.height();if(e._oldSize!=f){var g=f-e._oldSize;e._oldSize=f;var a=e.panels[e._floatIndex],c=jQuery(e.floatPanel),b=g+(e.isHori?c.width():c.height());if(b<a.minSize){b=a.minSize}if(e.isHori){c.width(b)}else{c.height(b)}}jslet.resizeEventBus.resize(e.floatPanel)},destroy:function($super){var f=this,e=jQuery(f.el);f.splitterTracker=null;f.floatPanel=null;var d=e.find("."+f.splitterClsName);d.off("mousedown",f._splitterMouseDown);var c;for(var b=0,a=d.length;b<a;b++){c=d[b];jslet.ui.dnd.unbindControl(c);c._doDragStart=null;c._doDragging=null;c._doDragEnd=null;c._doDragCancel=null}jslet.resizeEventBus.unsubscribe(f);$super()}});jslet.ui.register("SplitPanel",jslet.ui.SplitPanel);jslet.ui.SplitPanel.htmlTemplate="<div></div>";jslet.ui.TabControl=jslet.Class.create(jslet.ui.Control,{initialize:function($super,a,c){var b=this;b.el=a;b.allProperties="selectedIndex,newable,closable,items,onAddTabItem,onSelectedChanged,onRemoveTabItem,onCreateContextMenu";b._selectedIndex=0;b._newable=true;b._closable=true;b._onSelectedChanged=null;b._onAddTabItem=null;b._onRemoveTabItem=null;b._onCreateContextMenu=null;b._items=[];b._itemsWidth=[];b._containerWidth=0;b._ready=false;b._leftIndex=0;b._rightIndex=0;b._tabControlWidth=jQuery(b.el).width();jslet.resizeEventBus.subscribe(this);$super(a,c)},selectedIndex:function(a){if(a===undefined){return this._selectedIndex}jslet.Checker.test("TabControl.selectedIndex",a).isGTEZero();if(this._ready){this._chgSelectedIndex(a)}else{this._selectedIndex=a}},newable:function(a){if(a===undefined){return this._newable}this._newable=a?true:false},closable:function(a){if(a===undefined){return this._closable}this._closable=a?true:false},onAddTabItem:function(a){if(a===undefined){return this._onAddTabItem}jslet.Checker.test("TabControl.onAddTabItem",a).isFunction();this._onAddTabItem=a},onSelectedChanged:function(a){if(a===undefined){return this._onSelectedChanged}jslet.Checker.test("TabControl.onSelectedChanged",a).isFunction();this._onSelectedChanged=a},onRemoveTabItem:function(a){if(a===undefined){return this._onRemoveTabItem}jslet.Checker.test("TabControl.onRemoveTabItem",a).isFunction();this._onRemoveTabItem=a},onCreateContextMenu:function(a){if(a===undefined){return this._onCreateContextMenu}jslet.Checker.test("TabControl.onCreateContextMenu",a).isFunction();this._onCreateContextMenu=a},items:function(b){if(b===undefined){return this._items}jslet.Checker.test("TabControl.items",b).isArray();var d;for(var c=0,a=b.length;c<a;c++){d=b[c];jslet.Checker.test("TabControl.items.header",d.header).isString().required()}this._items=b},bind:function(){this.renderAll()},renderAll:function(){var g=this,e=['<div class="jl-tab-header jl-unselectable"><div class="jl-tab-container jl-unselectable"><ul class="jl-tab-list">',g._newable?'<li><a href="javascript:;" class="jl-tab-inner"><span class="jl-tab-new">+</span></a></li>':"",'</ul></div><a class="jl-tab-left jl-hidden"><span class="jl-nav-btn glyphicon glyphicon-circle-arrow-left"></span></a><a class="jl-tab-right  jl-hidden"><span class="jl-nav-btn glyphicon glyphicon-circle-arrow-right"></span></a></div><div class="jl-tab-items jl-round5"></div>'];var f=jQuery(g.el);if(!f.hasClass("jl-tabcontrol")){f.addClass("jl-tabcontrol jl-round5")}f.html(e.join(""));if(g._newable){oul=f.find(".jl-tab-list")[0];var h=oul.childNodes[oul.childNodes.length-1];g._newTabItem=h;h.onclick=function(){var i=null;if(g._onAddTabItem){i=g._onAddTabItem.call(g)}if(!i){i=new jslet.ui.TabItem();i.header="new tab";i.closable=true}g.addTabItem(i);g._calcItemsWidth();g.selectedIndex(g._items.length-1)}}var b=f.find(".jl-tab-left");b.on("click",function(i){g._setVisiTabItems(g._leftIndex-1);i.stopImmediatePropagation();i.preventDefault();return false});b.on("mousedown",function(i){i.stopImmediatePropagation();i.preventDefault();return false});b=f.find(".jl-tab-right");b.on("click",function(i){g._setVisiTabItems(g._leftIndex+1);i.stopImmediatePropagation();i.preventDefault();return false});b.on("mousedown",function(i){i.stopImmediatePropagation();i.preventDefault();return false});if(g._items&&g._items.length>0){var a,d=g._items.length;for(var c=0;c<d;c++){a=g._items[c];g.addTabItem(a,true)}}g._calcItemsWidth();g._ready=true;g._chgSelectedIndex(g._selectedIndex)},addItem:function(a){this._items[this._items.length]=a},tabLabel:function(c,b){jslet.Checker.test("tabLabel#index",c).isGTEZero();jslet.Checker.test("tabLabel#label",b).required().isString();var g=this;var f=g._getTabItemCfg(c);if(!f){return}f.label(b);var e=jQuery(g.el);var d=e.find(".jl-tab-items")[0];var a=d.childNodes;jQuery(a[c]).find(".jl-tab-title").html(b);g._calcItemsWidth()},tabDisabled:function(b,e){jslet.Checker.test("tabLabel#index",b).isGTEZero();var h=this;var g=h._getTabItemCfg(b);if(!g){return}if(b==h._selectedIndex){console.warn("Cannot set current tab item to disabled.");return}g.disabled(e);var f=jQuery(h.el);var d=f.find(".jl-tab-items")[0];var a=d.childNodes;var c=jQuery(a[b]);if(e){c.addClass("jl-tab-disabled")}else{c.removeClass("jl-tab-disabled")}},_chgSelectedIndex:function(f){var a=this;var l=a._getTabItemCfg(f);if(!l||l.disabled){return}if(a._onSelectedChanged){var m=a._onSelectedChanged.call(a,a._selectedIndex,f);if(m!==undefined&&!m){return}}var d=jQuery(a.el),o,k=d.find(".jl-tab-list")[0],b=k.childNodes,c=b.length-(a._newable?2:1);var h=d.find(".jl-tab-items")[0],n,g=h.childNodes;for(var e=0;e<=c;e++){o=jQuery(b[e]);n=g[e];if(e==f){o.addClass("jl-tab-selected");n.style.display="block"}else{o.removeClass("jl-tab-selected");n.style.display="none"}}a._selectedIndex=f;if(f<a._leftIndex||f>=a._rightIndex){a._setVisiTabItems(null,a._selectedIndex)}},_getTabItemCfg:function(a){var b=this;if(b._items.length<=a){return null}return b._items[a]},_calcItemsWidth:function(){var c=this,b=jQuery(c.el),a=b.find(".jl-tab-list").children();c._itemsWidth=[];a.each(function(d){c._itemsWidth[d]=jQuery(this).outerWidth()+5});c._containerWidth=b.find(".jl-tab-container").innerWidth()},_setVisiTabItems:function(e,g){var h=this,b;if(!e&&e!==0){if(!g){return}if(h._newable){g++}b=h._itemsWidth[g];h._leftIndex=g;for(var d=g-1;d>=0;d--){b+=h._itemsWidth[d];if(b>h._containerWidth){h._leftIndex=d+1;break}h._leftIndex=d}e=h._leftIndex}else{h._leftIndex=e}b=0;h._rightIndex=e;for(var d=e,a=h._itemsWidth.length;d<a;d++){b+=h._itemsWidth[d];if(b>h._containerWidth){h._rightIndex=d-1;break}h._rightIndex=d}var c=0;for(var d=0;d<h._leftIndex;d++){c+=h._itemsWidth[d]}c+=5;var f=jQuery(h.el);f.find(".jl-tab-container").scrollLeft(jslet.locale.isRtl?50000-c:c);h._setNavBtnVisible()},_setNavBtnVisible:function(){var f=this,e=jQuery(f.el),d=e.find(".jl-tab-left"),a=d.hasClass("jl-hidden");if(f._leftIndex>0){if(a){d.removeClass("jl-hidden")}}else{if(!a){d.addClass("jl-hidden")}}var b=e.find(".jl-tab-right");var a=b.hasClass("jl-hidden");var c=f._itemsWidth.length;if(f._rightIndex<c-1){if(a){b.removeClass("jl-hidden")}}else{if(!a){b.addClass("jl-hidden")}}},_createHeader:function(c,f){var g=this,b=['<a href="javascript:;" class="jl-tab-inner" onclick="javascript:this.blur();"><span class="jl-tab-title '],a=g._closable&&f.closable;if(a){b.push("jl-tab-close-loc ")}b.push('">');b.push(f.header);b.push("</span>");b.push("</a>");if(a){b.push('<a href="javascript:;" class="jl-tab-close glyphicon glyphicon-remove"></a>')}var e=document.createElement("li");if(f.disabled){jQuery(e).addClass("jl-tab-disabled")}e.innerHTML=b.join("");if(g._newable){var d=c.childNodes[c.childNodes.length-1];c.insertBefore(e,d)}else{c.appendChild(e)}e.jslet=g;jQuery(e).on("click",g._changeTabItem);if(a){jQuery(e).find(".jl-tab-close").click(g._doCloseBtnClick)}},_changeTabItem:function(d){var a=this.parentNode.childNodes,b=-1;for(var c=0;c<a.length;c++){if(a[c]==this){b=c;break}}this.jslet._chgSelectedIndex(b)},_doCloseBtnClick:function(d){var e=this.parentNode,a=e.parentNode.childNodes,b=-1;for(var c=0;c<a.length;c++){if(a[c]==e){b=c;break}}e.jslet.removeTabItem(b);d.preventDefault();return false},_createBody:function(l,k){var a=this,d=jQuery(document.createElement("div"));if(!d.hasClass("jl-tab-panel")){d.addClass("jl-tab-panel")}var b=d[0];l.appendChild(b);var g=4,c=jQuery(a.el),i=c.find(".jl-tab-header"),e=k.height;e=e?e:300;if(k.content||k.divId){var f=k.content?k.content:jQuery("#"+k.divId)[0];if(f){var m=f.parentNode;if(m&&m!=b){m.removeChild(f)}b.appendChild(f);f.style.display="block";return}}if(k.url){if(k.useIFrame){var n='<iframe scrolling="yes" frameborder="0" src="'+k.url+'" style="width: 100%;height:'+e+'px;"></iframe>';d.html(n)}}},addTabItem:function(b,f){var e=this,d=jQuery(e.el),a=d.find(".jl-tab-list")[0];e._items.push(b);e._createHeader(a,b);var c=d.find(".jl-tab-items")[0];e._createBody(c,b);if(!f){e._calcItemsWidth();e._chgSelectedIndex(e._selectedIndex+1)}},removeTabItem:function(c){var a=this,d=jQuery(a.el),k,h=d.find(".jl-tab-list")[0],b=h.childNodes,e=b.length-(a._newable?2:1);if(c>e||c<0){return}k=jQuery(b[c]);var g=k.hasClass("jl-tab-selected");if(a._onRemoveTabItem){var i=a._onRemoveTabItem.call(a,c,g);if(!i){return}}h.removeChild(k[0]);a._items.splice(c,1);var f=d.find(".jl-tab-items")[0];b=f.childNodes;f.removeChild(b[c]);a._calcItemsWidth();if(g){e--;c=a._getNextValidIndex(c,c>=e);if(c>=0){a._chgSelectedIndex(c)}}},_getNextValidIndex:function(e,d){var c=this;if(d){for(var b=e-1;b>=0;b--){if(!c._items[b].disabled){return b}}}else{for(var b=e+1,a=c._items.length;b<a;b++){if(!c._items[b].disabled){return b}}}return -1},close:function(){var b=this,a=b._selectedIndex;if(a>=0&&b._items[a].closable){b.removeTabItem(a)}b._calcItemsWidth()},closeOther:function(){var b=this;for(var a=b._items.length-1;a>=0;a--){if(b._items[a].closable){if(b._selectedIndex==a){continue}b.removeTabItem(a)}}b._calcItemsWidth()},checkSizeChanged:function(){var b=this,a=jQuery(b.el).width();if(b._tabControlWidth!=a){b._tabControlWidth=a;b._calcItemsWidth();b._setVisiTabItems(b._leftIndex)}},_createContextMenu:function(){var b=this;if(!jslet.ui.Menu||!b._closable){return}var c={type:"Menu",onItemClick:b._menuItemClick,items:[{id:"close",name:jslet.locale.TabControl.close},{id:"closeOther",name:jslet.locale.TabControl.closeOther}]};if(b._onCreateContextMenu){b._onCreateContextMenu.call(b,c.items)}if(c.items.length===0){return}b.contextMenu=jslet.ui.createControl(c);var a=jQuery(b.el).find(".jl-tab-container")[0];a.oncontextmenu=function(e){var d=e||window.event;b.contextMenu.showContextMenu(d,b)}},_menuItemClick:function(b,a){if(b=="close"){this.close()}else{if(b=="closeOther"){this.closeOther()}}},destroy:function($super){var d=this;if(d._newTabItem){d._newTabItem.onclick=null;d._newTabItem=null}var c=jQuery(d.el),b=c.find(".jl-tab-header")[0];c.find(".jl-tab-left").off();c.find(".jl-tab-right").off();b.oncontextmenu=null;c.find(".jl-tab-close").off();var a=c.find(".jl-tab-list").find("li");a.off();a.each(function(){this.jslet=null});jslet.resizeEventBus.unsubscribe(this);$super()}});jslet.ui.register("TabControl",jslet.ui.TabControl);jslet.ui.TabControl.htmlTemplate="<div></div>";jslet.ui.TabItem=function(){var a=this;a.id=null;a.index=-1;a.header=null;a.closable=false;a.disabled=false;a.useIFrame=false;a.height=100;a.url=null;a.divId=null;a.content=null};jslet.ui.TipPanel=function(){this._hideTimerId=null;this._showTimerId=null;this._oldElement=null;var a=document.createElement("div");jQuery(a).addClass("jl-tip-panel");document.body.appendChild(a);this._tipPanel=a;this.show=function(f,c,h){var b=this;var e=arguments.length;var g=false,d=c;if(e==2){var i=d;i=jQuery.event.fix(i);h=i.pageY+16;d=i.pageX+2;var k=i.currentTarget;g=(k===b._oldElement);b._oldElement=k}else{d=parseInt(d);h=parseInt(h)}if(b._hideTimerId){window.clearTimeout(b._hideTimerId);if(g){return}}this._showTimerId=window.setTimeout(function(){var l=b._tipPanel;l.innerHTML=f;l.style.left=d+"px";l.style.top=h+"px";b._tipPanel.style.display="block";b._showTimerId=null},300)};this.hide=function(){var b=this;if(b._showTimerId){window.clearTimeout(b._showTimerId);return}b._hideTimerId=window.setTimeout(function(){b._tipPanel.style.display="none";b._hideTimerId=null;b._oldElement=null},300)}};jslet.ui.globalTip=new jslet.ui.TipPanel();jslet.ui.WaitingBox=function(a,e,d){var b=new jslet.ui.OverlayPanel(a);var c='<div class="jl-waitingbox"><b class="jl-waitingbox-icon"></b>';c+='<span id="tips"></span></div>';jQuery(b.overlayPanel).html(c);this.show=function(g){var l=b.overlayPanel,i=l.firstChild,k=i.childNodes[1];k.innerHTML=g?g:"";var f=jQuery(l),m=f.height(),h=f.width();setTimeout(function(){var n=jQuery(i);i.style.top=Math.round((m-n.height())/2)+"px";i.style.left=Math.round((h-n.width())/2)+"px"},10);b.show()};this.hide=function(){b.hide()};this.destroy=function(){b.overlayPanel.innerHTML="";b.destroy()}};jslet.ui.Window=jslet.Class.create(jslet.ui.Control,{initialize:function($super,a,c){var b=this;b.el=a;b.allProperties="caption,resizable,minimizable,maximizable,closable,iconClass,onSizeChanged,onClosed,onPositionChanged,onActive,width,height,minWidth,maxWidth,minHeight,maxHeight,isCenter,stopEventBubling";b._caption=null;b._resizable=true;b._minimizable=true;b._maximizable=true;b._closable=true;b._iconClass=null;b._width=0;b._height=0;b._minWidth=20;b._minHeight=30;b._maxWidth=-1;b._maxHeight=-1;b._isCenter=false;b._onSizeChanged=null;b._onPositionChanged=null;b._onActive=null;b._onClosed=null;b._stopEventBubling=false;b.isModal=false;b.state=null;$super(a,c)},caption:function(a){if(a===undefined){return this._caption}jslet.Checker.test("Window.caption",a).isString();this._caption=a},iconClass:function(a){if(a===undefined){return this._iconClass}jslet.Checker.test("Window.iconClass",a).isString();this._iconClass=a},resizable:function(a){if(a===undefined){return this._resizable}this._resizable=a?true:false},minimizable:function(a){if(a===undefined){return this._minimizable}this._minimizable=a?true:false},maximizable:function(a){if(a===undefined){return this._maximizable}this._maximizable=a?true:false},closable:function(a){if(a===undefined){return this._closable}this._closable=a?true:false},isCenter:function(a){if(a===undefined){return this._isCenter}this._isCenter=a?true:false},stopEventBubling:function(a){if(a===undefined){return this._stopEventBubling}this._stopEventBubling=a?true:false},width:function(a){if(a===undefined){return this._width}jslet.Checker.test("Window.width",a).isGTZero();this._width=a},height:function(a){if(a===undefined){return this._height}jslet.Checker.test("Window.height",a).isGTZero();this._height=a},minWidth:function(a){if(a===undefined){return this._minWidth}jslet.Checker.test("Window.minWidth",a).isGTZero();this._minWidth=a},minHeight:function(a){if(a===undefined){return this._minHeight}jslet.Checker.test("Window.minHeight",a).isGTZero();this._minHeight=a},maxWidth:function(a){if(a===undefined){return this._maxWidth}jslet.Checker.test("Window.maxWidth",a).isNumber();this._maxWidth=a},maxHeight:function(a){if(a===undefined){return this._maxHeight}jslet.Checker.test("Window.maxHeight",a).isNumber();this._maxHeight=a},onSizeChanged:function(a){if(a===undefined){return this._onSizeChanged}jslet.Checker.test("Window.onSizeChanged",a).isFunction();this._onSizeChanged=a},onPositionChanged:function(a){if(a===undefined){return this._onPositionChanged}jslet.Checker.test("Window.onPositionChanged",a).isFunction();this._onPositionChanged=a},onActive:function(a){if(a===undefined){return this._onActive}jslet.Checker.test("Window.onActive",a).isFunction();this._onActive=a},onClosed:function(a){if(a===undefined){return this._onClosed}jslet.Checker.test("Window.onClosed",a).isFunction();this._onClosed=a},bind:function(){this.renderAll()},renderAll:function(){var c=this;if(!c._closable){c._minimizable=false;c._maximizable=false}if(c._minWidth<20){c._minWidth=20}if(c.minHeight<30){c.minheight=30}var d=jQuery(c.el);if(!d.hasClass("jl-window")){d.addClass("jl-window jl-border-box jl-unselectable jl-bgcolor jl-round5")}if(!c._width){c._width=parseInt(c.el.style.width)}if(!c._height){c._height=parseInt(c.el.style.height)}if(!c._width){c._width=300}if(!c._height){c._height=300}c.el.style.width=c._width+"px";c.el.style.height=c._height+"px";var k=['<div class="jl-win-header jl-unselectable" style="position:relative;width: 100%;cursor:move">',c._iconClass?'<div class="jl-win-header-icon '+c._iconClass+'"></div>':"",'<div class="jl-win-title jl-unselectable">',c._caption?c._caption:"","</div>",'<div class="jl-win-tool jl-unselectable">'];if(!jslet.locale.isRtl){k.push(c._minimizable?'<a href="javascript:;" class="jl-win-min" onfocus="this.blur();"></a>':"");k.push(c._maximizable?'<a href="javascript:;" class="jl-win-max" onfocus="this.blur();"></a>':"");k.push(c._closable?'<a href="javascript:;" class="jl-win-close" onfocus="this.blur();"></a>':"")}else{k.push(c._closable?'<a href="javascript:;" class="jl-win-close" onfocus="this.blur();"></a>':"");k.push(c._maximizable?'<a href="javascript:;" class="jl-win-max" onfocus="this.blur();"></a>':"");k.push(c._minimizable?'<a href="javascript:;" class="jl-win-min" onfocus="this.blur();"></a>':"")}k.push("</div></div>");k.push('<div class="jl-win-body jl-unselectable" title="" style="width: 100%;cursor:default"></div>');d.html(k.join(""));d.on("mousemove",c._doWinMouseMove);d.on("mousedown",c._doWinMouseDown);d.on("dblclick",function(m){m.stopPropagation();m.preventDefault()});d.on("click",function(m){if(c.isModal||c._stopEventBubling){m.stopPropagation();m.preventDefault()}});var i=d.find(".jl-win-header"),g=i[0];c._headerHeight=i.height();var e=d.find(".jl-win-body")[0],f=c._height-c._headerHeight-12;if(f<0){f=0}e.style.height=f+"px";jqBody=jQuery(e);jqBody.on("mouseenter",function(m){window.setTimeout(function(){if(jslet.temp_dragging){return}c.cursor=null},300)});jqBody.on("dblclick",function(m){m.stopPropagation();m.preventDefault()});i.on("mousedown",function(m){c.activate();if(c.state=="max"){return}c.cursor=null;jslet.ui.dnd.bindControl(this)});i.on("dblclick",function(m){m.stopPropagation();m.preventDefault();if(!c._maximizable){return}if(c.state!="max"){c.maximize()}else{c.restore()}});g._doDragStart=function(q,p,n,r,o,m){c._createTrackerMask(g);c.trackerMask.style.cursor=g.style.cursor;jslet.temp_dragging=true};g._doDragging=function(q,p,n,r,o,m){c.setPosition(c.left+o,c.top+m,true)};g._doDragEnd=function(q,p,n,t,o,m){var s=parseInt(c.el.style.left);var r=parseInt(c.el.style.top);c.setPosition(s,r);c._removeTrackerMask();c.cursor=null;jslet.temp_dragging=false};g._doDragCancel=function(q,p,n,r,o,m){c.setPosition(c.left,c.top);c._removeTrackerMask();c.cursor=null;jslet.temp_dragging=false};c.el._doDragStart=function(q,p,n,r,o,m){c._createTrackerMask(this);c._createTracker();c.trackerMask.style.cursor=c.el.style.cursor;jslet.temp_dragging=true};c.el._doDragging=function(q,p,n,r,o,m){c._changeTrackerSize(o,m)};c.el._doDragEnd=function(v,t,s,q,p,o){if(!c.tracker){return}var n=parseInt(c.tracker.style.left);var r=parseInt(c.tracker.style.top);var m=parseInt(c.tracker.style.width);var u=parseInt(c.tracker.style.height);c.setPosition(n,r);c.changeSize(m,u);c._removeTrackerMask();c._removeTracker();c.cursor=null;jslet.temp_dragging=false};c.el._doDragCancel=function(q,p,n,r,o,m){c._removeTrackerMask();c._removeTracker();c.cursor=null;jslet.temp_dragging=false};if(c._closable){var l=d.find(".jl-win-close");l.click(function(m){c.close();m=jQuery.event.fix(m||window.event);m.stopPropagation();m.preventDefault()})}if(c._minimizable){var h=d.find(".jl-win-min");h.click(function(n){if(c.state=="max"){var m=d.find(".jl-win-restore")[0];if(m){m.className="jl-win-max"}}c.minimize();n=jQuery.event.fix(n||window.event);n.stopPropagation();n.preventDefault()})}if(c._maximizable){var b=d.find(".jl-win-max"),a=b[0];b.click(function(m){if(c.state!="max"){a.className="jl-win-restore";c.maximize()}else{a.className="jl-win-max";c.restore()}m=jQuery.event.fix(m||window.event);m.stopPropagation();m.preventDefault()})}},show:function(f,e){var d=this;if(d._isCenter){var c=jQuery(d.el).offsetParent()[0],a=jQuery(c),b=a.width(),g=a.height();f=c.scrollLeft+Math.round((b-d._width)/2);e=c.scrollTop+Math.round((g-d._height)/2)}d.top=e?e:0;d.left=f?f:0;d.el.style.left=d.left+"px";d.el.style.top=d.top+"px";d.el.style.display="block";if(d.hasShadow){d._createShadow();d.shadow.style.top=d.top+"px";d.shadow.style.left=d.left+"px";d.shadow.style.display="block"}d.activate()},showModal:function(d,c){var b=this;b.isModal=true;if(!b.overlay){b.overlay=new jslet.ui.OverlayPanel(b.el.parentNode)}jslet.ui.GlobalZIndex+=10;var a=jslet.ui.GlobalZIndex;b.el.style.zIndex=a;if(b.shadow){b.shadow.style.zIndex=a-1}b.show(d,c);b.overlay.setZIndex(a-2);b.overlay.show()},hide:function(){var a=this;a.el.style.display="none";if(a.shadow){a.shadow.style.display="none"}if(a.overlay){a.overlay.hide()}},close:function(){var c=this;if(c._onClosed){var b=c._onClosed.call(c);if(b&&b.toLowerCase()=="hidden"){c.hide();return}}var a=c.el.parentNode;if(c.shadow){a.removeChild(c.shadow);c.shadow=null}a.removeChild(c.el);if(c.overlay){c.overlay.destroy();c.overlay=null}jslet.ui.GlobalZIndex-=10;c.destroy()},minimize:function(){var a=this;if(a.state=="min"){a.restore();return}if(a.state=="max"){a.restore()}a.changeSize(null,a._headerHeight+8,true);a.state="min"},maximize:function(){var d=this;var c=jQuery(d.el).offsetParent();var b=c.width();var a=c.height();d.setPosition(0,0,true);d.changeSize(b,a,true);d.state="max"},restore:function(){var a=this;a.setPosition(a.left,a.top,true);a.changeSize(a._width,a._height,true);a.state=null},activate:function(){var a=this;if(!a.overlay){a.bringToFront()}if(a._onActive){a._onActive.call()}},setPosition:function(e,d,b){var c=this;if(!b){c.left=e;c.top=d}else{if(c._onPositionChanged){var a=c._onPositionChanged.call(c,e,d);if(a){if(a.left){e=a.left}if(a.top){d=a.top}}}}c.el.style.left=e+"px";c.el.style.top=d+"px";if(c.shadow){c.shadow.style.top=d+"px";c.shadow.style.left=e+"px"}},changeSize:function(d,a,f){var g=this;if(!d){d=g._width}if(!a){a=g._height}if(g._onSizeChanged){g._onSizeChanged.call(g,d,a)}if(!f){g._width=d;g._height=a}g.el.style.width=d+"px";g.el.style.height=a+"px";if(g.shadow){g.shadow.style.width=d+3+"px";g.shadow.style.height=a+3+"px"}var e=jQuery(g.el);var c=e.find(".jl-win-body")[0];var b=a-g._headerHeight-12;if(b<0){b=0}c.style.height=b+"px"},getCaptionDiv:function(){return jQuery(this.el).find(".jl-win-title")[0]},changeCaption:function(b){this.caption=b;var a=jQuery(this.el).find(".jl-win-title");a.html(b)},getContentDiv:function(){return jQuery(this.el).find(".jl-win-body")[0]},setContent:function(a){if(!a){jslet.showError("Window content cannot be null!");return}var b=jQuery(this.el).find(".jl-win-body");if(a&&a.toLowerCase){b.html(a)}else{b.html("");a.parentNode.removeChild(a);b[0].appendChild(a);if(a.style&&a.style.display=="none"){a.style.display="block"}}},bringToFront:function(){var h=this;var g=h.el.parentNode;var e,f=jQuery(h.el);var c=0,d;for(var b=0,a=g.childNodes.length;b<a;b++){e=g.childNodes[b];if(e.nodeType!=1||e==h.el){if(!h.isModal){f.addClass("jl-window-active")}continue}d=jQuery(e);if(d.hasClass("jl-window")){if(c<e.style.zIndex){c=e.style.zIndex}if(!h.isModal){d.removeClass("jl-window-active")}}}if(h.el.style.zIndex<c||c===0){h.setZIndex(c+3)}},setZIndex:function(a){this.el.style.zIndex=a;if(this.shadow){this.shadow.style.zIndex=a-1}},_checkSize:function(b,a){var c=this;if(b){if(b<c._minWidth||c._maxWidth>0&&b>c._maxWidth){return false}}if(a){if(a<c.minHeight||c._maxHeight>0&&a>c._maxHeight){return false}}return true},_changeTrackerSize:function(c,a){var g=this;if(!g.tracker||!g.cursor){return}var b=g.el.offsetWidth,d=g.el.offsetHeight,f=null,e=null;if(g.cursor=="nw"){b=g._width-c;d=g._height-a;f=g.top+a;e=g.left+c}else{if(g.cursor=="n"){d=g._height-a;f=g.top+a}else{if(g.cursor=="ne"){d=g._height-a;b=g._width+c;f=g.top+a}else{if(g.cursor=="e"){b=g._width+c}else{if(g.cursor=="se"){b=g._width+c;d=g._height+a}else{if(g.cursor=="s"){d=g._height+a}else{if(g.cursor=="sw"){d=g._height+a;b=g._width-c;e=g.left+c}else{if(g.cursor=="w"){b=g._width-c;e=g.left+c}}}}}}}}if(!g._checkSize(b,d)){return}if(b){g.tracker.style.width=b+"px"}if(d){g.tracker.style.height=d+"px"}if(f){g.tracker.style.top=f+"px"}if(e){g.tracker.style.left=e+"px"}},_doWinMouseMove:function(a){if(jslet.temp_dragging){return}a=jQuery.event.fix(a||window.event);var b=a.target,c=jQuery(b);if(!c.hasClass("jl-window")){return}if(!b.jslet._resizable||b.jslet.state){b.jslet.cursor=null;b.style.cursor="default";return}var f=c.offset(),k=a.pageX-f.left,g=a.pageY-f.top,l=c.width(),e=c.height();var m=8,d=l-m,i=e-m,n=null;if(k<=m&&g<=m){n="nw"}else{if(k>m&&k<d&&g<=m){n="n"}else{if(k>=d&&g<=m){n="ne"}else{if(k>=d&&g>m&&g<=i){n="e"}else{if(k>=d&&g>=i){n="se"}else{if(k>m&&k<d&&g>=i){n="s"}else{if(k<=m&&g>=i){n="sw"}else{if(k<=m&&g>m&&g<i){n="w"}}}}}}}}b.jslet.cursor=n;b.style.cursor=n?n+"-resize":"default"},_doWinMouseDown:function(b){var a=this.jslet;a.activate();if(a.cursor){jslet.ui.dnd.bindControl(this)}},_createTrackerMask:function(a){var b=this;if(b.trackerMask){return}var c=jQuery(document.body);b.trackerMask=document.createElement("div");jQuery(b.trackerMask).addClass("jl-win-tracker-mask");b.trackerMask.style.top="0px";b.trackerMask.style.left="0px";b.trackerMask.style.zIndex=99998;b.trackerMask.style.width=c.width()+"px";b.trackerMask.style.height=c.height()+"px";b.trackerMask.style.display="block";b.trackerMask.onmousedown=function(){if(a&&a._doDragCancel){a._doDragCancel()}};c[0].appendChild(b.trackerMask)},_removeTrackerMask:function(){var a=this;if(a.trackerMask){a.trackerMask.onmousedown=null;document.body.removeChild(a.trackerMask)}a.trackerMask=null},_createTracker:function(){var a=this;if(a.tracker){return}a.tracker=document.createElement("div");jQuery(a.tracker).addClass("jl-win-tracker");a.tracker.style.top=a.top+"px";a.tracker.style.left=a.left+"px";a.tracker.style.zIndex=99999;a.tracker.style.width=a._width+"px";a.tracker.style.height=a._height+"px";a.tracker.style.display="block";a.el.parentNode.appendChild(a.tracker)},_removeTracker:function(){var a=this;if(a.tracker){a.el.parentNode.removeChild(a.tracker)}a.tracker=null},_createShadow:function(){var a=this;if(a.shadow){return}a.shadow=document.createElement("div");jQuery(a.shadow).addClass("jl-win-shadow");a.shadow.style.zIndex=a.el.style.zIndex-1;a.shadow.style.width=a._width+3+"px";a.shadow.style.height=a._height+3+"px";a.el.parentNode.appendChild(a.shadow)},destroy:function($super){var c=this,b=jQuery(c.el);b.find(".jl-win-max").off();b.find(".jl-win-min").off();b.find(".jl-win-close").off();var a=b.find(".jl-win-header"),d=a[0];a.off();b.find(".jl-win-body").off();if(c.trackerMask){c.trackerMask.onmousedown=null}c.trackerMask=null;c.shadow=null;c.el._doDragCancel=null;c.el._doDragEnd=null;c.el._doDragging=null;c.el._doDragStart=null;d._doDragCancel=null;d._doDragEnd=null;d._doDragging=null;d._doDragStart=null;if($super){$super()}}});jslet.ui.register("Window",jslet.ui.Window);jslet.ui.Window.htmlTemplate="<div></div>";jslet.ui.MessageBox=function(){this.show=function(m,z,b,w,h,a,q,f){jslet.ui.textMeasurer.setElement(document.body);var p=jslet.ui.textMeasurer.getWidth(m);var C=jslet.ui.textMeasurer.getHeight(m)+100;jslet.ui.textMeasurer.setElement();if(p<200){p=200}var g=parseInt(jslet.ui.getCssValue("jl-msg-button","width"));var c=w.length;var s=(g+10)*c-10;if(p<s){p=s}p+=100;if(a==1){C+=25}else{if(a==2){C+=100}}var d={type:"window",caption:z,isCenter:true,resizable:false,minimizable:false,maximizable:false,stopEventBubling:true,height:C,width:p};var v=jslet.ui.createControl(d);var t="";if(b){t='<div class="jl-msg-icon ';if(b=="info"||b=="error"||b=="question"||b=="warning"){t+="jl-msg-icon-"+b}else{t+=b}t+='"></div>'}var D=[],o,e,r=0,u;if(jslet.locale.isRtl){for(u=c-1;u>=0;u--){o=w[u];e=(r++)*(g+10);D.push('<button class="jl-msg-button" ');D.push(' data-jsletname="');D.push(o);D.push('" style="left: ');D.push(e);D.push('px">');D.push(jslet.locale.MessageBox[o]);D.push("</button>")}}else{for(u=0;u<c;u++){o=w[u];e=u*(g+10);D.push('<button class="jl-msg-button" ');D.push('" data-jsletname="');D.push(o);D.push('" style="left: ');D.push(e);D.push('px">');D.push(jslet.locale.MessageBox[o]);D.push("</button>")}}var A=["<br />"];if(a){if(a==1){A.push('<input type="text"')}else{A.push('<textarea rows="5"')}A.push(' style="width:');A.push('98%"');if(q!==null&&q!==undefined){A.push(' value="');A.push(q);A.push('"')}if(a==1){A.push(" />")}else{A.push("></textarea>")}}var l=['<div class="jl-msg-container">',t,'<div class="jl-msg-message">',m,A.join(""),"</div>","</div>",'<div class="jl-msg-tool"><div style="position:relative;width:',s,'px;margin:0px auto;">',D.join(""),"</div></div>"];v.setContent(l.join(""));var n=jQuery(v.el);var x=n.find(".jl-msg-tool")[0].firstChild;var y=null;if(a==1){y=n.find(".jl-msg-container input")[0]}else{y=n.find(".jl-msg-container textarea")[0]}var B;for(u=0;u<c;u++){B=x.childNodes[u];B.onclick=function(){o=jQuery(this).attr("data-jsletname");var i=null;if(a&&o=="ok"){i=y.value;if(f&&!f(i)){y.focus();return}}v.close();if(h){h(o,i)}}}v.onClosed(function(){if(h){h(o)}});v.showModal();v.setZIndex(99981);r=0;if(jslet.locale.isRtl){r=c-1}x.childNodes[r].focus()}};jslet.ui.MessageBox.alert=function(c,b,a){var d=new jslet.ui.MessageBox();if(!b){b=jslet.locale.MessageBox.info}d.show(c,b,"info",["ok"],a)};jslet.ui.MessageBox.error=function(c,b,a){var d=new jslet.ui.MessageBox();if(!b){b=jslet.locale.MessageBox.error}d.show(c,b,"error",["ok"],a)};jslet.ui.MessageBox.warn=function(c,b,a){var d=new jslet.ui.MessageBox();if(!b){b=jslet.locale.MessageBox.warn}d.show(c,b,"warning",["ok"],a)};jslet.ui.MessageBox.confirm=function(c,b,a,e){var d=new jslet.ui.MessageBox();if(!b){b=jslet.locale.MessageBox.confirm}if(!e){d.show(c,b,"question",["ok","cancel"],a)}else{d.show(c,b,"question",["yes","no","cancel"],a)}};jslet.ui.MessageBox.prompt=function(e,d,c,a,b,g){var f=new jslet.ui.MessageBox();if(!d){d=jslet.locale.MessageBox.prompt}if(!g){f.show(e,d,null,["ok","cancel"],c,1,a,b)}else{f.show(e,d,null,["ok","cancel"],c,2,a,b)}};jslet.ui.ListViewModel=function(b,c){var h=0;var g=0;var e=0;var a=null;var f=null;var i=0;this.onTopRownoChanged=null;this.onVisibleCountChanged=null;this.onCurrentRownoChanged=null;this.onNeedShowRowsCountChanged=null;this.onCheckStateChanged=null;this.fixedRows=0;var d=function(){if(!c){return false}var k=b;if(!k._parentField||!k._keyField){return false}return true};d();this.refreshModel=function(r){if(!c){return}if(r===undefined){r=-1}var w=b,E=0,p,v=w.recordCount(),o,u=[],x;var n=w.startSilenceMove();try{w.recno(this.fixedRows);var l=0,s=[],y,C,D,t,q;while(!w.isEof()){p=w.recno();keyValue=w.keyValue();l=0;C=null;x=w.parentValue();for(var z=s.length-1;z>=0;z--){D=s[z];if(D.keyvalue==x){l=D.level+1;C=D;break}}if(C){for(var B=s.length-1;B>z;B--){s.pop()}}t=w.getRecord();q=w.selected();if(!q){q=0}var A=true;if(r>=0&&l<=r){A=true}else{A=t._expanded_}y={parent:C,recno:p,keyvalue:keyValue,expanded:A,state:q,isbold:0,level:l};s.push(y);if(C){if(!C.children){C.children=[]}C.children.push(y);this._updateParentNodeBoldByChecked(y)}else{u.push(y)}w.next()}f=u;this._setLastFlag(u);this._refreshNeedShowRows()}finally{w.endSilenceMove(n)}};this._updateParentNodeBoldByChecked=function(k){if(!k.state||!k.parent){return}var l=k.parent;while(true){if(l.isbold){return}l.isbold=1;l=l.parent;if(!l){return}}};this._updateParentNodeBoldByNotChecked=function(n){if(n.state||!n.parent){return}var o=n.parent,m;while(true){if(o.children){for(var l=0,k=o.children.length;l<k;l++){m=o.children[l];if(m.state){return}}o.isbold=0}o=o.parent;if(!o){return}}};this._setLastFlag=function(k){if(!k||k.length===0){return}var n;k[k.length-1].islast=true;for(var m=0,l=k.length;m<l;m++){n=k[m];if(n.children&&n.children.length>0){this._setLastFlag(n.children)}}return null};this._refreshNeedShowRows=function(m){if(!c){return}var k=[],n;if(!f){this.refreshModel();return}var o=a?a.length:0;a=[];this._findVisibleNode(f);var l=a.length;if(!m&&this.onNeedShowRowsCountChanged){this.onNeedShowRowsCountChanged(l)}};this.hasChildren=function(k){if(!c){return false}if(!k){k=b.recno()}var l=this._innerFindNode(f,k);if(l===null){return}return l.children&&l.children.length>0};this.getLevel=function(k){if(!c){return false}if(!k){k=b.recno()}var l=this._innerFindNode(f,k);if(l===null){return}return l.level};this._findVisibleNode=function(k){if(!k){return}var n;for(var m=0,l=k.length;m<l;m++){n=k[m];a.push(n);if(n.expanded){this._findVisibleNode(n.children)}}};this.rownoToRecno=function(k){if(!c){return k+this.fixedRows}if(k<0){k=k+this.fixedRows;return k>=0?k:-1}if(k>=a.length){return -1}return a[k].recno};this.recnoToRowno=function(m){if(!c){return m-this.fixedRows}for(var l=0,k=a.length;l<k;l++){if(a[l].recno==m){return l}}return -1};this.setVisibleStartRow=function(l,k){if(l>=0){var m=this.getNeedShowRowCount()-h;if(l>m){l=m}}if(l<0){l=0}if(g==l){return}g=l;e=l+h-1;if(!k&&this.onTopRownoChanged){this.onTopRownoChanged(l)}};this.getVisibleStartRow=function(){return g};this.setVisibleEndRow=function(k){e=k};this.getVisibleEndRow=function(){return e};this.setVisibleCount=function(l,k){if(h==l){return}h=l;e=g+l-1;if(!k&&this.onVisibleCountChanged){this.onVisibleCountChanged(l)}};this.getVisibleCount=function(){return h};this.getNeedShowRowCount=function(){if(!c){return b.recordCount()-this.fixedRows}return a.length};this.getCurrentRow=function(){return a[i]};this.setCurrentRowno=function(o,l,q){if(o===undefined){return null}var n=i,m=0,p=null;if(o<0){var k=-1*this.fixedRows;if(o<k){o=k}m=this.fixedRows+o}else{var r=this.getNeedShowRowCount();if(r===0){return null}if(o>=r){o=r-1}if(!c){m=o+this.fixedRows}else{p=a[o];m=p.recno}if(q){if(o>=0&&o<g){this.setVisibleStartRow(o)}else{if(o>=g+h){this.setVisibleStartRow(o-h+1)}}}}if(m>=0){b.recno(m);if(b.aborted()){return null}}i=o;if(!l&&this.onCurrentRownoChanged){this.onCurrentRownoChanged(n,i)}return p};this.getCurrentRowno=function(){return i};this.nextRow=function(){this.setCurrentRowno(i+1,false,true)};this.priorRow=function(k){this.setCurrentRowno(i-1,false,true)};this.nextPage=function(){this.setVisibleStartRow(g+h);this.setCurrentRowno(g)};this.priorPage=function(){this.setVisibleStartRow(g-h);this.setCurrentRowno(g)};this._innerFindNode=function(m,p){var q,l;for(var o=0,n=m.length-1;o<=n;o++){q=m[o];if(q.recno==p){return q}if(q.children){var k=this._innerFindNode(q.children,p);if(k){return k}}}return null};this.expand=function(k){if(!c){return}var m=this._innerFindNode(f,b.recno());if(m===null){return}var l=b.startSilenceMove();try{m.expanded=m.children?true:false;b.recno(m.recno);b.getRecord()._expanded_=m.expanded;var n=m;while(true){n=n.parent;if(!n){break}if(!n.expanded){b.recno(n.recno);b.getRecord()._expanded_=true;n.expanded=true}}}finally{b.endSilenceMove(l)}this._refreshNeedShowRows();if(k){k()}};this.collapse=function(k){if(!c){return}var m=this._innerFindNode(f,b.recno());if(m===null){return}var l=b.startSilenceMove();try{b.recno(m.recno);b.getRecord()._expanded_=false;m.expanded=false}finally{b.endSilenceMove(l)}this._refreshNeedShowRows();if(k){k()}};this._iterateNode=function(l,k){var o;for(var n=0,m=l.length;n<m;n++){o=l[n];if(o.children){if(k){k(o)}if(o.children&&o.children.length>0){this._iterateNode(o.children,k)}}}return null};this._callbackFn=function(l,m){var k=b.startSilenceMove();try{b.recno(l.recno);b.getRecord()._expanded_=m;l.expanded=m}finally{b.endSilenceMove(k)}};this.expandAll=function(k){if(!c){return}var l=this;l._iterateNode(f,function(m){l._callbackFn(m,true)});l._refreshNeedShowRows();if(k){k()}};this.collapseAll=function(k){if(!c){return}var l=this;l._iterateNode(f,function(m){l._callbackFn(m,false)});l._refreshNeedShowRows();if(k){k()}};this.syncDataset=function(){var l=b.recno();if(l<0){return}var m=this._innerFindNode(f,b.recno()),n=m.parent;if(n&&!n.expanded){while(true){if(!n.expanded){n.expanded=true}else{break}n=n.parent;if(!n){break}}}this._refreshNeedShowRows();var k=this.recnoToRowno(l);this.setCurrentRowno(k,false,true)};this.checkNode=function(m,k){var l=this.getCurrentRow();l.state=m?1:0;b.selected(l.state);if(k){if(l.children&&l.children.length>0){this._updateChildState(l,m)}if(l.parent){this._updateParentState(l,m)}}if(m){this._updateParentNodeBoldByChecked(l)}else{this._updateParentNodeBoldByNotChecked(l)}if(this.onCheckStateChanged){this.onCheckStateChanged()}};this._updateChildState=function(o,p){var k=b.startSilenceMove(),n;try{for(var m=0,l=o.children.length;m<l;m++){n=o.children[m];n.state=p;b.recno(n.recno);b.selected(p);if(n.children&&n.children.length>0){this._updateChildState(n,p)}}}finally{b.endSilenceMove(k)}};this._updateParentState=function(p,q){var o=p.parent;if(!o){return}var n,r;if(q!=2){for(var m=0,l=o.children.length;m<l;m++){n=o.children[m];if(n.state==2){r=2;break}if(m===0){r=n.state}else{if(r!=n.state){r=2;break}}}}else{r=q}if(o.state!=r){o.state=r;var k=b.startSilenceMove();try{b.recno(o.recno);b.selected(r)}finally{b.endSilenceMove(k)}}this._updateParentState(o,r)};this.destroy=function(){b=null;f=null;this.onTopRownoChanged=null;this.onVisibleCountChanged=null;this.onCurrentRownoChanged=null;this.onNeedShowRowsCountChanged=null;this.onCheckStateChanged=null}};jslet.ui.DBChart=jslet.Class.create(jslet.ui.DBControl,{chartTypes:["line","bar","stackbar","pie"],legendPositions:["none","top","bottom","left","right"],initialize:function($super,a,c){var b=this;b.allProperties="dataset,chartType,chartTitle,categoryField,valueFields,legendPos";b.requiredProperties="valueFields,categoryField";b._chartType="line";b._categoryFields=null;b._valueFields=null;b._chartTitle=null;b._legendPos="top";b._fieldValidated=false;$super(a,c)},chartType:function(b){if(b===undefined){return this._chartType}b=jQuery.trim(b);var a=jslet.Checker.test("DBChart.chartType",b).isString().required();a.testValue(b.toLowerCase()).inArray(this.chartTypes);this._chartType=b},categoryField:function(a){if(a===undefined){return this._categoryField}jslet.Checker.test("DBChart.categoryField",a).isString().required();a=jQuery.trim(a);this._categoryField=a;this._fieldValidated=false},valueFields:function(a){if(a===undefined){return this._valueFields}jslet.Checker.test("DBChart.valueFields",a).isString().required();a=jQuery.trim(a);this._valueFields=a.split(",");this._fieldValidated=false},chartTitle:function(a){if(a===undefined){return this._chartTitle}jslet.Checker.test("DBChart.chartTitle",a).isString();this._chartTitle=a},legendPos:function(b){if(b===undefined){return this._legendPos}b=jQuery.trim(b);var a=jslet.Checker.test("DBChart.legendPos",b).isString().required();a.testValue(b.toLowerCase()).inArray(this.legendPositions);this._legendPos=b},isValidTemplateTag:function(a){return a.tagName.toLowerCase()=="div"},bind:function(){if(!this.el.id){this.el.id=jslet.nextId()}this.renderAll()},_validateFields:function(){var e=this;if(e._fieldValidated){return}var d=e._dataset,b=e._categoryField;if(!d.getField(b)){throw new Error(jslet.formatString(jslet.locale.Dataset.fieldNotFound,[b]))}for(var c=0,a=e._valueFields.length;c<a;c++){b=e._valueFields[c];if(!d.getField(b)){throw new Error(jslet.formatString(jslet.locale.Dataset.fieldNotFound,[b]))}}e._fieldValidated=true},_getLineData:function(){var a=this,m=a._dataset;if(m.recordCount()===0){return{xLabels:[],yValues:[]}}var b=m.startSilenceMove();var c=m.recno(),k=[],n=[];try{m.first();var f=false,h,l=a._valueFields.length,g,e=[];while(!m.isEof()){k.push(m.getFieldText(a._categoryField));for(var d=0;d<l;d++){h=a._valueFields[d];if(!f){g=[];n.push(g);e.push(m.getField(h).label())}else{g=n[d]}g.push(m.getFieldValue(h))}f=true;m.next()}}finally{m.recno(c);m.endSilenceMove(b)}return{xLabels:k,yValues:n,legendLabels:e}},_getPieData:function(){var h=this,e=h._dataset;if(e.recordCount()===0){return[]}var d=e.startSilenceMove();var b=e.recno(),a=[];try{e.first();var g=h._valueFields[0],c,f;while(!e.isEof()){c=e.getFieldText(h._categoryField);f=e.getFieldValue(g);a.push([c,f]);e.next()}}finally{e.recno(b);e.endSilenceMove(d)}return a},_drawLineChart:function(){var b=this;var a=b._getLineData();jQuery.jqplot(b.el.id,a.yValues,{title:b._chartTitle,animate:!jQuery.jqplot.use_excanvas,seriesDefaults:{rendererOptions:{smooth:true},pointLabels:{show:true,formatString:"%d"}},legend:{show:true,labels:a.legendLabels},axes:{xaxis:{renderer:$.jqplot.CategoryAxisRenderer,ticks:a.xLabels}}})},_drawPieChart:function(){var b=this;var a=b._getPieData();jQuery.jqplot(b.el.id,[a],{title:b._chartTitle,animate:!jQuery.jqplot.use_excanvas,seriesDefaults:{renderer:$.jqplot.PieRenderer,pointLabels:{show:true,formatString:"%d"}},legend:{show:true}})},_drawBarChart:function(a){var c=this;var b=c._getLineData();jQuery.jqplot(c.el.id,b.yValues,{title:c._chartTitle,stackSeries:a,animate:!jQuery.jqplot.use_excanvas,seriesDefaults:{renderer:$.jqplot.BarRenderer,pointLabels:{show:true,formatString:"%d"}},legend:{show:true,labels:b.legendLabels},axes:{xaxis:{renderer:$.jqplot.CategoryAxisRenderer,ticks:b.xLabels}},highlighter:{show:false}})},drawChart:function(){var b=this,a=b._dataset;b.el.innerHTML="";b._validateFields();if(b._chartType=="pie"){b._drawPieChart();return}if(b._chartType=="line"){b._drawLineChart();return}if(b._chartType=="bar"){b._drawBarChart(false);return}if(b._chartType=="stackbar"){b._drawBarChart(true);return}},refreshControl:function(a){var b=a.eventType;if(b==jslet.data.RefreshEvent.UPDATEALL||b==jslet.data.RefreshEvent.UPDATERECORD||b==jslet.data.RefreshEvent.UPDATECOLUMN||b==jslet.data.RefreshEvent.INSERT||b==jslet.data.RefreshEvent.DELETE){this.drawChart()}},renderAll:function(){this.refreshControl(jslet.data.RefreshEvent.updateAllEvent(),true)},destroy:function($super){this.swf=null;$super()}});jslet.ui.register("DBChart",jslet.ui.DBChart);jslet.ui.DBChart.htmlTemplate="<div></div>";jslet.ui.DBEditPanel=jslet.Class.create(jslet.ui.DBControl,{_totalColumns:12,initialize:function($super,a,c){var b=this;b.allProperties="dataset,columnCount,labelCols,onlySpecifiedFields,fields";b._columnCount=3;b._labelCols=1;b._onlySpecifiedFields=false;b._fields;$super(a,c)},columnCount:function(a){if(a===undefined){return this._columnCount}jslet.Checker.test("DBEditPanel.columnCount",a).isGTZero();this._columnCount=parseInt(a)},labelCols:function(a){if(a===undefined){return this._labelCols}jslet.Checker.test("DBEditPanel.labelCols",a).isNumber().between(1,3);this._labelCols=parseInt(a)},onlySpecifiedFields:function(a){if(a===undefined){return this._onlySpecifiedFields}this._onlySpecifiedFields=a?true:false},fields:function(b){if(b===undefined){return this._fields}jslet.Checker.test("DBEditPanel.fields",b).isArray();var c;for(var d=0,a=b.length;d<a;d++){c=b[d];jslet.Checker.test("DBEditPanel.fields.field",c.field).isString().required();jslet.Checker.test("DBEditPanel.fields.labelCols",c.colSpan).isNumber().between(1,3);jslet.Checker.test("DBEditPanel.fields.dataCols",c.colSpan).isNumber().between(1,11);c.inFirstCol=c.inFirstCol?true:false;c.showLine=c.showLine?true:false}this._fields=b},isValidTemplateTag:function(a){return a.tagName.toLowerCase()=="div"},bind:function(){this.renderAll()},_calcLayout:function(){var a=this,d=a._dataset.getNormalFields(),g,s;if(!a._onlySpecifiedFields){g=[];var l,f,b,e,u=a._fields?a._fields.length:0;for(var p=0,w=d.length;p<w;p++){s=d[p];l=s.name();f=false;for(var n=0;n<u;n++){b=a._fields[n];if(l==b.field){f=true;g.push(b)}}if(!f&&s.visible()){g.push({field:s.name()})}}}else{g=a._fields}var q=Math.floor((a._totalColumns-a._labelCols*a._columnCount)/a._columnCount);if(q<=0){q=1}var t,h=0,v=0,o=0,k;for(var p=0,m=g.length;p<m;p++){t=g[p];if(!t.labelCols){t._innerLabelCols=a._labelCols}if(!t.dataCols){t._innerDataCols=q}else{t._innerDataCols=t.dataCols}k=t._innerLabelCols+t._innerDataCols;if(t.inFirstCol||t.showLine||o+k>a._totalColumns){h++;o=0}t.row=h;o+=k}return g},getEditField:function(f){var d=this;if(!d._fields){d._fields=[]}var c;for(var b=0,a=d._fields.length;b<a;b++){c=d._fields[b];if(c.field==f){return c}}var e=d._dataset.getField(f);if(!e){return null}c={field:f};d._fields.push(c);return c},renderAll:function(){var c=this;var f=jQuery(c.el);if(!f.hasClass("jl-editpanel")){f.addClass("jl-editpanel form-horizontal")}f.html("");var q=c._dataset.getNormalFields(),o=q.length;var s=c._calcLayout();var a=-1,n,p,d,k,t,l,b,h;for(var m=0,e=s.length;m<e;m++){layout=s[m];if(layout.showLine){t=document.createElement("hr");c.el.appendChild(t)}if(layout.row!=a){b=document.createElement("div");b.className="form-group";c.el.appendChild(b);a=layout.row}d=layout.field;k=c._dataset.getField(d);p=k.editControl();var g=p.type.toLowerCase()=="dbcheckbox";if(g){n=document.createElement("div");b.appendChild(n);n.className="col-sm-"+layout._innerLabelCols;l=document.createElement("div");b.appendChild(l);l.className="col-sm-"+layout._innerDataCols;p.dataset=c._dataset;p.field=d;editor=jslet.ui.createControl(p,null);l.appendChild(editor.el);n=document.createElement("label");l.appendChild(n);new jslet.ui.DBLabel(n,{type:"DBLabel",dataset:c._dataset,field:d});h=jslet.nextId();editor.el.id=h;jQuery(n).attr("for",h)}else{n=document.createElement("label");b.appendChild(n);n.className="col-sm-"+layout._innerLabelCols;new jslet.ui.DBLabel(n,{type:"DBLabel",dataset:c._dataset,field:d});l=document.createElement("div");b.appendChild(l);l.className="col-sm-"+layout._innerDataCols;if(k.valueStyle()==jslet.data.FieldValueStyle.BETWEEN){p={type:"DBBetweenEdit"}}p.dataset=c._dataset;p.field=d;editor=jslet.ui.createControl(p,null);l.appendChild(editor.el);h=jslet.nextId();editor.el.id=h;jQuery(n).attr("for",h)}}},refreshControl:function(a){}});jslet.ui.register("DBEditPanel",jslet.ui.DBEditPanel);jslet.ui.DBEditPanel.htmlTemplate="<div></div>";jslet.ui.DBInspector=jslet.Class.create(jslet.ui.DBControl,{initialize:function($super,a,c){var b=this;b.allProperties="dataset,columnCount,rowHeight";b._columnCount=1;b._rowHeight=30;$super(a,c)},columnCount:function(a){if(a===undefined){return this._columnCount}jslet.Checker.test("DBEditPanel.columnCount",a).isGTZero();this._columnCount=parseInt(a)},rowHeight:function(a){if(a===undefined){return this._rowHeight}jslet.Checker.test("DBEditPanel.rowHeight",a).isGTZero();this._rowHeight=parseInt(a)},isValidTemplateTag:function(a){return a.tagName.toLowerCase()=="div"},bind:function(){var b=this;var a=b._columnCount;if(a){a=parseInt(a)}if(a&&a>0){b._columnCount=a}else{b._columnCount=1}b.renderAll()},renderAll:function(){var f=this,r=jQuery(f.el);if(!r.hasClass("jl-inspector")){r.addClass("jl-inspector jl-round5")}var h=r.width(),m=f._dataset.getFields();r.html('<table cellpadding=0 cellspacing=0 style="margin:0;padding:0;table-layout:fixed;width:100%;height:100%"><tbody></tbody></table>');var e,B,y,F=m.length,v=[];for(y=0;y<F;y++){B=m[y];if(B.visible()){v.push(B)}}F=v.length;if(F===0){return}var q,E,g=Math.min(F,f._columnCount),n=[];for(y=0;y<g;y++){n[y]=0}var t=jslet.ui.textMeasurer.getWidth("*");jslet.ui.textMeasurer.setElement(f.el);for(y=0;y<F;y++){B=v[y];E=y%g;q=Math.round(jslet.ui.textMeasurer.getWidth(B.label())+t)+5;if(n[E]<q){n[E]=q}}jslet.ui.textMeasurer.setElement();var A=0;for(y=0;y<g;y++){A+=n[y]}var s=Math.round((h-A)/g);var p=f.el.firstChild,b=p.createTHead(),x,o=b.insertRow(-1);o.style.height="0";for(y=0;y<g;y++){x=o.insertCell(-1);x.style.width=n[y]+"px";x.style.height="0";x=o.insertCell(-1);x.style.height="0"}var z=-1,D=-1,C,d,l,u,k,a;f.preRowIndex=-1;for(y=0;y<F;y++){B=v[y];u=B.name();C=Math.floor(y/g);E=y%g;if(z!=C){o=p.insertRow(-1);if(f._rowHeight){o.style.height=f._rowHeight+"px"}z=C}x=o.insertCell(-1);x.noWrap=true;x.className=jslet.ui.htmlclass.DBINSPECTOR.labelColCls;l=document.createElement("label");x.appendChild(l);new jslet.ui.DBLabel(l,{type:"DBLabel",dataset:f._dataset,field:u});x=o.insertCell(-1);x.className=jslet.ui.htmlclass.DBINSPECTOR.editorColCls;x.noWrap=true;x.align="left";d=document.createElement("div");d.noWrap=true;x.appendChild(d);a=B.editControl();a.dataset=f._dataset;a.field=u;k=jslet.ui.createControl(a,d);if(!k.isCheckBox){k.el.style.width="100%"}}},refreshControl:function(a){},destroy:function($super){$super()}});jslet.ui.htmlclass.DBINSPECTOR={labelColCls:"jl-inspector-label",editorColCls:"jl-inspector-editor"};jslet.ui.register("DBInspector",jslet.ui.DBInspector);jslet.ui.DBInspector.htmlTemplate="<div></div>";jslet.ui.htmlclass.TABLECLASS={currentrow:"jl-tbl-current",celldiv:"jl-tbl-cell",scrollBarWidth:17,selectColWidth:30,hoverrow:"jl-tbl-row-hover",sortAscChar:"&#8593;",sortDescChar:"&#8595;"};jslet.ui.TableColumn=function(){var a=this;a.field=null;a.colNum=null;a.label=null;a.title=null;a.width=null;a.colSpan=null;a.disableHeadSort=false;a.mergeSame=false;a.noRefresh=false;a.visible=true;a.cellRender=null};jslet.ui.TableSubgroup=function(){var a=this;a.hasExpander=true;a.template=null;a.height=0};jslet.ui.TableHead=function(){var a=this;a.label=null;a.title=null;a.id=null;a.rowSpan=0;a.colSpan=0;a.subHeads=null};jslet.ui.AbstractDBTable=jslet.Class.create(jslet.ui.DBControl,{initialize:function($super,a,c){var b=this;b.allProperties="dataset,fixedRows,fixedCols,hasSeqCol,hasSelectCol,noborder,readOnly,hideHead,disableHeadSort,onlySpecifiedCol,selectBy,rowHeight,onRowClick,onRowDblClick,onSelect,onSelectAll,onCustomSort,onFillRow,onFillCell,treeField,columns,subgroup,totalFields";b._fixedRows=0;b._fixedCols=0;b._hasSeqCol=true;b._hasSelectCol=false;b._noborder=false;b._readOnly=true;b._hideHead=false;b._disableHeadSort=false;b._selectBy=null;b._rowHeight=35;b._headRowHeight=35;b._treeField=null;b._columns=null;b._totalFields=null;b._onRowClick=null;b._onRowDblClick=null;b._onCustomSort=null;b._onSelect=null;b._onSelectAll=null;b._onFillRow=null;b._onFillCell=null;b.contentHeight=0;b.subgroup=null;b._sysColumns=null;b._isHoriOverflow=false;b._hoverRowIndex=-1;b._oldHoverRowClassName;b._oldHeight=null;$super(a,c)},fixedRows:function(a){if(a===undefined){return this._fixedRows}jslet.Checker.test("DBTable.fixedRows",a).isNumber();this._fixedRows=parseInt(a)},fixedCols:function(a){if(a===undefined){return this._fixedCols}jslet.Checker.test("DBTable.fixedCols",a).isNumber();this._fixedCols=parseInt(a)},rowHeight:function(a){if(a===undefined){return this._rowHeight}jslet.Checker.test("DBTable.rowHeight",a).isGTZero();this._rowHeight=parseInt(a)},headRowHeight:function(a){if(headRowHeight===undefined){return this._headRowHeight}jslet.Checker.test("DBTable.headRowHeight",headRowHeight).isGTZero();this._headRowHeight=parseInt(headRowHeight)},hasSeqCol:function(a){if(a===undefined){return this._hasSeqCol}this._hasSeqCol=a?true:false},hasSelectCol:function(a){if(a===undefined){return this._hasSelectCol}this._hasSelectCol=a?true:false},noborder:function(a){if(a===undefined){return this._noborder}this._noborder=a?true:false},readOnly:function(a){if(a===undefined){return this._readOnly}this._readOnly=a?true:false},hideHead:function(a){if(a===undefined){return this._hideHead}this._hideHead=a?true:false},disableHeadSort:function(a){if(a===undefined){return this._disableHeadSort}this._disableHeadSort=a?true:false},onlySpecifiedCol:function(a){if(a===undefined){return this._onlySpecifiedCol}this._onlySpecifiedCol=a?true:false},selectBy:function(a){if(a===undefined){return this._selectBy}jslet.Checker.test("DBTable.selectBy",a).isString();this._selectBy=a},treeField:function(a){if(a===undefined){return this._treeField}jslet.Checker.test("DBTable.treeField",a).isString();this._treeField=a},totalFields:function(a){if(a===undefined){return this._totalFields}jslet.Checker.test("DBTable.totalFields",a).isString();this._totalFields=a},onRowClick:function(a){if(a===undefined){return this._onRowClick}jslet.Checker.test("DBTable.onRowClick",a).isFunction();this._onRowClick=a},onRowDblClick:function(a){if(a===undefined){return this._onRowDblClick}jslet.Checker.test("DBTable.onRowDblClick",a).isFunction();this._onRowDblClick=a},onSelect:function(a){if(a===undefined){return this._onSelect}jslet.Checker.test("DBTable.onSelect",a).isFunction();this._onSelect=a},onSelectAll:function(a){if(a===undefined){return this._onSelectAll}jslet.Checker.test("DBTable.onSelectAll",a).isFunction();this._onSelectAll=a},onCustomSort:function(a){if(a===undefined){return this._onCustomSort}jslet.Checker.test("DBTable.onCustomSort",a).isFunction();this._onCustomSort=a},onFillRow:function(a){if(a===undefined){return this._onFillRow}jslet.Checker.test("DBTable.onFillRow",a).isFunction();this._onFillRow=a},onFillCell:function(a){if(a===undefined){return this._onFillCell}jslet.Checker.test("DBTable.onFillCell",a).isFunction();this._onFillCell=a},columns:function(c){if(c===undefined){return this._columns}jslet.Checker.test("DBTable.columns",c).isArray();var d;for(var b=0,a=c.length;b<a;b++){d=c[b];jslet.Checker.test("DBTable.Column.field",d.field).isString();jslet.Checker.test("DBTable.Column.label",d.label).isString();jslet.Checker.test("DBTable.Column.colNum",d.colNum).isGTZero();jslet.Checker.test("DBTable.Column.width",d.width).isGTZero();jslet.Checker.test("DBTable.Column.colSpan",d.colSpan).isGTZero();d.disableHeadSort=d.disableHeadSort?true:false;d.mergeSame=d.mergeSame?true:false;d.noRefresh=d.noRefresh?true:false;jslet.Checker.test("DBTable.Column.cellRender",d.cellRender).isObject()}this._columns=c},isValidTemplateTag:function(a){return a.tagName.toLowerCase()=="div"},bind:function(){var c=this;jslet.resizeEventBus.subscribe(c);jslet.ui.textMeasurer.setElement(c.el);c.charHeight=jslet.ui.textMeasurer.getHeight("M")+4;jslet.ui.textMeasurer.setElement();c.charWidth=12;c._initializeVm();c.renderAll();c._updateSortFlag(true);var b=jQuery(c.el);var a=b.attr("tabindex");if(!a){b.attr("tabindex",0)}b.on("keydown",function(d){var e=d.which;if(e==38){c.listvm.priorRow();d.preventDefault()}else{if(e==40){c.listvm.nextRow();d.preventDefault()}else{if(e==33){c.listvm.priorPage();d.preventDefault()}else{if(e==34){c.listvm.nextPage();d.preventDefault()}}}}})},_initializeVm:function(){var a=this;a.listvm=new jslet.ui.ListViewModel(a._dataset,a._treeField?true:false);a.listvm.onTopRownoChanged=function(c){if(c<0){return}var b=a._dataset.startSilenceMove();try{a._fillData()}finally{a._dataset.endSilenceMove(b)}a._syncScrollBar(c);a._showCurrentRow()};a.listvm.onVisibleCountChanged=function(){a.renderAll()};a.listvm.onCurrentRownoChanged=function(e,d){if(a._dataset.recordCount()===0){return}a._oldHoverRowClassName="";if(a.prevRow){if(a.prevRow.fixed){jQuery(a.prevRow.fixed).removeClass(jslet.ui.htmlclass.TABLECLASS.currentrow)}jQuery(a.prevRow.content).removeClass(jslet.ui.htmlclass.TABLECLASS.currentrow)}var f=a._getTrByRowno(d),b;if(!f){return}b=f.fixed;var c=a._dataset.recno();if(b){jQuery(b).addClass(jslet.ui.htmlclass.TABLECLASS.currentrow);if(a._hoverRowIndex==b.rowIndex){a._oldHoverRowClassName=jslet.ui.htmlclass.TABLECLASS.currentrow}}b=f.content;jQuery(b).addClass(jslet.ui.htmlclass.TABLECLASS.currentrow);if(a._hoverRowIndex==b.rowIndex){a._oldHoverRowClassName=jslet.ui.htmlclass.TABLECLASS.currentrow}a.prevRow=f}},renderAll:function(){var a=this;a.listvm.fixedRows=a._fixedRows;a._calcParams();a.listvm.refreshModel();a._createFrame();a._fillData();a._showCurrentRow();a._oldHeight=jQuery(a.el).height()},_prepareColumn:function(){var c=this,p;c._sysColumns=[];if(c._hasSeqCol){p={label:"&nbsp;",width:c.seqColWidth,disableHeadSort:true,isSeq:true,cellRender:jslet.ui.DBTable.sequenceCellRender};c._sysColumns.push(p)}if(c._hasSelectCol){p={label:'<input type="checkbox" />',width:c.selectColWidth,disableHeadSort:true,isSelect:true,cellRender:jslet.ui.DBTable.selectCellRender};c._sysColumns.push(p)}if(c.subgroup&&c.subgroup.hasExpander){p={label:"&nbsp;",width:c.selectColWidth,disableHeadSort:true,isSubgroup:true,cellRender:jslet.ui.DBTable.subgroupCellRender};c._sysColumns.push(p)}var n=[];if(!c._onlySpecifiedCol){var f,e,l=c._dataset.getFields();for(var h=0,a=l.length;h<a;h++){f=l[h];e=f.name();if(f.visible()){p=new jslet.ui.TableColumn();p.field=f.name();n.push(p)}}if(c._columns){for(var h=0,s=c._columns.length;h<s;h++){p=c._columns[h];if(!p.field){n.push(p);continue}f=c._dataset.getTopField(p.field);if(!f){throw new Error("Field: "+p.field+" doesn't exist!")}if(f.getType()==jslet.data.DataType.GROUP){e=f.name();var t=true;if(p.field!=e){for(var g=0;g<n.length;g++){if(n[g].field==e){t=false;break}}}if(t){p=new jslet.ui.TableColumn();p.field=e;n.push(p)}}}}}else{for(var h=0,s=c._columns.length;h<s;h++){n.push(c._columns[h])}}c.innerHeads=[];c.innerColumns=[];var b,e,r,d={lastColNum:0,depth:0};for(var h=0,s=n.length;h<s;h++){colObj=n[h];e=colObj.field;if(!e){b=new jslet.ui.TableHead();r=colObj.label;b.label=r?r:"";b.level=0;b.colNum=d.lastColNum++;colObj.colNum=b.colNum;b.id=jslet.nextId();c.innerHeads.push(b);c.innerColumns.push(colObj);continue}f=c._dataset.getField(e);c._convertField2Head(d,f)}c.maxHeadRows=d.depth+1;c._calcHeadSpan();var s=0,o=0,q=c._fixedCols-c._sysColumns.length;for(var h=1,m=c.innerHeads.length;h<m;h++){b=c.innerHeads[h];s+=b.colSpan;if(q<=o||q==s){break}if(q<s&&q>o){c._fixedCols=o+c._sysColumns.length}o=s}},_calcHeadSpan:function(d){var e=this;if(!d){d=e.innerHeads}var f,c=0;for(var b=0,a=d.length;b<a;b++){f=d[b];f.rowSpan=e.maxHeadRows-level;if(f.subHeads){f.colSpan=e._calcHeadSpan(f.subHeads);c+=f.colSpan}else{f.colSpan=1;c++}}return c},_convertField2Head:function(c,f,m){var b=this;if(!f.visible()){return false}if(!m){level=0;heads=b.innerHeads}else{level=m.level+1;heads=m.subHeads}var a,d=f.name();a=new jslet.ui.TableHead();a.label=f.label();a.field=d;a.level=level;a.colNum=c.lastColNum;a.id=jslet.nextId();heads.push(a);c.depth=Math.max(level,c.depth);if(f.getType()==jslet.data.DataType.GROUP){a.subHeads=[];var n=f.children(),l=false;for(var g=0,e=n.length;g<e;g++){b._convertField2Head(c,n[g],a)}}else{c.lastColNum++;var k,o=false;var h=b._columns?b._columns.length:0;for(var g=0;g<h;g++){k=b._columns[g];if(k.field==d){o=true;break}}if(!o){k=new jslet.ui.TableColumn();k.field=d}if(!k.label){k.label=f.label()}k.mergeSame=f.mergeSame();k.aggrateType=f.aggrateType();k.aggrateBy=f.aggrateBy();k.colNum=a.colNum;if(!k.width){maxWidth=f?f.displayWidth():0;if(k.label){maxWidth=Math.max(maxWidth,k.label.length)}k.width=maxWidth?(maxWidth*b.charWidth):10}if(!k.cellRender){if(f.getType()==jslet.data.DataType.BOOLEAN){if(!b._isCellEditable(k)){k.cellRender=jslet.ui.DBTable.boolCellRender}}else{if(k.field==b._treeField){k.cellRender=jslet.ui.DBTable.treeCellRender}}}b.innerColumns.push(k)}return true},_calcParams:function(){var e=this;if(e._treeField){e._disableHeadSort=true}if(e._hasSeqCol){e.seqColWidth=(""+e._dataset.recordCount()).length*e.charWidth+5;var d=jslet.ui.htmlclass.TABLECLASS.selectColWidth;e.seqColWidth=e.seqColWidth>d?e.seqColWidth:d}else{e.seqColWidth=0}if(e._hasSelectCol){e.selectColWidth=jslet.ui.htmlclass.TABLECLASS.selectColWidth}else{e.selectColWidth=0}if(e._fixedRows>0){e.fixedSectionHt=e._fixedRows*e._rowHeight}else{e.fixedSectionHt=0}e.innerTotalFields=null;if(e._totalFields){e.footSectionHt=e._rowHeight;e.innerTotalFields=e._totalFields.split(",")}else{e.footSectionHt=0}e._prepareColumn();if(e._fixedCols){if(e._fixedCols>e.innerColumns.length){e._fixedCols=e.innerColumns.length}}e.hasFixedCol=e._sysColumns.length>0||e._fixedCols>0;if(e.hasFixedCol){var a=0;for(var c=0,b=e._sysColumns.length;c<b;c++){a+=e._sysColumns[c].width}for(var c=0;c<e._fixedCols;c++){a+=e.innerColumns[c].width}e.fixedColWidth=a+3}else{e.fixedColWidth=0}},_setScrollBarMaxValue:function(c){var b=this,a=c+b._repairHeight;b.jqVScrollBar.find("div").height(a)},_changeColWidth:function(f,e){var g=this;var b=g.innerColumns[f];if(b.width+e<=0){return}b.width+=e;var c=b.width+"px",d=b.colNum-g._fixedCols,a=jQuery(g.rightHeadTbl).find(".jl-tbl-row4width")[0];a.cells[d].style.width=c;if(g.rightFixedTbl){a=jQuery(g.rightFixedTbl).find(".jl-tbl-row4width")[0];a.cells[d].style.width=c}a=jQuery(g.rightContentTbl).find(".jl-tbl-row4width")[0];a.cells[d].style.width=c;if(g.footSectionHt){a=jQuery(g.rightFootTbl).find(".jl-tbl-row4width")[0];a.cells[d].style.width=c}g._changeContentWidth(e)},_changeContentWidth:function(b){var d=this,a=d.getTotalWidth(),c=a+"px";d.setRightHeadWidth(a);if(d.footSectionHt){d.rightFootTbl.style.width=c}d.rightFixedTbl.parentNode.style.width=c;d.rightContentTbl.parentNode.style.width=c;d._checkHoriOverflow()},_createFrame:function(){var c=this;c.el.style.position="relative";var f=jQuery(c.el);if(!f.hasClass("jl-table")){f.addClass("jl-table jl-border-box jl-round5")}if(c._noborder){f.addClass("jl-tbl-noborder")}var k=['<div class="jl-tbl-splitter" style="display: none"></div>','<div class="jl-tbl-norecord">',jslet.locale.DBTable.norecord,"</div>",'<table class="jl-tbl-container" style="width:100%"><tr>','<td class="jl-tbl-fixedcol-td"><div class="jl-tbl-fixedcol"><table class="jl-tbl-data"><tbody /></table><table class="jl-tbl-data"><tbody /></table><div class="jl-tbl-content-div"><table class="jl-tbl-data"><tbody /></table></div><table><tbody /></table></div></td>','<td><div class="jl-tbl-contentcol"><div><table class="jl-tbl-data jl-tbl-content-table" border="0" cellpadding="0" cellspacing="0"><tbody /></table></div><div><table class="jl-tbl-data jl-tbl-content-table"><tbody /></table></div><div class="jl-tbl-content-div"><table class="jl-tbl-data jl-tbl-content-table"><tbody /></table></div><table class="jl-tbl-content-table jl-tbl-fixedcol-td"><tbody /></table></div></td>','<td class="jl-scrollbar-width"><div class="jl-tbl-vscroll-head"></div><div class="jl-tbl-vscroll"><div /></div></td></tr></table>'];f.html(k.join(""));var d=f.find(".jl-tbl-fixedcol")[0].childNodes;c.leftHeadTbl=d[0];c.leftFixedTbl=d[1];c.leftContentTbl=d[2].firstChild;c.leftFootTbl=d[3];d=f.find(".jl-tbl-contentcol")[0].childNodes;c.rightHeadTbl=d[0].firstChild;c.rightFixedTbl=d[1].firstChild;c.rightContentTbl=d[2].firstChild;c.rightFootTbl=d[3];c.height=f.height();if(c._hideHead){c.leftHeadTbl.style.display="none";c.rightHeadTbl.style.display="none";f.find(".jl-tbl-vscroll-head").css("display","none")}if(c._fixedRows<=0){c.leftFixedTbl.style.display="none";c.rightFixedTbl.style.display="none"}if(!c._totalFields){c.leftFootTbl.style.display="none";c.rightFootTbl.style.display="none"}c.leftHeadTbl.parentNode.parentNode.style.width=c.fixedColWidth+"px";var e=jQuery(c.rightHeadTbl);e.off();var m=e.on("mousedown",c._doSplitHookDown);var l=e.on("mouseup",c._doSplitHookUp);jQuery(c.leftHeadTbl).on("mousedown",".jl-tbl-header-cell",function(o){o=jQuery.event.fix(o||window.event);var n=o.target;if(n.className=="jl-tbl-splitter-hook"){return}if(c._head_label_cliecked){c._head_label_cliecked=false;return}c._doHeadClick(this.jsletcolcfg,o.ctrlKey)});e.on("mousedown",".jl-tbl-header-cell",function(o){o=jQuery.event.fix(o||window.event);var n=o.target;if(n.className=="jl-tbl-splitter-hook"){return}if(c._head_label_cliecked){c._head_label_cliecked=false;return}c._doHeadClick(this.jsletcolcfg,o.ctrlKey)});jQuery(c.leftHeadTbl).on("mousedown",".jl-focusable-item",function(n){n=jQuery.event.fix(n||window.event);c._doHeadClick(this.parentNode.parentNode.parentNode.jsletcolcfg,n.ctrlKey);c._head_label_cliecked=true;n.stopImmediatePropagation();n.preventDefault();return false});e.on("mousedown",".jl-focusable-item",function(n){n=jQuery.event.fix(n||window.event);c._doHeadClick(this.parentNode.parentNode.parentNode.jsletcolcfg,n.ctrlKey);c._head_label_cliecked=true;n.stopImmediatePropagation();n.preventDefault();return false});var g=jQuery(c.leftFixedTbl),i=jQuery(c.rightFixedTbl),h=jQuery(c.leftContentTbl),b=jQuery(c.rightContentTbl);g.off();g.on("mouseenter","tr",function(){if(this.className=="jl-tbl-row4width"){return}c._oldHoverRowClassName=this.className;c._hoverRowIndex=this.rowIndex;this.className=jslet.ui.htmlclass.TABLECLASS.hoverrow;i[0].rows[this.rowIndex].className=jslet.ui.htmlclass.TABLECLASS.hoverrow});g.on("mouseleave","tr",function(){if(this.className=="jl-tbl-row4width"){return}this.className=c._oldHoverRowClassName;i[0].rows[this.rowIndex].className=c._oldHoverRowClassName});i.off();i.on("mouseenter","tr",function(){if(this.className=="jl-tbl-row4width"){return}c._oldHoverRowClassName=this.className;c._hoverRowIndex=this.rowIndex;this.className=jslet.ui.htmlclass.TABLECLASS.hoverrow;g[0].rows[this.rowIndex].className=jslet.ui.htmlclass.TABLECLASS.hoverrow});i.on("mouseleave","tr",function(){if(this.className=="jl-tbl-row4width"){return}this.className=c._oldHoverRowClassName;g[0].rows[this.rowIndex].className=c._oldHoverRowClassName});h.off();h.on("mouseenter","tr",function(){if(this.className=="jl-tbl-row4width"){return}c._oldHoverRowClassName=this.className;c._hoverRowIndex=this.rowIndex;this.className=jslet.ui.htmlclass.TABLECLASS.hoverrow;b[0].rows[this.rowIndex].className=jslet.ui.htmlclass.TABLECLASS.hoverrow});h.on("mouseleave","tr",function(){if(this.className=="jl-tbl-row4width"){return}this.className=c._oldHoverRowClassName;b[0].rows[this.rowIndex].className=c._oldHoverRowClassName});b.off();b.on("mouseenter","tr",function(){if(this.className=="jl-tbl-row4width"){return}c._oldHoverRowClassName=this.className;c._hoverRowIndex=this.rowIndex;this.className=jslet.ui.htmlclass.TABLECLASS.hoverrow;var n=(c._fixedRows>0||c._sysColumns.length>0);if(n){h[0].rows[this.rowIndex].className=jslet.ui.htmlclass.TABLECLASS.hoverrow}});b.on("mouseleave","tr",function(){if(this.className=="jl-tbl-row4width"){return}this.className=c._oldHoverRowClassName;var n=(c._fixedRows>0||c._sysColumns.length>0);if(n){h[0].rows[this.rowIndex].className=c._oldHoverRowClassName}});c.jqVScrollBar=f.find(".jl-tbl-vscroll");c.noRecordDiv=f.find(".jl-tbl-norecord")[0];c.jqVScrollBar.width(jslet.scrollbarSize()+1);c.jqVScrollBar.on("scroll",function(){if(c._keep_silence_){return}var n=Math.round(this.scrollTop/c._rowHeight);if(n!=c.listvm.getVisibleStartRow()){c._keep_silence_=true;try{c.listvm.setVisibleStartRow(n)}finally{c._keep_silence_=false}}});var a=f.find(".jl-tbl-splitter")[0];a._doDragStart=function(){this.style.display="block"};a._doDragging=function(v,u,t,s,r,p){var q=parseInt(jQuery(document.body).css("margin-left"));var n=a.parentNode.jslet;var o=n.innerColumns[n.currColId];if(o.width+r<=40){return}a.style.left=t-jQuery(a.parentNode).offset().left-q+"px"};a._doDragEnd=function(r,q,o,t,p,n){var s=a.parentNode.jslet;s._changeColWidth(s.currColId,p);a.style.display="none";a.parentNode.jslet.isDraggingColumn=false};a._doDragCancel=function(){a.style.display="none";a.parentNode.jslet.isDraggingColumn=false};c._setScrollBarMaxValue(c.listvm.getNeedShowRowCount()*c._rowHeight);c._createWidthHiddenRow(c.leftHeadTbl,true);c._createWidthHiddenRow(c.leftFixedTbl,true);c._createWidthHiddenRow(c.leftContentTbl,true);c._createWidthHiddenRow(c.leftFootTbl,true);c._createWidthHiddenRow(c.rightHeadTbl,false,true);c._createWidthHiddenRow(c.rightFixedTbl);c._createWidthHiddenRow(c.rightContentTbl);c._createWidthHiddenRow(c.rightFootTbl);if(c._totalFields){c.leftFootTbl.style.display="";c.rightFootTbl.style.display=""}c._renderHeader();if(c._hideHead){c.headSectionHt=0}else{c.headSectionHt=c.maxHeadRows*c._headRowHeight}c._checkHoriOverflow();c._calcAndSetContentHeight();c.noRecordDiv.style.top=c.headSectionHt+"px";c.noRecordDiv.style.left=f.find(".jl-tbl-fixedcol").width()+5+"px";f.find(".jl-tbl-vscroll-head").height(c.headSectionHt+c.fixedSectionHt+2);c._renderBody()},_calcAndSetContentHeight:function(){var b=this,a=jQuery(b.el);b.contentSectionHt=b.height-b.headSectionHt-b.fixedSectionHt-b.footSectionHt;if(b._isHoriOverflow){b.contentSectionHt-=jslet.ui.htmlclass.TABLECLASS.scrollBarWidth}b.listvm.setVisibleCount(Math.floor((b.contentSectionHt)/b._rowHeight),true);b._repairHeight=b.contentSectionHt-b.listvm.getVisibleCount()*b._rowHeight;a.find(".jl-tbl-contentcol").height(b.height);a.find(".jl-tbl-content-div").height(b.contentSectionHt);b.jqVScrollBar.height(b.contentSectionHt+b.footSectionHt)},_checkHoriOverflow:function(){var b=this,a=b.getTotalWidth();if(b._hideHead){b._isHoriOverflow=a>jQuery(b.rightContentTbl.parentNode.parentNode).innerWidth()}else{b._isHoriOverflow=a>b.rightHeadTbl.parentNode.parentNode.clientWidth}b._calcAndSetContentHeight()},_createWidthHiddenRow:function(k,i,f){var a=this;if(i&&!a.hasFixedCol){return}var m=k.createTHead(),l=m.insertRow(-1),c,e,b,g;jQuery(l).addClass("jl-tbl-row4width");if(i&&a._sysColumns.length>0){for(var h=0,d=a._sysColumns.length;h<d;h++){c=a._sysColumns[h];e=document.createElement("th");e.style.width=c.width+"px";l.appendChild(e)}}if(i){b=0;g=a._fixedCols}else{b=a._fixedCols;g=a.innerColumns.length}for(var h=b;h<g;h++){c=a.innerColumns[h];e=document.createElement("th");e.style.width=c.width+"px";l.appendChild(e)}if(!i&&f){e=document.createElement("th");a.rightHeadTbl.rows[0].appendChild(e)}},_createHeadCell:function(b,g){var f=this,d=0,e=0;if(!g.subHeads){d=f.maxHeadRows-(g.level?g.level:0)}else{e=g.colSpan}var a=document.createElement("th");a.className="jl-tbl-header-cell jl-unselectable";a.noWrap=true;a.jsletcolcfg=g;if(d&&d>1){a.rowSpan=d}if(e&&e>1){a.colSpan=e}if(g.cellRender&&g.cellRender.createHeader){g.cellRender.createHeader.call(f,a,g)}else{var c=g.label||"&nbsp;";a.innerHTML=['<div style="position: relative" unselectable="on" class="jl-unselectable jl-tbl-cell jl-border-box"><span id="',g.id,'" unselectable="on" style="width:100%;padding:0px 2px">',((!f._disableHeadSort&&!g.disableHeadSort)?'<a class="jl-focusable-item" href="javascript:void(0)" >'+c+"</a>":c),'</span><span unselectable="on" class="jl-tbl-sorter" title="',jslet.locale.DBTable.sorttitle,'">&nbsp;</span><div  unselectable="on" class="jl-tbl-splitter-hook" colid="',g.colNum,'">&nbsp;</div></div>'].join("")}b.appendChild(a)},_renderHeader:function(){var a=this;if(a._hideHead){return}var s,l=null,n,o,e,c,f=a.leftHeadTbl.createTHead(),t=a.rightHeadTbl.createTHead();for(var d=0;d<a.maxHeadRows;d++){f.insertRow(-1);t.insertRow(-1)}s=f.rows[1];for(var d=0,b=a._sysColumns.length;d<b;d++){n=a._sysColumns[d];n.rowSpan=a.maxHeadRows;a._createHeadCell(s,n)}function m(i){var w,u;for(var h=0,v=i.length;h<v;h++){w=i[h];if(w.colNum<a._fixedCols){u=f.rows[w.level+1]}else{u=t.rows[w.level+1]}a._createHeadCell(u,w);if(w.subHeads){m(w.subHeads)}}}m(a.innerHeads);var r,q,k=a._headRowHeight;for(var d=1;d<=a.maxHeadRows;d++){r=jQuery(f.rows[d]);q=jQuery(t.rows[d]);r.height(k);q.height(k)}var p=document.createElement("th");p.colSpan=a.maxHeadRows;p.className="jl-tbl-extra-head jl-unselectable";p.innerHTML='<div style="position: relative" unselectable="on" class="jl-unselectable jl-tbl-cell jl-border-box">&nbsp;</div>';a.rightHeadTbl.rows[1].appendChild(p);var g=a.getTotalWidth();a.setRightHeadWidth(g);jQuery(a.rightFixedTbl.parentNode).width(g);jQuery(a.rightContentTbl.parentNode).width(g);jQuery(a.rightTotalTbl).width(g);a.sortedCell=null;a.indexField=null},setRightHeadWidth:function(b){var d=this,c=jQuery(d.el);var a=d.rightHeadTbl.parentNode.parentNode.clientWidth;if(b<a){jQuery(d.rightHeadTbl.parentNode).width(a)}else{jQuery(d.rightHeadTbl.parentNode).width(b)}},getTotalWidth:function(){var d=this,a=0;for(var c=d._fixedCols,b=d.innerColumns.length;c<b;c++){a+=d.innerColumns[c].width}return a},_adjustTableBorder:function(){var a=this;function b(e,h,c,d,l){var p=e.rows;if(p.length<2){return}var o,m,n,g,f,k;n=p[1].cells;f=n.length;for(g=0;g<f;g++){m=n[g];m.style.borderTopWidth=0}o=p[p.length-1];n=o.cells;f=n.length;for(g=0;g<f;g++){m=n[g];m.style.borderBottomWidth=0}k=p.length;f--;for(g=1;g<k;g++){o=p[g];f=o.cells.length;if(f==0){continue}m=o.cells[0];m.style.borderLeftWidth=0;m=o.cells[f-1];m.style.borderRightWidth=0}if(h){e.style.borderTopWidth=0}if(c){e.style.borderBottomWidth=0}if(d){e.style.borderLeftWidth=0}if(l){e.style.borderRightWidth=0}}b(a.leftHeadTbl,false,false,true,true);b(a.rightHeadTbl,false,false,false,false);b(a.leftFixedTbl,true,true,true,true);b(a.rightFixedTbl,true,true,false,false);b(a.leftContentTbl,false,false,true,true);b(a.rightContentTbl,false,false,false,false)},_doSplitHookDown:function(b){b=jQuery.event.fix(b||window.event);var c=b.target;if(c.className!="jl-tbl-splitter-hook"){return}var k=jslet.ui.findFirstParent(c,function(h){return h.tagName.toLowerCase()=="div"&&h.jslet&&h.jslet._dataset});var n=jQuery(k);var i=jQuery(document.body);var e=parseInt(i.css("margin-top"));var d=parseInt(i.css("margin-left"));var l=n.position().top-e;var m=jQuery(c);var g=n.height()-20;var f=m.offset().left-n.offset().left-d;var a=n.find(".jl-tbl-splitter")[0];a.style.left=f+"px";a.style.top="1px";a.style.height=g+"px";jslet.ui.dnd.bindControl(a);k.jslet.currColId=parseInt(m.attr("colid"));k.jslet.isDraggingColumn=true},_doSplitHookUp:function(d){d=jQuery.event.fix(d||window.event);var b=d.target.lastChild;if(b.className!="jl-tbl-splitter-hook"){return}var a=jslet.ui.findFirstParent(b,function(g){return g.tagName.toLowerCase()=="div"&&g.jslet&&g.jslet._dataset});var e=jQuery(a),f=jQuery(document.body);f.css("cursor","auto");var c=e.find(".jl-tbl-splitter")[0];if(c.style.display!="none"){c.style.display="none"}a.jslet.isDraggingColumn=false},_getColumnByField:function(e){var d=this;if(!d.innerColumns){return null}var c;for(var b=0,a=d.innerColumns.length;b<a;b++){c=d.innerColumns[b];if(c.field==e){return c}}return null},_doHeadClick:function(a,c){var b=this;if(b._disableHeadSort||a.disableHeadSort||b.isDraggingColumn){return}b._doSort(a.field,c)},_doSort:function(b,a){var c=this;c._dataset.disableControls();try{if(!c._onCustomSort){c._dataset.toggleIndexField(b,!a)}else{c._onCustomSort.call(c,indexFlds)}c.listvm.refreshModel()}finally{c._dataset.enableControls()}},_updateSortFlag:function(){var b=this;if(b._hideHead){return}var t=b._dataset.mergedIndexFields();var d=b.leftHeadTbl.createTHead(),a=b.rightHeadTbl.createTHead(),f=jQuery(d).find("th"),u=jQuery(a).find("th"),h=[],m;for(var q=0,p=f.length;q<p;q++){m=f[q];if(m.jsletcolcfg){h[h.length]=m}}for(var q=0,p=u.length;q<p;q++){m=u[q];if(m.jsletcolcfg){h[h.length]=m}}var r=t.length,l,c=h.length;for(var q=0;q<c;q++){m=h[q];l=jQuery(m).find(".jl-tbl-sorter")[0];if(l){l.innerHTML="&nbsp;"}}var g,s,e,n=1;for(var q=0;q<r;q++){e=t[q];for(var o=0;o<c;o++){m=h[o];g=m.jsletcolcfg.field;if(!g){continue}l=jQuery(m).find(".jl-tbl-sorter")[0];s="&nbsp;";if(g==e.fieldName){s=e.order===1?jslet.ui.htmlclass.TABLECLASS.sortAscChar:jslet.ui.htmlclass.TABLECLASS.sortDescChar;if(r>1){s+=n++}break}}l.innerHTML=s;if(!m){continue}}},_doSelectBoxClick:function(e){var b=null;if(e){e=jQuery.event.fix(e||window.event);b=e.target}else{b=this}var c=jslet.ui.getParentElement(b,2);try{jQuery(c).click()}finally{var f=jslet.ui.findFirstParent(c,function(g){return g.jslet?true:false});var d=f.jslet;if(d._onSelect){var a=d._onSelect.call(d,b.checked);if(a!==undefined&&!a){b.checked=!b.checked;return}}d._dataset.select(b.checked?1:0,d._selectBy)}},_doRowDblClick:function(a){var b=jslet.ui.findFirstParent(this,function(d){return d.jslet?true:false});var c=b.jslet;if(c._onRowDblClick){c._onRowDblClick.call(c,a)}},_doRowClick:function(b){var c=jslet.ui.findFirstParent(this,function(e){return e.jslet?true:false});var d=c.jslet;var a=d.listvm.recnoToRowno(this.jsletrecno);d.listvm.setCurrentRowno(a);if(d._onRowClick){d._onRowClick.call(d,b)}},_renderCell:function(c,a,b){var e=this;var d=document.createElement("td");d.noWrap=true;d.jsletColCfg=a;if(a.cellRender){a.cellRender.createCell.call(e,d,a)}else{if(!e._isCellEditable(a)){jslet.ui.DBTable.defaultCellRender.createCell.call(e,d,a)}else{jslet.ui.DBTable.editableCellRender.createCell.call(e,d,a)}}c.appendChild(d)},_renderRow:function(n,d){var b=this;var l=0,h=null,c,p=b._fixedCols>0||b._sysColumns.length>0;switch(n){case 1:l=b._fixedRows;if(p){h=b.leftFixedTbl.tBodies[0]}c=b.rightFixedTbl.tBodies[0];break;case 2:l=b.listvm.getVisibleCount();if(p){h=b.leftContentTbl.tBodies[0]}c=b.rightContentTbl.tBodies[0];break;case 3:if(!b.footSectionHt){return}l=1;if(p){h=b.leftFootTbl.tBodies[0]}c=b.rightFootTbl.tBodies[0];break}var q,f,e,m,r=0,a=b.innerColumns.length;if(d){r=c.rows.length}for(var k=r;k<l;k++){if(p){q=h.insertRow(-1);q.style.height=b._rowHeight+"px";if(n!=3){q.ondblclick=b._doRowDblClick;q.onclick=b._doRowClick}var o=b._sysColumns.length;for(var g=0;g<o;g++){e=b._sysColumns[g];b._renderCell(q,e,g===0)}m=o===0;for(var g=0;g<b._fixedCols;g++){e=b.innerColumns[g];b._renderCell(q,e,m&&g===0)}}m=!p;q=c.insertRow(-1);q.style.height=b._rowHeight+"px";if(n!=3){q.ondblclick=b._doRowDblClick;q.onclick=b._doRowClick}for(var g=b._fixedCols;g<a;g++){e=b.innerColumns[g];b._renderCell(q,e,g==b._fixedCols)}}},_sumTotal:function(){var g=this,f,b,a=g.innerColumns.length;for(var d=0;d<a;d++){f=g.innerColumns[d];if(g.innerTotalFields.indexOf(f.field)<0){continue}f.totalValue=0}var h=g._dataset.recordCount(),e=g._dataset.recno();try{for(var d=0;d<h;d++){g._dataset.recnoSilence(d);for(var c=0;c<a;c++){f=g.innerColumns[c];b=f.field;if(g.innerTotalFields.indexOf(b)>=0){f.totalValue+=g._dataset.getFieldValue(b)}}}}finally{g._dataset.recnoSilence(e)}},_renderBody:function(a){var b=this;if(a){b._renderRow(2,true)}else{b._renderRow(1);b._renderRow(2);b._renderRow(3)}b._adjustTableBorder()},_fillTotalSection:function(){var a=this;if(!a.footSectionHt){return}var m=a._fixedCols>0&&a._sysColumns.length>0,f,h;if(m){f=a.leftFootTbl.tBodies[0].rows[0]}h=a.rightFootTbl.tBodies[0].rows[0];a._sumTotal();var e,c=0,b,l;for(var d=0,g=a.innerColumns.length;d<g;d++){l=a.innerColumns[d];if(d<a._fixedCols){e=f.cells[d]}else{e=h.cells[d-a._fixedCols]}if(a.innerTotalFields.indexOf(l.field)<0){e.innerHTML="&nbsp;";continue}b=a._dataset.getField(l.field);e.innerHTML=jslet.formatNumber(l.totalValue,b.displayFormat());e.style.textAlign=b.alignment()}},_fillData:function(){var d=this;var c=d._dataset.recno(),e=d.listvm.getNeedShowRowCount(),b=e*d._rowHeight;d._setScrollBarMaxValue(b);d.noRecordDiv.style.display=(e===0?"block":"none");var a=d._dataset.startSilenceMove();try{d._fillRow(true);d._fillRow(false);if(d.footSectionHt){d._fillTotalSection()}}finally{d._dataset.endSilenceMove(a)}},_fillRow:function(n){var e=this,k=0,h=0,t=null,f,a=e._fixedCols>0||e._sysColumns.length>0;if(n){k=e._fixedRows;h=-1*e._fixedRows;if(k===0){return}if(a){t=e.leftFixedTbl.tBodies[0]}f=e.rightFixedTbl.tBodies[0]}else{k=e.listvm.getVisibleCount();h=e.listvm.getVisibleStartRow();if(a){t=e.leftContentTbl.tBodies[0]}f=e.rightContentTbl.tBodies[0]}var p,l,u,m=-1,g,r,x,b=e.innerColumns.length,s=e.listvm.getNeedShowRowCount()-e.listvm.getVisibleStartRow(),q=a?t.rows:null,d=f.rows,c={},o=true;for(var w=0;w<k;w++){if(w>=s){if(a){p=q[w];p.style.display="none"}p=d[w];p.style.display="none";continue}e.listvm.setCurrentRowno(w+h,true);m=e._dataset.recno();if(a){p=q[w];p.jsletrecno=m;p.style.display="";g=p.childNodes;r=g.length;for(var v=0;v<r;v++){x=g[v];e._fillCell(m,x,c,o)}}p=d[w];p.jsletrecno=m;p.style.display="";if(e._onFillRow){e._onFillRow.call(e,p,e._dataset)}p=d[w];g=p.childNodes;r=g.length;for(var v=0;v<r;v++){x=g[v];e._fillCell(m,x,c,o)}o=0}},_fillCell:function(g,f,d,b){var h=this,a=f.jsletColCfg;if(!a){return}var c=a.field;if(h._onFillCell){h._onFillCell.call(h,f,h._dataset,c)}if(c&&a.mergeSame){if(b||!h._dataset.isSameAsPrevious(c)){d[c]={cell:f,count:1};jQuery(f).attr("rowspan",1);f.style.display=""}else{var e=d[c];e.count++;f.style.display="none";jQuery(e.cell).attr("rowspan",e.count)}}if(a.cellRender&&a.cellRender.refreshCell){a.cellRender.refreshCell.call(h,f,a,g)}else{if(!h._isCellEditable(a)){jslet.ui.DBTable.defaultCellRender.refreshCell.call(h,f,a,g)}else{jslet.ui.DBTable.editableCellRender.refreshCell.call(h,f,a,g)}}},refreshCurrentRow:function(){var a=this,i=a._fixedCols>0,f=null,g,l,b=a._dataset.recno();if(b<a._fixedRows){if(i){f=a.leftFixedTbl.tBodies[0]}g=a.rightFixedTbl.tBodies[0];l=b}else{if(i){f=a.leftContentTbl.tBodies[0]}g=a.rightContentTbl.tBodies[0];l=a.listvm.recnoToRowno(a._dataset.recno())-a.listvm.getVisibleStartRow()}var k,m,e,c;if(i){k=f.rows[l];if(!k){return}m=k.childNodes;c=k.jsletrecno;for(var d=0,h=m.length;d<h;d++){e=m[d];if(e.isSeqCol){e.firstChild.innerHTML=b+1;continue}if(e.isSelectCol){ocheck=e.firstChild;ocheck.checked=a._dataset.selected();continue}a._fillCell(c,e)}}k=g.rows[l];if(!k){return}c=k.jsletrecno;m=k.childNodes;for(var d=0,h=m.length;d<h;d++){e=m[d];a._fillCell(c,e)}},_getLeftRowByRecno:function(c){var e=this;if(c<e._fixedRows){return e.leftFixedTbl.tBodies[0].rows[c]}var d=e.leftContentTbl.tBodies[0].rows,f;for(var b=0,a=d.length;b<a;b++){f=d[b];if(f.jsletrecno==c){return f}}return null},_showCurrentRow:function(b){var a=this;rowno=a.listvm.recnoToRowno(a._dataset.recno());a.listvm.setCurrentRowno(rowno,false,b)},_getTrByRowno:function(g){var a=this,d=a._fixedCols>0||a._sysColumns.length>0,f,e,b,i,h,c;if(g<0){i=a.rightFixedTbl.tBodies[0].rows;b=a._fixedRows+g;h=i[b];c=(d?a.leftFixedTbl.tBodies[0].rows[b]:null);return{fixed:c,content:h}}i=a.rightContentTbl.tBodies[0].rows;b=g-a.listvm.getVisibleStartRow();if(b>=0){h=i[b];if(!h){return null}c=d?a.leftContentTbl.tBodies[0].rows[b]:null;return{fixed:c,content:h}}return null},_syncScrollBar:function(b){var c=this;if(c._keep_silence_){return}var a=b*c._rowHeight;c._keep_silence_=true;try{c.jqVScrollBar[0].scrollTop=a}finally{c._keep_silence_=false}},expandAll:function(){var a=this;a.listvm.expandAll(function(){a._fillData()})},collapseAll:function(){var a=this;a.listvm.collapseAll(function(){a._fillData()})},refreshControl:function(q){var a=this,r=q.eventType;if(r==jslet.data.RefreshEvent.CHANGEMETA){}else{if(r==jslet.data.RefreshEvent.BEFORESCROLL){}else{if(r==jslet.data.RefreshEvent.SCROLL){if(a._dataset.recordCount()===0){return}a._showCurrentRow(true)}else{if(r==jslet.data.RefreshEvent.UPDATEALL){a.listvm.refreshModel();a.listvm.setVisibleStartRow(0,true);a._updateSortFlag(true);a._fillData();a._showCurrentRow(true);if(a._hasSelectCol){jQuery(a.el).find(".jl-tbl-select-all")[0].checked=false}}else{if(r==jslet.data.RefreshEvent.UPDATERECORD){a.refreshCurrentRow()}else{if(r==jslet.data.RefreshEvent.UPDATECOLUMN){a._fillData()}else{if(r==jslet.data.RefreshEvent.INSERT){a.listvm.refreshModel();var b=a._dataset.recno(),m=q.preRecno;a._fillData();a.refreshControl(jslet.data.RefreshEvent.scrollEvent(b,m))}else{if(r==jslet.data.RefreshEvent.DELETE){a.listvm.refreshModel();a._fillData();var b=a._dataset.recno(),m=q.preRecno;a.refreshControl(jslet.data.RefreshEvent.scrollEvent(b,m))}else{if(r==jslet.data.RefreshEvent.SELECTRECORD){if(!a._hasSelectCol){return}var d=0;if(a._hasSeqCol){d++}var b=q.recno,p,k,o,l;for(var h=0,c=b.length;h<c;h++){p=a._getLeftRowByRecno(b[h]);if(!p){continue}k=p.cells[d];o=q.selected?true:false;l=k.firstChild;l.checked=o;l.defaultChecked=o}}else{if(r==jslet.data.RefreshEvent.SELECTALL){if(!a._hasSelectCol){return}var d=0;if(a._hasSeqCol){d++}var n=a.leftFixedTbl.tBodies[0],f=a.leftContentTbl.tBodies[0],o,b,p,k,l,e,g=a._dataset.recno();try{for(var h=0,c=n.rows.length;h<c;h++){p=n.rows[h];if(p.style.display=="none"){break}a._dataset.recnoSilence(p.jsletrecno);o=a._dataset.selected()?true:false;k=p.cells[d];l=k.firstChild;l.checked=o;l.defaultChecked=o}for(var h=0,c=f.rows.length;h<c;h++){p=f.rows[h];if(p.style.display=="none"){break}a._dataset.recnoSilence(p.jsletrecno);o=a._dataset.selected()?true:false;k=p.cells[d];l=jQuery(k).find("[type=checkbox]")[0];l.checked=o;l.defaultChecked=o}}finally{a._dataset.recnoSilence(g)}}}}}}}}}}}},_isCellEditable:function(a){var d=this;if(d._readOnly){return false}var b=a.field;if(!b){return false}var e=d._dataset.getField(b),c=!e.disabled()&&!e.readOnly()?1:0;return c},_createEditControl:function(c){var a=this,b=c.field;if(!b){return null}var f=a._dataset.getField(b),l=!f.disabled()&&!f.readOnly()?1:0;if(!l){return null}var e,k,g,d=f.editControl();d.dataset=a._dataset;d.field=b;var i=jslet.ui.createControl(d);i=i.el;i.id=jslet.nextId();return i},checkSizeChanged:function(){var c=this,b=jQuery(c.el),a=b.height();if(a==c._oldHeight){return}c.height=a;c._calcAndSetContentHeight();c._renderBody(true);c._fillData()},destroy:function($super){var c=this,b=jQuery(c.el);jslet.resizeEventBus.unsubscribe(c);b.off();c.listvm.onTopRownoChanged=null;c.listvm.onVisibleCountChanged=null;c.listvm.onCurrentRownoChanged=null;c.listvm=null;c.prevRow=null;c.leftHeadTbl=null;c.rightHeadTbl=null;jQuery(c.rightHeadTbl).off();c.leftFixedTbl=null;c.rightFixedTbl=null;c.leftContentTbl=null;c.rightContentTbl=null;c.leftFootTbl=null;c.rightFootTbl=null;c.noRecordDiv=null;c.jqVScrollBar.off();c.jqVScrollBar=null;var a=b.find(".jl-tbl-splitter")[0];a._doDragging=null;a._doDragEnd=null;a._doDragCancel=null;c.parsedHeads=null;b.find("tr").each(function(){this.ondblclick=null;this.onclick=null});b.find(".jl-tbl-select-check").off();$super()}});jslet.ui.DBTable=jslet.Class.create(jslet.ui.AbstractDBTable,{});jslet.ui.register("DBTable",jslet.ui.DBTable);jslet.ui.DBTable.htmlTemplate="<div></div>";jslet.ui.CellRender=jslet.Class.create({createCell:function(b,a){},refreshCell:function(b,a){}});jslet.ui.DefaultCellRender=jslet.Class.create(jslet.ui.CellRender,{createCell:function(c,a){var e=this,b=a.field,f=e._dataset.getField(b);c.noWrap=true;c.style.textAlign=f.alignment();c.innerHTML="";var d=document.createElement("div");c.appendChild(d);jQuery(d).addClass(jslet.ui.htmlclass.TABLECLASS.celldiv)},refreshCell:function(g,d){if(!d||d.noRefresh){return}var h=jQuery(g.firstChild);h.html("");var b=this,c=d.field;if(!c){return}var f=b._dataset.getField(c),l;try{l=b._dataset.getFieldText(c)}catch(k){l="error: "+k.message}g.title=l;if(f.urlExpr()){var a="<a href="+f.calcUrl(),i=f.urlTarget();if(i){a+=" target="+i}a+=">"+l+"</a>";l=a}h.html(l)}});jslet.ui.EditableCellRender=jslet.Class.create(jslet.ui.CellRender,{createCell:function(d,a,f){var e=this,b=a.field,g=e._dataset.getField(b);d.noWrap=true;d.style.textAlign=g.alignment();d.innerHTML="";var c=e._createEditControl(a);jQuery(c).css("width","100%").on("focus",function(){this.jslet._dataset.recno(this.jslet.currRecno())});c.style.border="0px";d.style.paddingLeft="2px";d.style.paddingRight="2px";d.appendChild(c)},refreshCell:function(c,a,d){if(!a){return}var b=c.firstChild.jslet;b.currRecno(d);b.forceRefreshControl()}});jslet.ui.SequenceCellRender=jslet.Class.create(jslet.ui.CellRender,{createHeader:function(b,a){b.innerHTML='<div class="jl-tbl-cell">&nbsp;</div>'},createCell:function(b,a){var d=this;b.noWrap=true;b.innerHTML="";var c=document.createElement("div");b.appendChild(c);c.className=jslet.ui.htmlclass.TABLECLASS.celldiv},refreshCell:function(c,a){if(!a||a.noRefresh){return}var b=jQuery(c.firstChild);b.html("");var d=this,e=d._dataset.recno()+1;c.title=e;b.html(e)}});jslet.ui.SelectCellRender=jslet.Class.create(jslet.ui.CellRender,{createHeader:function(b,a){b.noWrap=true;b.style.textAlign="center";var d=document.createElement("input");d.type="checkbox";var c=this;jQuery(d).addClass("jl-tbl-select-check jl-tbl-select-all").on("click",function(e){c._dataset.selectAll(this.checked?1:0,c._onSelectAll)});b.appendChild(d)},createCell:function(c,a){c.noWrap=true;c.style.textAlign="center";var d=this,b=document.createElement("input"),e=jQuery(b);e.attr("type","checkbox").addClass("jl-tbl-select-check");e.click(d._doSelectBoxClick);c.appendChild(b)},refreshCell:function(c,a){if(!a||a.noRefresh){return}var d=this,b=c.firstChild;if(d._dataset.checkSelectable()){b.checked=d._dataset.selected();b.style.display=""}else{b.style.display="none"}}});jslet.ui.SubgroupCellRender=jslet.Class.create(jslet.ui.CellRender,{createCell:function(b,a){}});jslet.ui.BoolCellRender=jslet.Class.create(jslet.ui.DefaultCellRender,{refreshCell:function(d,a){if(!a||a.noRefresh){return}d.style.textAlign="center";var c=jQuery(d.firstChild);c.html("&nbsp;");var e=this,b=a.field,f=e._dataset.getField(b);if(f.trueValue()==e._dataset.getFieldValue(b)){c.addClass("jl-tbl-checked");c.removeClass("jl-tbl-unchecked")}else{c.removeClass("jl-tbl-checked");c.addClass("jl-tbl-unchecked")}}});jslet.ui.TreeCellRender=jslet.Class.create(jslet.ui.CellRender,{initialize:function(){},createCell:function(d,a){var f=this;d.noWrap=true;jQuery(d).html("");var e=document.createElement("div"),c=jQuery(e);c.addClass(jslet.ui.htmlclass.TABLECLASS.celldiv);e.style.height=f._rowHeight-2+"px";c.html('<span class="jl-tbltree-indent"></span><span class="jl-tbltree-node"></span><span class="jl-tbltree-icon"></span><span class="jl-tbltree-text"></span>');var b=e.childNodes[1];b.onclick=function(h){var g=jslet.ui.findFirstParent(this,function(i){return i.tagName&&i.tagName.toLowerCase()=="tr"});h.stopImmediatePropagation();h.preventDefault();f._dataset.recno(g.jsletrecno);if(f._dataset.aborted()){return false}if(this.expanded){f.listvm.collapse(function(){f._fillData()})}else{f.listvm.expand(function(){f._fillData()})}return false};b.onmouseover=function(h){var g=jQuery(this);if(g.hasClass("jl-tbltree-collapse")){g.addClass("jl-tbltree-collapse-hover")}else{g.addClass("jl-tbltree-expand-hover")}};b.onmouseout=function(h){var g=jQuery(this);g.removeClass("jl-tbltree-collapse-hover");g.removeClass("jl-tbltree-expand-hover")};d.appendChild(e)},refreshCell:function(r,i){if(!i||i.noRefresh){return}var f=r.firstChild,d=f.childNodes,g=this,b=g.listvm.getLevel();if(!jslet.ui.TreeCellRender.iconWidth){jslet.ui.TreeCellRender.iconWidth=parseInt(jslet.ui.getCssValue("jl-tbltree-indent","width"))}var q=g.listvm.hasChildren(),l=(!q?b+1:b)*jslet.ui.TreeCellRender.iconWidth,k=d[0];k.style.width=l+"px";var p=d[1];p.style.display=q?"inline-block":"none";if(q){p.expanded=g._dataset.getRecord()._expanded_;var m=jQuery(p);m.removeClass("jl-tbltree-expand");m.removeClass("jl-tbltree-collapse");m.addClass((p.expanded?"jl-tbltree-expand":"jl-tbltree-collapse"))}if(i.getIconClass){var c=i.getIconClass(b,q);if(c){var s=jQuery(d[2]);s.addClass("jl-tbltree-icon "+c)}}var a=d[3];var o=i.field,t=g._dataset.getField(o),n;try{n=g._dataset.getFieldText(o)}catch(u){n="error: "+u.message}r.title=n;if(t.urlExpr()){var h="<a href="+t.calcUrl();var v=t.urlTarget();if(v){h+=" target="+v}h+=">"+n+"</a>";n=h}a.innerHTML=n}});jslet.ui.DBTable.defaultCellRender=new jslet.ui.DefaultCellRender();jslet.ui.DBTable.editableCellRender=new jslet.ui.EditableCellRender();jslet.ui.DBTable.treeCellRender=new jslet.ui.TreeCellRender();jslet.ui.DBTable.boolCellRender=new jslet.ui.BoolCellRender();jslet.ui.DBTable.sequenceCellRender=new jslet.ui.SequenceCellRender();jslet.ui.DBTable.selectCellRender=new jslet.ui.SelectCellRender();jslet.ui.DBTable.subgroupCellRender=new jslet.ui.SubgroupCellRender();jslet.ui.Splitter=function(){if(!jslet.ui._splitDiv){var a=document.createElement("div");a.className="jl-split-column";a.style.display="none";jslet.ui._splitDiv=a;document.body.appendChild(a);a=null}this.isDragging=false;this.attach=function(c,f,e,b){if(!b){b=jQuery(c).height()}var d=jslet.ui._splitDiv;d.style.height=b+"px";d.style.left=f+"px";d.style.top=e+"px";d.style.display="block";jslet.ui.dnd.bindControl(this);this.isDragging=false};this.unattach=function(){jslet.ui._splitDiv.style.display="none";this.onSplitEnd=null;this.onSplitCancel=null};this.onSplitEnd=null;this.onSplitCancel=null;this._doDragEnd=function(f,e,c,g,d,b){jslet.ui.dnd.unbindControl();if(this.onSplitEnd){this.onSplitEnd(c-f)}this.unattach();this.isDragging=false};this._doDragging=function(f,e,c,g,d,b){this.isDragging=true;jslet.ui._splitDiv.style.left=c+"px"};this._doDragCancel=function(){jslet.ui.dnd.unbindControl();if(this.onSplitCancel){this.onSplitCancel()}this.unattach();this.isDragging=false}};jslet.ui.DBTreeView=jslet.Class.create(jslet.ui.DBControl,{initialize:function($super,a,c){var b=this;b.allProperties="dataset,displayFields,hasCheckBox,correlateCheck,readOnly,expandLevel,codeField,codeFormat,onItemClick,onItemDblClick,iconClassField,onGetIconClass,onCreateContextMenu";b.requiredProperties="displayFields";b._displayFields=null;b._hasCheckBox=false;b._readOnly=false;b._correlateCheck=false;b._iconClassField=null;b._expandLevel=-1;b._onItemClick=null;b._onItemDblClick=null;b._onGetIconClass=null;b._onCreateContextMenu=null;b.iconWidth=null;$super(a,c)},displayFields:function(a){if(a===undefined){return this._displayFields}a=jQuery.trim(a);jslet.Checker.test("DBTreeView.displayFields",a).required().isString();this._displayFields=a},iconClassField:function(a){if(a===undefined){return this._iconClassField}a=jQuery.trim(a);jslet.Checker.test("DBTreeView.iconClassField",a).isString();this._iconClassField=a},hasCheckBox:function(a){if(a===undefined){return this._hasCheckBox}this._hasCheckBox=a?true:false},correlateCheck:function(a){if(a===undefined){return this._correlateCheck}this._correlateCheck=a?true:false},readOnly:function(a){if(a===undefined){return this._readOnly}this._readOnly=a?true:false},expandLevel:function(a){if(a===undefined){return this._expandLevel}jslet.Checker.test("DBTreeView.expandLevel",a).isGTEZero();this._expandLevel=parseInt(a)},onItemClick:function(a){if(a===undefined){return this._onItemClick}jslet.Checker.test("DBTreeView.onItemClick",a).isFunction();this._onItemClick=a},onItemDblClick:function(a){if(a===undefined){return this._onItemDblClick}jslet.Checker.test("DBTreeView.onItemDblClick",a).isFunction();this._onItemDblClick=a},onGetIconClass:function(a){if(a===undefined){return this._onGetIconClass}jslet.Checker.test("DBTreeView.onGetIconClass",a).isFunction();this._onGetIconClass=a},onCreateContextMenu:function(a){if(a===undefined){return this._onCreateContextMenu}jslet.Checker.test("DBTreeView.onCreateContextMenu",a).isFunction();this._onCreateContextMenu=a},isValidTemplateTag:function(a){return a.tagName.toLowerCase()=="div"},bind:function(){var c=this,b=jQuery(c.el);c.scrBarSize=jslet.scrollbarSize()+1;if(c._keyField===undefined){c._keyField=c._dataset.keyField()}var a=b.attr("tabindex");if(!a){b.attr("tabindex",0)}b.keydown(function(d){if(c._doKeydown(d.which)){d.preventDefault()}});b.on("mouseenter","table.jl-tree-nodes",function(d){jQuery(this).addClass("jl-tree-nodes-hover")});b.on("mouseleave","table.jl-tree-nodes",function(d){jQuery(this).removeClass("jl-tree-nodes-hover")});if(!b.hasClass("jl-tree")){b.addClass("jl-tree")}c.renderAll();c.refreshControl(jslet.data.RefreshEvent.scrollEvent(this._dataset.recno()));c._createContextMenu();jslet.resizeEventBus.subscribe(c)},renderAll:function(){var b=this,a=jQuery(b.el);b.evaluator=new jslet.Expression(b._dataset,b._displayFields);a.html("");b.oldWidth=a.width();b.oldHeight=a.height();b.nodeHeight=b.iconWidth=parseInt(jslet.ui.getCssValue("jl-tree-lines","width"));b.treePanelHeight=a.height();b.treePanelWidth=a.width();b.nodeCount=Math.floor(b.treePanelHeight/b.nodeHeight)-1;b._initVm();b._initFrame()},_initFrame:function(){var a=this,b=jQuery(a.el);b.find(".jl-tree-container").off();b.find(".jl-tree-scrollbar").off();var k=[];for(var e=0;e<5;e++){k.push('<td class="jl-tree-lines" ');k.push(jslet.ui.DBTreeView.NODETYPE);k.push('="0"></td>')}var h=k.join(""),g=['<table border="0" cellpadding="0" cellspacing="0" style="table-layout:fixed;width:100%;height:100%"><tr><td style="vertical-align:top"><div class="jl-tree-container">'];for(var e=0,c=a.nodeCount;e<c;e++){g.push('<table class="jl-tree-nodes" cellpadding="0" cellspacing="0"><tr>');g.push(h);g.push('<td class="jl-tree-expander" ');g.push(jslet.ui.DBTreeView.NODETYPE);g.push('="1"></td><td ');g.push(jslet.ui.DBTreeView.NODETYPE);g.push('="2"></td><td ');g.push(jslet.ui.DBTreeView.NODETYPE);g.push('="3"></td><td class="jl-tree-text" ');g.push(jslet.ui.DBTreeView.NODETYPE);g.push('="9" nowrap="nowrap"></td></tr></table>')}g.push('</div></td><td class="jl-tree-scroll-col"><div class="jl-tree-scrollbar"><div class="jl-tree-tracker"></div></div></td></tr></table>');b.html(g.join(""));var d=b.find(".jl-tree-container");d.on("click",function(i){a._doRowClick(i.target)});d.on("dblclick",function(i){a._doRowDblClick(i.target)});a.listvm.setVisibleCount(a.nodeCount);var f=b.find(".jl-tree-scrollbar");f.on("scroll",function(){var i=Math.round(this.scrollTop/a.nodeHeight);if(i!=a.listvm.getVisibleStartRow()){a._skip_=true;try{a.listvm.setVisibleStartRow(i)}finally{a._skip_=false}}})},resize:function(){var d=this,c=jQuery(d.el),a=c.height(),b=c.width();if(b!=d.oldWidth){d.oldWidth=b;d.treePanelWidth=c.innerWidth();d._fillData()}if(a!=d.oldHeight){d.oldHeight=a;d.treePanelHeight=c.innerHeight();d.nodeCount=Math.floor(a/d.nodeHeight)-1;d._initFrame()}},hasChildren:function(){return this.listvm.hasChildren()},_initVm:function(){var a=this;a.listvm=new jslet.ui.ListViewModel(a._dataset,true);a.listvm.refreshModel(a._expandLevel);a.listvm.fixedRows=0;a.listvm.onTopRownoChanged=function(b){var b=a.listvm.getCurrentRowno();a._fillData();a._doCurrentRowChanged(b);a._syncScrollBar(b)};a.listvm.onVisibleCountChanged=function(){a._fillData();var b=a.listvm.getNeedShowRowCount();jQuery(a.el).find(".jl-tree-tracker").height(a.nodeHeight*b)};a.listvm.onCurrentRownoChanged=function(c,b){a._doCurrentRowChanged(b)};a.listvm.onNeedShowRowsCountChanged=function(b){a._fillData();jQuery(a.el).find(".jl-tree-tracker").height(a.nodeHeight*b)};a.listvm.onCheckStateChanged=function(){a._fillData()}},_doKeydown:function(c){var b=this,a=false;if(c==32){b._doCheckBoxClick();a=true}else{if(c==38){b.listvm.priorRow();a=true}else{if(c==40){b.listvm.nextRow();a=true}else{if(c==37){if(jslet.locale.isRtl){b.listvm.expand()}else{b.listvm.collapse()}a=true}else{if(c==39){if(jslet.locale.isRtl){b.listvm.collapse()}else{b.listvm.expand()}a=true}else{if(c==33){b.listvm.priorPage();a=true}else{if(c==34){b.listvm.nextPage();a=true}}}}}}}return a},_getTrByRowno:function(d){var a=jQuery(this.el).find(".jl-tree-nodes"),e;for(var c=0,b=a.length;c<b;c++){e=a[c].rows[0];if(e.jsletrowno==d){return e}}return null},_doCurrentRowChanged:function(b){var c=this;if(c.prevRow){jQuery(c._getTextTd(c.prevRow)).removeClass(jslet.ui.htmlclass.TREENODECLASS.selected)}var a=c._getTrByRowno(b);if(a){jQuery(c._getTextTd(a)).addClass(jslet.ui.htmlclass.TREENODECLASS.selected)}c.prevRow=a},_getTextTd:function(a){return a.cells[a.cells.length-1]},_doExpand:function(){this.expand()},_doRowClick:function(c){var d=this,a=c.getAttribute(jslet.ui.DBTreeView.NODETYPE);if(!a){return}if(a!="0"){d._syncToDs(c)}if(a=="1"||a=="2"){var b=d.listvm.getCurrentRow();if(a=="1"&&b.children&&b.children.length>0){if(b.expanded){d.collapse()}else{d.expand()}}if(a=="2"){d._doCheckBoxClick()}}if(a=="9"&&d._onItemClick){d._onItemClick.call(d)}},_doRowDblClick:function(b){this._syncToDs(b);var a=b.getAttribute(jslet.ui.DBTreeView.NODETYPE);if(this._onItemDblClick&&a=="9"){this._onItemDblClick.call(this)}},_doCheckBoxClick:function(){var b=this;if(b._readOnly){return}if(b.beforeCheckBoxClick){if(!b.beforeCheckBoxClick()){return}}var a=b.listvm.getCurrentRow();b.listvm.checkNode(!a.state?1:0,b._correlateCheck)},_syncToDs:function(b){var c=-1,a;while(true){a=b.jsletrowno;if(a===0||a){c=a;break}b=b.parentNode;if(!b){break}}if(c<0){return}this.listvm.setCurrentRowno(c)},_fillData:function(){var e=this,o=e.listvm.getVisibleCount(),m=e.listvm.getVisibleStartRow(),n=e.listvm.getNeedShowRowCount(),h=o+m,g=0,l=jQuery(e.el),p=l.find(".jl-tree-nodes"),q;if(e._isRendering){return}e._isRendering=true;e._skip_=true;var v=e._dataset.startSilenceMove(),d=e.listvm.getCurrentRowno(),a=true,u=0,f;try{if(n<h){for(var t=h-n;t>0;t--){q=p[o-t];q.style.display="none"}a=false}else{n=h}var r=n-1;for(var s=m;s<=r;s++){q=p[g++];f=e._fillNode(q,s);if(a&&u<e.treePanelWidth){if(s==r&&f<e.treePanelWidth){a=false}else{u=Math.max(u,f)}}if(s==r&&a){q.style.display="none"}else{q.style.display="";q.jsletrowno=s}}var c=l.find(".jl-tree-scrollbar");if(a){c.height(e.treePanelHeight-e.scrBarSize-2)}else{c.height(e.treePanelHeight-2)}}finally{e.listvm.setCurrentRowno(d,false);e._dataset.endSilenceMove(v);e._isRendering=false;e._skip_=false}},_getCheckClassName:function(a){if(!a){return jslet.ui.htmlclass.TREECHECKBOXCLASS.unChecked}if(a==2){return jslet.ui.htmlclass.TREECHECKBOXCLASS.mixedChecked}return jslet.ui.htmlclass.TREECHECKBOXCLASS.checked},_fillNode:function(node,rowNo){var row=node.rows[0],Z=this,item=Z.listvm.setCurrentRowno(rowNo,true),cells=row.cells,cellCnt=cells.length,reqiredCnt=item.level+4,otd;row.jsletrowno=rowNo;if(cellCnt<reqiredCnt){for(var i=1,cnt=requiredCnt-cellCnt;i<cnt;i++){otd=row.insertCell(0);jQuery(otd).addClass("jl-tree-lines").attr("jsletline",1)}}if(cellCnt>reqiredCnt){for(var i=0,cnt=cellCnt-reqiredCnt;i<cnt;i++){cells[i].style.display="none"}for(var i=cellCnt-reqiredCnt;i<reqiredCnt;i++){cells[i].style.display=""}}cellCnt=cells.length;var pitem=item,k=1,totalWidth=Z.iconWidth*item.level;for(var i=item.level;i>0;i--){otd=row.cells[cellCnt-4-k++];pitem=pitem.parent;if(pitem.islast){otd.className=jslet.ui.htmlclass.TREELINECLASS.empty}else{otd.className=jslet.ui.htmlclass.TREELINECLASS.line}}var oexpander=row.cells[cellCnt-4];oexpander.noWrap=true;oexpander.style.display="";if(item.children&&item.children.length>0){if(!item.islast){oexpander.className=item.expanded?jslet.ui.htmlclass.TREELINECLASS.minus:jslet.ui.htmlclass.TREELINECLASS.plus}else{oexpander.className=item.expanded?jslet.ui.htmlclass.TREELINECLASS.minusBottom:jslet.ui.htmlclass.TREELINECLASS.plusBottom}}else{if(!item.islast){oexpander.className=jslet.ui.htmlclass.TREELINECLASS.join}else{oexpander.className=jslet.ui.htmlclass.TREELINECLASS.joinBottom}}totalWidth+=Z.iconWidth;var flag=Z._hasCheckBox&&Z._dataset.checkSelectable();var ocheckbox=row.cells[cellCnt-3];if(flag){ocheckbox.noWrap=true;ocheckbox.className=Z._getCheckClassName(Z._dataset.selected());ocheckbox.style.display="";totalWidth+=Z.iconWidth}else{ocheckbox.style.display="none"}var oicon=row.cells[cellCnt-2],clsName="jl-tree-icon",iconClsId=null;if(Z._iconClassField||Z._onGetIconClass){if(Z._iconClassField){iconClsId=Z._dataset.getFieldValue(Z._iconClassField)}else{if(Z._onGetIconClass){var isLeaf=!(item.children&&item.children.length>0);iconClsId=Z._onGetIconClass.call(Z,Z._dataset.keyValue(),item.level,isLeaf)}}if(iconClsId){clsName+=" "+iconClsId}if(oicon.className!=clsName){oicon.className=clsName}oicon.style.display="";totalWidth+=Z.iconWidth}else{oicon.style.display="none"}var text=Z.evaluator.eval();jslet.ui.textMeasurer.setElement(Z.el);var width=Math.round(jslet.ui.textMeasurer.getWidth(text))+text.length;totalWidth+=width+10;jslet.ui.textMeasurer.setElement();var otd=row.cells[cellCnt-1];otd.style.width=width+"px";var jqTd=jQuery(otd);jqTd.html(text);if(item.isbold){jqTd.addClass("jl-tree-child-checked")}else{jqTd.removeClass("jl-tree-child-checked")}return totalWidth},_updateCheckboxState:function(){var c=this,k=c._dataset.startSilenceMove(),f=jQuery(c.el),d=f.find(".jl-tree-nodes"),a,g,l;try{for(var h=0,e=d.length;h<e;h++){l=d[h].rows[0];g=l.cells.length;a=l.jsletrowno;if(a){c.listvm.setCurrentRowno(a,true);l.cells[g-3].className=c._getCheckClassName(c._dataset.selected())}}}finally{c._dataset.endSilenceMove(k)}},_syncScrollBar:function(){var a=this;if(a._skip_){return}jQuery(a.el).find(".jl-tree-scrollbar").scrollTop(a.nodeHeight*a.listvm.getVisibleStartRow())},expand:function(){this.listvm.expand()},collapse:function(){this.listvm.collapse()},expandAll:function(){this.listvm.expandAll()},collapseAll:function(){this.listvm.collapseAll()},_createContextMenu:function(){if(!jslet.ui.Menu){return}var a=this;var b={type:"Menu",onItemClick:a._menuItemClick,items:[{id:"expandAll",name:jslet.locale.DBTreeView.expandAll},{id:"collapseAll",name:jslet.locale.DBTreeView.collapseAll}]};if(a._hasCheckBox&&!a._correlateCheck){b.items.push({name:"-"});b.items.push({id:"checkAll",name:jslet.locale.DBTreeView.checkAll});b.items.push({id:"uncheckAll",name:jslet.locale.DBTreeView.uncheckAll})}if(a._onCreateContextMenu){a._onCreateContextMenu.call(a,b.items)}if(b.items.length===0){return}a.contextMenu=jslet.ui.createControl(b);jQuery(a.el).on("contextmenu",function(e){var d=e.target,c=d.getAttribute(jslet.ui.DBTreeView.NODETYPE);if(!c||c=="0"){return}a._syncToDs(d);a.contextMenu.showContextMenu(e,a)})},_menuItemClick:function(b,a){if(b=="expandAll"){this.expandAll()}else{if(b=="collapseAll"){this.collapseAll()}else{if(b=="checkAll"){this.listvm.checkNode(true,true)}else{if(b=="uncheckAll"){this.listvm.checkNode(false,true)}}}}},refreshControl:function(a){var b=this,c=a.eventType;if(c==jslet.data.RefreshEvent.CHANGEMETA){}else{if(c==jslet.data.RefreshEvent.UPDATEALL||c==jslet.data.RefreshEvent.INSERT||c==jslet.data.RefreshEvent.DELETE){b.listvm.refreshModel();if(c==jslet.data.RefreshEvent.INSERT){b.listvm.syncDataset()}}else{if(c==jslet.data.RefreshEvent.UPDATERECORD||c==jslet.data.RefreshEvent.UPDATECOLUMN){b._fillData()}else{if(c==jslet.data.RefreshEvent.SELECTALL||c==jslet.data.RefreshEvent.SELECTRECORD){if(b._hasCheckBox){b._updateCheckboxState()}}else{if(c==jslet.data.RefreshEvent.SCROLL){b.listvm.syncDataset()}}}}}},checkSizeChanged:function(){this.resize()},destroy:function($super){var b=this,a=jQuery(b.el);jslet.resizeEventBus.unsubscribe(b);a.find(".jl-tree-nodes").off();b.listvm.destroy();b.listvm=null;b.prevRow=null;$super()}});jslet.ui.htmlclass.TREELINECLASS={line:"jl-tree-lines jl-tree-line",join:"jl-tree-lines jl-tree-join",joinBottom:"jl-tree-lines jl-tree-join-bottom",minus:"jl-tree-lines jl-tree-minus",minusBottom:"jl-tree-lines jl-tree-minus-bottom",noLineMinus:"jl-tree-lines jl-tree-noline-minus",plus:"jl-tree-lines jl-tree-plus",plusBottom:"jl-tree-lines jl-tree-plus-bottom",noLinePlus:"jl-tree-lines jl-tree-noline-plus",empty:"jl-tree-empty"};jslet.ui.htmlclass.TREECHECKBOXCLASS={checked:"jl-tree-checkbox jl-tree-checked",unChecked:"jl-tree-checkbox jl-tree-unchecked",mixedChecked:"jl-tree-checkbox jl-tree-mixedchecked"};jslet.ui.htmlclass.TREENODECLASS={selected:"jl-tree-selected",childChecked:"jl-tree-child-checked",treeNodeLevel:"jl-tree-child-level"};jslet.ui.DBTreeView.NODETYPE="data-nodetype";jslet.ui.register("DBTreeView",jslet.ui.DBTreeView);jslet.ui.DBTreeView.htmlTemplate="<div></div>";jslet.ui.DBText=jslet.Class.create(jslet.ui.DBFieldControl,{initialize:function($super,a,c){var b=this;b.allProperties="dataset,field,beforeUpdateToDataset,enableInvalidTip,onKeyDown";b._beforeUpdateToDataset=null;b._enableInvalidTip=true;b.oldValue=null;b.editMask=null;$super(a,c)},beforeUpdateToDataset:function(a){if(a===undefined){return this._beforeUpdateToDataset}jslet.Checker.test("DBText.beforeUpdateToDataset",a).isFunction();this._beforeUpdateToDataset=a},enableInvalidTip:function(a){if(a===undefined){return this._enableInvalidTip}this._enableInvalidTip=a?true:false},isValidTemplateTag:function(a){return a.tagName.toLowerCase()=="input"&&a.type.toLowerCase()=="text"},bind:function(){var b=this;b.renderAll();var a=jQuery(b.el);a.addClass("form-control");if(b.doFocus){a.on("focus",b.doFocus)}if(b.doBlur){a.on("blur",b.doBlur)}if(b.doKeydown){a.on("keydown",b.doKeydown)}if(b.doKeypress){a.on("keypress",b.doKeypress)}if(b._enableInvalidTip&&jslet.ui.globalTip){a.on("mouseover",b.doMouseOver);a.on("mouseout",b.doMouseOut)}},doFocus:function(a){var b=this.jslet;if(b._skipFocusEvent){return}var c=b._dataset.getField(b._field);if(!c.message()){b.refreshControl(jslet.data.RefreshEvent.updateRecordEvent(b._field))}jslet.ui.textutil.selectText(this)},doBlur:function(a){var c=this.jslet,d=c._dataset.getField(c._field);if(d.readOnly()||d.disabled()){return}var b=jQuery(this.el);if(b.attr("readOnly")||b.attr("disabled")){return}c.updateToDataset();c.refreshControl(jslet.data.RefreshEvent.updateRecordEvent(c._field))},doKeydown:null,doKeypress:function(a){var c=this.jslet,d=c._dataset.getField(c._field);if(d.readOnly()||d.disabled()){return}a=jQuery.event.fix(a||window.event);var b=a.which;if(!c._dataset.fieldValidator.checkInputChar(d,String.fromCharCode(b))){a.preventDefault()}if(b==13){c.updateToDataset();c.refreshControl(jslet.data.RefreshEvent.updateRecordEvent(c._field))}},doChange:function(a){this.jslet.updateToDataset()},doMouseOver:function(a){var c=this.jslet,d=c._dataset.getField(c._field),b=d.message();if(b){jslet.ui.globalTip.show(b,a)}},doMouseOut:function(a){jslet.ui.globalTip.hide()},focus:function(){var a=jQuery(this.el);if(!a.attr("disabled")){this.el.focus()}},refreshControl:function($super,a,b){if($super(a,b)&&this.afterRefreshControl){this.afterRefreshControl(a)}},doMetaChanged:function($super,b){$super(b);var a=this,d=a._dataset.getField(a._field);if(!b||b=="disabled"||b=="readOnly"){jslet.ui.setEditableStyle(a.el,d.disabled(),d.readOnly())}if(!b||b=="editMask"){var c=d.editMask();if(c){if(!a.editMask){a.editMask=new jslet.ui.EditMask();a.editMask.attach(a.el)}mask=c.mask;keepChar=c.keepChar;transform=c.transform;a.editMask.setMask(mask,keepChar,transform)}else{if(a.editMask){a.editMask.detach();a.editMask=null}}}if(b=="message"){if(a._enableInvalidTip){a.renderInvalid()}}a.el.maxLength=d.getEditLength()},doValueChanged:function(){var b=this;if(b._keep_silence_){return}var d=b._dataset.getField(b._field);if(d.message(b._valueIndex)){return}var c=d.alignment();if(jslet.locale.isRtl){if(c=="left"){c="right"}else{c="left"}}b.el.style.textAlign=c;var a;if(document.activeElement!=b.el||b.el.readOnly){a=b._dataset.getFieldText(b._field,false,b._valueIndex)}else{a=b._dataset.getFieldText(b._field,true,b._valueIndex)}if(b.editMask){b.editMask.setValue(a)}else{b.el.value=a}b.oldValue=b.el.value},renderAll:function(){this.refreshControl(jslet.data.RefreshEvent.updateAllEvent(),true)},updateToDataset:function(){var b=this;if(b._keep_silence_){return true}var a=b.el.value;b._dataset.editRecord();if(this.editMask&&!this.editMask.validateValue()){return false}if(b._beforeUpdateToDataset){if(!b._beforeUpdateToDataset.call(b)){return false}}b._keep_silence_=true;try{if(b.editMask){a=b.editMask.getValue()}b._dataset.setFieldText(b._field,a,b._valueIndex)}finally{b._keep_silence_=false}return true},destroy:function($super){var a=this;jQuery(a.el).off();if(a.editMask){a.editMask.detach();a.editMask=null}a._beforeUpdateToDataset=null;a.onKeyDown=null;$super()}});jslet.ui.register("DBText",jslet.ui.DBText);jslet.ui.DBText.htmlTemplate='<input type="text"></input>';jslet.ui.DBPassword=jslet.Class.create(jslet.ui.DBText,{initialize:function($super,a,b){$super(a,b)},isValidTemplateTag:function(a){return a.tagName.toLowerCase()=="input"&&a.type.toLowerCase()=="password"}});jslet.ui.register("DBPassword",jslet.ui.DBPassword);jslet.ui.DBPassword.htmlTemplate='<input type="password"></input>';jslet.ui.DBTextArea=jslet.Class.create(jslet.ui.DBText,{initialize:function($super,a,b){$super(a,b)},isValidTemplateTag:function(a){return a.tagName.toLowerCase()=="textarea"}});jslet.ui.register("DBTextArea",jslet.ui.DBTextArea);jslet.ui.DBTextArea.htmlTemplate="<textarea></textarea>";jslet.ui.DBCustomComboBox=jslet.Class.create(jslet.ui.DBFieldControl,{initialize:function($super,a,c){var b=this;b.allProperties="dataset,field,textReadOnly";b._textReadOnly=false;b.enableInvalidTip=false;$super(a,c)},textReadOnly:function(a){if(a===undefined){return this._textReadOnly}this._textReadOnly=a?true:false},afterBind:function($super){$super();if(this._textReadOnly){this.el.childNodes[0].readOnly=true}},currRecno:function($super,b){var a=$super(b);if(b!==undefined){this.textCtrl.currRecno(b)}return a},bind:function(){var f=this;var e=jQuery(f.el);if(!e.hasClass("input-group")){e.addClass("input-group")}var b=f.comboButtonCls?f.comboButtonCls:"fa-caret-down";var d='<input type="text" class="form-control"><div class="jl-comb-btn-group"><button class="btn btn-default"><i class="fa '+b+'"></i></button></div>';e.html(d);var c=e.find('[type="text"]')[0];f.textCtrl=new jslet.ui.DBText(c,{type:"dbtext",dataset:f._dataset,field:f._textField||f._field,enableInvalidTip:true,valueIndex:f._valueIndex});jQuery(f.textCtrl.el).on("keydown",this.popupUp);var a=e.find("button")[0];if(this.buttonClick){jQuery(a).on("click",function(g){f.buttonClick()})}},renderAll:function(){this.bind()},popupUp:function(b){if(b.keyCode==jslet.ui.KeyCode.DOWN){var a=jslet.ui.findJsletParent(this.parentNode);a.jslet.buttonClick()}},focus:function(){this.textCtrl.focus()},forceRefreshControl:function(){this.textCtrl.forceRefreshControl()},doMetaChanged:function($super,d){$super(d);var c=this;if(!d||d=="disabled"||d=="readOnly"){var e=c._dataset.getField(c._field),a=e.disabled()||e.readOnly();var b=jQuery(c.el);b.find("button").attr("disabled",a)}},destroy:function($super){var b=this;var a=b.el.childNodes[1];a.onclick=null;jQuery(b.textCtrl.el).off("keydown",this.popupUp);b.textCtrl.destroy();b.textCtrl=null;$super()}});jslet.ui.DBAutoComplete=jslet.Class.create(jslet.ui.DBText,{MatchModes:["start","end","any"],initialize:function($super,a,c){var b=this;if(!b.allProperties){b.allProperties="dataset,field,lookupField,minChars,minDelay,displayTemplate,matchMode,beforePopup,onGetFilterField"}b._lookupField=null;b._minChars=0;b._minDelay=0;b._beforePopup=null;b._onGetFilterField=null;b._matchMode="start";b._timeoutHandler=null;$super(a,c)},lookupField:function(a){if(a===undefined){return this._lookupField}jslet.Checker.test("DBAutoComplete.lookupField",a).isString();this._lookupField=a},minChars:function(a){if(a===undefined){return this._minChars}jslet.Checker.test("DBAutoComplete.minChars",a).isGTEZero();this._minChars=parseInt(a)},minDelay:function(a){if(a===undefined){return this._minDelay}jslet.Checker.test("DBAutoComplete.minDelay",a).isGTEZero();this._minDelay=parseInt(a)},matchMode:function(a){if(a===undefined){return this._matchMode}a=jQuery.trim(a);var b=jslet.Checker.test("DBAutoComplete.matchMode",a).isString();a=a.toLowerCase();b.testValue(a).inArray(this.MatchModes);this._matchMode=a},beforePopup:function(a){if(a===undefined){return this._beforePopup}jslet.Checker.test("DBAutoComplete.beforePopup",a).isFunction();this._beforePopup=a},onGetFilterField:function(a){if(a===undefined){return this._onGetFilterField}jslet.Checker.test("DBAutoComplete.onGetFilterField",a).isFunction();this._onGetFilterField=a},isValidTemplateTag:function(a){return a.tagName.toLowerCase()=="input"&&a.type.toLowerCase()=="text"},doBlur:function(a){if(this.disabled||this.readOnly){return}var b=this.jslet,c=b._dataset.getField(b._field);if(c.readOnly()||c.disabled()){return}if(b.contentPanel&&b.contentPanel.isShowing()){window.setTimeout(function(){if(b._isSelecting){return}if(b.contentPanel&&b.contentPanel.isShowing()){b.contentPanel.closePopup()}b.updateToDataset();b.refreshControl(jslet.data.RefreshEvent.updateRecordEvent(b._field))},200)}else{b.updateToDataset();b.refreshControl(jslet.data.RefreshEvent.updateRecordEvent(b._field))}},doChange:null,doKeydown:function(b){if(this.disabled||this.readOnly){return}b=jQuery.event.fix(b||window.event);var d=b.which,c=this.jslet;if((d==38||d==40)&&c.contentPanel&&c.contentPanel.isPop){var f=c._dataset.getField(c._lookupField||c._field),e=f.lookup(),a=e.dataset();if(d==38){a.prior()}if(d==40){a.next()}}if(d==8||d==46||d==229){this.jslet._invokePopup()}},doKeypress:function(a){if(this.disabled||this.readOnly){return}var b=a.keyCode?a.keyCode:a.which?a.which:a.charCode;if(b!=13&&b!=9){this.jslet._invokePopup()}else{if(this.jslet.contentPanel){this.jslet.contentPanel.confirmSelect()}}},_invokePopup:function(){var a=this;if(a._timeoutHandler){clearTimeout(a._timeoutHandler)}var b=100;if(a._minDelay){b=parseInt(a._minDelay)}a._timeoutHandler=setTimeout(function(){a._populate(a.el.value)},b)},_populate:function(e){var b=this;if(b._minChars>0&&e&&e.length<b._minChars){return}var f=b._dataset.getField(b._lookupField||b._field),m=f.lookup();if(!m){jslet.showError(b._field+" is NOT a lookup field!");return}var g=m.dataset();if(b._beforePopup){b._beforePopup.call(b,g,e)}else{if(e){var c;if(b._onGetFilterField){c=b._onGetFilterField.call(b,g,e)}if(!c){c=m.codeField()}var n=e;if(b._matchMode=="start"){n=n+"%"}else{if(b._matchMode=="end"){n="%"+n}else{n="%"+n+"%"}}g.filter("like(["+c+'],"'+n+'")');g.filtered(true)}else{g.filtered(false)}}if(!b.contentPanel){b.contentPanel=new jslet.ui.DBAutoCompletePanel(b)}else{if(b.contentPanel.isShowing()){return}}jslet.ui.PopupPanel.excludedElement=b.el;var d=jQuery(b.el),a=d.offset(),i=d.outerHeight(),l=a.left,k=a.top+i;if(jslet.locale.isRtl){l=l+d.outerWidth()-b.contentPanel.dlgWidth}b.contentPanel.showPopup(l,k,0,i)},destroy:function($super){var a=this;jQuery(a.el).off();if(a.contentPanel){a.contentPanel.destroy();a.contentPanel=null}$super()}});jslet.ui.DBAutoCompletePanel=function(b){var c=this;c.dlgWidth=500;c.dlgHeight=200;var d,a;c.comboCfg=b;c.dataset=b.dataset();c.field=b.lookupField()||b.field();c.panel=null;c.lkDataset=null;c.popup=new jslet.ui.PopupPanel();c.isPop=false;c.create=function(){if(!c.panel){c.panel=document.createElement("div");jQuery(c.panel).on("mousedown",function(l){c.comboCfg._isSelecting=true;l.stopPropagation()})}var k=c.dataset.getField(c.field),e=k.lookup(),g=e.dataset();c.lkDataset=g;c.panel.innerHTML="";var f=c.dlgWidth-4,h=c.dlgHeight-4,i={type:"DBTable",dataset:g,readOnly:true,noborder:true,hasSelectCol:false,hasSeqCol:false,hideHead:true};i.onRowClick=c.confirmSelect;c.otable=jslet.ui.createControl(i,c.panel,f,h);c.otable.el.focus();c.otable.el.style.border="0";return c.panel};c.confirmSelect=function(){c.comboCfg._isSelecting=true;var g=c.lkDataset.keyValue();if(g){c.dataset.setFieldValue(c.field,g,c.valueIndex);var l=c.dataset.getField(c.field),k=l.lookup(),f=k.returnFieldMap();if(f){var i=k.dataset();mainDs=c.dataset;var e,h;for(var e in f){h=f[e];mainDs.setFieldValue(e,i.getFieldValue(h))}}c.comboCfg.el.focus()}if(c.comboCfg.afterSelect){c.comboCfg.afterSelect(c.dataset,c.lkDataset)}c.closePopup()};c.showPopup=function(i,h,f,e){if(!c.panel){c.panel=c.create()}c.comboCfg._isSelecting=false;c.isPop=true;var g=c.popup.getPopupPanel();g.style.padding="0";c.popup.setContent(c.panel);c.popup.onHidePopup=c.doClosePopup;c.popup.show(i,h,c.dlgWidth,c.dlgHeight,f,e)};c.doClosePopup=function(){c.isPop=false;c.lkDataset.filtered(false)};c.closePopup=function(){c.popup.hide()};c.isShowing=function(){if(c.popup){return c.popup.isShowing}else{return false}};c.destroy=function(){jQuery(c.panel).off();c.otable.onRowClick=null;c.otable.destroy();c.otable=null;c.panel=null;c.popup.destroy();c.popup=null;c.comboCfg=null;c.dataset=null;c.field=null;c.lkDataset=null}};jslet.ui.register("DBAutoComplete",jslet.ui.DBAutoComplete);jslet.ui.DBAutoComplete.htmlTemplate='<input type="text"></input>';jslet.ui.DBBetweenEdit=jslet.Class.create(jslet.ui.DBFieldControl,{initialize:function($super,a,b){this.allProperties="dataset,field";$super(a,b)},isValidTemplateTag:function(b){var a=b.tagName.toLowerCase();return a=="div"},bind:function(){var a=this;a.renderAll()},refreshControl:function(a){return},renderAll:function(){var b=this;jslet.ui.textMeasurer.setElement(b.el);var f=jslet.locale.Dataset.betweenLabel;if(!f){f="-"}f="&nbsp;"+f+"&nbsp;";var h=jslet.ui.textMeasurer.getWidth(f);var i=['<table style="width:100%;margin:0px" cellspacing="0" cellpadding="0"><col /><col width="',h,'px" /><col /><tbody><tr><td></td><td>',f,"</td><td></td></tr></tbody></table>"];b.el.innerHTML=i.join("");var a=jQuery(b.el).find("td"),e=a[0],g=a[2],d=b._dataset.getField(b._field),c=d.editControl();c.dataset=b._dataset;c.field=b._field;c.valueIndex=0;var k=jslet.ui.createControl(c,e);k.el.style.width="98%";b.minElement=k;c.valueIndex=1;k=jslet.ui.createControl(c,g);k.el.style.width="98%"},focus:function(){this.minElement.focus()},destroy:function($super){this.minElement=null;$super()}});jslet.ui.register("DBBetweenEdit",jslet.ui.DBBetweenEdit);jslet.ui.DBBetweenEdit.htmlTemplate="<div></div>";jslet.ui.DBCheckBox=jslet.Class.create(jslet.ui.DBFieldControl,{initialize:function($super,a,c){var b=this;b.isCheckBox=true;b.allProperties="dataset,field,beforeClick";b._beforeClick=null;$super(a,c)},beforeClick:function(a){if(a===undefined){return this._beforeClick}jslet.Checker.test("DBCheckBox.beforeClick",a).isFunction();this._beforeClick=a},isValidTemplateTag:function(a){return a.tagName.toLowerCase()=="input"&&a.type.toLowerCase()=="checkbox"},bind:function(){var b=this;b.renderAll();var a=jQuery(b.el);a.on("click",b._doClick);a.addClass("checkbox-inline")},_doClick:function(b){var c=this.jslet;if(c._beforeClick){var a=c._beforeClick.call(c,c.el);if(!a){return}}c.updateToDataset()},doMetaChanged:function($super,c){$super(c);var b=this,d=b._dataset.getField(b._field);if(!c||c=="disabled"||c=="readOnly"){var a=d.disabled()||d.readOnly();jslet.ui.setEditableStyle(b.el,a,a)}if(c=="message"){if(b._enableInvalidTip){b.renderInvalid()}}},doValueChanged:function(){var c=this,d=c._dataset.getField(c._field);try{var a=c._dataset.getFieldValue(c._field,c._valueIndex);if(a!==null&&a==d.trueValue()){c.el.checked=true}else{c.el.checked=false}}catch(b){jslet.showError(b)}},focus:function(){this.el.focus()},renderAll:function(){this.refreshControl(jslet.data.RefreshEvent.updateAllEvent(),true)},updateToDataset:function(){var c=this;if(c._keep_silence_){return}var d=c._dataset.getField(c._field),a;if(c.el.checked){a=d.trueValue()}else{a=d.falseValue()}c._keep_silence_=true;try{c._dataset.setFieldValue(c._field,a,c._valueIndex)}catch(b){jslet.showError(b)}finally{c._keep_silence_=false}},destroy:function($super){jQuery(this.el).off()}});jslet.ui.register("DBCheckBox",jslet.ui.DBCheckBox);jslet.ui.DBCheckBox.htmlTemplate='<input type="checkbox"></input>';jslet.ui.DBCheckBoxGroup=jslet.Class.create(jslet.ui.DBFieldControl,{initialize:function($super,a,c){var b=this;b.allProperties="dataset,field,columnCount";b._columnCount=99999;b._itemIds=null;$super(a,c)},columnCount:function(a){if(a===undefined){return this._columnCount}jslet.Checker.test("DBCheckBoxGroup.columnCount",a).isGTEZero();this._columnCount=parseInt(a)},isValidTemplateTag:function(b){var a=b.tagName.toLowerCase();return a=="div"},bind:function(){this.renderAll();var a=jQuery(this.el);a.on("click",'input[type="checkbox"]',function(b){b.delegateTarget.jslet.updateToDataset(this)});a.addClass("form-control");a.css("height","auto")},doMetaChanged:function($super,g){$super(g);var a=this,c=a._dataset.getField(a._field);if(!g||g=="disabled"||g=="readOnly"){var d=c.disabled(),h=c.readOnly();d=d||h;var f=jQuery(a.el).find('input[type="checkbox"]');for(var e=0,b=f.length;e<b;e++){jslet.ui.setEditableStyle(f[e],d,h)}}if(g=="message"){a.renderInvalid()}},doValueChanged:function(){var a=this;if(a._keep_silence_){return}var b=a._dataset.getField(a._field);if(b.message(a._valueIndex)){return}try{var n=jQuery(a.el).find('input[type="checkbox"]'),k=n.length,g,f;for(f=0;f<k;f++){g=n[f];g.checked=false}var m=a._dataset.getFieldValue(a._field);if(m&&m.length>0){var c=m.length,l;for(f=0;f<k;f++){g=n[f];for(var d=0;d<c;d++){l=m[d];if(l==g.value){g.checked=true}}}}}catch(h){jslet.showError(h)}},doLookupChanged:function(){var a=this,d=a._dataset.getField(a._field),i=d.lookup();if(!i){jslet.showError(jslet.formatString(jslet.locale.Dataset.lookupNotFound,[d.name()]));return}if(d.valueStyle()!=jslet.data.FieldValueStyle.MULTIPLE){d.valueStyle(jslet.data.FieldValueStyle.MULTIPLE)}var e=i.dataset(),c=e.recordCount(),b=e.startSilenceMove(),h;a._itemIds=[];try{var l=['<table cellpadding="0" cellspacing="0">'],g=false;for(var f=0;f<c;f++){e.recnoSilence(f);g=(f%a._columnCount===0);if(g){if(f>0){l.push("</tr>")}l.push("<tr>")}h=jslet.nextId();l.push('<td style="white-space: nowrap; "><input type="checkbox" value="');l.push(e.getFieldValue(i.keyField()));l.push('" id="');l.push(h);l.push('" /><label for="');l.push(h);l.push('">');l.push(i.getCurrentDisplayValue());l.push("</label></td>");g=(f%a._columnCount===0)}if(c>0){l.push("</tr>")}l.push("</table>");a.el.innerHTML=l.join("")}finally{e.endSilenceMove(b)}},updateToDataset:function(h){var a=this;if(a._is_silence_){return}var c=a._dataset.getField(a._field),b=c.valueCountLimit();var i=[],g=0;var f=jQuery(a.el).find('input[type="checkbox"]'),k;for(var d=0,e=f.length;d<e;d++){k=f[d];if(k.checked){i.push(k.value);g++}}if(b&&g>b){h.checked=!h.checked;jslet.showInfo(jslet.formatString(jslet.locale.DBCheckBoxGroup.invalidCheckedCount,[""+b]));return}a._is_silence_=true;try{a._dataset.setFieldValue(a._field,i)}finally{a._is_silence_=false}},focus:function(){if(_itemIds&&_itemIds.length>0){document.getElementById(_itemIds[0]).focus()}},renderAll:function(){var b=this,a=jQuery(b.el);if(!a.hasClass("jl-checkboxgroup")){a.addClass("jl-checkboxgroup")}b.refreshControl(jslet.data.RefreshEvent.updateAllEvent(),true)},destroy:function($super){var a=jQuery(this.el);a.off();$super()}});jslet.ui.register("DBCheckBoxGroup",jslet.ui.DBCheckBoxGroup);jslet.ui.DBCheckBoxGroup.htmlTemplate="<div></div>";jslet.ui.DBComboSelect=jslet.Class.create(jslet.ui.DBCustomComboBox,{showStyles:["auto","table","tree"],initialize:function($super,a,c){var b=this;b.allProperties="dataset,field,textField,searchField,popupHeight,popupWidth,showStyle,textReadOnly,onGetSearchField";b._textField=null;b._showStyle="auto";b._popupWidth=500;b._popupHeight=300;b._contentPanel=null;b._pickupField=null;$super(a,c)},textField:function(a){if(a===undefined){return this._textField}jslet.Checker.test("DBComboSelect.textField",a).required().isString();this._textField=a.trim()},popupHeight:function(a){if(a===undefined){return this._popupHeight}jslet.Checker.test("DBComboSelect.popupHeight",a).isGTEZero();this._popupHeight=parseInt(a)},popupWidth:function(a){if(a===undefined){return this._popupWidth}jslet.Checker.test("DBComboSelect.popupWidth",a).isGTEZero();this._popupWidth=parseInt(a)},showStyle:function(b){if(b===undefined){return this._showStyle}b=jQuery.trim(b);var a=jslet.Checker.test("DBComboSelect.showStyle",b).isString();b=b.toLowerCase();a.testValue(b).inArray(this.showStyles);this._showStyle=b},onGetSearchField:function(a){if(a===undefined){return this._onGetSearchField}jslet.Checker.test("DBComboSelect.onGetSearchField",a).isFunction();this._onGetSearchField=a},isValidTemplateTag:function(a){return true},afterBind:function($super){$super();if(this._contentPanel){this._contentPanel=null}},buttonClick:function(){var b=this,d=b.el,f=b._dataset.getField(b._field),l=f.lookup(),e=jQuery(d);if(f.readOnly()||f.disabled()){return}if(l===null&&l===undefined){throw new Error(b._field+" is NOT a lookup field!")}var c=b._showStyle;if(b._showStyle=="auto"){c=l.parentField()?"tree":"table"}if(!b._contentPanel){b._contentPanel=new jslet.ui.DBComboSelectPanel(b);b._contentPanel.showStyle=c;b._contentPanel.customButtonLabel=b.customButtonLabel;b._contentPanel.onCustomButtonClick=b.onCustomButtonClick;if(b._popupWidth){b._contentPanel.popupWidth=b._popupWidth}if(b._popupHeight){b._contentPanel.popupHeight=b._popupHeight}}jslet.ui.PopupPanel.excludedElement=d;var a=e.offset(),g=e.outerHeight(),k=a.left,i=a.top+g;if(jslet.locale.isRtl){k=k+e.outerWidth()}b._contentPanel.showPopup(k,i,0,g)},closePopup:function(){this._contentPanel=null},destroy:function($super){var a=this;if(a._contentPanel){a._contentPanel.destroy();a._contentPanel=null}jslet.ui.PopupPanel.excludedElement=null;$super()}});jslet.ui.DBComboSelectPanel=function(a){var b=this;b.showStyle="auto";b.customButtonLabel=null;b.onCustomButtonClick=null;b.popupWidth=350;b.popupHeight=350;var d,i,e,f=",",g,c,h=this;b.comboSelectObj=a;b.dataset=a._dataset;b.field=a._field;b.fieldObject=b.dataset.getField(b.field);b.panel=null;b.searchBoxEle=null;b.popup=new jslet.ui.PopupPanel();b.popup.onHidePopup=function(){b.comboSelectObj.focus()}};jslet.ui.DBComboSelectPanel.prototype={lookupDs:function(){return this.fieldObject.lookup().dataset()},isMultiple:function(){return this.fieldObject.valueStyle()==jslet.data.FieldValueStyle.MULTIPLE},showPopup:function(f,e,c,b){var d=this;d._initSelected();if(!d.panel){d.panel=d._create()}else{var a=d.otree?d.otree:d.otable;a.dataset().addLinkedControl(a);window.setTimeout(function(){a.renderAll()},1)}d.popup.setContent(d.panel,"100%","100%");d.popup.show(f,e,d.popupWidth,d.popupHeight,c,b);jQuery(d.panel).find(".jl-combopnl-head select").focus()},closePopup:function(){var b=this;var d=b.dataset.getField(b.field),a=d.lookup();if(b.isMultiple()&&a.onlyLeafLevel()){b.lookupDs().onCheckSelectable(null)}b.popup.hide();var c=b.otree?b.otree:b.otable;if(c){c.dataset().removeLinkedControl(c)}},_create:function(){var c=this;if(!c.panel){c.panel=document.createElement("div")}var e=c.dataset.getField(c.field),p=e.lookup(),a=p.parentField(),g=c.showStyle.toLowerCase(),f=c.lookupDs();var l=['<div class="jl-combopnl-head row"><div class="col-xs-12">','<input class="form-control" type="text" size="20"></input></div></div>','<div class="jl-combopnl-content',c.isMultiple()?" jl-combopnl-multiselect":"",'"></div>','<div class="jl-combopnl-footer" style="display:none"><button class="jl-combopnl-footer-cancel btn btn-default" >',jslet.locale.MessageBox.cancel,'</button><button type="button" class="jl-combopnl-footer-ok btn btn-default" >',jslet.locale.MessageBox.ok,"</button></div>"];c.panel.innerHTML=l.join("");var b=jQuery(c.panel),h=b.find(".jl-combopnl-head");c.searchBoxEle=h.find("input")[0];jQuery(c.searchBoxEle).on("keydown",jQuery.proxy(c._findData,c));var i=b.find(".jl-combopnl-content");if(c.isMultiple()){i.addClass("jl-combopnl-content-nofooter").removeClass("jl-combopnl-content-nofooter");var d=b.find(".jl-combopnl-footer")[0];d.style.display="block";var n=jQuery(d);n.find(".jl-combopnl-footer-cancel").click(jQuery.proxy(c.closePopup,c));n.find(".jl-combopnl-footer-ok").click(jQuery.proxy(c._confirmSelect,c))}else{i.addClass("jl-combopnl-content-nofooter")}var o=i[0];if(g=="tree"){var k={type:"DBTreeView",dataset:f,readOnly:false,displayFields:p.displayFields(),hasCheckBox:c.isMultiple()};if(!c.isMultiple()){k.onItemDblClick=jQuery.proxy(c._confirmSelect,c)}window.setTimeout(function(){c.otree=jslet.ui.createControl(k,o,"100%","100%")},1)}else{var m={type:"DBTable",dataset:f,readOnly:true,hasSelectCol:c.isMultiple(),hasSeqCol:false};if(!c.isMultiple()){m.onRowDblClick=jQuery.proxy(c._confirmSelect,c)}window.setTimeout(function(){c.otable=jslet.ui.createControl(m,o,"100%","100%")},1)}return c.panel},_initSelected:function(){var g=this;var f=g.dataset.getFieldValue(g.field,g._valueIndex),c=g.lookupDs();if(!g.isMultiple()){if(f){c.findByKey(f)}return}var h=g.dataset.getField(g.field),b=h.lookup();c.selectAll(false);if(b.onlyLeafLevel()){c.onCheckSelectable(function(){return !this.hasChildren()})}if(f){var e=f;if(!jslet.isArray(f)){e=f.split(jslet.global.valueSeparator)}for(var d=0,a=e.length;d<a;d++){c.selectByKeyValue(true,e[d])}}},_findData:function(d){d=jQuery.event.fix(d||window.event);if(d.which!=13){return}var f=this;var b=f.comboSelectObj.searchField,e=this.searchBoxEle.value;if(!e){return}if(f.comboSelectObj.onGetSearchField){b=f.comboSelectObj.onGetSearchField(e)}if(!b){var c=f.fieldObject.lookup();b=c.nameField()}if(!b){console.warn("Search field NOT specified! Can't search data!");return}var a=f.lookupDs(),g=a.getField(b);if(!g){console.warn("Field Name: "+b+" NOT exist!");return}a.find("like(["+b+'],"%'+e+'%")')},_confirmSelect:function(){var a=this;var g=a.dataset.getFieldValue(a.field,a._valueIndex),d=a.dataset.getField(a.field),k=d.lookup(),f=a.isMultiple(),h=a.lookupDs();if(f){g=h.selectedKeyValues()}else{g=h.keyValue()}if(g){a.dataset.setFieldValue(a.field,g,a._valueIndex)}if(!f&&a.comboSelectObj._afterSelect){a.comboSelectObj._afterSelect(a.dataset,h)}if(!f){var c=k.returnFieldMap();if(c){var i=a.dataset,b,e;for(var b in c){e=c[b];a.dataset.setFieldValue(b,h.getFieldValue(e))}}}a.closePopup()},destroy:function(){var b=this;if(b.otree){b.otree.destroy();b.otree=null}if(b.otable){b.otable.destroy();b.otable=null}b.comboSelectObj=null;var c=jQuery(b.panel),a=c.find(".jl-combopnl-footer");a.find(".jl-combopnl-footer-cancel").off();a.find(".jl-combopnl-footer-ok").off();jQuery(b.searchBoxEle).off();b.fieldObject=null;b.searchBoxEle=null;b.popup=null;b.panel=null}};jslet.ui.register("DBComboSelect",jslet.ui.DBComboSelect);jslet.ui.DBComboSelect.htmlTemplate="<div></div>";jslet.ui.DBLabel=jslet.Class.create(jslet.ui.DBFieldControl,{initialize:function($super,a,b){this.allProperties="dataset,field";this.isLabel=true;$super(a,b)},bind:function(){jQuery(this.el).addClass("control-label");this.renderAll()},isValidTemplateTag:function(a){return a.tagName.toLowerCase()=="label"},doMetaChanged:function(c){if(c&&jslet.ui.DBLabel.METANAMES.indexOf(c)<0){return}var b=this,d=b._fieldMeta,e=b._dataset.getField(b._field),a="";if(!e){throw new Error("Field: "+this._field+" NOT exist!")}if((!d||d=="label")&&(!c||c=="label"||c=="required")){a=e.label();if(e.required()){a+='<span class="jl-lbl-required">'+jslet.ui.DBLabel.REQUIREDCHAR+"<span>"}b.el.innerHTML=a||"";return}if(d&&d=="tip"&&(!c||c==d)){a=e.tip();b.el.innerHTML=a||"";return}if(d&&d=="message"&&(c&&c==d)){a=e.message();b.el.innerHTML=a||"";return}},renderAll:function(){var a=jQuery(this.el),b=this.fieldMeta();this.refreshControl(jslet.data.RefreshEvent.updateAllEvent());if(b=="message"){if(!a.hasClass("jl-lbl-message")){a.addClass("jl-lbl-message")}}else{if(b=="tip"){if(!a.hasClass("jl-lbl-tip")){a.addClass("jl-lbl-tip")}}else{if(!a.hasClass("jl-lbl")){a.addClass("jl-lbl")}}}}});jslet.ui.DBLabel.REQUIREDCHAR="*";jslet.ui.DBLabel.METANAMES=["label","required","tip","message"];jslet.ui.register("DBLabel",jslet.ui.DBLabel);jslet.ui.DBLabel.htmlTemplate="<label></label>";jslet.ui.DBDataLabel=jslet.Class.create(jslet.ui.DBFieldControl,{initialize:function($super,a,b){this.allProperties="dataset,field";$super(a,b)},bind:function(){this.renderAll();jQuery(this.el).addClass("form-control-static jl-datalabel")},isValidTemplateTag:function(a){return a.tagName.toLowerCase()=="label"},doValueChanged:function(){var a=this,c=a._dataset.getField(a._field);var b=a._dataset.getFieldText(a._field,a._valueIndex);a.el.innerHTML=b;a.el.title=b},renderAll:function(){this.refreshControl(jslet.data.RefreshEvent.updateAllEvent(),true)}});jslet.ui.register("DBDataLabel",jslet.ui.DBDataLabel);jslet.ui.DBDataLabel.htmlTemplate="<label></label>";jslet.ui.DBDatePicker=jslet.Class.create(jslet.ui.DBCustomComboBox,{initialize:function($super,a,c){var b=this;b.allProperties="dataset,field,textReadOnly,popupWidth, popupHeight";b._popupWidth=260;b._popupHeight=226;b.popup=new jslet.ui.PopupPanel();b.popup.onHidePopup=function(){b.focus()};b.comboButtonCls="fa-calendar";$super(a,c)},popupHeight:function(a){if(a===undefined){return this._popupHeight}jslet.Checker.test("DBDatePicker.popupHeight",a).isGTEZero();this._popupHeight=parseInt(a)},popupWidth:function(a){if(a===undefined){return this._popupWidth}jslet.Checker.test("DBDatePicker.popupWidth",a).isGTEZero();this._popupWidth=parseInt(a)},isValidTemplateTag:function(a){return true},buttonClick:function(){var e=this.el,c=this,i=c._dataset.getField(c._field),f=jQuery(e);if(i.readOnly()||i.disabled()){return}var d=c._popupWidth,p=c._popupHeight,g=c._dataset.getFieldValue(c._field,c._valueIndex),m=i.dataRange(),k=null,b=null;if(m){if(m.min){k=m.min}if(m.max){b=m.max}}if(!c.contentPanel){c.contentPanel=jslet.ui.createControl({type:"Calendar",value:g,minDate:k,maxDate:b,onDateSelected:function(h){c.popup.hide();c.el.focus();var q=c._dataset.getFieldValue(c._field,c._valueIndex);if(!q){q=h}else{q.setFullYear(h.getFullYear());q.setMonth(h.getMonth());q.setDate(h.getDate())}c._dataset.setFieldValue(c._field,q,c._valueIndex)}},null,d+"px",p+"px")}jslet.ui.PopupPanel.excludedElement=e;var a=f.offset(),l=f.outerHeight(),o=a.left,n=a.top+l;if(jslet.locale.isRtl){o=o+f.outerWidth()}c.popup.setContent(c.contentPanel.el,"100%","100%");c.contentPanel.el.style.display="block";c.contentPanel.setValue(g);c.popup.show(o,n,d+3,p+3,0,l)},destroy:function($super){var a=this;if(a.contentPanel){a.contentPanel.destroy();a.contentPanel=null}a.popup.destroy();a.popup=null;$super()}});jslet.ui.register("DBDatePicker",jslet.ui.DBDatePicker);jslet.ui.DBDatePicker.htmlTemplate="<div></div>";jslet.ui.DBTimePicker=jslet.Class.create(jslet.ui.DBFieldControl,{initialize:function($super,a,c){var b=this;b.allProperties="dataset,field,is12Hour,hasSecond";b._is12Hour=false;b._hasSecond=false;$super(a,c)},is12Hour:function(a){if(a===undefined){return this._is12Hour}this._is12Hour=a?true:false},hasSecond:function(a){if(a===undefined){return this._hasSecond}this._hasSecond=a?true:false},isValidTemplateTag:function(b){var a=b.tagName.toLowerCase();return a=="div"||a=="span"},bind:function(){var b=this,a=jQuery(b.el);if(!a.hasClass("jl-timepicker")){a.addClass("form-control jl-timepicker")}b.renderAll();a.on("change","select",function(c){b.updateToDataset()})},renderAll:function(){var a=this,d=jQuery(a.el),f=a._dataset.getField(a._field),m=f.dataRange(),e={hour:0,minute:0,second:0},c={hour:23,minute:59,second:59};if(m){if(m.min){e=a._splitTime(m.min)}if(m.max){c=a._splitTime(m.max)}}var o=[];o.push('<select class="jl-time-hour">');if(a._is12Hour){var l=e.hour;var b=c.hour;var i=100,n=0,h;for(var g=l;g<b;g++){h=g;if(g>11){h=g-12}i=Math.min(i,h);n=Math.max(n,h)}o.push(a._getOptions(i,n))}else{o.push(a._getOptions(e.hour,c.hour||23))}o.push("</select>");o.push('<select class="jl-time-minute">');o.push(a._getOptions(0,59));o.push("</select>");if(a._hasSecond){o.push('<select class="jl-time-second">');o.push(a._getOptions(0,59));o.push("</select>")}if(a._is12Hour){o.push('<select class="jl-time-ampm"><option value="am">AM</option><option value="pm">PM</option></select>')}d.html(o.join(""));a.refreshControl(jslet.data.RefreshEvent.updateAllEvent(),true)},_getOptions:function(d,b){var a=[],e;for(var c=d;c<=b;c++){if(c<10){e="0"+c}else{e=""+c}a.push('<option value="');a.push(c);a.push('">');a.push(e);a.push("</option>")}return a.join("")},doMetaChanged:function($super,g){$super(g);var a=this,c=a._dataset.getField(a._field);if(!g||g=="disabled"||g=="readOnly"){var d=c.disabled()||c.readOnly();var f=jQuery(a.el).find("select"),h;for(var e=0,b=f.length;e<b;e++){h=f[e];h.disabled=d;jslet.ui.setEditableStyle(h,d,d,true)}}if(g=="message"){a.renderInvalid()}},doValueChanged:function(){var g=this;if(g._keep_silence_){return}var h=g._dataset.getField(g._field);if(h.message(g._valueIndex)){return}var f=g._dataset.getFieldValue(g._field,g._valueIndex),d=g._splitTime(f),c=d.hour,e=jQuery(g.el),b=e.find(".jl-time-hour"),a=e.find(".jl-time-minute");if(g._is12Hour){jqAmPm=e.find(".jl-time-ampm");jqAmPm.prop("selectedIndex",c<12?0:1);if(c>11){c-=12}}b.val(c);a.val(d.minute);if(g._hasSecond){a=e.find(".jl-time-second");a.val(d.second)}},_splitTime:function(c){var a=0,e=0,b=0;if(c){if(jslet.isDate(c)){a=c.getHours();e=c.getMinutes();b=c.getSeconds()}else{if(jslet.isString(c)){var d=c.split(":");a=parseInt(d[0]);if(d.length>1){e=parseInt(d[1])}if(d.length>2){b=parseInt(d[2])}}}}return{hour:a,minute:e,second:b}},_prefix:function(a){if(parseInt(a)<10){return"0"+a}return a},updateToDataset:function(){var e=this;if(e._keep_silence_){return true}e._keep_silence_=true;try{var d=jQuery(e.el),g=e._dataset.getField(e._field),c=null,a;if(g.getType()!=jslet.data.DataType.DATE){c=[];if(e._is12Hour&&d.find(".jl-time-ampm").prop("selectedIndex")>0){a=parseInt(d.find(".jl-time-hour").val())+12;c.push(a)}else{c.push(e._prefix(d.find(".jl-time-hour").val()))}c.push(":");c.push(e._prefix(d.find(".jl-time-minute").val()));if(e._hasSecond){c.push(":");c.push(e._prefix(d.find(".jl-time-second").val()))}c=c.join("")}else{c=e._dataset.getFieldValue(e._field,e._valueIndex);if(!c){c=new Date()}a=parseInt(d.find(".jl-time-hour").val());if(e._is12Hour&&d.find(".jl-time-ampm").prop("selectedIndex")>0){a+=12}var f=parseInt(d.find(".jl-time-minute").val());var b=0;if(e._hasSecond){b=parseInt(d.find(".jl-time-second").val())}c.setHours(a);c.setMinutes(f);c.setSeconds(b)}e._dataset.setFieldValue(e._field,c,e._valueIndex)}finally{e._keep_silence_=false}return true},destroy:function($super){jQuery(this.el).off();$super()}});jslet.ui.register("DBTimePicker",jslet.ui.DBTimePicker);jslet.ui.DBTimePicker.htmlTemplate="<div></div>";jslet.ui.DBLookupLabel=jslet.Class.create(jslet.ui.DBControl,{initialize:function($super,a,c){var b=this;b.allProperties="dataset,lookupField,returnField,lookupValue";b.requiredProperties="lookupValue,lookupField,returnField";b.lookupField;b.lookupValue;b.returnField;$super(a,c)},bind:function(){this.renderAll();jQuery(this.el).addClass("form-control")},isValidTemplateTag:function(a){return a.tagName.toLowerCase()=="label"},refreshControl:function(b,d){if(b.eventType!=jslet.data.RefreshEvent.UPDATEALL){return}if(!d&&!c.isActiveRecord()){return}var c=this;var a=c.dataset.lookup(c.lookupField,c.lookupValue,c.returnField);if(a==null){a="NOT found: "+c.lookupValue}c.el.innerHTML=a},renderAll:function(){this.refreshControl(jslet.data.RefreshEvent.updateAllEvent,true)}});jslet.ui.register("DBLookupLabel",jslet.ui.DBLookupLabel);jslet.ui.DBLookupLabel.htmlTemplate="<label></label>";jslet.ui.DBImage=jslet.Class.create(jslet.ui.DBFieldControl,{initialize:function($super,a,c){var b=this;b.allProperties="dataset,field,locked,baseUrl,altField";b._locked=false;b._baseUrl=null;b._altField=null;$super(a,c)},baseUrl:function(a){if(a===undefined){return this._baseUrl}a=jQuery.trim(a);jslet.Checker.test("DBImage.baseUrl",a).isString();this._baseUrl=a},altField:function(a){if(a===undefined){return this._altField}a=jQuery.trim(a);jslet.Checker.test("DBImage.altField",a).isString();this._altField=a},locked:function(a){if(a===undefined){return this._locked}this._locked=a},isValidTemplateTag:function(a){return a.tagName.toLowerCase()=="img"},bind:function(){this.renderAll();jQuery(this.el).addClass("img-responsive img-rounded")},doValueChanged:function(){var c=this,f=c._dataset.getField(c._field);if(c._locked){c.el.alt=jslet.locale.DBImage.lockedImageTips;c.el.src="";return}try{var d=c._dataset.getFieldValue(c._field);if(!d){d=""}else{if(c._baseUrl){d=c._baseUrl+d}}if(c.el.src!=d){var a=d;if(c._altField){a=c._dataset.getFieldText(c._altField)}c.el.alt=a;c.el.src=d}}catch(b){jslet.showError(b)}},renderAll:function(){this.refreshControl(jslet.data.RefreshEvent.updateAllEvent(),true)}});jslet.ui.register("DBImage",jslet.ui.DBImage);jslet.ui.DBImage.htmlTemplate="<img></img>";jslet.ui.DBSelect=jslet.Class.create(jslet.ui.DBFieldControl,{initialize:function($super,a,c){var b=this;b.allProperties="dataset,field,groupField,lookupDataset";b._groupField=null;b._lookupDataset=null;b._enableInvalidTip=true;$super(a,c)},groupField:function(a){if(a===undefined){return this._groupField}a=jQuery.trim(a);jslet.Checker.test("DBSelect.groupField",a).isString();this._groupField=a},lookupDataset:function(a){if(a===undefined){return this._lookupDataset}if(jslet.isString(a)){a=jslet.data.dataModule.get(jQuery.trim(a))}jslet.Checker.test("DBSelect.lookupDataset",a).isClass(jslet.data.Dataset.className);this._lookupDataset=a},isValidTemplateTag:function(a){return(a.tagName.toLowerCase()=="select")},bind:function(){var c=this,d=c._dataset.getField(c._field),a=d.valueStyle();if(c.el.multiple&&a!=jslet.data.FieldValueStyle.MULTIPLE){d.valueStyle(jslet.data.FieldValueStyle.MULTIPLE)}else{if(a==jslet.data.FieldValueStyle.MULTIPLE&&!c.el.multiple){c.el.multiple="multiple"}}c.renderAll();var b=jQuery(c.el);b.on("change",c._doChanged);if(c.el.multiple){b.on("click","option",c._doCheckLimitCount)}b.addClass("form-control")},_doChanged:function(d){var e=this.jslet;if(e.el.multiple){if(e.inProcessing){e.inProcessing=false}var f=e._dataset.getField(e._field),c=f.valueCountLimit();if(c){var a=e._dataset.getFieldValue(e._field),b=1;if(jslet.isArray(a)){b=a.length}if(b>=c){jslet.showError(jslet.formatString(jslet.locale.DBCheckBoxGroup.invalidCheckedCount,[""+c]));window.setTimeout(function(){if(e._currOption){e.inProcessing=true;e._currOption.selected=false}},10);return}}}this.jslet.updateToDataset()},_doCheckLimitCount:function(a){var b=a.delegateTarget.jslet;b._currOption=this},doLookupChanged:function(){var b=this,h=b._dataset.getField(b._field),r=h.lookup();if(b._lookupDataset){r=new jslet.data.FieldLookup();r.dataset(b._lookupDataset)}else{if(!r){return}}var k=r.dataset(),l=k.recno(),o=false,c,f,n;try{if(b._groupField){f=k.getField(b._groupField);if(f===null){throw"NOT found field: "+b._groupField+" in "+k.name()}c=f.lookup();o=(c!==null);if(o){n=b._groupField+"."+c.codeField()}else{n=b._groupField}var q=k.indexFields();if(q){k.indexFields(n+";"+q)}else{k.indexFields(n)}}var a,d,e,p=[];if(!b.el.multiple&&!h.required()){p.push('<option value="_null_">');p.push(h.nullText());p.push("</option>")}for(var m=0,g=k.recordCount();m<g;m++){k.recnoSilence(m);if(b._groupField){d=k.getFieldValue(b._groupField);if(d!=a){if(a!==null){p.push("</optgroup>")}if(o){if(!c.dataset().findByField(c.keyField(),d)){throw"Not found: ["+d+"] in Dataset: ["+c.dataset().name()+"]field: ["+c.keyField()+"]"}e=c.getCurrentDisplayValue()}else{e=d}p.push('<optgroup label="');p.push(e);p.push('">');a=d}}p.push('<option value="');p.push(k.getFieldValue(r.keyField()));p.push('">');p.push(r.getCurrentDisplayValue());p.push("</option>")}if(a!==null){p.push("</optgroup>")}jQuery(b.el).html(p.join(""))}finally{k.recnoSilence(l)}},doMetaChanged:function($super,c){$super(c);var b=this,d=b._dataset.getField(b._field);if(!c||c=="disabled"||c=="readOnly"){var a=d.disabled()||d.readOnly();b.el.disabled=a;jslet.ui.setEditableStyle(b.el,a,a,true)}if(c=="message"){b.renderInvalid()}},doValueChanged:function(){var b=this;if(b._keep_silence_){return}var d=b._dataset.getField(b._field);if(d.message(b._valueIndex)){return}try{var f=b.el.options.length,c,h;for(h=0;h<f;h++){c=b.el.options[h];if(c){c.selected=false}}if(!b.el.multiple){var m=b._dataset.getFieldValue(b._field,b._valueIndex);if(m===null){if(!d.required()){m="_null_"}}b.el.value=m}else{var a=b._dataset.getFieldValue(b._field);if(a===null||a.length===0){return}var k=a.length-1,g;b._keep_silence_=true;try{for(h=0;h<f;h++){c=b.el.options[h];for(j=k;j>=0;j--){g=(a[j]==c.value);if(g){c.selected=g}}}}finally{b._keep_silence_=false}}}catch(l){jslet.showError(l)}},focus:function(){this.el.focus()},renderAll:function(){this.refreshControl(jslet.data.RefreshEvent.updateAllEvent(),true)},updateToDataset:function(){var b=this;if(b._keep_silence_){return}var c,o,m=b.el.multiple;if(!m){o=b.el.value;if(!o){c=b.el.options[b.el.selectedIndex];o=c.innerHTML}}else{var a=jQuery(b.el).find("option"),h=a.length-1;o=[];for(var l=0;l<=h;l++){c=a[l];if(c.selected){o.push(c.value?c.value:c.innerHTML)}}}b._keep_silence_=true;try{if(!m){var g=b._dataset.getField(b._field);if(o=="_null_"&&!g.required()){o=null}b._dataset.setFieldValue(b._field,o,b._valueIndex);var q=g.lookup(),f=q.returnFieldMap();if(f){var p=q.dataset();mainDs=b._dataset;if(p.findByKey(o)){var d,k;for(var d in f){k=f[d];mainDs.setFieldValue(d,p.getFieldValue(k))}}}}else{b._dataset.setFieldValue(b._field,o)}}catch(n){jslet.showError(n)}finally{b._keep_silence_=false}},destroy:function($super){this._currOption=null;jQuery(this.el).off();$super()}});jslet.ui.register("DBSelect",jslet.ui.DBSelect);jslet.ui.DBSelect.htmlTemplate="<select></select>";jslet.ui.DBRadioGroup=jslet.Class.create(jslet.ui.DBFieldControl,{initialize:function($super,a,c){var b=this;b.allProperties="dataset,field,columnCount";b._columnCount=99999;b._itemIds=null;$super(a,c)},columnCount:function(a){if(a===undefined){return this._columnCount}jslet.Checker.test("DBRadioGroup.columnCount",a).isGTEZero();this._columnCount=parseInt(a)},isValidTemplateTag:function(b){var a=b.tagName.toLowerCase();return a=="div"},bind:function(){this.renderAll();var a=jQuery(this.el);a.on("click",'input[type="radio"]',function(b){b.delegateTarget.jslet.updateToDataset(this)});a.addClass("form-control");a.css("height","auto")},doMetaChanged:function($super,g){$super(g);var a=this,c=a._dataset.getField(a._field);if(!g||g=="disabled"||g=="readOnly"){var d=c.disabled(),h=c.readOnly();a.disabled=d||h;d=a.disabled;var f=jQuery(a.el).find('input[type="radio"]');for(var e=0,b=f.length;e<b;e++){jslet.ui.setEditableStyle(f[e],d,h)}}if(g=="message"){a.renderInvalid()}},doValueChanged:function(){var g=this;if(g._keep_silence_){return}var k=g._dataset.getField(g._field);if(k.message(g._valueIndex)){return}try{var d=g._dataset.getFieldValue(g._field),h=jQuery(g.el).find('input[type="radio"]'),a;for(var c=0,b=h.length;c<b;c++){a=h[c];a.checked=(d==jQuery(a.parentNode).attr("value"))}}catch(f){jslet.showError(f)}},doLookupChanged:function(){var a=this;var c=a._dataset.getField(a._field),i=c.lookup();if(!i){jslet.showError(jslet.formatString(jslet.locale.Dataset.lookupNotFound,[c.name()]));return}var d=i.dataset();var f=d.recno();try{var l=['<table cellpadding="0" cellspacing="0">'],g=false,b=d.recordCount(),h;a._itemIds=[];for(var e=0;e<b;e++){d.recnoSilence(e);g=(e%a._columnCount===0);if(g){if(e>0){l.push("</tr>")}l.push("<tr>")}h=jslet.nextId();a._itemIds.push(h);l.push('<td style="white-space: nowrap" value="');l.push(d.getFieldValue(i.keyField()));l.push('"><input name="');l.push(a._field);l.push('" type="radio"  id="');l.push(h);l.push('" /><label for="');l.push(h);l.push('">');l.push(i.getCurrentDisplayValue());l.push("</label></td>")}if(b>0){l.push("</tr>")}l.push("</table>");a.el.innerHTML=l.join("")}finally{d.recnoSilence(f)}},updateToDataset:function(a){var c=this;if(c._keep_silence_||c.disabled){return}c._keep_silence_=true;try{c._dataset.setFieldValue(c._field,jQuery(a.parentNode).attr("value"));a.checked=true}catch(b){jslet.showError(b)}finally{c._keep_silence_=false}},focus:function(){if(_itemIds&&_itemIds.length>0){document.getElementById(_itemIds[0]).focus()}},renderAll:function(){var b=this,a=jQuery(b.el);if(!a.hasClass("jl-radiogroup")){a.addClass("jl-radiogroup")}b.refreshControl(jslet.data.RefreshEvent.updateAllEvent(),true)},destroy:function($super){var a=jQuery(this.el);a.off();$super()}});jslet.ui.register("DBRadioGroup",jslet.ui.DBRadioGroup);jslet.ui.DBRadioGroup.htmlTemplate="<div></div>";jslet.ui.DBRangeSelect=jslet.Class.create(jslet.ui.DBFieldControl,{initialize:function($super,a,c){var b=this;b.allProperties="dataset,field,beginItem,endItem,step";if(!b.requiredProperties){b.requiredProperties="field,beginItem,endItem,step"}b._beginItem=0;b._endItem=10;b._step=1;$super(a,c)},beginItem:function(a){if(a===undefined){return this._beginItem}jslet.Checker.test("DBRangeSelect.beginItem",a).isNumber();this._beginItem=parseInt(a)},endItem:function(a){if(a===undefined){return this._endItem}jslet.Checker.test("DBRangeSelect.endItem",a).isNumber();this._endItem=parseInt(a)},step:function(a){if(a===undefined){return this._step}jslet.Checker.test("DBRangeSelect.step",a).isNumber();this._step=parseInt(a)},isValidTemplateTag:function(a){return(a.tagName.toLowerCase()=="select")},bind:function(){var c=this,d=c._dataset.getField(c._field),a=d.valueStyle();if(c.el.multiple&&a!=jslet.data.FieldValueStyle.MULTIPLE){d.valueStyle(jslet.data.FieldValueStyle.MULTIPLE)}else{if(a==jslet.data.FieldValueStyle.MULTIPLE&&!c.el.multiple){c.el.multiple="multiple"}}c.renderAll();var b=jQuery(c.el);b.on("change",c._doChanged);if(c.el.multiple){b.on("click","option",function(){c._currOption=this})}b.addClass("form-control")},_doChanged:function(d){var e=this.jslet;if(e.el.multiple){if(e.inProcessing){e.inProcessing=false}var f=e._dataset.getField(e._field),c=f.valueCountLimit();if(c){var a=e._dataset.getFieldValue(e._field),b=1;if(jslet.isArray(a)){b=a.length}if(b>=c){jslet.showError(jslet.formatString(jslet.locale.DBCheckBoxGroup.invalidCheckedCount,[""+c]));window.setTimeout(function(){if(e._currOption){e.inProcessing=true;e._currOption.selected=false}},10);return}}}this.jslet.updateToDataset()},renderOptions:function(){var c=this,b=[];var d=c._dataset.getField(c._field);if(!d.required()){b.push('<option value="_null_">');b.push(d.nullText());b.push("</option>")}for(var a=c._beginItem;a<=c._endItem;a+=c._step){b.push('<option value="');b.push(a);b.push('">');b.push(a);b.push("</option>")}jQuery(c.el).html(b.join(""))},doMetaChanged:function($super,c){$super(c);var b=this,d=b._dataset.getField(b._field);if(!c||c=="disabled"||c=="readOnly"){var a=d.disabled()||d.readOnly();b.el.disabled=a;jslet.ui.setEditableStyle(b.el,a,a,true)}if(c=="message"){b.renderInvalid()}},doValueChanged:function(){var b=this;if(b._keep_silence_){return}var d=b._dataset.getField(b._field);if(d.message(b._valueIndex)){return}try{if(!b.el.multiple){var m=b._dataset.getFieldValue(b._field,b._valueIndex);if(m!==null){b.el.value=m}else{b.el.value=null}}else{var a=b._dataset.getFieldValue(b._field),f=b.el.options.length,c,g,k;b._keep_silence_=true;try{for(k=0;k<f;k++){c=b.el.options[k];if(c){c.selected=false}}var h=a.length-1;for(k=0;k<f;k++){c=b.el.options[k];for(j=h;j>=0;j--){g=(a[j]==c.value);if(g){c.selected=g}}}}finally{b._keep_silence_=false}}}catch(l){jslet.showError(l)}},focus:function(){this.el.focus()},renderAll:function(){this.renderOptions();this.refreshControl(jslet.data.RefreshEvent.updateAllEvent(),true)},updateToDataset:function(){var g=this;if(g._keep_silence_){return}var d,k=g.el.multiple;if(!k){d=g.el.value;var h=g._dataset.getField(g._field);if(d=="_null_"&&!h.required()){d=null}}else{var c=jQuery(g.el).find("option"),b=c.length-1;d=[];for(var a=0;a<=b;a++){opt=c[a];if(opt.selected){d.push(opt.value)}}}g._keep_silence_=true;try{if(!k){g._dataset.setFieldValue(g._field,d,g._valueIndex)}else{g._dataset.setFieldValue(g._field,d)}}catch(f){jslet.showError(f)}finally{g._keep_silence_=false}},destroy:function($super){jQuery(this.el).off();$super()}});jslet.ui.register("DBRangeSelect",jslet.ui.DBRangeSelect);jslet.ui.DBRangeSelect.htmlTemplate="<select></select>";jslet.ui.DBSpinEdit=jslet.Class.create(jslet.ui.DBText,{initialize:function($super,a,c){var b=this;b.allProperties="dataset,field,step";b._step=1;$super(a,c)},step:function(a){if(a===undefined){return this._step}jslet.Checker.test("DBSpinEdit.step",a).isNumber();this._step=a},isValidTemplateTag:function(b){var a=b.tagName.toLowerCase();return a=="div"},bind:function(){var b=this,a=jQuery(b.el);if(!a.hasClass("jl-spinedit")){a.addClass("input-group jl-spinedit");a.attr("role","spinbutton")}b._createControl();b.renderAll()},_createControl:function(){var e=this,d=jQuery(e.el),c='<input type="text" class="form-control"><div class="jl-spinedit-btn-group"><button class="btn btn-default jl-spinedit-up"><i class="fa fa-caret-up"></i></button><button class="btn btn-default jl-spinedit-down"><i class="fa fa-caret-down"></i></button>';d.html(c);var b=d.find("input")[0],a=d.find(".jl-spinedit-up")[0],f=d.find(".jl-spinedit-down")[0];e.editor=b;jQuery(e.editor).on("keydown",function(g){if(e._isDisabled()){return}var h=g.keyCode;if(h==jslet.ui.KeyCode.UP){e.decValue();g.preventDefault();return}if(h==jslet.ui.KeyCode.DOWN){e.incValue();g.preventDefault();return}});new jslet.ui.DBText(b,{dataset:e._dataset,field:e._field,beforeUpdateToDataset:e.beforeUpdateToDataset,valueIndex:e._valueIndex});jQuery(a).on("click",function(){e.incValue()});jQuery(f).on("click",function(){e.decValue()})},_isDisabled:function(){var a=this,b=a._dataset.getField(a._field);return b.disabled()||b.readOnly()},beforeUpdateToDataset:function(){var d=this,e=d.el.value;var f=d._dataset.getField(d._field),a=f.dataRange(),b=Number.NEGATIVE_INFINITY,c=Number.POSITIVE_INFINITY;if(a){if(a.min){b=parseFloat(a.min)}if(a.max){c=parseFloat(a.max)}}if(e){e=parseFloat(e)}jQuery(d.el).attr("aria-valuenow",e);d.el.value=e;return true},setValueToDataset:function(c){var b=this;if(b.silence){return}b.silence=true;if(c===undefined){c=b.value}try{b._dataset.setFieldValue(b._field,c,b._valueIndex)}catch(a){jslet.showError(a)}finally{b.silence=false}},incValue:function(){var b=this,c=b._dataset.getFieldValue(b._field,b._valueIndex);if(!c){c=0}var a=b._getRange().maxValue;if(c==a){return}else{if(c<a){c+=b._step}else{c=a}}if(c>a){value=a}jQuery(b.el).attr("aria-valuenow",c);b.setValueToDataset(c)},_getRange:function(){var d=this,e=d._dataset.getField(d._field),a=e.dataRange(),b=Number.NEGATIVE_INFINITY,c=Number.POSITIVE_INFINITY;if(a){if(a.min){b=parseFloat(a.min)}if(a.max){c=parseFloat(a.max)}}return{minValue:b,maxValue:c}},decValue:function(){var b=this,c=b._dataset.getFieldValue(b._field,b._valueIndex);if(!c){c=0}var a=b._getRange().minValue;if(c==a){return}else{if(c>a){c-=b._step}else{c=a}}if(c<a){c=a}jQuery(b.el).attr("aria-valuenow",c);b.setValueToDataset(c)},focus:function(){if(Z._isDisabled()){return}this.editor.focus()},doMetaChanged:function($super,f){$super(f);var e=this,d=jQuery(this.el),g=e._dataset.getField(e._field);if(!f||f=="disabled"||f=="readOnly"){var c=g.disabled()||g.readOnly(),a=d.find(".jl-spinedit-up"),b=d.find(".jl-spinedit-down");if(c){a.attr("disabled","disabled");b.attr("disabled","disabled")}else{a.attr("disabled",false);b.attr("disabled",false)}}if(!f||f=="dataRange"){range=g.dataRange();d.attr("aria-valuemin",range&&(range.min||range.min===0)?range.min:"");d.attr("aria-valuemin",range&&(range.max||range.max===0)?range.max:"")}},renderAll:function(){this.refreshControl(jslet.data.RefreshEvent.updateAllEvent(),true)},destroy:function(){var a=jQuery(this.el);jQuery(this.editor).off();this.editor=null;a.find(".jl-upbtn-up").off();a.find(".jl-downbtn-up").off()}});jslet.ui.register("DBSpinEdit",jslet.ui.DBSpinEdit);jslet.ui.DBSpinEdit.htmlTemplate="<div></div>";jslet.ui.DBRating=jslet.Class.create(jslet.ui.DBFieldControl,{initialize:function($super,a,c){var b=this;b.allProperties="dataset,field,itemCount,splitCountitemWidth";b._itemCount=5;b._splitCount=1;b._itemWidth=20;b._required=false;b._readOnly=false;$super(a,c)},itemCount:function(a){if(a===undefined){return this._itemCount}jslet.Checker.test("DBRating.itemCount",a).isGTZero();this._itemCount=parseInt(a)},splitCount:function(a){if(a===undefined){return this._splitCount}jslet.Checker.test("DBRating.splitCount",a).isGTZero();this._splitCount=parseInt(a)},itemWidth:function(a){if(a===undefined){return this._itemWidth}jslet.Checker.test("DBRating.itemWidth",a).isGTZero();this._itemWidth=parseInt(a)},isValidTemplateTag:function(a){return a.tagName.toLowerCase()=="div"},bind:function(){var b=this;b.renderAll();var a=jQuery(b.el);a.on("mousedown","td",b._mouseDown);a.on("mousemove","td",b._mouseMove);a.on("mouseout","td",b._mouseOut);a.on("mouseup","td",b._mouseUp)},_mouseMove:function domove(b){b=jQuery.event.fix(b||window.event);var f=b.delegateTarget,a=f.jslet;if(a._readOnly){return}var n=jQuery(f),d=b.pageX-n.offset().left,g=Math.ceil(d/a.splitWidth),m,c=f.firstChild.rows[0],l=c.cells.length;var o=this.cellIndex+1;for(var h=0;h<l;h++){var e=c.cells[h];a._setBackgroundPos(e,a._getPosX(h%a._splitCount,h<o?1:2))}},_mouseOut:function doout(a){a=jQuery.event.fix(a||window.event);var b=a.delegateTarget.jslet;if(b._readOnly){return}b.doValueChanged()},_mouseDown:function dodown(d){d=jQuery.event.fix(d||window.event);var c=d.delegateTarget,e=c.jslet;if(e._readOnly){return}var b=c.firstChild.rows[0],f=b.cells.length;var a=this.cellIndex+1;if(!e._required&&a==1){a=(e.value*e._splitCount)==1?0:1}e.value=a/e._splitCount;e._dataset.setFieldValue(e._field,e.value,e._valueIndex);e.doValueChanged()},_mouseUp:function(d){d=jQuery.event.fix(d||window.event);var c=d.delegateTarget,b=c.firstChild.rows[0],e=c.jslet;if(e._readOnly){return}if(e._selectedItem>=0){var a=b.cells[e._selectedItem];e._setBackgroundPos(a,e._selectedPx)}},_getPosX:function(d,b){var e=this,c=jslet.locale.isRtl,a;a=0-b*e._itemWidth;if(c){a+=(d+1)*e.splitWidth-e._itemWidth}else{a-=d*e.splitWidth}return a},_setBackgroundPos:function(a,b){if(a.style.backgroundPositionX!==undefined){a.style.backgroundPositionX=b+"px"}else{a.style.backgroundPosition=b+"px 0px"}},doMetaChanged:function($super,b){$super(b);var a=this,c=a._dataset.getField(a._field);if(!b||b=="disabled"||b=="readOnly"){a._readOnly=c.disabled()||c.readOnly()}if(!b||b=="required"){a._required=c.required()}if(b=="message"){a.renderInvalid()}},doValueChanged:function(){var a=this;try{var b=a._dataset.getField(a._field),o=a._dataset.getFieldValue(a._field,a._valueIndex),f=a._itemCount*a._splitCount,p=Math.ceil(o*a._splitCount),c,g,l,n=a.el.firstChild.rows[0],m=a._itemWidth*2,k=jslet.locale.isRtl;a.value=o;for(var d=0;d<f;d++){c=n.childNodes[d];a._setBackgroundPos(c,a._getPosX(d%a._splitCount,d<p?0:2))}}catch(h){jslet.showError(h)}},renderAll:function(){var e=this,g=e._dataset.getField(e._field);var d=jQuery(e.el);if(!d.hasClass("jl-rating")){d.addClass("jl-rating")}d.html('<table border="0" cellspacing="0" cellpadding="0" style="table-layout:fixed;border-collapse:collapse"><tr></tr></table>');var a,f=e._itemCount*e._splitCount,b=e.el.firstChild.rows[0];e.splitWidth=parseInt(e._itemWidth/e._splitCount);for(var c=1;c<=f;c++){a=document.createElement("td");a.className="jl-rating-item";a.style.width=e.splitWidth+"px";a.style.height=e._itemWidth+"px";a.title=c/e._splitCount;b.appendChild(a)}d.width(e._itemCount*e._itemWidth);e.refreshControl(jslet.data.RefreshEvent.updateAllEvent(),true)},destroy:function($super){var a=jQuery(Z.el);a.off();$super()}});jslet.ui.DBRating.CHECKED=0;jslet.ui.DBRating.UNCHECKED=1;jslet.ui.DBRating.FOCUS=2;jslet.ui.register("DBRating",jslet.ui.DBRating);jslet.ui.DBRating.htmlTemplate="<Div></Div>";jslet.ui.DBHtml=jslet.Class.create(jslet.ui.DBFieldControl,{initialize:function($super,a,b){this.allProperties="dataset,field";$super(a,b)},bind:function(){this.renderAll();jQuery(this.el).addClass("form-control")},isValidTemplateTag:function(a){return a.tagName.toLowerCase()=="div"},doValueChanged:function(){var a=this._dataset.getFieldText(this._field);this.el.innerHTML=a},renderAll:function(){this.refreshControl(jslet.data.RefreshEvent.updateAllEvent(),true)}});jslet.ui.register("DBHtml",jslet.ui.DBHtml);jslet.ui.DBHtml.htmlTemplate='<div style="width:200px;height:200px"></div>';jslet.ui.DBPageBar=jslet.Class.create(jslet.ui.DBControl,{initialize:function($super,a,c){var b=this;b.allProperties="dataset,showPageSize,showGotoButton,pageSizeList";b._showPageSize=true;b._showGotoButton=true;b._pageSizeList=[100,200,500];$super(a,c)},showPageSize:function(a){if(a===undefined){return this._showPageSize}this._showPageSize=a?true:false},showGotoButton:function(a){if(a===undefined){return this._showGotoButton}this._showGotoButton=a?true:false},pageSizeList:function(d){if(d===undefined){return this._pageSizeList}jslet.Checker.test("DBPageBar.pageSizeList",d).isArray();var c;for(var b=0,a=d.length;b<a;b++){c=d[b];jslet.Checker.test("DBPageBar.pageSizeList",c).isGTZero()}this._pageSizeList=d},isValidTemplateTag:function(b){var a=b.tagName.toLowerCase();return a=="div"},bind:function(){var h=this,g=jQuery(h.el);if(!g.hasClass("jl-pagebar")){g.addClass("jl-pagebar")}var e=['<select class="jl-pb-item"></select><label class="jl-pb-item jl-pb-label">',jslet.locale.DBPageBar.pageSizeLabel,'</label><a class="jl-pb-item jl-pb-button jl-pb-first" href="javascript:;"></a><a class="jl-pb-item jl-pb-button jl-pb-prior" href="javascript:;"></a><label class="jl-pb-item jl-pb-label">',jslet.locale.DBPageBar.pageNumLabel,'</label><input class="jl-pb-item jl-pb-pagenum" value="1" size="2" ></input><a class="jl-pb-item jl-pb-button jl-pb-goto" href="javascript:;"></a><label class="jl-pb-item jl-pb-label">',jslet.formatString(jslet.locale.DBPageBar.pageCountLabel,[0]),'</label><a class="jl-pb-item jl-pb-button jl-pb-next" href="javascript:;"></a><a class="jl-pb-item jl-pb-button jl-pb-last" href="javascript:;"></a></div>'];g.html(e.join(""));var c=h.el.childNodes[0];if(h._showPageSize){var f=h._pageSizeList;var b=f.length,d="";for(var a=0;a<b;a++){d+="<option value="+f[a]+">"+f[a]+"</option>"}c.innerHTML=d;h._dataset.pageSize(parseInt(c.value))}jQuery(c).on("change",function(i){var k=this.parentElement.jslet.dataset();k.pageNo(1);k.pageSize(parseInt(this.value));k.requery()});h._firstBtn=h.el.childNodes[2];h._priorBtn=h.el.childNodes[3];h._pageNoTxt=h.el.childNodes[5];h._gotoBtn=h.el.childNodes[6];h._pageCountLbl=h.el.childNodes[7];h._nextBtn=h.el.childNodes[8];h._lastBtn=h.el.childNodes[9];jQuery(h._firstBtn).on("click",function(i){if(this.disabled){return}var k=this.parentElement.jslet.dataset();k.pageNo(1);k.requery()});jQuery(h._priorBtn).on("click",function(k){if(this.disabled){return}var l=this.parentElement.jslet.dataset(),i=l.pageNo();if(i==1){return}l.pageNo(i-1);l.requery()});jQuery(h._gotoBtn).on("click",function(l){var k=this.parentElement.jslet;var m=k.dataset();var i=parseInt(k._pageNoTxt.value);if(i<1){i=1}if(i>m.pageCount()){i=m.pageCount()}m.pageNo(i);m.requery()});jQuery(h._nextBtn).on("click",function(l){if(this.disabled){return}var k=this.parentElement.jslet,m=k.dataset(),i=m.pageNo();if(i>=m.pageCount()){return}m.pageNo(++i);m.requery()});jQuery(h._lastBtn).on("click",function(k){if(this.disabled){return}var i=this.parentElement.jslet,l=i.dataset();if(l.pageCount()<1){return}l.pageNo(l.pageCount());l.requery()});jQuery(h._pageNoTxt).on("keypress",function(k){k=jQuery.event.fix(k||window.event);var l=k.which;var i=new Array("0","1","2","3","4","5","6","7","8","9");if(i.indexOf(String.fromCharCode(l))<0){k.preventDefault()}});h.renderAll()},refreshControl:function(a){if(a&&a.eventType!=jslet.data.RefreshEvent.CHANGEPAGE){return}var d=this,b=d._dataset.pageNo(),c=d._dataset.pageCount();d._pageNoTxt.value=b;d._pageCountLbl.innerHTML=jslet.formatString(jslet.locale.DBPageBar.pageCountLabel,[c]);d._refreshButtonStatus()},_refreshButtonStatus:function(){var e=this,c=e._dataset,b=c.pageNo(),d=c.pageCount(),a=true,f=true;if(b>1){a=false}if(b<d){f=false}if(a){jQuery(e._firstBtn).addClass("jl-pb-first-disabled jl-pb-button-disabled");jQuery(e._priorBtn).addClass("jl-pb-prior-disabled jl-pb-button-disabled")}else{jQuery(e._firstBtn).removeClass("jl-pb-first-disabled jl-pb-button-disabled");jQuery(e._priorBtn).removeClass("jl-pb-prior-disabled jl-pb-button-disabled")}if(f){jQuery(e._nextBtn).addClass("jl-pb-next-disabled jl-pb-button-disabled");jQuery(e._lastBtn).addClass("jl-pb-last-disabled jl-pb-button-disabled")}else{jQuery(e._nextBtn).removeClass("jl-pb-next-disabled jl-pb-button-disabled");jQuery(e._lastBtn).removeClass("jl-pb-last-disabled jl-pb-button-disabled")}e._firstBtn.disabled=a;e._priorBtn.disabled=a;e._nextBtn.disabled=f;e._lastBtn.disabled=f},renderAll:function(){var b=this._showPageSize?"inline":"none";var a=this.el;a.childNodes[0].style.display=b;a.childNodes[1].style.display=b;this.refreshControl()},destroy:function($super){var a=this;jQuery(a._firstBtn).off();jQuery(a._priorBtn).off();jQuery(a._pageNoTxt).off();jQuery(a._gotoBtn).off();jQuery(a._pageCountLbl).off();jQuery(a._nextBtn).off();jQuery(a._lastBtn).off();a._firstBtn=null;a._priorBtn=null;a._pageNoTxt=null;a._gotoBtn=null;a._pageCountLbl=null;a._nextBtn=null;a._lastBtn=null;$super()}});jslet.ui.register("DBPageBar",jslet.ui.DBPageBar);jslet.ui.DBPageBar.htmlTemplate="<div></div>";jslet.ui.DBError=jslet.Class.create(jslet.ui.DBControl,{initialize:function($super,a,b){this.allProperties="dataset";$super(a,b)},isValidTemplateTag:function(b){var a=b.tagName.toLowerCase();return a=="div"},bind:function(){var b=this,a=jQuery(b.el);if(!a.hasClass("jl-errorpanel")){a.addClass("jl-errorpanel")}b.renderAll()},refreshControl:function(a){if(a&&a.eventType==jslet.data.RefreshEvent.ERROR){this.el.innerHTML=a.message||""}},renderAll:function(){this.refreshControl()},destroy:function($super){var a=this;$super()}});jslet.ui.register("DBError",jslet.ui.DBError);jslet.ui.DBError.htmlTemplate="<div></div>";