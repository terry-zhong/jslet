"use strict";!function(e,t){"function"==typeof define?define.amd?define("jslet-ui",["jslet-data"],t):define(function(require,e,l){require("jslet-css"),require("jslet-data"),l.exports=t()}):t()}(this,function(){jslet.ui||(jslet.ui={}),jslet.ui.Control=jslet.Class.create({initialize:function(e,t){var l=this;if(l.el=e,l.allProperties=null,t=jslet.ui._evalParams(t),l.isValidTemplateTag&&!l.isValidTemplateTag(l.el)){var i,n=jslet.ui.getControlClass(t.type);throw i=n?n.htmlTemplate:"",new Error(jslet.formatMessage(jslet.locale.DBControl.invalidHtmlTag,i))}l._styleClass=null,l.styleClass=function(e){return void 0===e?l._styleClass:void(l._styleClass=e)},l._childControls=null,l.setParams(t),l.checkRequiredProperty(),l.el.jslet=this,l.beforeBind(),l.el.id||(l.el.id=jslet.nextId()),l.bind();var a=jQuery(l.el);l._styleClass&&a.addClass(l._styleClass),l.afterBind()},beforeBind:function(){},bind:function(){},afterBind:function(){},setParams:function(e){if(e){var t=e.type;this.styleClass(e.styleClass);for(var l in e){var i=this[l];if("type"!=l&&"styleClass"!=l){if(!i||!i.call)throw new Error(t+" NOT support control property: "+l);i.call(this,e[l])}}}},checkRequiredProperty:function(){if(this.requiredProperties)for(var e,t=this.requiredProperties.split(","),l=t.length,i=0;l>i;i++)if(e=t[i].trim(),!this[e])throw new Error(jslet.formatMessage(jslet.locale.DBControl.expectedProperty,[e]))},addChildControl:function(e){var t=this;t._childControls||(t._childControls=[]),e&&t._childControls.push(e)},removeAllChildControls:function(){var e,t=this;if(t.el&&(t.el.innerHTML=""),t._childControls){for(var l=0,i=t._childControls.length;i>l;l++)e=t._childControls[l],e.destroy();t._childControls=null}},destroy:function(){this.el&&(this.el.jslet=null,this.el=null)}}),jslet.ui.DBControl=jslet.Class.create(jslet.ui.Control,{initialize:function($super,e,t){$super(e,t)},_dataset:void 0,dataset:function(e){return void 0===e?this._dataset:(jslet.isString(e)&&(e=jslet.data.dataModule.get(jQuery.trim(e))),jslet.Checker.test("DBControl.dataset",e).required().isClass(jslet.data.Dataset.className),void(this._dataset=e))},setParams:function($super,e){if($super(e),!this._dataset){var t=this.getDatasetInParentElement();this.dataset(t)}},beforeBind:function($super){$super(),this._dataset.addLinkedControl(this)},checkRequiredProperty:function($super){jslet.Checker.test("DBControl.dataset",this._dataset).required(),$super()},refreshControl:function(e){var t,l=this;if(t=e?e.eventType:jslet.data.RefreshEvent.UPDATEALL,t==jslet.data.RefreshEvent.CHANGEMETA){var i=e.metaName;return l._field&&l._field==e.fieldName?l.doMetaChanged(i):l._field||"visible"!=i&&"editControl"!=i||l.doMetaChanged(i),!0}return t==jslet.data.RefreshEvent.UPDATELOOKUP&&e.fieldName==l._field?(l.doLookupChanged(e.isMetaChanged),!0):t==jslet.data.RefreshEvent.SCROLL||t==jslet.data.RefreshEvent.INSERT||t==jslet.data.RefreshEvent.DELETE?(l.doValueChanged(),!0):(t==jslet.data.RefreshEvent.UPDATERECORD||t==jslet.data.RefreshEvent.UPDATECOLUMN)&&void 0===e.fieldName||e&&e.fieldName==l._field?(l.doValueChanged(),!0):t==jslet.data.RefreshEvent.UPDATEALL?(l.doMetaChanged(),l.doLookupChanged(),l.doValueChanged(),!0):!0},doMetaChanged:function(e){},doValueChanged:function(){},doLookupChanged:function(){},getDatasetInParentElement:function(){for(var e=this.el,t=null;;){if(t=jslet.ui.getParentElement(e,1),!t)break;if(t.jslet)return t.jslet.dataset;e=t}return null},destroy:function($super){this.removeAllChildControls(),this._dataset&&this._dataset.removeLinkedControl(this),this._dataset=null,$super()}}),jslet.ui.DBFieldControl=jslet.Class.create(jslet.ui.DBControl,{initialize:function($super,e,t){$super(e,t)},_field:void 0,_valueIndex:void 0,_enableInvalidTip:!0,_tableId:null,_tabIndex:null,field:function(e){if(void 0===e)return this._field;e=jQuery.trim(e),jslet.Checker.test("DBControl.field",e).isString().required();var t=e.lastIndexOf("#");t>0&&(this._fieldMeta=e.substring(t+1),e=e.substring(0,t)),this._field=e},fieldMeta:function(){return this._fieldMeta},valueIndex:function(e){return void 0===e?this._valueIndex:(jslet.Checker.test("DBControl.valueIndex",e).isNumber(),void(this._valueIndex=parseInt(e)))},tabIndex:function(e){return void 0===e?this._tabIndex:(jslet.Checker.test("DBControl.tabIndex",e).isNumber(),void(this._tabIndex=e))},setParams:function($super,e){$super(e);var t=e.valueIndex;void 0!==t&&this.valueIndex(t);var l=e.tabIndex;void 0!==l&&this.tabIndex(l)},checkRequiredProperty:function($super){$super(),jslet.Checker.test("DBControl.field",this._field).required(),this.existField(this._field)},doMetaChanged:function($super,e){if($super(e),!e||"tip"==e){var t=this._dataset.getField(this._field);if(!t)throw new Error("Field: "+this._field+" NOT exist!");var l=t.tip();l=l?l:"",this.el.title=l}},setTabIndex:function(){var e=this,t=e._tabIndex;if(0!==t&&!t){var l=e._dataset.getField(e._field);l&&(t=l.tabIndex())}(0===t||t)&&(e.el.tabIndex=t)},existField:function(e){var t=this._dataset.getField(e);return!!t},tableId:function(e){return void 0===e?this._tableId:void(this._tableId=e)},getValue:function(){return this._dataset.getFieldValue(this._field,this._valueIndex)},getText:function(e){return this._dataset.getFieldText(this._field,e,this._valueIndex)},getFieldError:function(){return this._dataset.getFieldError(this._field,this._valueIndex)},renderInvalid:function(e){var t=this;t._field&&(e?(jQuery(t.el).parent().addClass("has-error"),t.el.title=e.message||""):(jQuery(t.el).parent().removeClass("has-error"),t.el.title=""))},canFocus:function(){return!0},focus:function(){var e=this;if(e.canFocus()){var t=e._dataset.getField(e._field),l=!t||t.disabled()||t.readOnly()||!t.visible();l||(e._tableId&&jslet("#"+e._tableId).gotoField(e._field),this.innerFocus())}},innerFocus:function(){var e=this,t=e.el;if(t.focus)try{return t.focus(),void(e.selectText&&e.selectText())}catch(l){console.warn(jslet.locale.Dataset.cannotFocusControl)}},destroy:function($super){$super(),this._field=null}}),jslet.ui._evalParams=function(e){if(jslet.Checker.test("evalParams#ctrlParams",e).required(),jslet.isString(e)){var t=jQuery.trim(e);!t.startsWith("{")&&t.indexOf(":")>0&&(t="{"+t+"}");try{return e=new Function("return "+t)(),e["var"]&&(e=e["var"]),e}catch(l){throw new Error(jslet.formatMessage(jslet.locale.DBControl.invalidJsletProp,[e]))}}return e},jslet.ui.controls=new jslet.SimpleMap,jslet.ui.register=function(e,t){jslet.ui.controls.set(e.toLowerCase(),t)},jslet.ui.createControl=function(e,t,l,i,n){var a=document.createElement("div"),s=jslet.ui._evalParams(e),r=s.type;r||(r=jslet.ui.controls.DBTEXT);var o=jslet.ui.controls.get(r.toLowerCase());if(!o)throw new Error("NOT found control type: "+r);a.innerHTML=o.htmlTemplate;var d=a.firstChild;return a.removeChild(d),n&&(d.style.display="none"),t?t.appendChild(d):document.body.appendChild(d),l&&(parseInt(l)==l&&(l+="px"),d.style.width=l),i&&(parseInt(i)==i&&(i+="px"),d.style.height=i),new o(d,s)},jslet.ui.getControlClass=function(e){return jslet.ui.controls.get(e.toLowerCase())},jslet.ui.bindControl=function(e,t){if(t||(t=jQuery(e).attr("data-jslet")),e.jslet)return void console.warn("Control has installed! Don't install it again!");var l=jslet.ui._evalParams(t),i=l.type;if(!i)return void(e.jslet=l);var n=jslet.ui.controls.get(i.toLowerCase());if(!n)throw new Error("NOT found control type: "+i);new n(e,l)},jslet.ui.unbindControl=function(e){e.jslet&&e.jslet.destroy&&e.jslet.destroy(),e.jslet=null},jslet.ui.rebindControl=function(e){jslet.ui.unbindControl(e),jslet.ui.bindControl(e)},jslet.ui.install=function(e,t){if(e&&void 0===t&&jQuery.isFunction(e)&&(t=e,e=null),!e&&jslet.locale.isRtl){var l=jQuery(document.body);l.hasClass("jl-rtl")||l.addClass("jl-rtl")}var i;e||(e=document.body),i=jQuery(e).find("*[data-jslet]");var n,a,s=i.length,r=jslet.existIds;r||(r={},jslet.existIds=r);for(var o=0;s>o;o++)n=i[o],a=n.id,a&&(r[a]?console.warn(jslet.formatMessage(jslet.locale.Control.duplicatedId,[a])):r[a]=1),jslet.ui.bindControl(n);t&&t(),jslet.global.afterInstall&&jslet.global.afterInstall(e)},jslet.ui.uninstall=function(e){var t;t=e?jQuery(e).find("*[data-jslet]"):jQuery("*[data-jslet]");for(var l,i=0,n=t.length;n>i;i++)l=t[i],l.jslet&&l.jslet.destroy&&l.jslet.destroy(),l.jslet=null;jslet.ui.menuManager&&jQuery(document).off("mousedown",jslet.ui.menuManager.hideAll)},jslet.ui||(jslet.ui={}),jslet.ui.DnD=function(){var e,t,l,i,n,a,s,r=2,o=!1,d=!0,u=this;this._docMouseDown=function(r){r=jQuery.event.fix(r||window.event),d=!0,n=0,a=0,e=r.pageX,t=r.pageY,o=!1,s&&s._doMouseDown&&s._doMouseDown(e,t,l,i,n,a)},this._docMouseMove=function(u){if(d){if(u=jQuery.event.fix(u||window.event),l=u.pageX,i=u.pageY,!o&&(Math.abs(n)>r||Math.abs(a)>r))return o=!0,e=l,t=i,void(s&&s._doDragStart&&s._doDragStart(e,t));n=l-e,a=i-t,o?s&&s._doDragging&&s._doDragging(e,t,l,i,n,a):(s&&s._doMouseMove&&s._doMouseMove(e,t,l,i,n,a),e=l,t=i)}},this._docMouseUp=function(r){d=!1,o?(o=!1,s&&s._doDragEnd&&s._doDragEnd(e,t,l,i,n,a)):s&&s._doMouseUp&&s._doMouseUp(e,t,l,i,n,a),u.unbindControl()},this._docKeydown=function(e){e=jQuery.event.fix(e||window.event),27==e.which&&o&&(o=!1,s&&s._doDragCancel&&(s._doDragCancel(),u.unbindControl()))},this._docSelectStart=function(e){return e=jQuery.event.fix(e||window.event),e.preventDefault(),!1},this.bindControl=function(e){s=e;var t=jQuery(document);t.on("mousedown",this._docMouseDown),t.on("mouseup",this._docMouseUp),t.on("mousemove",this._docMouseMove),t.on("selectstart",this._docSelectStart),t.on("keydown",this._docKeydown)},this.unbindControl=function(){var e=jQuery(document);e.off("mousedown",this._docMouseDown),e.off("mouseup",this._docMouseUp),e.off("mousemove",this._docMouseMove),e.off("selectstart",this._docSelectStart),e.off("keydown",this._docKeydown),s=null}},jslet.ui.dnd=new jslet.ui.DnD,jslet.ui||(jslet.ui={}),jslet.ui.EditMask=function(){this._mask=null,this._keepChar=!0,this._transform=null,this._literalChars=null,this._parsedMask=null,this._format=null,this._target=null,this._buffer=null},jslet.ui.EditMask.prototype={maskChars:{"#":{regexpr:new RegExp("[0-9\\-]"),required:!1},0:{regexpr:new RegExp("[0-9]"),required:!0},9:{regexpr:new RegExp("[0-9]"),required:!1},L:{regexpr:new RegExp("[A-Za-z]"),required:!0},l:{regexpr:new RegExp("[A-Za-z]"),required:!1},A:{regexpr:new RegExp("[0-9a-zA-Z]"),required:!0},a:{regexpr:new RegExp("[0-9a-zA-Z]"),required:!1},C:{regexpr:null,required:!0},c:{regexpr:null,required:!1}},transforms:["upper","lower"],setMask:function(e,t,l){if(e=jQuery.trim(e),jslet.Checker.test("EditMask#mask",e).isString(),this._mask=e,this._keepChar=!!t,this._transform=null,l){var i=jslet.Checker.test("EditMask#transform",l).isString();l=jQuery.trim(l),l=l.toLowerCase(),i.inArray(this.transforms),this._transform=l}this._parseMask()},attach:function(e){jslet.Checker.test("EditMask.attach#target",e).required();var t=this,l=jQuery(e);t._target=e,l.on("keypress.editmask",function(e){if(this.readOnly||!t._mask)return!0;var l=e.which;return 0===l?!0:t._doKeypress(l)?!0:void e.preventDefault()}),l.on("keydown.editmask",function(e){return this.readOnly||!t._mask?!0:t._doKeydown(e.which)?!0:void e.preventDefault()}),l.on("blur.editmask",function(e){return this.readOnly||!t._mask?!0:t._doBur()?!0:(e.preventDefault(),void e.currentTarget.focus())}),l.on("cut.editmask",function(e){return this.readOnly||!t._mask?!0:(t._doCut(e.originalEvent.clipboardData||window.clipboardData),e.preventDefault(),!1)}),l.on("paste.editmask",function(e){return this.readOnly||!t._mask?!0:void(t._doPaste(e.originalEvent.clipboardData||window.clipboardData)||e.preventDefault())})},detach:function(){var e=jQuery(this._target);e.off("keypress.editmask"),e.off("keydown.editmask"),e.off("blur.editmask"),e.off("cut.editmask"),e.off("paste.editmask"),this._target=null},setValue:function(e){if(e=jQuery.trim(e),jslet.Checker.test("EditMask.setValue#value",e).isString(),e=e?e:"",!this._mask)return void(this._target.value=e);var t=this;t._clearBuffer(0);var l,i,n,a,s,r,o=0,d=0,u=0;for(t._parsedMask.length;;){if(r=t._getFixedCharAndPos(o),l=r.pos,a=r.ch,0>l&&(l=o),!a){i=0;var c,h=t._buffer.length;for(n=o;h>n&&(c=e.charAt(d+i),c);n++)t._buffer[n]=c,i++;break}for(u=e.indexOf(a,d),0>u&&(u=e.length),i=-1,n=u-1;n>=d;n--)s=e.charAt(n),t._buffer[i+l]=s,i--;d=u+1,o=l+1}t._showValue()},getValue:function(){var e=this._target.value;if(this._keepChar)return e;for(var t,l=[],i=0,n=e.length;n>i;i++)t=this._parsedMask[i],t.isMask&&l.push(e.charAt(i));return l.join("")},validateValue:function(){for(var e,t=this,l=t._parsedMask.length,i=0;l>i;i++)if(e=t._parsedMask[i],e.isMask&&t.maskChars[e.ch].required&&t._buffer[i]==t._format[i])return!1;return!0},_getFixedCharAndPos:function(e){var t=this;if(!t._literalChars||0===t._literalChars.length)return{pos:0,ch:null};e||(e=0);for(var l,i,n=e,a=t._parsedMask.length;a>n;n++)if(i=t._parsedMask[n],!i.isMask&&(l=i.ch,t._literalChars.indexOf(l)>=0))return{ch:l,pos:n};return{pos:-1,ch:null}},_parseMask:function(){var e=this;if(!e._mask)return void(e._parsedMask=null);e._parsedMask=[],e._format=[];for(var t,l,i=null,n=0,a=e._mask.length;a>n;n++)if(t=e._mask.charAt(n),"\\"!=t){if(l=!1,void 0===e.maskChars[t]?(i&&e._parsedMask.push({ch:i,isMask:l}),e._parsedMask.push({ch:t,isMask:l})):(l=!i,e._parsedMask.push({ch:t,isMask:l})),e._keepChar&&!l){e._literalChars||(e._literalChars=[]);for(var s=!0,r=0,o=e._literalChars.length;o>r;r++)if(e._literalChars[r]==t){s=!1;break}s&&e._literalChars.push(t)}i=null,e._format.push(l?"_":t)}else i=t;e._buffer=e._format.slice(0),e._target&&(e._target.value=e._format.join(""))},_validateChar:function(e,t){var l=this.maskChars[e],i=l.regexpr;return i?i.test(t):!0},_getValidPos:function(e,t){var l,i=this,n=i._parsedMask.length;if(e>=n)return n-1;if(t){for(l=e;l>=0;l--)if(i._parsedMask[l].isMask)return l;for(l=e;n>l;l++)if(i._parsedMask[l].isMask)return l}else{for(l=e;n>l;l++)if(i._parsedMask[l].isMask)return l;for(l=e;l>=0;l--)if(i._parsedMask[l].isMask)return l}return-1},_clearBuffer:function(e,t){if(this._buffer){t||(t=this._buffer.length-1);for(var l=e;t>=l;l++)this._buffer[l]=this._format[l]}},_packEmpty:function(e,t){var l,i,n=0,a=this;for(i=e;i>=0;i--)if(l=a._format[i],a._literalChars&&a._literalChars.indexOf(l)>=0){n=i;break}e=n;var s=[];for(i=e;t>i;i++)l=a._buffer[i],l!=a._format[i]&&s.push(l);var r=s.length-1;for(i=t-1;i>=e;i--)r>=0?(a._buffer[i]=s[r],r--):a._buffer[i]=a._format[i]},_updateBuffer:function(e,t){var l=e.begin,i=e.end,n=this;if(l=n._getValidPos(l),0>l)return-1;if(n._clearBuffer(l+1,i),!(n._literalChars&&n._literalChars.indexOf(t)>=0)){var a=n._parsedMask[l];return n._validateChar(a.ch,t)?(n._buffer[l]=t,l):-1}for(var s=l,r=n._parsedMask.length;r>s;s++)if(n._parsedMask[s].ch==t)return n._packEmpty(l,s),s},_moveCursor:function(e,t){e=this._getValidPos(e,t),e>=0&&jslet.ui.textutil.setCursorPos(this._target,e)},_showValue:function(){this._target.value=this._buffer.join("")},_doKeypress:function(e){if(13==e)return!0;var t=String.fromCharCode(e),l=this;"upper"==l._transform?t=t.toUpperCase():"lower"==l._transform&&(t=t.toLowerCase());var i=jslet.ui.textutil.getCursorPos(l._target),n=l._updateBuffer(i,t);return l._showValue(),n>=0?l._moveCursor(n+1):l._moveCursor(i.begin),!1},_doKeydown:function(e){var t=this,l=jslet.ui.textutil.getCursorPos(t._target),i=l.begin,n=l.end;if(229==e){var a=t._parsedMask.legnth>i;if(a){var s=t._parsedMask[i];if(a=s.isMask){var r=s.ch;a="c"==r||"C"==r}}a||window.setTimeout(function(){t._showValue(),t._moveCursor(i)},50)}return 13==e?!0:8==e?(i==n&&(i=t._getValidPos(--i,!0),n=i),t._clearBuffer(i,n),t._showValue(),t._moveCursor(i,!0),!1):27==e?!1:46==e?(t._clearBuffer(i,n-1),t._showValue(),t._moveCursor(i),!1):!0},_doBur:function(){for(var e,t,l=this,i=0,n=l._parsedMask.length;n>i;i++)if(e=l._parsedMask[i],e.isMask&&(t=e.ch,l.maskChars[t].required&&l._buffer[i]==l._format[i]))return!0;return!0},_doCut:function(e){var t=this,l=jslet.ui.textutil.getSelectedText(t._target),i=jslet.ui.textutil.getCursorPos(t._target),n=i.begin;return t._clearBuffer(n,i.end-1),t._showValue(),t._moveCursor(n,!0),e.setData("Text",l),!1},_doPaste:function(e){var t=e.getData("Text");if(!t)return!1;var l,i=jslet.ui.textutil.getCursorPos(this._target),n=0;i.end=i.begin;for(var a=0;a<t.length;a++)l=t.charAt(a),n=this._updateBuffer(i,l),i.begin=a,i.end=i.begin;return this._showValue(),n>=0&&this._moveCursor(n+1),!0}},jslet.ui.textutil={selectText:function(e,t,l){var i=e.value;if(i.length>0)if(t=void 0===t?0:t,l=void 0===l?i.length:l,e.setSelectionRange)e.setSelectionRange(t,l);else if(e.createTextRange){var n=e.createTextRange();n.moveStart("character",t),n.moveEnd("character",l-i.length),n.select()}},getSelectedText:function(e){if(e.setSelectionRange){var t=e.selectionStart,l=e.selectionEnd;return e.value.substring(t,l)}return document.selection&&document.selection.createRange?document.selection.createRange().text:void 0},getCursorPos:function(e){var t={begin:0,end:0};if(e.setSelectionRange)t.begin=e.selectionStart,t.end=e.selectionEnd;else if(document.selection&&document.selection.createRange){var l=document.selection.createRange();t.begin=0-l.duplicate().moveStart("character",-1e5),t.end=t.begin+l.text.length}return t},setCursorPos:function(e,t){if(e.setSelectionRange)e.focus(),e.setSelectionRange(t,t);else if(e.createTextRange){var l=e.createTextRange();l.collapse(!0),l.moveEnd("character",t),l.moveStart("character",t),l.select()}}},jslet.ui||(jslet.ui={}),jslet.ui.FocusManager=function(){this._onChangingFocus=null,this._focusKeyCode=null,this._containerIds=null,this._activeDataset=null,this._activeField=null,this._activeValueIndex=null,this._initialize()},jslet.ui.FocusManager.prototype={onChangingFocus:function(e){return void 0===e?this._onChangingFocus:(jslet.Checker.test("FocusManager.onChangingFocus",e).isFunction(),void(this._onChangingFocus=e))},focusKeyCode:function(e){return void 0===e?this._focusKeyCode:(jslet.Checker.test("FocusManager.focusKeyCode",e).isNumber(),void(this._focusKeyCode=e))},pushContainer:function(e){jslet.Checker.test("FocusManager.pushContainer#containerId",e).required().isString(),null===this._containerIds&&(this._containerIds=[]),this._containerIds.push(e)},popContainer:function(e){jslet.Checker.test("FocusManager.pushContainer#containerId",e).required().isString(),this._containerIds[this._containerIds.length-1]==e&&this._containerIds.pop()},activeDataset:function(e){return void 0===e?this._activeDataset:(jslet.Checker.test("FocusManager.activeDataset",e).isString(),this._activeDataset=e,this)},activeField:function(e){return void 0===e?this._activeField:(jslet.Checker.test("FocusManager.activeField",e).isString(),this._activeField=e,this)},activeValueIndex:function(e){return void 0===e?this._activeValueIndex:(jslet.Checker.test("FocusManager.activeValueIndex",e).isNumber(),this._activeValueIndex=e,this)},tabPrev:function(){jQuery.tabPrev(this._getContainer(),!0,jQuery.proxy(this._doChangingFocus,this))},tabNext:function(){jQuery.tabNext(this._getContainer(),!0,jQuery.proxy(this._doChangingFocus,this))},_getContainer:function(){var e,t=this;if(t._containerIds&&t._containerIds.length>0){var l=t._containerIds[t._containerIds.length-1];if(e=jQuery("#"+l),0===e.length)throw new Error("Not found container: "+l)}else e=jQuery(document);return e},_doChangingFocus:function(e,t){var l=this,i=jslet.data.getDataset(l._activeDataset),n=i&&i.mergedFocusedFields();if(l._onChangingFocus){var a=l._onChangingFocus(e,t,i,l._activeField,n,l._activeValueIndex);if(!a)return!1}if(!l._activeDataset&&!l._activeField)return!0;if(!i||!i.focusedFields())return!0;var s=n.indexOf(l._activeField);if(0>s)return!0;if(t){if(0===s)return!0;i.focusEditControl(n[s-1])}else{if(s===n.length-1)return!0;i.focusEditControl(n[s+1])}return!1},_initialize:function(){function e(e){var t=e.tagName;if("TEXTAREA"==t||"A"==t||"BUTTON"==t)return!1;if("INPUT"==t){var l=e.type;if("button"==l||"image"==l||"reset"==l||"submit"==l||"url"==l||"file"==l)return!1}return!0}function t(t){var i=l._focusKeyCode||jslet.global.defaultFocusKeyCode||9,n=t.which;if(n===i||9===n){if(9!==n&&!e(t.target))return;return t.shiftKey?l.tabPrev():l.tabNext(),t.preventDefault(),t.stopImmediatePropagation(),!1}}var l=this;jQuery(document).keydown(t)}},jslet.ui.focusManager=new jslet.ui.FocusManager,function(e){function t(t,l,n,a){l||(l=document);var s=jQuery(l).find(t);i(s);var r=e(":focus"),o=0,d=null;if(1===r.length){d=r[0];var u=s.index(r);u+1<s.length?o=u+1:n&&(o=0)}var c=!0;if(a&&d&&(c=a(d,!1)),c){var h=s.eq(o);return h.focus(),h[0]}return d}function l(t,l,n,a){l||(l=document);var s=jQuery(l).find(t);i(s);var r=e(":focus"),o=s.length-1,d=null;if(1===r.length){d=r[0];var u=s.index(r);u>0?o=u-1:n&&(o=s.length-1)}var c=!0;if(a&&d&&(c=a(d,!0)),c){var h=s.eq(o);return h.focus(),h[0]}return d}function i(e){if(e)for(var t,l,i,n=1,a=e.length;a>n;n++){t=e[n],i=0;for(var s=n-1;s>=0;s--)if(l=e[s],l.tabIndex<=t.tabIndex){i=s+1;break}n!==i&&(e.splice(n,1),e.splice(i,0,t))}}function n(t){function l(t){return e.expr.filters.visible(t)&&!e(t).parents().addBack().filter(function(){return"hidden"===e.css(this,"visibility")}).length}var i,n,a,s=t.nodeName.toLowerCase(),r=!isNaN(e.attr(t,"tabindex"));return"area"===s?(i=t.parentNode,n=i.name,t.href&&n&&"map"===i.nodeName.toLowerCase()?(a=e("img[usemap=#"+n+"]")[0],!!a&&l(a)):!1):(/input|select|textarea/.test(s)?!t.disabled:"a"===s?t.href||r:r)&&l(t)}e.focusNext=function(e,l,i){t(":focusable",e,l,i)},e.focusPrev=function(e,t,i){return l(":focusable",e,t,i)},e.tabNext=function(e,l,i){return t(":tabbable",e,l,i)},e.tabPrev=function(e,t,i){return l(":tabbable",e,t,i)},e.extend(e.expr[":"],{data:e.expr.createPseudo?e.expr.createPseudo(function(t){return function(l){return!!e.data(l,t)}}):function(t,l,i){return!!e.data(t,i[3])},focusable:function(t){return n(t,!isNaN(e.attr(t,"tabindex")))},tabbable:function(t){var l=e.attr(t,"tabindex"),i=isNaN(l);return(i||l>=0)&&n(t,!i)}})}(jQuery),jslet.ResizeEventBus=function(){var e=null;this.resize=function(t){e&&window.clearTimeout(e),e=setTimeout(function(){var l,i,n;l=t?jQuery(t).find("*[data-jslet-resizable]"):jQuery("*[data-jslet-resizable]"),jslet.ui._activePopup&&jslet.ui._activePopup.hide();for(var a=0,s=l.length;s>a;a++)i=l[a],i&&(n=i.jslet,n&&n.checkSizeChanged&&n.checkSizeChanged());e=null},100)},this.subscribe=function(e){if(!e||!e.el)throw new Error("ctrlObj required!");jQuery(e.el).attr(jslet.ResizeEventBus.RESIZABLE,!0)},this.unsubscribe=function(e){if(!e||!e.el)throw new Error("ctrlObj required!");jQuery(e.el).removeAttr(jslet.ResizeEventBus.RESIZABLE)}},jslet.ResizeEventBus.RESIZABLE="data-jslet-resizable",jslet.resizeEventBus=new jslet.ResizeEventBus,jQuery(window).on("resize",function(){jslet.resizeEventBus.resize()}),jslet.ui||(jslet.ui={}),jslet.ui.htmlclass={},jslet.ui.GlobalZIndex=100,jslet.ui.KeyCode={BACKSPACE:8,TAB:9,ENTER:13,SHIFT:16,CONTROL:17,ALT:18,CAPSLOCK:20,ESCAPE:27,SPACE:32,PAGEUP:33,PAGEDOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,INSERT:45,DELETE:46,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,IME:229};for(var e=65;90>e;e++)jslet.ui.KeyCode[String.fromCharCode(e)]=e;return jslet.ui.PopupPanel=function(){this.onHidePopup=null,this.isShowing=!1,this.documentClickHandler=function(e){e=jQuery.event.fix(e||window.event);var t=e.target;jslet.ui.isChild(jslet.ui.PopupPanel.excludedElement,t)||jslet.ui.inPopupPanel(t)||jslet.ui._activePopup&&jslet.ui._activePopup.hide()},this._stopMouseEvent=function(e){e.stopImmediatePropagation(),e.preventDefault()},this._createPanel=function(){if(!jslet.ui._popupPanel){var e=document.createElement("div");e.style.display="none",e.className="jl-popup-panel jl-opaque jl-border-box dropdown-menu",e.style.position="absolute",e.style.zIndex=99e3,document.body.appendChild(e),jQuery(document).on("click",this.documentClickHandler),jslet.ui._popupPanel=e}},this.show=function(e,t,l,i,n,a){this._createPanel(),e=parseInt(e),t=parseInt(t),i&&(jslet.ui._popupPanel.style.height=parseInt(i)+"px"),l&&(jslet.ui._popupPanel.style.width=parseInt(l)+"px");var s=jQuery(window),r=s.scrollLeft()+s.width(),o=s.scrollTop()+s.height(),d=jQuery(jslet.ui._popupPanel),u=d.outerWidth(),c=d.outerHeight();jslet.locale.isRtl&&(e-=u),e+u>r&&(e+=r-e-u-1),t+c>o&&(t-=c+2+a),0>e&&(e=1),0>t&&(t=1),t&&(jslet.ui._popupPanel.style.top=t+"px"),e&&(jslet.ui._popupPanel.style.left=e+"px"),jslet.ui._popupPanel.style.display="block";var h=jslet.ui._popupShadow;h&&(h.style.width=u+"px",h.style.height=c+"px",h.style.top=t+2+"px",h.style.left=e+2+"px",h.style.display="block"),jslet.ui._activePopup=this,this.isShowing=!0},this.setContent=function(e,t,l){this._createPanel();var i=jslet.ui._popupPanel.childNodes[0];i&&jslet.ui._popupPanel.removeChild(i),jslet.ui._popupPanel.appendChild(e),e.style.border="none",t&&(e.style.width=t),l&&(e.style.height=l)},this.getPopupPanel=function(){return this._createPanel(),jslet.ui._popupPanel},this.destroy=function(){jslet.ui._popupPanel&&(this.isShowing=!1,document.body.removeChild(jslet.ui._popupPanel),jslet.ui._popupShadow&&document.body.removeChild(jslet.ui._popupShadow),jQuery(this._popupPanel).off(),jslet.ui._popupPanel=null,jslet.ui._popupShadow=null,this.onHidePopup=null,jQuery(document).off("click",this.documentClickHandler))},this.hide=function(){jslet.ui._popupPanel&&(jslet.ui._popupPanel.style.display="none",jslet.ui._popupShadow&&(jslet.ui._popupShadow.style.display="none")),this.onHidePopup&&this.onHidePopup(),this.isShowing=!1,delete jslet.ui._activePopup}},jslet.ui.inPopupPanel=function(e){return e&&e!=document?jQuery(e).hasClass("jl-popup-panel")?!0:jslet.ui.inPopupPanel(e.parentNode):!1},jslet.ui.getParentElement=function(e,t){t||(t=1);for(var l=!!e.parentElement,i=e,n=0;t>n;n++)if(i=l?i.parentElement:i.parentNode,!i)return null;return i},jslet.ui.findFirstParent=function(e,t,l){var i=e;return i?t?t(i)?i:l&&l(i.parentNode)?null:jslet.ui.findFirstParent(i.parentNode,t,l):i.parentNode:null},jslet.ui.findJsletParent=function(e){return jslet.ui.findFirstParent(e,function(e){return!!e.jslet})},jslet.ui.isChild=function(e,t){if(!e||!t)return!1;for(var l=t;l;){if(l==e)return!0;l=l.parentNode}return!1},jslet.ui.TextMeasurer=function(){function e(e){n!=e&&(t.innerHTML=e)}var t,l,i=document.body,n=null,a=function(){t||(t=document.createElement("div"),document.body.appendChild(t),t.style.position="absolute",t.style.left="-9999px",t.style.top="-9999px",t.style.display="none",t.style.margin="0px",t.style.padding="0px",t.style.overflow="hidden"),i||(i=document.body)};this.setElement=function(e){i=e,i&&(a(),t.style.fontSize=i.style.fontSize,t.style.fontStyle=i.style.fontStyle,t.style.fontWeight=i.style.fontWeight,t.style.fontFamily=i.style.fontFamily,t.style.lineHeight=i.style.lineHeight,t.style.textTransform=i.style.textTransform,t.style.letterSpacing=i.style.letterSpacing)},this.setElementWidth=function(e){l=e,i&&(e?i.style.width=e:i.style.width="")},this.getSize=function(l){a(),e(l);var i=jQuery(t);return{width:i.width(),height:i.height()}},this.getWidth=function(e){return this.getSize(e).width},this.getHeight=function(e){return this.getSize(e).height}},jslet.ui.textMeasurer=new jslet.ui.TextMeasurer,jslet.ui.getCssValue=function(e,t){var l=document.createElement("div");l.className=e,l.style.display="none",document.body.appendChild(l);var i=jQuery(l).css(t);return document.body.removeChild(l),i},jslet.ui.setEditableStyle=function(e,t,l,i,n){i||(e.disabled=t,e.readOnly=l);var a=jQuery(e);t||l?a.hasClass("jl-readonly")||(a.addClass("jl-readonly"),a.removeClass("jl-ctrl-required")):(a.removeClass("jl-readonly"),n&&a.addClass("jl-ctrl-required"))},jslet.scrollbarSize=function(){var e,t,l;return void 0===l&&(e=jQuery('<div style="width:50px;height:50px;overflow:auto"><div/></div>').appendTo("body"),t=e.children(),l=t.innerWidth()-t.height(99).innerWidth(),e.remove()),l},jslet.ui.Accordion=jslet.Class.create(jslet.ui.Control,{initialize:function($super,e,t){var l=this;l.el=e,l.allProperties="styleClass,selectedIndex,onChanged,items",l._selectedIndex=0,l._onChanged=null,l._items=null,$super(e,t)},selectedIndex:function(e){return void 0===e?this._selectedIndex:(jslet.Checker.test("Accordion.selectedIndex",e).isGTEZero(),void(this._selectedIndex=e))},onChanged:function(e){return void 0===e?this._onChanged:(jslet.Checker.test("Accordion.onChanged",e).isFunction(),void(this._onChanged=e))},items:function(e){if(void 0===e)return this._items;jslet.Checker.test("Accordion.items",e).isArray();for(var t,l=0,i=e.length;i>l;l++)t=e[l],jslet.Checker.test("Accordion.items.caption",t.caption).isString().required();this._items=e},bind:function(){this.renderAll()},renderAll:function(){var e=this,t=jQuery(e.el);t.hasClass("jl-accordion")||t.addClass("jl-accordion jl-border-box jl-round5");var l,i=t.find(">div"),n=0,a=e._items?e._items.length-1:-1;i.before(function(t){return l=a>=t?e._items[t].caption:"caption"+t,'<button class="btn btn-default jl-accordion-head btn-sm" jsletindex = "'+t+'">'+l+"</button>"});var s=t.find(">.jl-accordion-head");s.click(e._doCaptionClick),n=s.outerHeight()*i.length;var r=t.innerHeight()-n-1;i.wrap('<div class="jl-accordion-body" style="height:'+r+'px;display:none"></div>'),e.setSelectedIndex(e._selectedIndex,!0)},_doCaptionClick:function(e){var t=jQuery(e.currentTarget),l=jslet.ui.findJsletParent(t[0]).jslet,i=parseInt(t.attr("jsletindex"));l.setSelectedIndex(i)},setSelectedIndex:function(e,t){e||(e=0);var l=this,i=jQuery(l.el).find(">.jl-accordion-body"),n=i.length-1;if(!(e>n)){if(l._selectedIndex==e&&n>e)return jQuery(i[e]).slideUp("fast"),(!t||t&&e>0)&&e++,jQuery(i[e]).slideDown("fast"),l._selectedIndex=e,void(l._onChanged&&l._onChanged.call(this,e));l._selectedIndex>=0&&l._selectedIndex!=e&&jQuery(i[l._selectedIndex]).slideUp("fast"),jQuery(i[e]).slideDown("fast"),l._selectedIndex=e,l._onChanged&&l._onChanged.call(this,e)}},destroy:function($super){var e=jQuery(this.el);e.find(">.jl-accordion-head").off(),$super()}}),jslet.ui.register("Accordion",jslet.ui.Accordion),jslet.ui.Accordion.htmlTemplate="<div></div>",jslet.ui.Calendar=jslet.Class.create(jslet.ui.Control,{initialize:function($super,e,t){var l=this;l.el=e,l.allProperties="styleClass,value,onDateSelected,minDate,maxDate",l._value=null,l._onDateSelected=null,l._minDate=null,l._maxDate=null,l._currYear=0,l._currMonth=0,l._currDate=0,$super(e,t)},value:function(e){return void 0===e?this._value:(jslet.Checker.test("Calendar.value",e).isDate(),void(this._value=e))},minDate:function(e){return void 0===e?this._minDate:(jslet.Checker.test("Calendar.minDate",e).isDate(),void(this._minDate=e))},maxDate:function(e){return void 0===e?this._maxDate:(jslet.Checker.test("Calendar.maxDate",e).isDate(),void(this._maxDate=e))},onDateSelected:function(e){return void 0===e?this._onDateSelected:(jslet.Checker.test("Calendar.onDateSelected",e).isFunction(),void(this._onDateSelected=e))},bind:function(){this.renderAll()},renderAll:function(){var e=this,t=jQuery(e.el);t.hasClass("jl-calendar")||t.addClass("jl-calendar panel panel-default");var l=['<div class="jl-cal-header">','<a class="jl-cal-btn jl-cal-yprev" title="',jslet.locale.Calendar.yearPrev,'" href="javascript:;">&lt;&lt;</a><a href="javascript:;" class="jl-cal-btn jl-cal-mprev" title="',jslet.locale.Calendar.monthPrev,'">&lt;','</a><a href="javascript:;" class="jl-cal-title"></a><a href="javascript:;" class="jl-cal-btn jl-cal-mnext" title="',jslet.locale.Calendar.monthNext,'">&gt;','</a><a href="javascript:;" class="jl-cal-btn jl-cal-ynext" title="',jslet.locale.Calendar.yearNext,'">&gt;&gt;</a>',"</div>",'<div class="jl-cal-body">','<table cellpadding="0" cellspacing="0">','<thead><tr><th class="jl-cal-weekend">',jslet.locale.Calendar.Sun,"</th><th>",jslet.locale.Calendar.Mon,"</th><th>",jslet.locale.Calendar.Tue,"</th><th>",jslet.locale.Calendar.Wed,"</th><th>",jslet.locale.Calendar.Thu,"</th><th>",jslet.locale.Calendar.Fri,'</th><th class="jl-cal-weekend">',jslet.locale.Calendar.Sat,"</th></tr></thead><tbody>",'<tr><td class="jl-cal-weekend"><a href="javascript:;"></a></td><td><a href="javascript:;"></a></td><td><a href="javascript:;"></a></td><td><a href="javascript:;"></a></td><td><a href="javascript:;"></a></td><td><a href="javascript:;"></a></td><td class="jl-cal-weekend"><a href="javascript:;"></a></td></tr>','<tr><td class="jl-cal-weekend"><a href="javascript:;"></a></td><td><a href="javascript:;"></a></td><td><a href="javascript:;"></a></td><td><a href="javascript:;"></a></td><td><a href="javascript:;"></a></td><td><a href="javascript:;"></a></td><td class="jl-cal-weekend"><a href="javascript:;"></a></td></tr>','<tr><td class="jl-cal-weekend"><a href="javascript:;"></a></td><td><a href="javascript:;"></a></td><td><a href="javascript:;"></a></td><td><a href="javascript:;"></a></td><td><a href="javascript:;"></a></td><td><a href="javascript:;"></a></td><td class="jl-cal-weekend"><a href="javascript:;"></a></td></tr>','<tr><td class="jl-cal-weekend"><a href="javascript:;"></a></td><td><a href="javascript:;" class="jl-cal-disable"></a></td><td><a href="javascript:;"></a></td><td><a href="javascript:;"></a></td><td><a href="javascript:;"></a></td><td><a href="javascript:;"></a></td><td class="jl-cal-weekend"><a href="javascript:;"></a></td></tr>','<tr><td class="jl-cal-weekend"><a href="javascript:;"></a></td><td><a href="javascript:;" class="jl-cal-disable"></a></td><td><a href="javascript:;"></a></td><td><a href="javascript:;"></a></td><td><a href="javascript:;"></a></td><td><a href="javascript:;"></a></td><td class="jl-cal-weekend"><a href="javascript:;"></a></td></tr>','<tr><td class="jl-cal-weekend"><a href="javascript:;"></a></td><td><a href="javascript:;"></a></td><td><a href="javascript:;"></a></td><td><a href="javascript:;"></a></td><td><a href="javascript:;"></a></td><td><a href="javascript:;"></a></td><td class="jl-cal-weekend"><a href="javascript:;"></a></td></tr>','</tbody></table></div><div class="jl-cal-footer"><a class="jl-cal-today" href="javascript:;">',jslet.locale.Calendar.today,"</a></div>"];
t.html(l.join(""));var i=t.find(".jl-cal-body table");e._currYear=-1,i.on("click",e._doTableClick);var n=e._value&&jslet.isDate(e._value)?e._value:new Date;this.setValue(n),t.find(".jl-cal-today").click(function(t){var l=new Date;e.setValue(new Date(l.getFullYear(),l.getMonth(),l.getDate())),e._fireSelectedEvent()}),t.find(".jl-cal-yprev").click(function(t){e.incYear(-1)}),t.find(".jl-cal-mprev").click(function(t){e.incMonth(-1)}),t.find(".jl-cal-ynext").click(function(t){e.incYear(1)}),t.find(".jl-cal-mnext").click(function(t){e.incMonth(1)}),t.on("keydown",function(t){var l=t.ctrlKey,i=t.keyCode;return i==jslet.ui.KeyCode.UP?(l?e.incYear(-1):e.incDate(-7),void t.preventDefault()):i==jslet.ui.KeyCode.DOWN?(l?e.incYear(1):e.incDate(7),void t.preventDefault()):i==jslet.ui.KeyCode.LEFT?(l?e.incMonth(-1):e.incDate(-1),void t.preventDefault()):i==jslet.ui.KeyCode.RIGHT?(l?e.incMonth(1):e.incDate(1),void t.preventDefault()):void 0})},_getNotNullDate:function(){var e=this._value;return e||(e=new Date),e},incDate:function(e){var t=this._getNotNullDate();t.setDate(t.getDate()+e),this.setValue(t)},incMonth:function(e){var t=this._getNotNullDate(),l=t.getDate();if(t.setMonth(t.getMonth()+e),l>=29){var i=t.getDate();l!=i&&(t=new Date(t.getFullYear(),t.getMonth(),1)-864e5,t=new Date(t))}this.setValue(t)},incYear:function(e){var t=this._getNotNullDate(),l=t.getDate();if(t.setFullYear(t.getFullYear()+e),l>=29){var i=t.getDate();l!=i&&(t=new Date(t.getFullYear(),t.getMonth(),1)-864e5,t=new Date(t))}this.setValue(t)},_innerSetValue:function(e){var t=this,l=t._getNotNullDate();e&&l.setFullYear(e.getFullYear(),e.getMonth(),e.getDate()),t._value=l},setValue:function(e){if(e){var t=this;t._minDate&&e<t._minDate&&(e=new Date(t._minDate.getTime())),t._maxDate&&e>t._maxDate&&(e=new Date(t._maxDate.getTime())),t._innerSetValue(e);var l=e.getFullYear(),i=e.getMonth();t._currYear==l&&t._currMonth==i?t._setCurrDateCls():t._refreshDateCell(l,i)}},focus:function(){var e=this,t=jQuery(e.el);t.find(".jl-cal-current")[0].focus()},_checkNaviState:function(){var e,t,l=this,i=jQuery(l.el);if(l._minDate){var n=l._minDate.getFullYear(),a=l._minDate.getMonth(),s=i.find(".jl-cal-yprev")[0];e=l._currYear<=n,s.style.visibility=e?"hidden":"visible",e=l._currYear==n&&l._currMonth<=a;var r=i.find(".jl-cal-mprev")[0];r.style.visibility=e?"hidden":"visible",e=l._minDate>new Date,t=i.find(".jl-cal-today")[0],t.style.visibility=e?"hidden":"visible"}if(l._maxDate){var o=l._maxDate.getFullYear(),d=l._maxDate.getMonth(),u=i.find(".jl-cal-ynext")[0];e=l._currYear>=o,u.jslet_disabled=e,u.style.visibility=e?"hidden":"visible",e=l._currYear==o&&l._currMonth>=d;var c=i.find(".jl-cal-mnext")[0];c.jslet_disabled=e,c.style.visibility=e?"hidden":"visible",e=l._maxDate<new Date,t=i.find(".jl-cal-today")[0],t.style.visibility=e?"hidden":"visible"}},_refreshDateCell:function(e,t){var l=this,i=jQuery(l.el),n=jslet.locale.Calendar.monthNames,a=n[t],s=i.find(".jl-cal-title")[0];s.innerHTML=a+","+e;var r=i.find(".jl-cal-body table")[0],o=r.tBodies[0].rows,d=new Date(e,t,1),u=d.getDay(),c=864e5,h=new Date(d.getTime()-(u+1)*c);h=new Date(h.getFullYear(),h.getMonth(),h.getDate());for(var f,p,v,_,C=o.length,j=1;C>=j;j++){f=o[j-1];for(var m=1,g=f.cells.length;g>=m;m++)p=f.cells[m-1],h=new Date(h.getTime()+c),_=p.firstChild,l._minDate&&h<l._minDate||l._maxDate&&h>l._maxDate?(_.innerHTML="",p.jslet_date_value=null):(_.innerHTML=h.getDate(),p.jslet_date_value=h,v=h.getMonth(),v!=t?jQuery(p).addClass("jl-cal-disable"):jQuery(p).removeClass("jl-cal-disable"))}l._currYear=e,l._currMonth=t,l._setCurrDateCls(),l._checkNaviState()},_fireSelectedEvent:function(){var e=this;e._onDateSelected&&e._onDateSelected.call(e,e._value)},_doTableClick:function(e){e=jQuery.event.fix(e||window.event);var t=e.target,l=t.parentNode;if(l&&l.tagName&&"td"==l.tagName.toLowerCase()){if(!l.jslet_date_value)return;var i=jslet.ui.findFirstParent(l,function(e){return e.jslet}),n=i.jslet;n._innerSetValue(l.jslet_date_value),n._setCurrDateCls();try{l.firstChild.focus()}catch(a){}n._fireSelectedEvent()}},_setCurrDateCls:function(){var e=this;if(jslet.isDate(e._value))for(var t,l,i,n,a,s,r,o=e._value.getMonth(),d=e._value.getFullYear(),u=e._value.getDate(),c=jQuery(e.el),h=c.find(".jl-cal-body table")[0],f=h.tBodies[0].rows,p=f.length,v=0;p>v;v++){t=f[v];for(var _=0,C=t.cells.length;C>_;_++)if(l=t.cells[_],s=l.jslet_date_value)if(i=s.getMonth(),a=s.getFullYear(),n=s.getDate(),r=jQuery(l.firstChild),a==d&&i==o&&n==u){r.hasClass("jl-cal-current")||r.addClass("jl-cal-current");try{l.firstChild.focus()}catch(j){}}else r.removeClass("jl-cal-current")}},destroy:function($super){var e=jQuery(this.el);e.off(),e.find(".jl-cal-body table").off(),e.find(".jl-cal-today").off(),e.find(".jl-cal-yprev").off(),e.find(".jl-cal-mprev").off(),e.find(".jl-cal-mnext").off(),e.find(".jl-cal-ynext").off(),$super()}}),jslet.ui.register("Calendar",jslet.ui.Calendar),jslet.ui.Calendar.htmlTemplate="<div></div>",jslet.ui.FieldSet=jslet.Class.create(jslet.ui.Control,{initialize:function($super,e,t){var l=this;l.el=e,l.allProperties="styleClass,caption,collapsed",l._caption=null,l._collapsed=!1,$super(e,t)},caption:function(e){return void 0===e?this._caption:(jslet.Checker.test("FieldSet.caption",e).isString(),void(this._caption=e))},collapsed:function(e){return void 0===e?this._collapsed:void(this._collapsed=!!e)},bind:function(){this.renderAll()},renderAll:function(){var e=this,t=jQuery(e.el);t.hasClass("jl-fieldset")||t.addClass("jl-fieldset jl-round5");var l=['<legend class="jl-fieldset-legend">'];l.push('<span class="jl-fieldset-title"><i class="fa fa-chevron-circle-up jl-fieldset-btn">'),l.push("<span>"),l.push(e._caption),l.push('</span></span></legend><div class="jl-fieldset-body"></div>');var i,n,a=e.el.childNodes,s=[];for(n=a.length,i=0;n>i;i++)s.push(a[i]);t.html(l.join(""));var r=jQuery(e.el).find(".jl-fieldset-body")[0];for(n=s.length,i=0;n>i;i++)r.appendChild(s[i]);t.find(".jl-fieldset-btn").click(jQuery.proxy(e._doExpandBtnClick,this))},_doExpandBtnClick:function(){var e=this,t=jQuery(e.el),l=t.find(".jl-fieldset-body");e._collapsed?(l.slideDown(),t.removeClass("jl-fieldset-collapse"),t.find(".jl-fieldset-btn").removeClass("fa-chevron-circle-down")):(l.slideUp(),t.addClass("jl-fieldset-collapse"),t.find(".jl-fieldset-btn").addClass("fa-chevron-circle-down")),l[0].focus(),e._collapsed=!e._collapsed},destroy:function($super){var e=jQuery(this.el);e.find("input.jl-fieldset-btn").off(),$super()}}),jslet.ui.register("FieldSet",jslet.ui.FieldSet),jslet.ui.FieldSet.htmlTemplate="<fieldset></fieldset>",jslet.ui.menuManager={},jslet.ui.menuManager._menus=[],jslet.ui.menuManager.register=function(e){jslet.ui.menuManager._menus.push(e)},jslet.ui.menuManager.unregister=function(e){for(var t=0,l=this._menus.length;l>t;t++)jslet.ui.menuManager._menus.splice(t,1)},jslet.ui.menuManager.hideAll=function(e){for(var t,l,i=jslet.ui.menuManager._menus,n=0,a=i.length;a>n;n++)t=i[n],l=jslet("#"+t),l&&l.hide();jslet.ui.menuManager.menuBarShown=!1,jslet.ui.menuManager._contextObject=null},jQuery(document).on("mousedown",jslet.ui.menuManager.hideAll),jslet.ui.MenuBar=jslet.Class.create(jslet.ui.Control,{initialize:function($super,e,t){var l=this;l.el=e,l.allProperties="styleClass,onItemClick,items",l._onItemClick=null,l._items=null,$super(e,t)},onItemClick:function(e){return void 0===e?this._onItemClick:(jslet.Checker.test("MenuBar.onItemClick",e).isFunction(),void(this._onItemClick=e))},items:function(e){if(void 0===e)return this._items;jslet.Checker.test("MenuBar.items",e).isArray();for(var t,l=0,i=e.length;i>l;l++)t=e[l],jslet.Checker.test("MenuBar.items.name",t.name).isString().required();this._items=e},bind:function(){this.renderAll()},renderAll:function(){var e=this,t=jQuery(e.el);t.hasClass("jl-menubar")||t.addClass("jl-menubar jl-unselectable jl-bgcolor jl-round5"),e._createMenuBar(),t.on("mouseout",function(t){e._preHoverItem&&!jslet.ui.menuManager.menuBarShown&&jQuery(e._preHoverItem).removeClass("jl-menubar-item-hover")})},_createMenuBar:function(){var e=this;if(!e.isPopup)for(var t,l=0,i=e._items.length;i>l;l++)t=e._items[l],e._createBarItem(e.el,t,e._menubarclick)},_showSubMenu:function(e){var t=e.parentNode.jslet,l=e.jsletvar;if(l.items){if(!l.subMenu){var i=document.createElement("div");document.body.appendChild(i),l.subMenu=new jslet.ui.Menu(i,{onItemClick:t._onItemClick,items:l.items})}var n=jQuery(document.body),a=(parseInt(n.css("margin-top")),parseInt(n.css("margin-left")),jQuery(e)),s=a.offset(),r=s.left;jslet.locale.isRtl&&(r+=a.width()+10),l.subMenu.show(r,s.top+a.height()),jslet.ui.menuManager.menuBarShown=!0,t._activeMenuItem=e}},_createBarItem:function(e,t){if(void 0===t.visible||t.visible){var l=document.createElement("div");jQuery(l).addClass("jl-menubar-item"),l.jsletvar=t;var i=this,n=jQuery(l);n.on("click",function(e){var t=this.jsletvar;t.items?i._showSubMenu(this):(t.onClick?t.onClick.call(i,t.id||t.name):i._onItemClick&&i._onItemClick.call(i,t.id||t.name),jslet.ui.menuManager.hideAll()),e.stopPropagation(),e.preventDefault()}),n.on("mouseover",function(e){i._preHoverItem&&jQuery(i._preHoverItem).removeClass("jl-menubar-item-hover"),i._preHoverItem=this,jQuery(this).addClass("jl-menubar-item-hover"),jslet.ui.menuManager.menuBarShown&&(jslet.ui.menuManager.hideAll(),i._showSubMenu(this),jslet.ui.menuManager._inPopupMenu=!0)});var a=[];a.push('<a class="jl-focusable-item" href="javascript:void(0)">'),a.push(t.name),a.push("</a>"),l.innerHTML=a.join(""),e.appendChild(l)}},destroy:function($super){var e=this;e._activeMenuItem=null,e._preHoverItem=null,e._menubarclick=null,e._onItemClick=null;var t=jQuery(e.el);t.off(),t.find(".jl-menubar-item").off(),t.find(".jl-menubar-item").each(function(){var e=this;e.jsletvar&&(e.jsletvar.subMenu=null,e.jsletvar=null)}),$super()}}),jslet.ui.register("MenuBar",jslet.ui.MenuBar),jslet.ui.MenuBar.htmlTemplate="<div></div>",jslet.ui.Menu=jslet.Class.create(jslet.ui.Control,{_onItemClick:void 0,_items:void 0,_invoker:null,initialize:function($super,e,t){var l=this;l.el=e,l.allProperties="onItemClick,items,invoker",$super(e,t),l._activeSubMenu=null},onItemClick:function(e){return void 0===e?this._onItemClick:(jslet.Checker.test("Menu.onItemClick",e).isFunction(),void(this._onItemClick=e))},items:function(e){if(void 0===e)return this._items;jslet.Checker.test("Menu.items",e).isArray();for(var t,l=0,i=e.length;i>l;l++)t=e[l],jslet.Checker.test("Menu.items.name",t.name).isString().required();this._items=e},invoker:function(e){return void 0===e?this._invoker:void(this._invoker=e)},bind:function(){this.renderAll()},renderAll:function(){var e=this,t=jQuery(e.el),l=e.el;t.hasClass("jl-menu")||t.addClass("jl-menu"),l.style.display="none",l.id||(l.id=jslet.nextId()),jslet.ui.menuManager.register(l.id),e._createMenuPopup(),t.on("mousedown",function(e){return e=jQuery.event.fix(e||window.event),e.stopPropagation(),e.preventDefault(),!1}),t.on("mouseover",function(e){jslet.ui.menuManager._inPopupMenu=!0,jslet.ui.menuManager.timerId&&window.clearTimeout(jslet.ui.menuManager.timerId)}),t.on("mouseout",function(e){jslet.ui.menuManager._inPopupMenu=!1,jslet.ui.menuManager.timerId=window.setTimeout(function(){jslet.ui.menuManager._inPopupMenu||jslet.ui.menuManager.hideAll(),jslet.ui.menuManager.timerId=null},800)})},show:function(e,t){var l=this,i=jQuery(l.el),n=i.outerWidth(),a=i.outerHeight(),s=jQuery(window),r=s.scrollLeft()+s.width(),o=s.scrollTop()+s.height();e=e||l.left||10,t=t||l.top||10,jslet.locale.isRtl&&(e-=n),e+n>r&&(e+=r-e-n-1),t+a>o&&(t+=o-t-a-1),0>e&&(e=0),0>t&&(t=0),l.el.style.left=e+"px",l.el.style.top=parseInt(t)+"px",l.el.style.display="block",l.shadow||(l.shadow=document.createElement("div"),jQuery(l.shadow).addClass("jl-menu-shadow"),l.shadow.style.width=n+"px",l.shadow.style.height=a+"px",document.body.appendChild(l.shadow)),l.shadow.style.left=e+1+"px",l.shadow.style.top=t+1+"px",l.shadow.style.display="block"},hide:function(){this.ctxElement=null,this.el.style.display="none",this.shadow&&(this.shadow.style.display="none")},showContextMenu:function(e,t){jslet.ui.menuManager.hideAll(),e=jQuery.event.fix(e||window.event),jslet.ui.menuManager._contextObject=t,this.show(e.pageX,e.pageY),e.preventDefault()},_createMenuPopup:function(){var e,t,l,i,n=this.el,a=this._items;for(i=a.length,l=0;i>l;l++)e=a[l],e.name&&(t=e.name.trim(),"-"!=t?this._createMenuItem(n,e):this._createLine(n,e));var s,r=jQuery(n).width()-2+"px",o=n.childNodes;for(i=o.length,l=0;i>l;l++)s=o[l],1==s.nodeType&&(s.style.width=r);document.body.appendChild(n)},_ItemClick:function(e,t){if(t.items)return void this._showSubMenu(e,t);if(!t.disabled){var l=jslet.ui.menuManager._contextObject||this;t.onClick?t.onClick.call(l,t.id||t.name,t.checked):this._onItemClick&&this._onItemClick.call(l,t.id||t.name,t.checked),"check"!=t.itemType&&"radio"!=t.itemType||jslet.ui.Menu.setChecked(e,!t.checked),jslet.ui.menuManager.hideAll()}},_hideSubMenu:function(){var e=this;e._activeSubMenu&&(e._activeSubMenu._hideSubMenu(),e._activeSubMenu.hide(),e._activeSubMenu.el.style.zIndex=parseInt(jQuery(e.el).css("zIndex")))},_showSubMenu:function(e,t,l){var i=this,n=function(){if(i._hideSubMenu(),t.subMenu){var l=jQuery(e),n=l.offset(),a=n.left;jslet.locale.isRtl||(a+=l.width()),t.subMenu.show(a-2,n.top),t.subMenu.el.style.zIndex=parseInt(jQuery(i.el).css("zIndex"))+1,i._activeSubMenu=t.subMenu}};l?window.setTimeout(n,l):n()},_ItemOver:function(e,t){this._activeSubMenu&&this._showSubMenu(e,t,200)},_createMenuItem:function(e,t,l){var i=!1,n=!1,a=t.itemType;a&&(i="check"==a,n="radio"==a),i&&(t.iconClass="jl-menu-check",t.disabledIconClass="jl-menu-check-disabled"),n&&(t.iconClass="jl-menu-radio",t.disabledIconClass="jl-menu-radio-disabled"),t.items&&(t.disabled=!1);var s=document.createElement("div"),r=this,o=jQuery(s);o.addClass("jl-menu-item "+(t.disabled?"jl-menu-disabled":"jl-menu-enabled")),t.id||(t.id=jslet.nextId()),s.id=t.id,s.jsletvar=t,o.on("click",function(e){r._ItemClick(this,this.jsletvar),e.stopPropagation(),e.preventDefault()}),o.on("mouseover",function(e){r._ItemOver(this,this.jsletvar),r._preHoverItem&&jQuery(r._preHoverItem).removeClass("jl-menu-item-hover"),r._preHoverItem=this,this.jsletvar.disabled||jQuery(this).addClass("jl-menu-item-hover")}),o.on("mouseout",function(e){this.jsletvar.subMenu||jQuery(this).removeClass("jl-menu-item-hover")});var d=[];if(d.push('<span class="jl-menu-icon-placeholder '),(!i&&!n||t.checked)&&t.iconClass&&d.push(t.disabled&&t.disabledIconClass?t.disabledIconClass:t.iconClass),d.push('"></span>'),t.items&&d.push('<div class="jl-menu-arrow"></div>'),d.push('<a  href="javascript:void(0)" class="jl-focusable-item jl-menu-content '),d.push(" jl-menu-content-left jl-menu-content-right"),d.push('">'),d.push(t.name),d.push("</a>"),s.innerHTML=d.join(""),e.appendChild(s),t.items){var u=document.createElement("div");document.body.appendChild(u),t.subMenu=new jslet.ui.Menu(u,{onItemClick:r._onItemClick,items:t.items,invoker:s})}},_createLine:function(e,t){var l=document.createElement("div");jQuery(l).addClass("jl-menu-line"),e.appendChild(l)},destroy:function($super){var e=this,t=jQuery(e.el);e._activeSubMenu=null,jslet.ui.menuManager.unregister(e.el.id),t.off(),t.find(".jl-menu-item").each(function(){this.onmouseover=null,this.onclick=null,this.onmouseout=null}),$super()}}),jslet.ui.register("Menu",jslet.ui.Menu),jslet.ui.Menu.htmlTemplate="<div></div>",jslet.ui.Menu.setDisabled=function(e,t){var l;l=Object.isString(e)?jQuery("#"+e):jQuery(e);var i=l.context.jsletvar;i.items||(t?(l.removeClass("jl-menu-enabled"),l.addClass("jl-menu-disabled")):(l.removeClass("jl-menu-disabled"),l.addClass("jl-menu-enabled")),i.disabled=t)},jslet.ui.Menu.setChecked=function(e,t){var l;l="string"==typeof e?jQuery("#"+e):jQuery(e);var i=l.context,n=i.jsletvar,a=n.itemType;if("check"==a||"radio"==a){if("radio"==a){if(n.checked&&t||!t)return;for(var s,r,o,d=i.group,u=i.parentNode.childNodes,c=0,h=u.length;h>c;c++)s=u[c],s!=i&&(r=s.jsletvar,r&&"radio"==r.itemType&&r.group==d&&(o=s.childNodes[0],r.disabled?jQuery(o).removeClass(r.disabledIconClass):jQuery(o).removeClass(r.iconClass),r.checked=!1))}var f=jQuery(i.childNodes[0]);n.checked&&!t&&(n.disabled?f.removeClass(n.disabledIconClass):f.removeClass(n.iconClass)),!n.checked&&t&&(n.disabled?f.addClass(n.disabledIconClass):f.addClass(n.iconClass)),n.checked=t}},jslet.ui.OverlayPanel=function(e,t){var l=document.createElement("div");jQuery(l).addClass("jl-overlay").on("click",function(e){e=jQuery.event.fix(e||window.event);var t=e.target;jslet.ui.isChild(jslet.ui.PopupPanel.excludedElement,t)||jslet.ui.inPopupPanel(t)||(jslet.ui._activePopup&&jslet.ui._activePopup.hide(),e.stopPropagation(),e.preventDefault())}),t&&(l.style.backgroundColor=t);var i,n,a,s;if(e)a=jQuery(e).width(),s=jQuery(e).height();else{var r=jQuery(document.body);i=0,n=0,a=r.width(),s=r.height()}l.style.left="0px",l.style.top="0px",l.style.bottom="0px",l.style.right="0px",e?e.appendChild(l):document.body.appendChild(l),l.style.display="none";var o=null;e?(o=e.onresize,e.onresize=function(){var t=jQuery(e).width()-12,i=jQuery(e).height()-12;l.style.width=t+"px",l.style.height=i+"px"}):(o=window.onresize,window.onresize=function(){l.style.width=document.body.scrollWidth+"px",l.style.height=document.body.scrollHeight+"px"}),this.overlayPanel=l,this.show=function(){return l.style.display="block",l},this.hide=function(){return l.style.display="none",l},this.setZIndex=function(e){this.overlayPanel.style.zIndex=e},this.destroy=function(){this.hide(),e?(e.onresize=o,e.removeChild(l)):(window.onresize=o,document.body.removeChild(l)),jQuery(this.overlayPanel).off()}},jslet.ui.SplitPanel=jslet.Class.create(jslet.ui.Control,{directions:["hori","vert"],initialize:function($super,e,t){var l=this;l.el=e,l.allProperties="styleClass,direction,floatIndex,onExpanded,onSize",l._direction="hori",l._floatIndex=1,l._onExpanded=null,l._onSize=null,l.panels=null,l.splitter=null,l._oldSize=0,jslet.resizeEventBus.subscribe(l),$super(e,t)},floatIndex:function(e){return void 0===e?this._floatIndex:(jslet.Checker.test("SplitPanel.floatIndex",e).isGTEZero(),void(this._floatIndex=e))},direction:function(e){if(void 0===e)return this._direction;e=jQuery.trim(e);var t=jslet.Checker.test("SplitPanel.direction",e).required().isString();e=e.toLowerCase(),t.inArray(this.directions),this._direction=e},onExpanded:function(e){return void 0===e?this._onExpanded:(jslet.Checker.test("SplitPanel.onExpanded",e).isFunction(),void(this._onExpanded=e))},onSize:function(e){return void 0===e?this._onSize:(jslet.Checker.test("SplitPanel.onSize",e).isFunction(),void(this._onSize=e))},bind:function(){this.renderAll()},renderAll:function(){var e=this,t=jQuery(e.el);t.hasClass("jl-splitpanel")||t.addClass("jl-splitpanel jl-border-box jl-round5"),e.isHori="hori"==e._direction,e.width=t.innerWidth(),e.height=t.innerHeight(),e._oldSize=e.isHori?e.width:e.height;var l=t.find(">div"),i=l.length-1;(!e._floatIndex||e._floatIndex>i)&&(e._floatIndex=i),e._floatIndex>i&&(e._floatIndex=i),e.panels||(e.panels=[]);var n=e.isHori?e.width:e.height,a=0;l.each(function(t){var i=jQuery(l[t]),n=e.panels[t];n||(n={},e.panels[t]=n);var s=parseInt(i.css(e.isHori?"min-width":"min-height"));n.minSize=s?s:5;var r=parseInt(i.css(e.isHori?"max-width":"max-height"));n.maxSize=r?r:1/0,n.expanded="none"!=i.css("display");var o=n.size;null===o||void 0===o?o=e.isHori?i.outerWidth():i.outerHeight():e.isHori?i.width(o-5):i.height(o-5),t!=e._floatIndex&&(a+=o,n.size=o)}),e.panels[e._floatIndex].size=n-a,e.splitterTracker=document.createElement("div");var s=jQuery(e.splitterTracker);s.addClass("jl-sp-splitter-tracker");var r=0,o=e.isHori?"jl-sp-panel-hori":"jl-sp-panel-vert";e.splitterClsName=e.isHori?"jl-sp-splitter-hori":"jl-sp-splitter-vert",e.el.appendChild(e.splitterTracker),e.isHori?e.splitterTracker.style.height="100%":e.splitterTracker.style.width="100%";var d=parseInt(jslet.ui.getCssValue(e.splitterClsName,e.isHori?"width":"height"));l.after(function(t){var n=l[t],a=jQuery(n),s=e.panels[t].expanded;if(a.addClass(o),t==e._floatIndex?e.floatPanel=n:s?r+=d+e.panels[t].size:(a.css("display","none"),r+=d),t==i)return e.isHori?'<div style="clear:both;width:0px"></div>':"";var u=jslet.nextId(),c=e.isHori?"jl-sp-button-left":"jl-sp-button-top";return(e._floatIndex<=t||!s)&&(c+=e.isHori?" jl-sp-button-right":" jl-sp-button-bottom"),'<div class="'+e.splitterClsName+' jl-unselectable" id = "'+u+'" jsletindex="'+(t>=e._floatIndex?t+1:t)+'"><div class="jl-sp-button '+c+'"'+(s?"":' jsletcollapsed="1"')+"></div></div>"}),e.isHori?jQuery(e.floatPanel).width(t.innerWidth()-r-4):jQuery(e.floatPanel).height(t.innerHeight()-r);var u=t.find("."+e.splitterClsName);u.on("mousedown",e._splitterMouseDown);var c=u.children();c.on("mousedown",function(t){var l=jQuery(t.target),i=l.parent(),n=parseInt(i.attr("jsletindex"));e.expand(n),t.stopPropagation()});for(var h,f=0,p=u.length;p>f;f++)h=u[f],h._doDragStart=e._splitterDragStart,h._doDragging=e._splitterDragging,h._doDragEnd=e._splitterDragEnd,h._doDragCancel=e._splitterDragCancel},floatPanel:function(){return this.panels[this._floatIndex]},changeSize:function(e,t){},expand:function(e,t,l){var i,n=this,a=jQuery(n.el),s=a.find("."+n.splitterClsName);if(!(0>e||e>s.length)){var r=jQuery(s[e>=n._floatIndex?e-1:e]),o=r.find(":first-child");if(void 0===t&&(t="1"==o.attr("jsletcollapsed")),i=e<n._floatIndex?r.prev():r.next(),n.isHori?o.hasClass("jl-sp-button-right")?o.removeClass("jl-sp-button-right"):o.addClass("jl-sp-button-right"):o.hasClass("jl-sp-button-bottom")?o.removeClass("jl-sp-button-bottom"):o.addClass("jl-sp-button-bottom"),t?(i.css("display","block"),o.attr("jsletcollapsed","0")):(i.css("display","none"),o.attr("jsletcollapsed","1")),!l){var d=jQuery(n.floatPanel);n.isHori?d.width(d.width()+i.width()*(t?-1:1)):d.height(d.height()+i.height()*(t?-1:1)),n.panels[e].expanded=t,n._onExpanded&&n._onExpanded.call(n,e),jslet.resizeEventBus.resize(n.el)}}},_splitterMouseDown:function(e){var t=jQuery(this).position(),l=this.parentNode.jslet;l.splitterTracker.style.top=t.top+"px",l.splitterTracker.style.left=t.left+"px",l.draggingId=this.id;var i=jQuery("#"+l.draggingId),n=i.find(":first-child");return"1"==n.attr("jsletcollapsed")?void n.click():void jslet.ui.dnd.bindControl(this)},_splitterDragStart:function(e,t,l,i,n,a){var s=this.parentNode.jslet,r=jQuery(s.splitterTracker),o=jQuery("#"+s.draggingId),d=parseInt(o.attr("jsletindex")),u=s.panels[d],c=jQuery(s.floatPanel);s.dragRangeMin=u.size-u.minSize,s.dragRangeMax=u.maxSize-u.size;var h=(s.isHori?c.width():c.height())-s.panels[s._floatIndex].minSize;s.dragRangeMax>h&&(s.dragRangeMax=h),r.show()},_splitterDragging:function(e,t,l,i,n,a){var s,r=this.parentNode.jslet,o=jQuery(r.splitterTracker),d=jQuery("#"+r.draggingId),u=parseInt(d.attr("jsletindex")),c=Math.abs(r.isHori?n:a);if(s=r.isHori?u<r._floatIndex&&n>=0||u>r._floatIndex&&0>n:u<r._floatIndex&&a>=0||u>r._floatIndex&&0>a,s&&c>r.dragRangeMax)return void(r.endDelta=r.dragRangeMax);if(!s&&c>r.dragRangeMin)return void(r.endDelta=r.dragRangeMin);r.endDelta=Math.abs(r.isHori?n:a);var h=o.offset();r.isHori?h.left=l:h.top=i,o.offset(h)},_splitterDragEnd:function(e,t,l,i,n,a){var s,r=this.parentNode.jslet,o=jQuery(r.splitterTracker),d=jQuery("#"+r.draggingId),u=parseInt(d.attr("jsletindex")),c=u<r._floatIndex?d.prev():d.next(),h=jQuery(r.floatPanel);s=r.isHori?u<r._floatIndex&&n>=0||u>r._floatIndex&&0>n:u<r._floatIndex&&a>=0||u>r._floatIndex&&0>a;var f=r.endDelta*(s?1:-1),p=r.panels[u].size+f;r.panels[u].size=p,r.isHori?(c.width(p),h.width(h.width()-f)):(c.height(p),h.height(h.height()-f)),r._onSize&&r._onSize.call(r,u,p),jslet.resizeEventBus.resize(r.el),o.hide()},_splitterDragCancel:function(e,t,l,i,n,a){var s=this.parentNode.jslet,r=jQuery(s.splitterTracker);r.hide()},checkSizeChanged:function(){var e=this,t=jQuery(e.el),l=e.isHori?t.width():t.height();if(e._oldSize!=l){var i=l-e._oldSize;e._oldSize=l;var n=e.panels[e._floatIndex],a=jQuery(e.floatPanel),s=i+(e.isHori?a.width():a.height());s<n.minSize&&(s=n.minSize),e.isHori?a.width(s):a.height(s)}jslet.resizeEventBus.resize(e.floatPanel)},destroy:function($super){var e=this,t=jQuery(e.el);e.splitterTracker=null,e.floatPanel=null;var l=t.find("."+e.splitterClsName);l.off("mousedown",e._splitterMouseDown);for(var i,n=0,a=l.length;a>n;n++)i=l[n],jslet.ui.dnd.unbindControl(i),i._doDragStart=null,i._doDragging=null,i._doDragEnd=null,i._doDragCancel=null;jslet.resizeEventBus.unsubscribe(e),$super()}}),jslet.ui.register("SplitPanel",jslet.ui.SplitPanel),jslet.ui.SplitPanel.htmlTemplate="<div></div>",jslet.ui.TabItem=function(){var e=this;e.id=null,e.index=-1,e.header=null,e.closable=!1,e.disabled=!1,e.useIFrame=!1,e.height="100%",e.url=null,e.contentId=null,e.content=null},jslet.ui.TabControl=jslet.Class.create(jslet.ui.Control,{initialize:function($super,e,t){var l=this;l.el=e,l.allProperties="styleClass,activeIndex,newable,closable,items,onAddTabItem,onActiveIndexChanged,onRemoveTabItem,onCreateContextMenu,onContentLoading,onContentLoaded",l._activeIndex=-1,l._newable=!0,l._closable=!0,l._onActiveIndexChanged=null,l._onAddTabItem=null,l._onRemoveTabItem=null,l._onCreateContextMenu=null,l._items=[],l._itemsWidth=[],l._containerWidth=0,l._ready=!1,l._leftIndex=0,l._rightIndex=0,l._maxHeaderWidth=160,l._tabControlWidth=jQuery(l.el).width(),l._tabControlHeight=jQuery(l.el).height(),l._contextItemIndex=0,l._onContentLoading=null,l._onContentLoaded=null,jslet.resizeEventBus.subscribe(this),$super(e,t)},activeIndex:function(e){return void 0===e?this._activeIndex:(jslet.Checker.test("TabControl.activeIndex",e).isGTEZero(),void(this._ready?this._chgActiveIndex(e):this._activeIndex=e))},activeItemId:function(e){var t=this;if(void 0===e){var l=t._items[this._activeIndex];return l?l.id:null}if(jslet.Checker.test("TabControl.activeItemId",e).isString(),this._ready)for(var i=t._items,n=0,a=i.length;a>n;n++)if(e===i[n].id){this._chgActiveIndex(n);break}return this},activeItem:function(){var e=this._items;return e&&e.length>0?this._items[this._activeIndex||0]:null},newable:function(e){return void 0===e?this._newable:void(this._newable=!!e)},closable:function(e){return void 0===e?this._closable:void(this._closable=!!e)},onAddTabItem:function(e){return void 0===e?this._onAddTabItem:(jslet.Checker.test("TabControl.onAddTabItem",e).isFunction(),void(this._onAddTabItem=e))},onActiveIndexChanged:function(e){return void 0===e?this._onActiveIndexChanged:(jslet.Checker.test("TabControl.onActiveIndexChanged",e).isFunction(),void(this._onActiveIndexChanged=e))},onRemoveTabItem:function(e){return void 0===e?this._onRemoveTabItem:(jslet.Checker.test("TabControl.onRemoveTabItem",e).isFunction(),void(this._onRemoveTabItem=e))},onCreateContextMenu:function(e){return void 0===e?this._onCreateContextMenu:(jslet.Checker.test("TabControl.onCreateContextMenu",e).isFunction(),void(this._onCreateContextMenu=e))},onContentLoading:function(e){return void 0===e?this._onContentLoading:(jslet.Checker.test("TabControl.onContentLoading",e).isFunction(),void(this._onContentLoading=e))},onContentLoaded:function(e){return void 0===e?this._onContentLoaded:(jslet.Checker.test("TabControl.onContentLoaded",e).isFunction(),void(this._onContentLoaded=e))},items:function(e){if(void 0===e)return this._items;jslet.Checker.test("TabControl.items",e).isArray();for(var t,l=0,i=e.length;i>l;l++)t=e[l],jslet.Checker.test("TabControl.items.header",t.header).isString().required();this._items=e},bind:function(){this.renderAll()},renderAll:function(){var e=this;e._createContextMenu();var t=['<div class="jl-tab-header jl-unselectable"><div class="jl-tab-container jl-unselectable"><ul class="jl-tab-list">',e._newable?'<li><a href="javascript:;" class="jl-tab-inner"><span class="jl-tab-new">+</span></a></li>':"",'</ul></div><a class="jl-tab-left jl-hidden"><span class="jl-nav-btn fa fa-arrow-circle-left"></span></a><a class="jl-tab-right jl-hidden"><span class="jl-nav-btn fa fa-arrow-circle-right"></span></a></div>','<div class="jl-tab-panels jl-round5"></div>'],l=jQuery(e.el);if(l.hasClass("jl-tabcontrol")||l.addClass("jl-tabcontrol jl-round5"),l.html(t.join("")),e._newable){var i=l.find(".jl-tab-list")[0],n=i.childNodes[i.childNodes.length-1];e._newTabItem=n,n.onclick=function(){var t=null;e._onAddTabItem&&(t=e._onAddTabItem.call(e)),t||(t=new jslet.ui.TabItem,t.header=jslet.locale.TabControl.newTab,t.closable=!0),e.addTabItem(t),e._calcItemsWidth(),e.activeIndex(e._items.length-1)}}var a=l.find(".jl-tab-left");if(a.on("click",function(t){return e._setVisiTabItems(e._leftIndex-1),t.stopImmediatePropagation(),t.preventDefault(),!1}),a.on("mousedown",function(e){return e.stopImmediatePropagation(),e.preventDefault(),!1}),a=l.find(".jl-tab-right"),a.on("click",function(t){return e._setVisiTabItems(e._leftIndex+1),t.stopImmediatePropagation(),t.preventDefault(),!1}),a.on("mousedown",function(e){return e.stopImmediatePropagation(),e.preventDefault(),!1}),e._items&&e._items.length>0){for(var s,r=e._items.length,o=0;r>o;o++)s=e._items[o],e._renderTabItem(s);e._activeIndex=0}e._calcItemsWidth(),e._ready=!0,e._chgActiveIndex(e._activeIndex)},addItem:function(e){this._items[this._items.length]=e},tabHeader:function(e,t){jslet.Checker.test("tabHeader#index",e).isGTEZero(),jslet.Checker.test("tabHeader#label",t).required().isString();var l=this,i=l._getTabItemCfg(e);if(i){i.header=t;var n=jQuery(l.el),a=n.find(".jl-tab-list")[0],s=a.childNodes;jQuery(s[e]).find(".jl-tab-title").html(t),l._calcItemsWidth()}},tabDisabled:function(e,t){jslet.Checker.test("tabDisabled#index",e).isGTEZero();var l=this,i=l._getTabItemCfg(e);if(i){if(e==l._activeIndex)return void console.warn("Cannot set current tab item to disabled.");i.disabled(t);var n=jQuery(l.el),a=n.find(".jl-tab-panels"),s=a[0],r=s.childNodes,o=jQuery(r[e]);t?o.addClass("jl-tab-disabled"):o.removeClass("jl-tab-disabled")}},_checkTabItemCount:function(){var e=this,t=jQuery(e.el).find(".jl-tab-panels");e._items&&0!==e._items.length?t.removeClass("jl-hidden"):t.hasClass("jl-hidden")||t.addClass("jl-hidden")},_chgActiveIndex:function(e){var t=this,l=t._getTabItemCfg(e);if(l&&!l.disabled){if(t._onActiveIndexChanged){var i=t._onActiveIndexChanged.call(t,t._activeIndex,e);if(void 0!==i&&!i)return}for(var n,a,s=jQuery(t.el),r=s.find(".jl-tab-list")[0],o=r.childNodes,d=o.length-(t._newable?2:1),u=s.find(".jl-tab-panels")[0],c=u.childNodes,h=0;d>=h;h++)n=jQuery(o[h]),a=c[h],h==e?(n.addClass("jl-tab-active"),a.style.display="block"):(n.removeClass("jl-tab-active"),a.style.display="none");t._activeIndex=e,(e<t._leftIndex||e>=t._rightIndex)&&t._setVisiTabItems(null,t._activeIndex)}},_getTabItemCfg:function(e){var t=this;return t._items.length<=e?null:t._items[e]},_calcItemsWidth:function(){var e=this,t=jQuery(e.el),l=t.find(".jl-tab-list").children();e._itemsWidth=[],e._totalItemsWidth=0,l.each(function(t){var l=jQuery(this).outerWidth()+5;e._itemsWidth[t]=l,e._totalItemsWidth+=l}),e._containerWidth=t.find(".jl-tab-container").innerWidth(),e._setNavBtnVisible()},_setVisiTabItems:function(e,t){var l,i,n,a=this;if(e||0===e)a._leftIndex=e;else{if(!t)return;for(a._newable&&t++,l=a._itemsWidth[t],a._leftIndex=t,i=t-1;i>=0;i--){if(l+=a._itemsWidth[i],l>a._containerWidth){a._leftIndex=i+1;break}a._leftIndex=i}e=a._leftIndex}for(l=0,a._rightIndex=e,i=e,n=a._itemsWidth.length;n>i;i++){if(l+=a._itemsWidth[i],l>a._containerWidth){a._rightIndex=i-1;break}a._rightIndex=i}var s=0;for(i=0;i<a._leftIndex;i++)s+=a._itemsWidth[i];s+=5;var r=jQuery(a.el);r.find(".jl-tab-container").scrollLeft(jslet.locale.isRtl?5e4-s:s),a._setNavBtnVisible()},_setNavBtnVisible:function(){var e=this,t=jQuery(e.el),l=t.find(".jl-tab-left"),i=l.hasClass("jl-hidden");e._leftIndex>0&&e._totalItemsWidth>e._containerWidth?i&&l.removeClass("jl-hidden"):i||l.addClass("jl-hidden");var n=t.find(".jl-tab-right"),a=e._itemsWidth.length;i=n.hasClass("jl-hidden"),e._rightIndex<a-1&&e._totalItemsWidth>e._containerWidth?i&&n.removeClass("jl-hidden"):i||n.addClass("jl-hidden");
},_createHeader:function(e,t){var l=this,i=l._closable&&t.closable,n=['<a href="javascript:;" class="jl-tab-inner'+(i?" jl-tab-close-loc":"")+'" onclick="javascript:this.blur();" title="'+t.header+'"><span class="jl-tab-title '];n.push('">'),n.push(t.header),n.push("</span>"),n.push('<span class="fa fa-times close jl-tab-close'+(!i||t.disabled?" jl-hidden":"")+'"></span><span style="clear:both"></span>'),n.push("</a>");var a=document.createElement("li");if(t.disabled&&jQuery(a).addClass("jl-tab-disabled"),a.innerHTML=n.join(""),l._newable){var s=e.childNodes[e.childNodes.length-1];e.insertBefore(a,s)}else e.appendChild(a);a.jslet=l,jQuery(a).on("click",l._changeTabItem),i&&jQuery(a).find(".jl-tab-close").click(l._doCloseBtnClick),l.contextMenu&&!t.disabled&&(a.oncontextmenu=function(e){var t=0;jQuery(l.el).find(".jl-tab-list li").each(function(){return this===e.currentTarget?(l._contextItemIndex=t,!1):void t++});l.contextMenu.showContextMenu(e,l)})},_changeTabItem:function(e){for(var t=this.parentNode.childNodes,l=-1,i=0;i<t.length;i++)if(t[i]==this){l=i;break}this.jslet._chgActiveIndex(l)},_doCloseBtnClick:function(e){for(var t=this.parentNode.parentNode,l=t.parentNode.childNodes,i=-1,n=0;n<l.length;n++)if(l[n]==t){i=n;break}return t.jslet.removeTabItem(i),e.preventDefault(),!1},_createBody:function(e,t){var l=this,i=jQuery(document.createElement("div"));i.hasClass("jl-tab-panel")||i.addClass("jl-tab-panel");var n=i[0];e.appendChild(n);var a=jQuery(l.el),s=(a.find(".jl-tab-header"),t.height);if(s=s?s:"100%",t.content||t.contentId){var r=t.content?t.content:jQuery("#"+t.contentId)[0];if(r){var o=r.parentNode;return o&&o!=n&&o.removeChild(r),n.appendChild(r),void(r.style.display="block")}}var d=t.url;if(d&&(d=d+(d.indexOf("?")>=0?"&":"?")+"jlTabItemId="+t.id,t.useIFrame||void 0===t.useIFrame)){var u=jslet.nextId(),c='<iframe id="'+u+'"scrolling="yes" frameborder="0" allowtransparency="true" src="'+d+'" style="width: 100%;height:'+s+';background-color:transparent"></iframe>';i.html(c),t.contentId=u,l._onContentLoading&&l._onContentLoading.call(l,u,t)}},addTabItem:function(e,t){var l=this,i=l._items,n=e.id;n||(n=jslet.nextId(),e.id=n);var a;if((void 0===t||t)&&n)for(var s=0,r=i.length;r>s;s++)if(a=i[s],n===a.id)return a.url!==e.url&&(a.url=e.url,l.reloadTabItem(a)),void l.activeIndex(s);i.push(e),l._renderTabItem(e),l._calcItemsWidth(),l._chgActiveIndex(i.length-1),l._checkTabItemCount()},setContentLoadedState:function(e){var t=this;if(t._onContentLoaded){for(var l,i=t._items,n=null,a=0,s=i.length;s>a;a++)if(l=i[a],e===l.id){n=l.contentId;break}n&&t._onContentLoaded.call(t,n,l)}},setContentChangedState:function(e,t){for(var l,i=this,n=i._items,a=-1,s=0,r=n.length;r>s;s++)if(l=n[s],e===l.id){a=s;break}if(!(0>a)){l.changed=t;var o=l.header,d="*"===o.charAt(0);t?d||(o="*"+o,i.tabHeader(a,o)):d&&(o=o.substring(1),i.tabHeader(a,o))}},hasChanged:function(){for(var e,t=this,l=t._items,i=0,n=l.length;n>i;i++)if(e=l[i],e.changed)return!0;return!1},_renderTabItem:function(e){var t=this,l=jQuery(t.el),i=l.find(".jl-tab-list")[0],n=l.find(".jl-tab-panels")[0];e.id||(e.id=jslet.nextId()),t._createHeader(i,e),t._createBody(n,e)},removeTabItem:function(e,t){var l=this;if(!(e>=l._items.length||0>e)){var i=l._items[e];i.changed?jslet.ui.MessageBox.confirm(jslet.locale.TabControl.contentChanged,jslet.locale.MessageBox.confirm,function(i){"ok"===i&&l._innerRemoveTabItem(e,t)}):l._innerRemoveTabItem(e,t)}},_innerRemoveTabItem:function(e,t){var l=this,i=jQuery(l.el),n=i.find(".jl-tab-list")[0],a=n.childNodes,s=a.length-(l._newable?2:1),r=jQuery(a[e]),o=r.hasClass("jl-tab-active");if(l._onRemoveTabItem){var d=l._onRemoveTabItem.call(l,l._items[e],o);if(!d)return}r.find(".jl-tab-close").hide(),r.animate({width:"toggle"},200,function(){var d=r[0];d.oncontextmenu=null,n.removeChild(d),l._items.splice(e,1);var u=i.find(".jl-tab-panels")[0];a=u.childNodes;var c=a[e];u.removeChild(c),t||(l._calcItemsWidth(),l._checkTabItemCount()),o?(e=l._getNextValidIndex(e,e>=s),e>=0?l._chgActiveIndex(e):l._activeIndex=-1):l._activeIndex>e&&l._activeIndex--})},_getNextValidIndex:function(e,t){var l,i,n=this;if(t){for(l=e-1;l>=0;l--)if(!n._items[l].disabled)return l}else for(l=e,i=n._items.length;i>l;l++)if(!n._items[l].disabled)return l;return-1},reload:function(){var e=this,t=e._contextItemIndex,l=e._items[t];e.reloadTabItem(l)},reloadTabItem:function(e){var t=this;if(e){var l=e.contentId;if(l){var i=jQuery("#"+l);t._onContentLoading&&t._onContentLoading.call(t,i.attr("id"),e);var n=e.url;n=n+(n.indexOf("?")>=0?"&":"?")+"jlTabItemId="+e.id,i.attr("src",n)}}},close:function(e){var t=this;void 0===e&&(e=t._activeIndex);var l=t._items[e];l&&e>=0&&l.closable&&!l.disabled&&t.removeTabItem(e)},closeOther:function(){for(var e,t=this,l=t._items.length-1;l>=0;l--)if(e=t._items[l],e.closable&&!e.disabled){if(t._contextItemIndex==l)continue;t.removeTabItem(l,!0)}t._calcItemsWidth(),t._checkTabItemCount()},closeAll:function(){for(var e,t=this,l=t._items.length-1;l>=0;l--)e=t._items[l],e.closable&&!e.disabled&&t.removeTabItem(l,!0);t._calcItemsWidth(),t._checkTabItemCount()},checkSizeChanged:function(){var e=this,t=jQuery(e.el),l=t.width();t.height();e._tabControlWidth!=l&&(e._tabControlWidth=l,e._calcItemsWidth(),e._setVisiTabItems(e._leftIndex))},_createContextMenu:function(){var e=this;if(e.contextMenu=null,jslet.ui.Menu&&e._closable){var t={type:"Menu",onItemClick:e._menuItemClick,items:[{id:"reload",name:jslet.locale.TabControl.reload},{id:"close",name:jslet.locale.TabControl.close},{id:"closeOther",name:jslet.locale.TabControl.closeOther},{id:"closeAll",name:jslet.locale.TabControl.closeAll}]};e._onCreateContextMenu&&e._onCreateContextMenu.call(e,t.items),0!==t.items.length&&(e.contextMenu=jslet.ui.createControl(t))}},_menuItemClick:function(e,t){"reload"===e?this.reload():"close"===e?this.close(this._contextItemIndex):"closeOther"===e?this.closeOther():"closeAll"===e&&this.closeAll()},destroy:function($super){var e=this;e._newTabItem&&(e._newTabItem.onclick=null,e._newTabItem=null);var t=jQuery(e.el),l=t.find(".jl-tab-header")[0];t.find(".jl-tab-left").off(),t.find(".jl-tab-right").off(),l.oncontextmenu=null,t.find(".jl-tab-close").off();var i=t.find(".jl-tab-list").find("li");i.off(),i.each(function(){this.jslet=null}),jslet.resizeEventBus.unsubscribe(this),$super()}}),jslet.ui.register("TabControl",jslet.ui.TabControl),jslet.ui.TabControl.htmlTemplate="<div></div>",jslet.ui.TipPanel=function(){this._hideTimerId=null,this._showTimerId=null,this._oldElement=null;var e=document.createElement("div");jQuery(e).addClass("jl-tip-panel"),document.body.appendChild(e),this._tipPanel=e,this.show=function(e,t,l){var i=this,n=arguments.length,a=!1,s=t;if(2==n){var r=s;r=jQuery.event.fix(r),l=r.pageY+16,s=r.pageX+2;var o=r.currentTarget;a=o===i._oldElement,i._oldElement=o}else s=parseInt(s),l=parseInt(l);i._hideTimerId&&(window.clearTimeout(i._hideTimerId),a)||(this._showTimerId=window.setTimeout(function(){var t=i._tipPanel;t.innerHTML=e,t.style.left=s+"px",t.style.top=l+"px",i._tipPanel.style.display="block",i._showTimerId=null},300))},this.hide=function(){var e=this;return e._showTimerId?void window.clearTimeout(e._showTimerId):void(e._hideTimerId=window.setTimeout(function(){e._tipPanel.style.display="none",e._hideTimerId=null,e._oldElement=null},300))}},jslet.ui.globalTip=new jslet.ui.TipPanel,jslet.ui.WaitingBox=function(e,t,l){var i=new jslet.ui.OverlayPanel(e),n='<div class="jl-waitingbox jl-round4"><b class="jl-waitingbox-icon"></b>';n+='<span class="jl-waitingbo-text"></span></div>',jQuery(i.overlayPanel).html(n),this.show=function(e){var t=i.overlayPanel,l=t.firstChild,n=l.childNodes[1];n.innerHTML=e?e:"";var a=jQuery(t),s=a.height(),r=a.width();setTimeout(function(){var e=jQuery(l);l.style.top=Math.round((s-e.height())/2)+"px",l.style.left=Math.round((r-e.width())/2)+"px"},10),i.show()},this.hide=function(){i.hide()},this.destroy=function(){i.overlayPanel.innerHTML="",i.destroy()}},jslet.ui.Window=jslet.Class.create(jslet.ui.Control,{initialize:function($super,e,t){var l=this;l.el=e,l.allProperties="styleClass,caption,resizable,minimizable,maximizable,closable,iconClass,onSizeChanged,onClosed,onPositionChanged,onActive,width,height,minWidth,maxWidth,minHeight,maxHeight,isCenter,isSmallHeader,stopEventBubbling,animation",l._caption=null,l._resizable=!0,l._minimizable=!0,l._maximizable=!0,l._closable=!0,l._iconClass=null,l._width=0,l._height=0,l._minWidth=20,l._minHeight=30,l._maxWidth=-1,l._maxHeight=-1,l._isCenter=!1,l._animation="linear",l._onSizeChanged=null,l._onPositionChanged=null,l._onActive=null,l._onClosed=null,l._stopEventBubbling=!1,l._isModal=!1,l._state=null,$super(e,t)},caption:function(e){return void 0===e?this._caption:(jslet.Checker.test("Window.caption",e).isString(),void(this._caption=e))},iconClass:function(e){return void 0===e?this._iconClass:(jslet.Checker.test("Window.iconClass",e).isString(),void(this._iconClass=e))},resizable:function(e){return void 0===e?this._resizable:void(this._resizable=!!e)},minimizable:function(e){return void 0===e?this._minimizable:void(this._minimizable=!!e)},maximizable:function(e){return void 0===e?this._maximizable:void(this._maximizable=!!e)},closable:function(e){return void 0===e?this._closable:void(this._closable=!!e)},isCenter:function(e){return void 0===e?this._isCenter:void(this._isCenter=!!e)},animation:function(e){return void 0===e?this._animation:void(this._animation=e)},stopEventBubbling:function(e){return void 0===e?this._stopEventBubbling:void(this._stopEventBubbling=!!e)},width:function(e){return void 0===e?this._width:(jslet.Checker.test("Window.width",e).isGTZero(),void(this._width=e))},height:function(e){return void 0===e?this._height:(jslet.Checker.test("Window.height",e).isGTZero(),void(this._height=e))},minWidth:function(e){return void 0===e?this._minWidth:(jslet.Checker.test("Window.minWidth",e).isGTZero(),20>e&&(e=20),void(this._minWidth=e))},minHeight:function(e){return void 0===e?this._minHeight:(jslet.Checker.test("Window.minHeight",e).isGTZero(),30>e&&(e=30),void(this._minHeight=e))},maxWidth:function(e){return void 0===e?this._maxWidth:(jslet.Checker.test("Window.maxWidth",e).isNumber(),void(this._maxWidth=e))},maxHeight:function(e){return void 0===e?this._maxHeight:(jslet.Checker.test("Window.maxHeight",e).isNumber(),void(this._maxHeight=e))},onSizeChanged:function(e){return void 0===e?this._onSizeChanged:(jslet.Checker.test("Window.onSizeChanged",e).isFunction(),void(this._onSizeChanged=e))},onPositionChanged:function(e){return void 0===e?this._onPositionChanged:(jslet.Checker.test("Window.onPositionChanged",e).isFunction(),void(this._onPositionChanged=e))},onActive:function(e){return void 0===e?this._onActive:(jslet.Checker.test("Window.onActive",e).isFunction(),void(this._onActive=e))},onClosed:function(e){return void 0===e?this._onClosed:(jslet.Checker.test("Window.onClosed",e).isFunction(),void(this._onClosed=e))},bind:function(){this.renderAll()},renderAll:function(){var e=this;e._closable||(e._minimizable=!1,e._maximizable=!1);var t=jQuery(e.el);t.hasClass("jl-window")||t.addClass("panel panel-default jl-window"),e._width&&t.width(e._width),e._height&&t.height(e._height),t.css("display","none");var l=['<div class="panel-heading jl-win-header jl-win-header-sm" style="cursor:move">',e._iconClass?'<span class="jl-win-header-icon '+e._iconClass+'"></span>':"",'<span class="panel-title jl-win-caption">',e._caption?e._caption:"","</span>",'<span class="jl-win-tool jl-unselectable">'];l.push(e._closable?'<button class="close jl-win-close" onfocus="this.blur();">x</button>':""),l.push(e._maximizable?'<button class="close jl-win-max" onfocus="this.blur();"></button>':""),l.push(e._minimizable?'<button class="close jl-win-min" onfocus="this.blur();">-</button>':""),l.push("</span></div>"),l.push('<div class="panel-body jl-win-body"></div>'),t.html(l.join("")),t.on("mousemove",e._doWinMouseMove),t.on("mousedown",e._doWinMouseDown),t.on("dblclick",function(e){e.stopPropagation(),e.preventDefault()}),t.on("click",function(t){e._stopEventBubbling&&(t.stopPropagation(),t.preventDefault())}),e._height&&e._changeBodyHeight();var i=t.find(".jl-win-header"),n=i[0],a=t.find(".jl-win-body");if(a.on("mouseenter",function(t){window.setTimeout(function(){jslet.temp_dragging||(e.cursor=null)},300)}),a.on("dblclick",function(e){e.stopPropagation(),e.preventDefault()}),i.on("mousedown",function(t){e.activate(),"max"!=e._state&&(e.cursor=null,jslet.ui.dnd.bindControl(this))}),i.on("dblclick",function(t){t.stopPropagation(),t.preventDefault(),e._maximizable&&("max"!=e._state?e.maximize():e.restore())}),n._doDragStart=function(t,l,i,a,s,r){e._createTrackerMask(n),e.trackerMask.style.cursor=n.style.cursor,jslet.temp_dragging=!0},n._doDragging=function(t,l,i,n,a,s){e.setPosition(e.left+a,e.top+s,!0)},n._doDragEnd=function(t,l,i,n,a,s){var r=parseInt(e.el.style.left),o=parseInt(e.el.style.top);e.setPosition(r,o),e._removeTrackerMask(),e.cursor=null,jslet.temp_dragging=!1},n._doDragCancel=function(t,l,i,n,a,s){e.setPosition(e.left,e.top),e._removeTrackerMask(),e.cursor=null,jslet.temp_dragging=!1},e.el._doDragStart=function(t,l,i,n,a,s){e._createTrackerMask(this),e._createTracker(),e.trackerMask.style.cursor=e.el.style.cursor,jslet.temp_dragging=!0},e.el._doDragging=function(t,l,i,n,a,s){e._changeTrackerSize(a,s)},e.el._doDragEnd=function(t,l,i,n,a,s){if(e.tracker){var r=parseInt(e.tracker.style.left),o=parseInt(e.tracker.style.top),d=parseInt(e.tracker.style.width),u=parseInt(e.tracker.style.height);e.setPosition(r,o),e.changeSize(d,u),e._removeTrackerMask(),e._removeTracker(),e.cursor=null,jslet.temp_dragging=!1}},e.el._doDragCancel=function(t,l,i,n,a,s){e._removeTrackerMask(),e._removeTracker(),e.cursor=null,jslet.temp_dragging=!1},e._closable){var s=t.find(".jl-win-close");s.click(function(t){e.close(),t=jQuery.event.fix(t||window.event),t.stopPropagation(),t.preventDefault()})}if(e._minimizable){var r=t.find(".jl-win-min");r.click(function(t){e.minimize(),t=jQuery.event.fix(t||window.event),t.stopPropagation(),t.preventDefault()})}if(e._maximizable){var o=t.find(".jl-win-max"),d=o[0];o.click(function(t){"max"!=e._state?(d.innerHTML="",e.maximize()):(d.innerHTML="",e.restore()),t=jQuery.event.fix(t||window.event),t.stopPropagation(),t.preventDefault()})}},show:function(e,t){var l=this,i=jQuery(l.el);if(l._isCenter){var n=i.offsetParent()[0],a=jQuery(n),s=a.width(),r=a.height();e=n.scrollLeft+Math.round((s-i.outerWidth())/2),t=n.scrollTop+Math.round((r-i.outerHeight())/2),0>e&&(e=0),0>t&&(t=0)}l.top=t?t:0,l.left=e?e:0,l.el.style.left=l.left+"px",l.el.style.top=l.top+"px","slide"==l._animation?i.slideDown():"fade"==l._animation?i.fadeIn():"none"==l._animation?i.show():i.show("fast"),l.activate()},showModal:function(e,t){var l=this;l._isModal=!0,l.overlay||(l.overlay=new jslet.ui.OverlayPanel(l.el.parentNode)),jslet.ui.GlobalZIndex+=10;var i=jslet.ui.GlobalZIndex;l.el.style.zIndex=i,l.show(e,t),l.overlay.setZIndex(i-2),l.overlay.show()},hide:function(){var e=this,t=jQuery(e.el);"slide"==e._animation?t.slideUp():"fade"==e._animation?t.fadeOut():"none"==e._animation?t.hide():t.hide("fast"),e.overlay&&e.overlay.hide()},close:function(){var e=this;if(e.el){if(e._onClosed){var t=e._onClosed.call(e);if(t&&"hidden"==t.toLowerCase())return void e.hide()}var l=e.el.parentNode;l.removeChild(e.el),e.overlay&&(e.overlay.destroy(),e.overlay=null),jslet.ui.GlobalZIndex-=10,e.destroy()}},minimize:function(){var e=this;if("min"==e._state)return void e.restore();"max"==e._state&&e.restore();var t=jQuery(e.el);e._tempHeight=t.height(),e._tempWidth=t.width(),e.changeSize(e._tempWidth,e._getHeaerHeight()+2),e._state="min"},maximize:function(){var e=this,t=jQuery(e.el).offsetParent(),l=t.innerWidth(),i=t.innerHeight();if(e.setPosition(0,0,!0),"min"!==e._state){var n=jQuery(e.el);e._tempHeight=n.height(),e._tempWidth=n.width()}e.changeSize(l,i),e._state="max"},restore:function(){var e=this;e.setPosition(e.left,e.top,!0),e.changeSize(e._tempWidth,e._tempHeight),e._state=null},activate:function(){var e=this;e.overlay||e.bringToFront(),e._onActive&&e._onActive.call()},setPosition:function(e,t,l){var i=this;if(l){if(i._onPositionChanged){var n=i._onPositionChanged.call(i,e,t);n&&(n.left&&(e=n.left),n.top&&(t=n.top))}}else i.left=e,i.top=t;i.el.style.left=e+"px",i.el.style.top=t+"px"},changeSize:function(e,t){var l=this;l._onSizeChanged&&l._onSizeChanged.call(l,e,t);var i=jQuery(l.el);i.width(e),i.height(t),l._changeBodyHeight()},_getHeaerHeight:function(){var e=this,t=jQuery(e.el),l=t.find(".jl-win-header");return l.outerHeight()},_changeBodyHeight:function(){var e=this,t=jQuery(e.el),l=t.find(".jl-win-body");l.outerHeight(t.innerHeight()-e._getHeaerHeight())},getCaptionPanel:function(){return jQuery(this.el).find(".jl-win-caption")[0]},changeCaption:function(e){this.caption=e;var t=jQuery(this.el).find(".jl-win-caption");t.html(e)},getContentPanel:function(){return jQuery(this.el).find(".jl-win-body")[0]},setContent:function(e){if(!e)return void jslet.showError("Window content cannot be null!");var t=jQuery(this.el).find(".jl-win-body");e&&e.toLowerCase?t.html(e):(t.html(""),e.parentNode.removeChild(e),t[0].appendChild(e),e.style&&"none"==e.style.display&&(e.style.display="block"))},bringToFront:function(){for(var e,t,l,i=this,n=i.el.parentNode,a=jQuery(i.el),s=0,r=0,o=n.childNodes.length;o>r;r++)e=n.childNodes[r],1==e.nodeType&&e!=i.el?(t=jQuery(e),t.hasClass("jl-window")&&(l=parseInt(e.style.zIndex)||0,l>s&&(s=l),i._isModal||t.find(".jl-win-header").removeClass("jl-window-active"))):i._isModal||a.find(".jl-win-header").addClass("jl-window-active");var d=a.getStyleObject();l=parseInt(d.zIndex)||0,s>=l&&i.setZIndex(s+2)},setZIndex:function(e){this.el.style.zIndex=e,this.overlay&&this.overlay.setZIndex(e-2)},_checkSize:function(e,t){var l=this;return e&&(e<l._minWidth||l._maxWidth>0&&e>l._maxWidth)?!1:!t||!(t<l.minHeight||l._maxHeight>0&&t>l._maxHeight)},_changeTrackerSize:function(e,t){var l=this;if(l.tracker&&l.cursor){var i=jQuery(l.el),n=i.width(),a=i.height(),s=null,r=null;if("nw"==l.cursor?(n-=e,a-=t,s=l.top+t,r=l.left+e):"n"==l.cursor?(a-=t,s=l.top+t):"ne"==l.cursor?(a-=t,n+=e,s=l.top+t):"e"==l.cursor?n+=e:"se"==l.cursor?(n+=e,a+=t):"s"==l.cursor?a+=t:"sw"==l.cursor?(a+=t,n-=e,r=l.left+e):"w"==l.cursor&&(n-=e,r=l.left+e),l._checkSize(n,a)){var o=jQuery(l.tracker);n&&o.width(n),a&&o.height(a),s&&(l.tracker.style.top=s+"px"),r&&(l.tracker.style.left=r+"px")}}},_doWinMouseMove:function(e){if(!jslet.temp_dragging){e=jQuery.event.fix(e||window.event);var t=e.target,l=jQuery(t);if(l.hasClass("jl-window")){if(!t.jslet._resizable||t.jslet._state)return t.jslet.cursor=null,void(t.style.cursor="default");var i=l.offset(),n=e.pageX-i.left,a=e.pageY-i.top,s=l.width(),r=l.height(),o=8,d=s-o,u=r-o,c=null;o>=n&&o>=a?c="nw":n>o&&d>n&&o>=a?c="n":n>=d&&o>=a?c="ne":n>=d&&a>o&&u>=a?c="e":n>=d&&a>=u?c="se":n>o&&d>n&&a>=u?c="s":o>=n&&a>=u?c="sw":o>=n&&a>o&&u>a&&(c="w"),t.jslet.cursor=c,t.style.cursor=c?c+"-resize":"default"}}},_doWinMouseDown:function(e){var t=this.jslet;t.activate(),t.cursor&&jslet.ui.dnd.bindControl(this)},_createTrackerMask:function(e){var t=this;if(!t.trackerMask){var l=jQuery(document.body);t.trackerMask=document.createElement("div"),jQuery(t.trackerMask).addClass("jl-win-tracker-mask"),t.trackerMask.style.top="0px",t.trackerMask.style.left="0px",t.trackerMask.style.zIndex=99998,t.trackerMask.style.width=l.width()+"px",t.trackerMask.style.height=l.height()+"px",t.trackerMask.style.display="block",t.trackerMask.onmousedown=function(){e&&e._doDragCancel&&e._doDragCancel()},l[0].appendChild(t.trackerMask)}},_removeTrackerMask:function(){var e=this;e.trackerMask&&(e.trackerMask.onmousedown=null,document.body.removeChild(e.trackerMask)),e.trackerMask=null},_createTracker:function(){var e=this;if(!e.tracker){var t=jQuery(e.el),l=t.width(),i=t.height();e.tracker=document.createElement("div");var n=jQuery(e.tracker);n.addClass("jl-win-tracker"),e.tracker.style.top=e.top+"px",e.tracker.style.left=e.left+"px",e.tracker.style.zIndex=99999,n.width(l),n.height(i),e.tracker.style.display="block",e.el.parentNode.appendChild(e.tracker)}},_removeTracker:function(){var e=this;e.tracker&&e.el.parentNode.removeChild(e.tracker),e.tracker=null},destroy:function($super){var e=this,t=jQuery(e.el);t.find(".jl-win-max").off(),t.find(".jl-win-min").off(),t.find(".jl-win-close").off();var l=t.find(".jl-win-header"),i=l[0];l.off(),t.find(".jl-win-body").off(),e.trackerMask&&(e.trackerMask.onmousedown=null),e.trackerMask=null,e.el._doDragCancel=null,e.el._doDragEnd=null,e.el._doDragging=null,e.el._doDragStart=null,i._doDragCancel=null,i._doDragEnd=null,i._doDragging=null,i._doDragStart=null,$super&&$super()}}),jslet.ui.register("Window",jslet.ui.Window),jslet.ui.Window.htmlTemplate="<div></div>",jslet.ui.MessageBox=function(){this.show=function(e,t,l,i,n,a,s,r){var o={type:"window",caption:t,isCenter:!0,resizable:!1,minimizable:!1,maximizable:!1,stopEventBubbling:!0,animation:"fade"},d=jslet.ui.createControl(o),u="";if(l){switch(u='<div class="jl-msg-icon ',u+="info"==l||"error"==l||"question"==l||"warning"==l?"jl-msg-icon-"+l:l,u+='"><i class="fa ',l){case"info":u+="fa-info";break;case"error":u+="fa-times";break;case"success":u+="fa-check";break;case"warning":u+="fa-exclamation";break;case"question":u+="fa-question";break;default:u+="fa-info"}u+='"></i></div>'}var c,h,f=i.length,p=[];if(jslet.locale.isRtl)for(h=f-1;h>=0;h--)c=i[h],p.push('<button class="jl-msg-button btn btn-default btn-xs" '),p.push(' data-jsletname="'),p.push(c),p.push('">'),p.push(jslet.locale.MessageBox[c]),p.push("</button>");else for(h=0;f>h;h++)c=i[h],p.push('<button class="jl-msg-button btn btn-default btn-xs" '),p.push('" data-jsletname="'),p.push(c),p.push('">'),p.push(jslet.locale.MessageBox[c]),p.push("</button>");var v=["<br />"];a&&(1==a?v.push('<input type="text"'):v.push('<textarea rows="5"'),v.push(' style="width:'),v.push('98%"'),null!==s&&void 0!==s&&(v.push(' value="'),v.push(s),v.push('"')),1==a?v.push(" />"):v.push("></textarea>")),e&&(e=e.replace("\n","<br />"));var _=['<div class="jl-msg-container">',u,'<div class="'+(a?"jl-msg-message-noicon":"jl-msg-message")+'">',e,v.join(""),"</div>","</div>",'<div class="jl-msg-tool"><div>',p.join(""),"</div></div>"];d.setContent(_.join(""));var C=jQuery(d.el),j=C.find(".jl-msg-tool")[0].firstChild,m=null;m=1==a?C.find(".jl-msg-container input")[0]:C.find(".jl-msg-container textarea")[0],jQuery(j).on("click","button",function(e){var t=e.currentTarget,l=jQuery(t).attr("data-jsletname"),i=null;return a&&"ok"==l&&(i=m.value,r&&!r(i))?void m.focus():(d.close(),void(n&&n(l,i)))}),d.onClosed(function(){n&&n(c)}),d.showModal(),d.setZIndex(99981);var g=f-1;jslet.locale.isRtl&&(g=0);var b=j.childNodes[g];return b&&b.focus(),d}},jslet.ui.MessageBox.alert=function(e,t,l,i){var n=new jslet.ui.MessageBox;t||(t=jslet.locale.MessageBox.info);var a=n.show(e,t,"info",["ok"],l);i&&(i=parseInt(i),window.isNaN(i)&&window.setTimeout(function(){a.close()},i))},jslet.ui.MessageBox.error=function(e,t,l,i){var n=new jslet.ui.MessageBox;t||(t=jslet.locale.MessageBox.error);var a=n.show(e,t,"error",["ok"],l);i&&(i=parseInt(i),window.isNam(i)&&window.setTimeout(function(){a.close()},i))},jslet.ui.MessageBox.warn=function(e,t,l){var i=new jslet.ui.MessageBox;t||(t=jslet.locale.MessageBox.warn),i.show(e,t,"warning",["ok"],l)},jslet.ui.MessageBox.confirm=function(e,t,l,i){var n=new jslet.ui.MessageBox;t||(t=jslet.locale.MessageBox.confirm),i?n.show(e,t,"question",["yes","no","cancel"],l):n.show(e,t,"question",["ok","cancel"],l)},jslet.ui.MessageBox.prompt=function(e,t,l,i,n,a){var s=new jslet.ui.MessageBox;t||(t=jslet.locale.MessageBox.prompt),a?s.show(e,t,null,["ok","cancel"],l,2,i,n):s.show(e,t,null,["ok","cancel"],l,1,i,n)},jslet.ui.TableCellEditor=function(e){function t(){var t,i,a,s='<div class="form-group form-group-sm jl-tbl-editpanel"><table class="jl-tbl-edittable"><tbody><tr class="jl-tbl-editrow">',r=n._sysColumns,o=e.dataset(),d=o.name(),u=1;for(i=0,a=r.length;a>i;i++)t=r[i],u+=t.width+1;r=n.innerColumns;var c,h=e.el.id,f=e.editorTabIndex(),p=";text-align: center";for(i=0,a=r.length;a>i;i++)t=r[i],t.field&&(c=o.getField(t.field).dataType()===jslet.data.DataType.BOOLEAN,s+='<td class="jl-edtfld-'+t.field+'" style="display:none;vertical-align: middle'+(c?p:"")+'"><div data-jslet=\'type:"DBPlace",dataset:"'+d+'",field:"'+t.field+'", tableId: "'+h+'", expandChildWidth: '+(c?"false":"true")+(f?", tabIndex: "+f:"")+"' class=\""+t.widthCssName+'"></div></td>');s+="</tr></tbody></table></div>";var v=jQuery(s);v.appendTo(jQuery(n.el)),v.css("left",u+"px"),jslet.ui.install(v[0]),l=v,v.height(n.rowHeight()),v.on("keydown",function(e){var t=e.which;e.ctrlKey&&t===jslet.ui.KeyCode.C&&e.stopImmediatePropagation()})}var l,i,n=e;t(),this.showEditor=function(e,t){var a=n.dataset();if(!e)return void n.dataset().focusEditControl(i);var s=a.getField(e);if(!s||s.disabled()||s.readOnly())return void l.hide();var r=jQuery(t).offset();i&&l.show().find(".jl-edtfld-"+i).hide();var o=l.find(".jl-edtfld-"+e);l.offset(r),o.show(),n.dataset().focusEditControl(e),i=e},this.currentField=function(){return i},this.hideEditor=function(){l.hide()},this.destroy=function(){n=null}},jslet.ui.FindDialog=function(e){function t(){function e(){if(!(i.recordCount()<2)){var t=u.val(),l=0;c||(l=i.recno()+1);var n=i.findByField(a,t,l,!0,"any");return c=!n,n||l>0&&e(),n}}var t={type:"window",caption:jslet.formatMessage(jslet.locale.findDialog.caption,[""]),isCenter:!1,resizable:!0,minimizable:!1,maximizable:!1,stopEventBubbling:!0,styleClass:"jl-finddlg"};l=jslet.ui.createControl(t,n),l.onClosed(function(){return"hidden"});var o='<div class="input-group input-group-sm"><input class="form-control jl-finddlg-value" placeholder="'+jslet.locale.findDialog.placeholder+'"/><div class="input-group-btn"><button class="btn btn-default jl-finddlg-find"><i class="fa fa-search" /></button></div></div>';l.setContent(o),l.onPositionChanged(function(e,t){s=e>0?e:0,r=t>0?t:0});var d=l.el,u=jQuery(d).find(".jl-finddlg-value"),c=!0;u.on("keydown",function(t){return t.keyCode===jslet.ui.KeyCode.ENTER?(e(),t.stopImmediatePropagation(),t.preventDefault(),!1):void(c=!0)});var h=jQuery(d).find(".jl-finddlg-find");h.on("click",function(t){e()})}var l,i=e.dataset(),n=e.el,a=null,s=-1,r=-1;this.show=function(e,t){s>=0&&(e=s),r>=0&&(t=r),e=e||0,t=t||0,l.show(e,t),this.focus()},this.hide=function(){l.hide()},this.findingField=function(e){if(void 0===e)return a;var t=a;if(a=e){var n=i.getField(a);n&&(l.changeCaption(jslet.formatMessage(jslet.locale.findDialog.caption,[n.label()])),t!=e&&jQuery(l.el).find(".jl-finddlg-value").val(""))}},this.focus=function(){jQuery(l.el).find(".jl-finddlg-value").focus()},this.destroy=function(){l.destroy()},t()},jslet.ui.FilterDialog=function(e,t){},jslet.ui.DBTableFilterPanel=function(e){var t=this;t._width=300,t._height=150,t.fieldName=null,t._filterDatasetObj=new jslet.data.FilterDataset(e.dataset()),t._filterDataset=t._filterDatasetObj.filterDataset(),t._filterDataset.getField("lParenthesis").visible(!1),t._filterDataset.getField("rParenthesis").visible(!1),t._filterDataset.getField("logicalOpr").visible(!1),t._filterDataset.getField("valueExprInput").visible(!1),t._dbtable=e,t._jqFilterBtn=null,t._currFieldName=null,t._currFilterExpr=null},jslet.ui.DBTableFilterPanel.prototype={jqFilterBtn:function(e){this._jqFilterBtn=e},changeField:function(e){var t=this._filterDataset,l=t.getField("field"),i=l.lookup().dataset();t.cancel(),i.filter('[name] == "'+e+'" || like([name],"'+e+'.%")'),i.filtered(!0),l.visible(i.recordCount()>1),t.find('[field] == "'+e+'" || like([field], "'+e+'.%")')||(t.appendRecord(),t.setFieldValue("field",e)),this._currFieldName=e},show:function(e,t,l,i){var n=this;n._panel||(n._panel=n._create()),n._panel.style.left=e+"px",n._panel.style.top=t+"px",jQuery(n._panel).show("fast"),window.setTimeout(function(){n._filterDataset.focusEditControl("value")},5)},hide:function(){this._filterDataset.cancel(),jQuery(this._panel).hide("fast")},cancelFilter:function(){this._filterDataset.cancel()},_create:function(){var e=this;e._panel||(e._panel=document.createElement("div"),e._dbtable.el.appendChild(e._panel)),jQuery(e._panel).addClass("panel panel-default jl-filter-panel"),e._panel.innerHTML="<div class=\"\"><div data-jslet=\"type: 'DBEditPanel', dataset: '"+e._filterDataset.name()+'\', columnCount: 1,hasLabel:false " style="width:100%;height:100%" ></div></div><div><button class="btn btn-default btn-sm jl-filter-panel-ok" tabIndex="90990">'+jslet.locale.FilterPanel.ok+'</button><button class="btn btn-default btn-sm jl-filter-panel-cancel" tabIndex="90991">'+jslet.locale.FilterPanel.cancel+'</button><button class="btn btn-default btn-sm jl-filter-panel-clear" tabIndex="90992">'+jslet.locale.FilterPanel.clear+'</button><button class="btn btn-default btn-sm jl-filter-panel-clearall" tabIndex="90993">'+jslet.locale.FilterPanel.clearAll+"</button></div>",jslet.ui.install(e._panel);var t=jQuery(e._panel);return t.find(".jl-filter-panel-ok").on("click",function(){var t=e._filterDataset;t.confirm(),jslet.isEmpty(t.getFieldValue("value"))&&t.deleteRecord();var l=e._filterDatasetObj.getFilterExpr();e._dbtable.dataset().filter(l).filtered(!0),e._currFilterExpr=l,e.hide(),e._setFilterBtnStyle()}),t.find(".jl-filter-panel-cancel").on("click",function(){e._filterDataset.cancel(),e.hide()}),t.find(".jl-filter-panel-clear").on("click",function(){e._filterDataset.deleteRecord();var t=e._filterDatasetObj.getFilterExpr();e._dbtable.dataset().filter(t).filtered(!0),e.hide(),e._currFilterExpr=t,e._setFilterBtnStyle()}),t.find(".jl-filter-panel-clearall").on("click",function(){e._filterDataset.dataList(null),e._dbtable.dataset().filter(null).filtered(!1),e.hide(),e._clearFilterBtnStyle()}),t.on("keydown",function(e){e.stopImmediatePropagation()}),e._panel},_clearFilterBtnStyle:function(){var e=jQuery(this._panel);jQuery(this._dbtable.el).find(".jl-tbl-filter-hasfilter").attr("title","").removeClass("jl-tbl-filter-hasfilter"),e.find(".jl-filter-panel-clearall").attr("title",""),this._currFilterExpr=null},checkFilterBtnStyle:function(){var e=this;if(e._currFilterExpr){var t=e._dbtable.dataset(),l=t.filter();if(!t.filtered()||l!=e._currFilterExpr){e._clearFilterBtnStyle();var i=e._filterDataset;l&&t.filtered()||i.dataList(null);var n=e._filterDatasetObj.getFilterExprText();jQuery(e._dbtable.el).find("button.jl-tbl-filter").each(function(){var e=this.getAttribute("jsletfilterfield"),t=jQuery(this);i.find('[field] == "'+e+'" || like([field], "'+e+'.%")')?t.addClass("jl-tbl-filter-hasfilter"):t.removeClass("jl-tbl-filter-hasfilter"),t.attr("title",n||"")}),jQuery(e._panel).find(".jl-filter-panel-clearall").attr("title",n||"")}}},_setFilterBtnStyle:function(){var e=this,t=e._filterDatasetObj.getFilterExprText(),l=e._filterDataset;l.find('[field] == "'+e._currFieldName+'" || like([field], "'+e._currFieldName+'.%")')?e._jqFilterBtn.addClass("jl-tbl-filter-hasfilter"):e._jqFilterBtn.removeClass("jl-tbl-filter-hasfilter"),e._jqFilterBtn.attr("title",t||""),jQuery(e._dbtable.el).find(".jl-tbl-filter-hasfilter").attr("title",t||""),jQuery(e._panel).find(".jl-filter-panel-clearall").attr("title",t||"")},destroy:function(){var e=this;jslet.ui.uninstall(e._panel),e._panel.innerHTML="",e._panel=null,e._dbtable=null,e._jqFilterBtn=null}},jslet.ui.ExportDialog=function(e,t){this._dataset=jslet.data.getDataset(e),this._exportDataset=null,this._hasSchemaSection=!(void 0!==t&&!t),this._dlgId=null,this._initialize()},jslet.ui.ExportDialog.prototype={_initialize:function(){var e=[{name:"field",type:"S",length:100,label:"Field Name",nullText:"default"},{name:"label",type:"S",length:50,label:"Field Label"},{name:"parent",type:"S",length:100,label:"Field Name"}],t=jslet.data.createDataset("exportLKDs"+jslet.nextId(),e,{keyField:"field",codeField:"field",nameField:"label",parentField:"parent",
isFireGlobalEvent:!1});t.onCheckSelectable(function(){return!this.hasChildren()});var l=[{name:"schema",type:"S",length:30,label:"Export Schema"},{name:"fields",type:"S",length:500,label:"Export Fields",visible:!1,valueStyle:jslet.data.FieldValueStyle.MULTIPLE,lookup:{dataset:t}}];if(this._exportDataset=jslet.data.createDataset("exportDs"+jslet.nextId(),l,{keyField:"schema",nameField:"schema",isFireGlobalEvent:!1}),this._hasSchemaSection){var i=this._exportDataset,n=new jslet.data.FieldLookup;n.dataset(i),this._exportDataset.getField("schema").lookup(n)}var a={type:"window",caption:jslet.locale.ExportDialog.caption,isCenter:!0,resizable:!0,minimizable:!1,maximizable:!1,animation:"fade"},s=jslet.ui.createControl(a),r=['<div class="form-horizontal jl-expdlg-content" data-jslet="dataset: \'',this._exportDataset.name(),'\'"><div class="form-group form-group-sm">',"<div class=\"col-sm-6\"><div data-jslet=\"type:'DBComboSelect',field:'schema'\"></div></div>",'<div class="col-sm-6"><button class="btn btn-default btn-sm" id="jlbtnSave">',jslet.locale.ExportDialog.saveSchema,'</button><button class="btn btn-default btn-sm">',jslet.locale.ExportDialog.deleteSchema,"</button></div></div>",'<div class="form-group form-group-sm">',"<div class=\"col-sm-12 jl-expdlg-fields\" data-jslet=\"type:'DBList',field:'fields',correlateCheck:true\"></div></div>",'<div class="form-group form-group-sm"><label class="control-label col-sm-3">',jslet.locale.ExportDialog.fileName,"</label>",'<div class="col-sm-9"><input id="jltxtExportFile" class="form-control" type="text"></input></div></div>','<div class="form-group form-group-sm"><label class="control-label col-sm-8">&nbsp</label>','<div class="col-sm-4"><button id="jlbtnExport" class="btn btn-default btn-sm">',jslet.locale.ExportDialog.exportData,'</button><button id="jlbtnCancel" class="btn btn-default btn-sm">',jslet.locale.ExportDialog.cancel,"</button></div></div>","</div>"];s.setContent(r.join("")),s.onClosed(function(){return"hidden"});var o=this;this._dlgId=s.el.id;var d=jQuery(s.el);d.find("#jlbtnExport").click(function(e){var t=d.find("#jltxtExportFile"),l=t.val();if(!l||!l.trim())return jslet.showInfo("FileName required!"),e.stopPropagation(),e.preventDefault(),!1;var i=o._exportDataset.getFieldValue("fields");o._dataset.exportCsvFile(l,{includeFields:i}),s.close()}),d.find("#jlbtnSave").click(function(e){jslet.ui.MessageBox.prompt("Please input exportting shema: ","Input Export Schema",function(e,t){if("ok"===e&&t){var l=o._exportDataset.getFieldValue("fields");o._exportDataset.appendRecord(),o._exportDataset.setFieldValue("schema",t),o._exportDataset.setFieldValue("fields",l),o._exportDataset.confirm()}})}),d.find("#jlbtnCancel").click(function(e){s.close()})},exportDataset:function(e){return this._exportDataset},_refreshFields:function(){function e(t,l,i,n,a){for(var s,r,o=0,d=i.length;d>o;o++){s=i[o],r=s.name(),n&&a&&(r=n+"."+r);var u=s.subDataset();if(u)t.push({field:r,label:s.label(),parent:n||"_all_"}),e(t,l,u.getNormalFields(),r,!0);else if(s.visible()){t.push({field:r,label:s.label(),parent:n||"_all_"});var c=s.children();c?e(t,l,c,r):l.push(r)}}}var t=[{field:"_all_",label:jslet.locale.ExportDialog.all}],l=[];e(t,l,this._dataset.getFields());var i=this._exportDataset.getField("fields").lookup().dataset();i.dataList(t),this._exportDataset.setFieldValue("fields",l),i.first()},show:function(){var e=this;e._refreshFields();var t=jQuery("#"+this._dlgId),l=t[0].jslet,i=e._dataset.description()+".csv",n=t.find("#jltxtExportFile");return n.val(i),l.showModal(),l.setZIndex(999),l}},jslet.ui.InputSettingDialog=function(){function e(e,t,l){var i=jslet.data.getDataset(e.dataset).getField(t);if(l.dataType(i.dataType()),l.length(i.length()),l.scale(i.scale()),l.editMask(i.editMask()),l.displayFormat(i.displayFormat()),l.dateFormat(i.dateFormat()),l.displayControl(i.displayControl()),l.validChars(i.validChars()),i.lookup()){var n=i.lookup(),a=new jslet.data.FieldLookup;a.dataset(n.dataset()),a.keyField(n.keyField()),a.codeField(n.codeField()),a.nameField(n.nameField()),a.displayFields(n.displayFields()),a.parentField(n.parentField()),a.onlyLeafLevel(!1),l.lookup(a),l.editControl("DBComboSelect")}else{l.lookup(null);var s=i.editControl();0===jslet.compareValue(s.type,"DBTextArea")&&(s={type:"DBText"}),l.editControl(s)}l.valueStyle(jslet.data.FieldValueStyle.NORMAL)}function t(){var t=[{name:"dataset",type:"S",length:30,visible:!1},{name:"field",type:"S",length:30,displayWidth:20,visible:!1},{name:"label",type:"S",label:jslet.locale.InputSettingDialog.labelLabel,length:50,displayWidth:20,disabled:!0},{name:"parentField",type:"S",length:30,visible:!1},{name:"tabIndex",type:"N",label:"tabIndex",length:3,visible:!1},{name:"defaultValue",type:"P",label:jslet.locale.InputSettingDialog.labelDefaultValue,length:200,displayWidth:30,proxyHostFieldName:"field",proxyFieldChanged:e},{name:"focused",type:"B",label:jslet.locale.InputSettingDialog.labelFocused,displayWidth:6},{name:"valueFollow",type:"B",label:jslet.locale.InputSettingDialog.labelValueFollow,displayWidth:6},{name:"isDatasetField",type:"B",label:"",visible:!1}];l._inputSettingDs=jslet.data.createDataset("custDs"+jslet.nextId(),t,{keyField:"field",nameField:"label",parentField:"parentField",logChanges:!1,indexFields:"tabIndex",isFireGlobalEvent:!1});var i=function(e,t){var l=e.dataset();e.disabled(l.getFieldValue("isDatasetField"))};l._inputSettingDs.contextRules([{condition:"true",rules:[{field:"defaultValue",customized:i},{field:"focused",customized:i},{field:"valueFollow",customized:i}]}]),l._inputSettingDs.enableContextRule(),l._inputSettingDs.onFieldChanged(function(e,t){if(!l._isInit){l._settings||(l._settings={});var i=this.getFieldValue("dataset"),n=this.getFieldValue("field"),a=l._settings[i];a||(a={},l._settings[i]=a);var s=a[n];s||(s={},a[n]=s),s[e]=t}})}this._inputSettingDs=null,this._hostDataset=null,this._onClosed=null,this._onRestoreDefault=null,this._settings=null;var l=this;t.call(this)},jslet.ui.InputSettingDialog.prototype={hostDataset:function(e){return void 0===e?this._hostDataset:void(this._hostDataset=e)},onClosed:function(e){return void 0===e?this._onClosed:void(this._onClosed=e)},onRestoreDefault:function(e){return void 0===e?this._onRestoreDefault:void(this._onRestoreDefault=e)},show:function(e){jslet.Checker.test("InputSettingDialog.show#hostDataset",e).required();var t=this;t._hostDataset=e,t._isInit=!0,t._settings=null,t._inputSettingDs.disableControls();try{t._initializeFields()}finally{t._isInit=!1,t._inputSettingDs.first(),t._inputSettingDs.enableControls()}var l=!1;t._dlgId||(t._createDialog(),l=!0);var i=jQuery("#"+t._dlgId).find(".jl-isdlg-fields")[0].jslet;i.expandAll(),l&&i.onRowClick(function(){this.dataset().getFieldValue("isDatasetField")&&this.toggle()});var n=jslet("#"+t._dlgId);n.showModal(),n.setZIndex(999)},_initializeFields:function(e,t,l){var i,n=this,a=n._inputSettingDs;e||(e=jslet.data.getDataset(n._hostDataset));var s=e.getNormalFields();t||a.dataList(null);for(var r,o=0,d=s.length;d>o;o++)i=s[o],r=!!i.subDataset(),(r||i.visible())&&(a.appendRecord(),a.setFieldValue("isDatasetField",r),a.setFieldValue("dataset",e.name()),a.setFieldValue("field",i.name()),a.setFieldValue("label",i.label()),a.setFieldValue("tabIndex",i.tabIndex()),l&&a.setFieldValue("parentField",l),r||(a.setFieldValue("defaultValue",i.defaultValue()),a.setFieldValue("focused",i.focused()),a.setFieldValue("valueFollow",i.valueFollow())),a.confirm(),r&&this._initializeFields(i.subDataset(),!0,i.name()))},_createDialog:function(){var e={type:"window",caption:jslet.locale.InputSettingDialog.caption,isCenter:!0,resizable:!0,minimizable:!1,maximizable:!1,animation:"fade",styleClass:"jl-isdlg"},t=jslet.ui.createControl(e),l=['<div class="form-group form-group-sm">',"<div class=\"jl-isdlg-fields\" data-jslet=\"type:'DBTable',dataset:'",this._inputSettingDs.name(),"',treeField:'label',readOnly:false,hasFilterDialog:false\"></div></div>",'<div class="form-group form-group-sm"><label class="control-label col-sm-9">&nbsp</label>','<div class="col-sm-3"><button id="jlbtnSave" class="btn btn-default btn-sm">',jslet.locale.InputSettingDialog.save,'</button><button id="jlbtnCancel" class="btn btn-default btn-sm">',jslet.locale.InputSettingDialog.cancel,"</button></div></div>","</div>"];t.setContent(l.join("")),t.onClosed(function(){return"hidden"}),this._dlgId=t.el.id;var i=jQuery(t.el),n=this;i.find("#jlbtnSave").on("click",function(e){if(n._settings){var l,i,a,s;for(var r in n._settings){l=jslet.data.getDataset(r),a=n._settings[r];for(var o in a){i=l.getField(o),s=a[o];for(var d in s)i[d](s[d])}}n._onClosed&&n._onClosed(n._settings)}t.close()}),i.find("#jlbtnCancel").on("click",function(e){t.close()}),jslet.ui.install(t.el)}},jslet.ui.defaultInputSettingDialog=new jslet.ui.InputSettingDialog,jslet.ui.DBChart=jslet.Class.create(jslet.ui.DBControl,{chartTypes:["line","bar","stackbar","pie"],legendPositions:["none","top","bottom","left","right"],initialize:function($super,e,t){var l=this;l.allProperties="styleClass,dataset,chartType,chartTitle,categoryField,valueFields,legendPos",l.requiredProperties="valueFields,categoryField",l._chartType="line",l._categoryFields=null,l._valueFields=null,l._chartTitle=null,l._legendPos="top",l._fieldValidated=!1,$super(e,t)},chartType:function(e){if(void 0===e)return this._chartType;e=jQuery.trim(e);var t=jslet.Checker.test("DBChart.chartType",e).isString().required();t.testValue(e.toLowerCase()).inArray(this.chartTypes),this._chartType=e},categoryField:function(e){return void 0===e?this._categoryField:(jslet.Checker.test("DBChart.categoryField",e).isString().required(),e=jQuery.trim(e),this._categoryField=e,void(this._fieldValidated=!1))},valueFields:function(e){return void 0===e?this._valueFields:(jslet.Checker.test("DBChart.valueFields",e).isString().required(),e=jQuery.trim(e),this._valueFields=e.split(","),void(this._fieldValidated=!1))},chartTitle:function(e){return void 0===e?this._chartTitle:(jslet.Checker.test("DBChart.chartTitle",e).isString(),void(this._chartTitle=e))},legendPos:function(e){if(void 0===e)return this._legendPos;e=jQuery.trim(e);var t=jslet.Checker.test("DBChart.legendPos",e).isString().required();t.testValue(e.toLowerCase()).inArray(this.legendPositions),this._legendPos=e},isValidTemplateTag:function(e){return"div"==e.tagName.toLowerCase()},bind:function(){this.el.id||(this.el.id=jslet.nextId()),this.renderAll()},_validateFields:function(){var e=this;if(!e._fieldValidated){var t=e._dataset,l=e._categoryField;if(!t.getField(l))throw new Error(jslet.formatMessage(jslet.locale.Dataset.fieldNotFound,[l]));for(var i=0,n=e._valueFields.length;n>i;i++)if(l=e._valueFields[i],!t.getField(l))throw new Error(jslet.formatMessage(jslet.locale.Dataset.fieldNotFound,[l]));e._fieldValidated=!0}},_getLineData:function(){var e=this,t=e._dataset;if(0===t.recordCount())return{xLabels:[],yValues:[]};var l=t.recnoSilence(),i=[],n=[],a=[];try{for(var s,r,o=!1,d=e._valueFields.length,u=0,c=t.recordCount();c>u;u++){t.recnoSilence(u),i.push(t.getFieldText(e._categoryField));for(var h=0;d>h;h++)s=e._valueFields[h],o?r=n[h]:(r=[],n.push(r),a.push(t.getField(s).label())),r.push(t.getFieldValue(s));o=!0}}finally{t.recnoSilence(l)}return{xLabels:i,yValues:n,legendLabels:a}},_getPieData:function(){var e=this,t=e._dataset;if(0===t.recordCount())return[];var l=t.recnoSilence(),i=[];try{for(var n,a,s=e._valueFields[0],r=0,o=t.recordCount();o>r;r++)t.recnoSilence(r),n=t.getFieldText(e._categoryField),a=t.getFieldValue(s),i.push([n,a])}finally{t.recnoSilence(l)}return i},_drawLineChart:function(){var e=this,t=e._getLineData();jQuery.jqplot(e.el.id,t.yValues,{title:e._chartTitle,animate:!jQuery.jqplot.use_excanvas,seriesDefaults:{rendererOptions:{smooth:!0},pointLabels:{show:!0,formatString:"%d"}},legend:{show:!0,labels:t.legendLabels},axes:{xaxis:{renderer:jQuery.jqplot.CategoryAxisRenderer,ticks:t.xLabels}}})},_drawPieChart:function(){var e=this,t=e._getPieData();jQuery.jqplot(e.el.id,[t],{title:e._chartTitle,animate:!jQuery.jqplot.use_excanvas,seriesDefaults:{renderer:jQuery.jqplot.PieRenderer,pointLabels:{show:!0,formatString:"%d"}},legend:{show:!0}})},_drawBarChart:function(e){var t=this,l=t._getLineData();jQuery.jqplot(t.el.id,l.yValues,{title:t._chartTitle,stackSeries:e,animate:!jQuery.jqplot.use_excanvas,seriesDefaults:{renderer:jQuery.jqplot.BarRenderer,pointLabels:{show:!0,formatString:"%d"}},legend:{show:!0,labels:l.legendLabels},axes:{xaxis:{renderer:jQuery.jqplot.CategoryAxisRenderer,ticks:l.xLabels}},highlighter:{show:!1}})},drawChart:function(){var e=this;e._dataset;return e.el.innerHTML="",e._validateFields(),"pie"==e._chartType?void e._drawPieChart():"line"==e._chartType?void e._drawLineChart():"bar"==e._chartType?void e._drawBarChart(!1):"stackbar"==e._chartType?void e._drawBarChart(!0):void 0},refreshControl:function(e){var t=e.eventType;t!=jslet.data.RefreshEvent.UPDATEALL&&t!=jslet.data.RefreshEvent.UPDATERECORD&&t!=jslet.data.RefreshEvent.UPDATECOLUMN&&t!=jslet.data.RefreshEvent.INSERT&&t!=jslet.data.RefreshEvent.DELETE||this.drawChart()},renderAll:function(){this.refreshControl(jslet.data.RefreshEvent.updateAllEvent(),!0)},destroy:function($super){this.swf=null,$super()}}),jslet.ui.register("DBChart",jslet.ui.DBChart),jslet.ui.DBChart.htmlTemplate="<div></div>",jslet.ui.DBEditPanel=jslet.Class.create(jslet.ui.DBControl,{_totalColumns:12,initialize:function($super,e,t){var l=this;l.allProperties="styleClass,dataset,columnCount,labelCols,onlySpecifiedFields,fields,hasLabel",l._columnCount=3,l._labelCols=1,l._onlySpecifiedFields=!1,l._fields=null,l._hasLabel=!0,l._metaChangedDebounce=jslet.debounce(l.renderAll,10),$super(e,t)},columnCount:function(e){return void 0===e?this._columnCount:(jslet.Checker.test("DBEditPanel.columnCount",e).isGTZero(),void(this._columnCount=parseInt(e)))},labelCols:function(e){return void 0===e?this._labelCols:(jslet.Checker.test("DBEditPanel.labelCols",e).isNumber().between(1,3),void(this._labelCols=parseInt(e)))},onlySpecifiedFields:function(e){return void 0===e?this._onlySpecifiedFields:void(this._onlySpecifiedFields=!!e)},hasLabel:function(e){return void 0===e?this._hasLabel:void(this._hasLabel=!!e)},fields:function(e){if(void 0===e)return this._fields;jslet.Checker.test("DBEditPanel.fields",e).isArray();for(var t,l=0,i=e.length;i>l;l++)t=e[l],jslet.Checker.test("DBEditPanel.fields.field",t.field).isString().required(),jslet.Checker.test("DBEditPanel.fields.labelCols",t.colSpan).isNumber().between(1,3),jslet.Checker.test("DBEditPanel.fields.dataCols",t.colSpan).isNumber().between(1,11),jslet.Checker.test("DBEditPanel.fields.prefix",t.prefix).isArray(),jslet.Checker.test("DBEditPanel.fields.suffix",t.suffix).isArray(),t.inFirstCol=!!t.inFirstCol,t.showLine=!!t.showLine,t.visible=!(void 0!==t.visible&&!t.visible);this._fields=e},isValidTemplateTag:function(e){return"div"==e.tagName.toLowerCase()},bind:function(){this.renderAll()},_calcLayout:function(){var e,t,l,i,n=this,a=n._dataset.getNormalFields(),s=a.length;if(n._onlySpecifiedFields)e=n._fields;else{e=[];var r,o,d,u;for(i=n._fields?n._fields.length:0,l=0;s>l;l++){t=a[l],r=t.name(),u=t.visible(),o=!1;for(var c=0;i>c;c++)if(d=n._fields[c],r==d.field){o=!0,(void 0===d.visible||d.visible)&&e.push(d);break}if(!o){if(!u)continue;e.push({field:t.name()})}}}var h=Math.floor((n._totalColumns-n._labelCols*n._columnCount)/n._columnCount);0>=h&&(h=1);var f,p,v=0,_=0;for(l=0,i=e.length;i>l;l++)f=e[l],f.labelCols||(f._innerLabelCols=n._labelCols),f.dataCols?f._innerDataCols=f.dataCols:f._innerDataCols=h,p=f._innerLabelCols+f._innerDataCols,(f.inFirstCol||f.showLine||_+p>n._totalColumns)&&(v++,_=0),f.row=v,_+=p;return e},getEditField:function(e){var t=this;t._fields||(t._fields=[]);for(var l,i=0,n=t._fields.length;n>i;i++)if(l=t._fields[i],l.field==e)return l;var a=t._dataset.getField(e);return a?(l={field:e},t._fields.push(l),l):null},renderAll:function(){var e=this;e.removeAllChildControls();var t=jQuery(e.el);t.hasClass("jl-editpanel")||t.addClass("jl-editpanel form-horizontal"),t.html("");for(var l,i,n,a,s,r,o,d,u,c,h,f,p=e._dataset.getNormalFields(),v=(p.length,e._calcLayout()),_=-1,C=0,j=v.length;j>C;C++){if(l=v[C],l.showLine&&(d=document.createElement("hr"),e.el.appendChild(d)),l.row!=_&&(c=document.createElement("div"),c.className="form-group form-group-sm",e.el.appendChild(c),_=l.row),r=l.field,o=e._dataset.getField(r),!o)throw new Error(jslet.formatMessage(jslet.locale.Dataset.fieldNotFound,[r]));s=o.editControl();var m="dbcheckbox"==s.type.toLowerCase();m?(e._hasLabel&&(a=document.createElement("div"),c.appendChild(a),a.className="col-sm-"+l._innerLabelCols),u=document.createElement("div"),c.appendChild(u),u.className="col-sm-"+(e._hasLabel?l._innerDataCols:12),s.dataset=e._dataset,s.field=r,n=jslet.ui.createControl(s,null),u.appendChild(n.el),e.addChildControl(n),e._hasLabel&&(a=document.createElement("label"),u.appendChild(a),f=new jslet.ui.DBLabel(a,{type:"DBLabel",dataset:e._dataset,field:r})),h=jslet.nextId(),n.el.id=h,jQuery(a).attr("for",h),e.addChildControl(f)):(e._hasLabel&&(a=document.createElement("label"),c.appendChild(a),a.className="col-sm-"+l._innerLabelCols,i=new jslet.ui.DBLabel(a,{type:"DBLabel",dataset:e._dataset,field:r}),e.addChildControl(f)),u=document.createElement("div"),c.appendChild(u),u.className="col-sm-"+(e._hasLabel?l._innerDataCols:12),h=e._renderEditPart(u,l),jQuery(a).attr("for",h),e.addChildControl(n))}},_renderEditPart:function(e,t){var l,i=this,n=t.prefix&&t.prefix.length>0,a=t.suffix&&t.suffix.length>0,s=0;n&&(s=i._renderOtherPart(e,t.prefix)),l=t.field;var r=i._renderEditor(l);return e.appendChild(r),a&&(s+=i._renderOtherPart(e,t.suffix)),s&&(jQuery(r).addClass("jl-ep-part"),r.style.width=jQuery(e).width()-s+"px"),r.id},_renderOtherPart:function(e,t){for(var l,i,n,a=jQuery(e),s=0,r=0,o=t.length;o>r;r++){if(l=t[r],i=l.width,l.field)n=this._renderEditor(l.field),a.append(n);else{if(!l.content){console.warn("prefix or suffix: field or content is required!");continue}var d=jslet.nextId();a.append('<div id = "'+d+'">'+l.content+"</div>");a.children();n=jQuery("#"+d)[0]}i||(console.warn("Width is empty, use 5% instead!"),i="5%"),jQuery(n).addClass("jl-ep-part"),n.style.width=i,s+=jQuery(n).outerWidth()}return s},_renderEditor:function(e){var t=jslet.ui.createControl({type:"DBPlace",dataset:this._dataset,field:e},null);return t.el.id=jslet.nextId(),t.el},doMetaChanged:function($super,e){!e||"visible"!=e&&"editControl"!=e||this._metaChangedDebounce.call(this)}}),jslet.ui.register("DBEditPanel",jslet.ui.DBEditPanel),jslet.ui.DBEditPanel.htmlTemplate="<div></div>",jslet.ui.DBInspector=jslet.Class.create(jslet.ui.DBControl,{initialize:function($super,e,t){var l=this;l.allProperties="styleClass,dataset,columnCount,fields",l._columnCount=1,l._fields=null,l._metaChangedDebounce=jslet.debounce(l.renderAll,10),$super(e,t)},columnCount:function(e){return void 0===e?this._columnCount:(jslet.Checker.test("DBInspector.columnCount",e).isGTZero(),void(this._columnCount=parseInt(e)))},fields:function(e){if(void 0===e)return this._fields;jslet.Checker.test("DBInspector.fields",e).isArray();for(var t,l=0,i=e.length;i>l;l++)t=e[l],jslet.Checker.test("DBInspector.fields.field",t.field).isString().required(),t.visible=!!t.visible;this._fields=e},isValidTemplateTag:function(e){return"div"==e.tagName.toLowerCase()},bind:function(){var e=this,t=e._columnCount;t&&(t=parseInt(t)),t&&t>0?e._columnCount=t:e._columnCount=1,e.renderAll()},renderAll:function(){var e=this,t=jQuery(e.el);e.removeAllChildControls(),t.hasClass("jl-inspector")||t.addClass("jl-inspector jl-round5");var l=t.width(),i=e._dataset.getFields();t.html('<table cellpadding=0 cellspacing=0 style="margin:0;padding:0;table-layout:fixed;width:100%;height:100%"><tbody></tbody></table>');var n,a,s,r,o,d,u=i.length,c=[];for(a=0;u>a;a++){if(n=i[a],o=n.name(),s=!1,e._fields)for(var h=0,f=e._fields.length;f>h;h++)if(d=e._fields[h],o==d.field){s=!0,r=!!d.visible;break}s||(r=n.visible()),r&&c.push(n)}if(u=c.length,0!==u){var p,v,_=Math.min(u,e._columnCount),C=[];for(a=0;_>a;a++)C[a]=0;var j=jslet.ui.textMeasurer.getWidth("*");for(jslet.ui.textMeasurer.setElement(e.el),a=0;u>a;a++)n=c[a],v=a%_,p=Math.round(jslet.ui.textMeasurer.getWidth(n.displayLabel())+j)+15,C[v]<p&&(C[v]=p);jslet.ui.textMeasurer.setElement();var m=0;for(a=0;_>a;a++)m+=C[a];var g,b=(Math.round((l-m)/_),e.el.firstChild),y=b.createTHead(),w=y.insertRow(-1);for(a=0;_>a;a++)g=w.insertCell(-1),g.style.width=C[a]+"px",g=w.insertCell(-1);var x,k,D,S,T,F,I=-1;for(e.preRowIndex=-1,a=0;u>a;a++)n=c[a],o=n.name(),x=Math.floor(a/_),v=a%_,I!=x&&(w=b.insertRow(-1),I=x),g=w.insertCell(-1),g.noWrap=!0,g.className=jslet.ui.htmlclass.DBINSPECTOR.labelColCls,D=document.createElement("label"),g.appendChild(D),F=new jslet.ui.DBLabel(D,{type:"DBLabel",dataset:e._dataset,field:o}),e.addChildControl(F),g=w.insertCell(-1),g.className=jslet.ui.htmlclass.DBINSPECTOR.editorColCls,g.noWrap=!0,g.align="left",k=document.createElement("div"),k.noWrap=!0,g.appendChild(k),T=n.editControl(),T.dataset=e._dataset,T.field=o,S=jslet.ui.createControl(T,k),S.isCheckBox||(S.el.style.width="100%"),e.addChildControl(S)}},doMetaChanged:function($super,e){!e||"visible"!=e&&"editControl"!=e||this._metaChangedDebounce.call(this)}}),jslet.ui.htmlclass.DBINSPECTOR={labelColCls:"jl-inspector-label",editorColCls:"jl-inspector-editor"},jslet.ui.register("DBInspector",jslet.ui.DBInspector),jslet.ui.DBInspector.htmlTemplate="<div></div>",jslet.ui.htmlclass.TABLECLASS={currentrow:"jl-tbl-current",scrollBarWidth:16,selectColWidth:30,hoverrow:"jl-tbl-row-hover"},jslet.ui.TableColumn=function(){var e=this;e.field=null,e.colNum=null,e.label=null,e.title=null,e.displayOrder=null,e.width=null,e.colSpan=null,e.disableHeadSort=!1,e.mergeSame=!1,e.noRefresh=!1,e.visible=!0,e.cellRender=null},jslet.ui.TableSubgroup=function(){var e=this;e.hasExpander=!0,e.template=null,e.height=0},jslet.ui.TableHead=function(){var e=this;e.label=null,e.title=null,e.id=null,e.rowSpan=0,e.colSpan=0,e.disableHeadSort=!1,e.subHeads=null},jslet.ui.AbstractDBTable=jslet.Class.create(jslet.ui.DBControl,{initialize:function($super,e,t){var l=this;l.allProperties="styleClass,dataset,fixedRows,fixedCols,hasSeqCol,hasSelectCol,reverseSeqCol,seqColHeader,noborder,readOnly,editable,hideHead,disableHeadSort,onlySpecifiedCol,selectBy,rowHeight,onRowClick,onRowDblClick,onSelect,onSelectAll,beforeSelect,beforeSelectAll,afterSelect,afterSelectAll,onCustomSort,onFillRow,onFillCell,treeField,columns,subgroup,aggraded,autoClearSelection,onCellClick,defaultCellRender,hasFindDialog,hasFilterDialog",l._fixedRows=0,l._fixedCols=0,l._hasSeqCol=!0,l._reverseSeqCol=!1,l._seqColHeader=null,l._hasSelectCol=!1,l._noborder=!1,l._editable=!1,l._hideHead=!1,l._onlySpecifiedCol=!1,l._disableHeadSort=!1,l._aggraded=!0,l._autoClearSelection=!0,l._selectBy=null,l._rowHeight=null,l._headRowHeight=null,l._treeField=null,l._columns=null,l._onRowClick=null,l._onRowDblClick=null,l._onCellClick=null,l._onCustomSort=null,l._onSelect=null,l._onSelectAll=null,l._beforeSelect=null,l._afterSelect=null,l._beforeSelectAll=null,l._afterSelectAll=null,l._onFillRow=null,l._onFillCell=null,l._defaultCellRender=null,l._hasFindDialog=!0,l._hasFilterDialog=!0,l._repairHeight=0,l.contentHeight=0,l.subgroup=null,l._sysColumns=null,l._isHoriOverflow=!1,l._oldHeight=null,l._currRow=null,l._currColNum=0,l._editingField=null,l._editorTabIndex=1,l._rowHeightChanged=!1,l._cellEditor=null,$super(e,t)},fixedRows:function(e){return void 0===e?this._fixedRows:(jslet.Checker.test("DBTable.fixedRows",e).isNumber(),void(this._fixedRows=parseInt(e)))},fixedCols:function(e){return void 0===e?this._fixedCols:(jslet.Checker.test("DBTable.fixedCols",e).isNumber(),void(this._fixedCols=parseInt(e)))},rowHeight:function(e){var t=this;if(void 0===e){if(null===t._rowHeight){var l=t._editable?"jl-tbl-editing-row":"jl-tbl-row";t._rowHeight=parseInt(jslet.ui.getCssValue(l,"height"))||25}return t._rowHeight}jslet.Checker.test("DBTable.rowHeight",e).isGTZero(),t._rowHeight=parseInt(e),t._rowHeightChanged=!0},headRowHeight:function(e){return void 0===e?(null===this._headRowHeight&&(this._headRowHeight=parseInt(jslet.ui.getCssValue("jl-tbl-header-row","height"))||25),this._headRowHeight):(jslet.Checker.test("DBTable.headRowHeight",e).isGTZero(),void(this._headRowHeight=parseInt(e)))},hasSeqCol:function(e){return void 0===e?this._hasSeqCol:void(this._hasSeqCol=!!e)},reverseSeqCol:function(e){return void 0===e?this._reverseSeqCol:void(this._reverseSeqCol=!!e)},seqColHeader:function(e){return void 0===e?this._seqColHeader:void(this._seqColHeader=e)},hasSelectCol:function(e){return void 0===e?this._hasSelectCol:void(this._hasSelectCol=!!e)},noborder:function(e){return void 0===e?this._noborder:void(this._noborder=!!e)},readOnly:function(e){var t=this;return void 0===e?!t._editable:void t.editable(!e)},editable:function(e){var t=this;return void 0===e?t._editable:(t._editable=!!e,void(t._editable&&!t._rowHeightChanged&&(t._rowHeight=null)))},hideHead:function(e){return void 0===e?this._hideHead:void(this._hideHead=!!e)},aggraded:function(e){return void 0===e?this._aggraded:void(this._aggraded=!!e)},autoClearSelection:function(e){return void 0===e?this._autoClearSelection:void(this._autoClearSelection=!!e)},disableHeadSort:function(e){return void 0===e?this._disableHeadSort:void(this._disableHeadSort=!!e)},onlySpecifiedCol:function(e){return void 0===e?this._onlySpecifiedCol:void(this._onlySpecifiedCol=!!e)},selectBy:function(e){return void 0===e?this._selectBy:(jslet.Checker.test("DBTable.selectBy",e).isString(),void(this._selectBy=e))},treeField:function(e){return void 0===e?this._treeField:(jslet.Checker.test("DBTable.treeField",e).isString(),void(this._treeField=e))},defaultCellRender:function(e){return void 0===e?this._defaultCellRender:(jslet.Checker.test("DBTable.defaultCellRender",e).isObject(),void(this._defaultCellRender=e))},currColNum:function(e){var t=this;if(void 0===e)return t._currColNum;var l=t._currColNum;if(t._currColNum=e,l!==e&&t._adjustCurrentCellPos(l>e),t._showCurrentCell(),t._findDialog){var i=t.innerColumns[e];i.field&&t._findDialog.findingField(i.field)}},onRowClick:function(e){return void 0===e?this._onRowClick:(jslet.Checker.test("DBTable.onRowClick",e).isFunction(),void(this._onRowClick=e))},onRowDblClick:function(e){return void 0===e?this._onRowDblClick:(jslet.Checker.test("DBTable.onRowDblClick",e).isFunction(),void(this._onRowDblClick=e))},onCellClick:function(e){return void 0===e?this._onCellClick:(jslet.Checker.test("DBTable.onCellClick",e).isFunction(),void(this._onCellClick=e))},onSelect:function(e){return void 0===e?this._onSelect:(jslet.Checker.test("DBTable.onSelect",e).isFunction(),void(this._onSelect=e))},onSelectAll:function(e){return void 0===e?this._onSelectAll:(jslet.Checker.test("DBTable.onSelectAll",e).isFunction(),void(this._onSelectAll=e))},beforeSelect:function(e){return void 0===e?this._beforeSelect:(jslet.Checker.test("DBTable.beforeSelect",e).isFunction(),void(this._beforeSelect=e))},afterSelect:function(e){return void 0===e?this._afterSelect:(jslet.Checker.test("DBTable.afterSelect",e).isFunction(),void(this._afterSelect=e))},beforeSelectAll:function(e){return void 0===e?this._beforeSelectAll:(jslet.Checker.test("DBTable.beforeSelectAll",e).isFunction(),void(this._beforeSelectAll=e))},afterSelectAll:function(e){return void 0===e?this._afterSelectAll:(jslet.Checker.test("DBTable.afterSelectAll",e).isFunction(),void(this._afterSelectAll=e))},onCustomSort:function(e){return void 0===e?this._onCustomSort:(jslet.Checker.test("DBTable.onCustomSort",e).isFunction(),void(this._onCustomSort=e))},onFillRow:function(e){return void 0===e?this._onFillRow:(jslet.Checker.test("DBTable.onFillRow",e).isFunction(),void(this._onFillRow=e))},onFillCell:function(e){return void 0===e?this._onFillCell:(jslet.Checker.test("DBTable.onFillCell",e).isFunction(),void(this._onFillCell=e))},hasFindDialog:function(e){var t=this;return void 0===e?t._hasFindDialog:void(t._hasFindDialog=!!e)},hasFilterDialog:function(e){var t=this;return void 0===e?t._hasFilterDialog:void(t._hasFilterDialog=!!e)},cellEditor:function(){var e=this;return e._editable?(e._cellEditor||(e._cellEditor=new jslet.ui.TableCellEditor(e)),e._cellEditor):null},columns:function(e){if(void 0===e)return this._columns;jslet.Checker.test("DBTable.columns",e).isArray();for(var t,l=0,i=e.length;i>l;l++)t=e[l],jslet.Checker.test("DBTable.Column.field",t.field).isString(),jslet.Checker.test("DBTable.Column.label",t.label).isString(),jslet.Checker.test("DBTable.Column.colNum",t.colNum).isGTEZero(),jslet.Checker.test("DBTable.Column.displayOrder",t.displayOrder).isNumber(),jslet.Checker.test("DBTable.Column.width",t.width).isGTZero(),jslet.Checker.test("DBTable.Column.colSpan",t.colSpan).isGTZero(),t.disableHeadSort=!!t.disableHeadSort,t.field||(t.disableHeadSort=!0),t.mergeSame=!!t.mergeSame,t.noRefresh=!!t.noRefresh,jslet.Checker.test("DBTable.Column.cellRender",t.cellRender).isObject();this._columns=e},gotoField:function(e){jslet.Checker.test("DBTable.gotoField#fldName",e).required().isString();var t=this.getColNumByField(e);t>=0&&this.gotoColumn(t)},getColNumByField:function(e){for(var t,l=this.innerColumns.length-1,i=0;l>=i;i++)if(t=this.innerColumns[i],t.field==e)return t.colNum;return-1},getFieldByColNum:function(e){for(var t,l=this.innerColumns.length-1,i=0;l>=i;i++)if(t=this.innerColumns[i],t.colNum==e)return t.field;return null},gotoColumn:function(e){jslet.Checker.test("DBTable.gotoColumn#colNum",e).required().isGTEZero();var t=this.innerColumns.length-1;e>t&&(e=t),this.currColNum(e)},editorTabIndex:function(){return this._editorTabIndex},isValidTemplateTag:function(e){return"div"==e.tagName.toLowerCase()},_calcTabIndex:function(){var e=this;jQuery(e.el);if(e._editable){var t=e._dataset.getMasterFieldObject(),l=null;t&&(l=t.tabIndex()),l||(l=e.el.tabIndex),e._editorTabIndex=l&&l>0?l:null}e.el.tabIndex=-1},bind:function(){var e=this;jslet.resizeEventBus.subscribe(e),jslet.ui.textMeasurer.setElement(e.el),e.charHeight=jslet.ui.textMeasurer.getHeight("M")+4,jslet.ui.textMeasurer.setElement(),e.charWidth=jslet.global.defaultCharWidth||12,e._widthStyleId=jslet.nextId(),e._initializeVm(),e._calcTabIndex(),e.renderAll();var t=jQuery(e.el),l="object"==typeof e.el.onmousewheel,i=l?"mousewheel":"DOMMouseScroll";t.on(i,function(t){var i=t.originalEvent,n=l?i.wheelDelta/-120:i.detail/3;e._editable&&e._dataset.status()!=jslet.data.DataSetStatus.BROWSE&&e._dataset.confirm();var a=e.cellEditor();a&&a.hideEditor(),e.listvm.setVisibleStartRow(e.listvm.getVisibleStartRow()+n),t.preventDefault()}),t.on("mousedown",function(e){return e.shiftKey?(e.preventDefault(),e.stopImmediatePropagation(),!1):void 0}),t.on("click","button.jl-tbl-filter",function(t){e._filterPanel||(e._filterPanel=new jslet.ui.DBTableFilterPanel(e));var l=t.currentTarget,i=jQuery(l),n=jQuery(e.el).offset(),a=i.offset(),s=i.outerHeight(),r=a.left-n.left,o=a.top+s-n.top;jslet.locale.isRtl&&(r+=i.outerWidth());var d=i[0].getAttribute("jsletfilterfield");e._filterPanel.changeField(d),e._filterPanel.jqFilterBtn(i),e._filterPanel.show(r,o,0,s),t.preventDefault(),t.stopImmediatePropagation()}),t.on("click","td.jl-tbl-cell",function(t){var l=t.currentTarget,i=l.jsletColCfg;if(i){if(i.isSeqCol)e._processRowSelection(t.ctrlKey,t.shiftKey,t.altKey);else{var n=i.colNum;if(0!==n&&!n)return;e._doBeforeSelect(t.ctrlKey,t.shiftKey,t.altKey),e.currColNum(n),e._processSelection(t.ctrlKey,t.shiftKey,t.altKey)}e._doCellClick(i);var a=e.cellEditor();if(a)if(e._isCellEditable(i)){var s=i.field;a.showEditor(s,l),i.isBoolColumn&&window.setTimeout(function(){e._dataset.setFieldValue(s,!e._dataset.getFieldValue(s))},5)}else a.hideEditor()}return t.shiftKey||t.ctrlKey?(t.preventDefault(),t.stopImmediatePropagation(),!1):void 0}),t.on("keydown",function(t){var l=t.which,i=t.ctrlKey,n=t.shiftKey,a=t.altKey;if(e._hasFindDialog&&i&&l===jslet.ui.KeyCode.F)return e.showFindDialog(),
t.preventDefault(),t.stopImmediatePropagation(),!1;if(i&&l===jslet.ui.KeyCode.E)return e.gotoNextError(),t.preventDefault(),t.stopImmediatePropagation(),!1;if(i&&l===jslet.ui.KeyCode.C)return void e.copySelection(!1);if(i&&l===jslet.ui.KeyCode.A)return e.selectAllCells(),t.preventDefault(),t.stopImmediatePropagation(),!1;var s=l===jslet.ui.KeyCode.TAB||l===jslet.global.defaultFocusKeyCode;if(n&&s){if(!e.tabPrior())return}else if(s){if(!e.tabNext())return}else if(l===jslet.ui.KeyCode.LEFT)e.movePriorCell(i,n,a);else if(l===jslet.ui.KeyCode.RIGHT)e.moveNextCell(i,n,a);else if(l===jslet.ui.KeyCode.UP)e._doBeforeSelect(i,n,a),e.listvm.priorRow(),e._processSelection(i,n,a);else if(l===jslet.ui.KeyCode.DOWN)e._doBeforeSelect(i,n,a),e.listvm.nextRow();else if(l===jslet.ui.KeyCode.PAGEUP)e.listvm.priorPage();else{if(l!==jslet.ui.KeyCode.PAGEDOWN)return;e.listvm.nextPage()}t.preventDefault(),t.stopImmediatePropagation()})},showFindDialog:function(){var e=this;if(e._filterPanel&&e._filterPanel.hide(),e._hasFindDialog){if(e._findDialog||(e._findDialog=new jslet.ui.FindDialog(e)),!e._findDialog.findingField()){var t=e.innerColumns[e._currColNum];if(t.field)e._findDialog.findingField(t.field);else for(var l=e._currColNum+1,i=e.innerColumns.length;i>l;l++)if(t=e.innerColumns[l],t.field){e._findDialog.findingField(t.field);break}}e._findDialog.findingField()&&e._findDialog.show(0,e.headSectionHt)}},gotoNextError:function(){var e=this;e._dataset.nextError()||e._dataset.firstError()},copySelection:function(e){var t,l=this;if(t=e?l._dataset.selection.getSelectionText('"',!0,"	"):l._dataset.selection.getSelectionText("",!1,"	"),!t){var i=l.getFieldByColNum(l._currColNum);i&&(t=l._dataset.getFieldText(i))}t&&(jslet.Clipboard.putText(t),window.setTimeout(function(){l.el.focus()},5))},selectAllCells:function(){for(var e,t,l=this,i=[],n=0,a=l.innerColumns.length;a>n;n++)e=l.innerColumns[n],t=e.field,t&&i.push(t);l._dataset.selection.selectAll(i,!0),l._refreshSelection()},tabPrior:function(){var e,t=this,l=t.getFieldByColNum(t._currColNum),i=null,n=t._dataset.focusedFields(),a=t._getEditingFields();if(a&&a.indexOf(l)>=0){var s=jslet.ui.focusManager,r=s.onChangingFocus();if(n){n=n.slice(0);for(var o=n.length-1;o>=0;o--)a.indexOf(n[o])<0&&n.splice(o,1)}var d,u=-1;if(n&&(d=n,u=d.indexOf(l)),0>u&&(d=a,u=d.indexOf(l)),r){var c=r(document.activeElement||t.el,!0,t._dataset,s.activeField(),d,s.activeValueIndex());if(!c)return!0}if(d&&u>=0){if(0===u){if(!(t._dataset.recno()>0))return!1;t._dataset.prior(),l=d[d.length-1]}else l=d[u-1];i=t.getColNumByField(l)}}if(null===i)if(e=t.innerColumns.length-1,0===t._currColNum){if(!(t._dataset.recno()>0))return!1;t._dataset.prior(),i=e}else i=t._currColNum-1;return t.currColNum(i),!0},tabNext:function(){var e,t=this,l=t.getFieldByColNum(t._currColNum),i=null,n=t._dataset.focusedFields(),a=t._getEditingFields();if(a&&a.indexOf(l)>=0){var s=jslet.ui.focusManager,r=s.onChangingFocus();if(n){n=n.slice(0);for(var o=n.length-1;o>=0;o--)a.indexOf(n[o])<0&&n.splice(o,1)}var d,u=-1;if(n&&(d=n,u=d.indexOf(l)),0>u&&(d=a,u=d.indexOf(l)),r){var c=r(document.activeElement||t.el,!1,t._dataset,s.activeField(),d,s.activeValueIndex());if(!c)return!0}if(d&&u>=0){if(u===d.length-1){if(!(t._dataset.recno()<t._dataset.recordCount()-1))return!1;t._dataset.next(),l=d[0]}else l=d[u+1];i=t.getColNumByField(l)}}if(null===i)if(e=t.innerColumns.length-1,t._currColNum<e)i=t._currColNum+1;else{if(t._dataset.recno()===t._dataset.recordCount()-1)return!1;t._dataset.next(),i=0}return t.currColNum(i),!0},movePriorCell:function(e,t,l){var i,n=this,a=n.innerColumns.length-1;if(0===n._currColNum){if(!(n._dataset.recno()>0))return;n._dataset.prior(),i=a}else i=n._currColNum-1;n._doBeforeSelect(e,t,l),n.currColNum(i),n._processSelection(e,t,l)},moveNextCell:function(){var e,t=this,l=t.innerColumns.length-1;if(t._currColNum<l)e=t._currColNum+1;else{if(t._dataset.recno()===t._dataset.recordCount()-1)return;t._dataset.next(),e=0}t.currColNum(e)},_getEditingFields:function(){var e=this;if(!e._editable)return null;for(var t,l,i=e._dataset,n=null,a=0,s=e.innerColumns.length;s>a;a++)t=e.innerColumns[a].field,t&&(l=i.getField(t),l.disabled()||l.readOnly()||(n||(n=[]),n.push(t)));return n},_initializeVm:function(){var e=this;e.listvm=new jslet.ui.ListViewModel(e._dataset,!!e._treeField),e.listvm.onTopRownoChanged=function(t){0>t||(e._fillData(),e._syncScrollBar(t),e._showCurrentRow())},e.listvm.onVisibleCountChanged=function(){e.renderAll()},e.listvm.onCurrentRownoChanged=function(t,l){if(0===e._dataset.recordCount())return void(e._currRow=null);e._dataset.recno(e.listvm.getCurrentRecno()),e._currRow&&(e._currRow.fixed&&jQuery(e._currRow.fixed).removeClass(jslet.ui.htmlclass.TABLECLASS.currentrow),jQuery(e._currRow.content).removeClass(jslet.ui.htmlclass.TABLECLASS.currentrow));var i,n=e._getTrByRowno(l);if(n&&(i=n.fixed,i&&jQuery(i).addClass(jslet.ui.htmlclass.TABLECLASS.currentrow),i=n.content,jQuery(i).addClass(jslet.ui.htmlclass.TABLECLASS.currentrow),e._currRow=n,e._editable)){var a=e._editingField;if(a){var s=e._dataset.getField(a);!s||s.disabled()||s.readOnly()||e._dataset.focusEditControl(a)}}}},renderAll:function(){var e=this;e._innerDestroy(),e.el.innerHTML="",e.listvm.fixedRows=e._fixedRows,e._calcParams(),e.listvm.refreshModel(),e._createFrame(),e._fillData(),e._showCurrentRow(),e._oldHeight=jQuery(e.el).height(),e._updateSortFlag(!0)},_doBeforeSelect:function(e,t,l){},_getSelectionFields:function(e,t){if(e>t){var l=e;e=t,t=l}for(var i,n,a,s=[],r=0,o=this.innerColumns.length;o>r;r++)n=this.innerColumns[r],a=n.colNum,a>=e&&t>=a&&(i=n.field,i&&s.push(i));return s},_processSelection:function(e,t,l){var i,n=this,a=n._dataset.recno();if(e||!n._autoClearSelection)return i=n.innerColumns[n._currColNum].field,i&&(n._dataset.selection.isSelected(a,i)?n._dataset.selection.remove(a,a,[i],!0):n._dataset.selection.add(a,a,[i],!0),n._refreshSelection()),n._preRecno=a,void(n._preColNum=n._currColNum);if(t){var s;n._preTmpRecno>=0&&n._preTmpColNum>=0&&(s=n._getSelectionFields(n._preColNum||0,n._preTmpColNum),n._dataset.selection.remove(n._preRecno||0,n._preTmpRecno,s,!1)),s=n._getSelectionFields(n._preColNum||0,n._currColNum),n._dataset.selection.add(n._preRecno||0,a,s,!0),n._refreshSelection(),n._preTmpRecno=a,n._preTmpColNum=n._currColNum}else n._preRecno=a,n._preColNum=n._currColNum,n._preTmpRecno=a,n._preTmpColNum=n._currColNum,n._autoClearSelection&&(n._dataset.selection.removeAll(),n._refreshSelection())},_processColumnSelection:function(e,t,l,i){if(t||l){var n=this,a=n._dataset.recordCount();if(0!==a){var s,r;if(l)n._preTmpColNum>=0&&(s=n._getSelectionFields(n._preColNum||0,n._preTmpColNum),n._dataset.selection.remove(0,a,s,!0)),r=e.colNum+e.colSpan-1,s=n._getSelectionFields(n._preColNum||0,r),n._dataset.selection.add(0,a,s,!0),n._preTmpColNum=r;else{if(!t&&n._autoClearSelection&&n._dataset.selection.removeAll(),e.colSpan>1){s=[];var o,d=e.colNum,u=e.colNum+e.colSpan;for(r=d;u>r;r++)o=n.innerColumns[r].field,s.push(o)}else s=[e.field];n._dataset.selection.add(0,a,s,!0),n._preColNum=e.colNum}n._refreshSelection()}}},_processRowSelection:function(e,t,l){if(e||t){var i=this,n=i._getSelectionFields(0,i.innerColumns.length-1),a=i._dataset.recno();t?(i._preTmpRecno>=0&&i._dataset.selection.remove(i._preRecno||0,i._preTmpRecno,n,!0),i._dataset.selection.add(i._preRecno||0,a,n,!0),i._preTmpColNum=a):(!e&&i._autoClearSelection&&i._dataset.selection.removeAll(),i._dataset.selection.add(a,a,n,!0),i._preRecno=a),i._refreshSelection()}},_prepareColumn:function(){function e(e){if(l._columns)for(var i=0,n=l._columns.length;n>i;i++)if(t=l._columns[i],t.field&&t.field==e)return t;return null}var t,l=this;l._sysColumns=[],l._hasSeqCol&&(t={label:"&nbsp;",width:l.seqColWidth,disableHeadSort:!0,isSeqCol:!0,cellRender:jslet.ui.DBTable.sequenceCellRender,widthCssName:l._widthStyleId+"-s0"},l._sysColumns.push(t)),l._hasSelectCol&&(t={label:'<input type="checkbox" />',width:l.selectColWidth,disableHeadSort:!0,isSelectCol:!0,cellRender:jslet.ui.DBTable.selectCellRender,widthCssName:l._widthStyleId+"-s1"},l._sysColumns.push(t)),l.subgroup&&l.subgroup.hasExpander&&(t={label:"&nbsp;",width:l.selectColWidth,disableHeadSort:!0,isSubgroup:!0,cellRender:jslet.ui.DBTable.subgroupCellRender,widthCssName:l._widthStyleId+"-s2"},l._sysColumns.push(t));var i,n=[];if(l._columns)for(var a=0,s=l._columns.length;s>a;a++){if(t=l._columns[a],t.field){if(i=l._dataset.getField(t.field),!i)throw new Error("Not found Field: "+t.field);t.displayOrder=i.displayOrder()}else t.disableHeadSort=!0;n.push(t)}var r,o,d,u;if(!l._onlySpecifiedCol){var c=l._dataset.getFields();for(r=0,o=c.length;o>r;r++)i=c[r],u=i.name(),i.visible()&&(t=e(u),t||(t=new jslet.ui.TableColumn,t.field=i.name(),t.displayOrder=i.displayOrder(),n.push(t)));if(l._columns)for(r=0,d=l._columns.length;d>r;r++)if(t=l._columns[r],t.field){if(i=l._dataset.getTopField(t.field),!i)throw new Error("Field: "+t.field+" doesn't exist!");var h=i.children();if(h&&h.length>0){u=i.name();var f=!0;if(t.field!=u)for(var p=0;p<n.length;p++)if(n[p].field==u){f=!1;break}f&&(t=new jslet.ui.TableColumn,t.field=u,t.displayOrder=i.displayOrder(),n.push(t))}}}n.sort(function(e,t){var l=e.displayOrder||0,i=t.displayOrder||0;return l===i?0:i>l?-1:1}),l.innerHeads=[],l.innerColumns=[];var v,_,C={lastColNum:0,depth:0};for(r=0,d=n.length;d>r;r++)t=n[r],u=t.field,u?(i=l._dataset.getField(u),l._convertField2Head(C,i)):(v=new jslet.ui.TableHead,_=t.label,v.label=_?_:"",v.level=0,v.colNum=C.lastColNum++,t.colNum=v.colNum,v.id=jslet.nextId(),v.widthCssName=l._widthStyleId+"-"+v.colNum,t.widthCssName=v.widthCssName,v.disableHeadSort=t.disableHeadSort,l.innerHeads.push(v),l.innerColumns.push(t));l.maxHeadRows=C.depth+1,l._calcHeadSpan();var j,m=0,g=l._fixedCols-l._sysColumns.length;for(d=0,r=1,j=l.innerHeads.length;j>r&&(v=l.innerHeads[r],d+=v.colSpan,!(m>=g||g==d));r++)d>g&&g>m&&(l._fixedCols=m+l._sysColumns.length),m=d},_calcHeadSpan:function(e){var t=this;e||(e=t.innerHeads);for(var l,i=0,n=0,a=e.length;a>n;n++)l=e[n],l.rowSpan=t.maxHeadRows-l.level,l.subHeads?(l.colSpan=t._calcHeadSpan(l.subHeads),i+=l.colSpan):(l.colSpan=1,i++);return i},_convertField2Head:function(e,t,l){var i=this;if(!t.visible())return!1;var n,a=0;l?(a=l.level+1,n=l.subHeads):n=i.innerHeads;var s,r=t.name();s=new jslet.ui.TableHead,s.label=t.displayLabel(),s.field=r,s.level=a,s.colNum=e.lastColNum,s.id=jslet.nextId(),n.push(s),e.depth=Math.max(a,e.depth);var o=t.children();if(o&&o.length>0){s.subHeads=[];for(var d=0,u=o.length;u>d;d++)i._convertField2Head(e,o[d],s)}else{e.lastColNum++;for(var c,h=!1,f=i._columns?i._columns.length:0,p=0;f>p;p++)if(c=i._columns[p],c.field==r){h=!0;break}if(h||(c=new jslet.ui.TableColumn,c.field=r),c.label||(c.label=t.displayLabel()),t.getType()===jslet.data.DataType.BOOLEAN&&(c.isBoolColumn=!0),c.mergeSame=t.mergeSame(),c.colNum=s.colNum,!c.width){var v=t?t.displayWidth():0;!i._hideHead&&c.label&&(v=Math.max(v,c.label.length)),c.width=v?v*i.charWidth:10}c.cellRender||(t.getType()==jslet.data.DataType.BOOLEAN?c.cellRender=jslet.ui.DBTable.boolCellRender:c.field==i._treeField&&(c.cellRender=jslet.ui.DBTable.treeCellRender)),s.widthCssName=i._widthStyleId+"-"+s.colNum,c.widthCssName=s.widthCssName,i.innerColumns.push(c)}return!0},_calcParams:function(){var e=this;if(e._currColNum=0,e._preTmpColNum=-1,e._preTmpRecno=-1,e._preRecno=-1,e._preColNum=-1,e._treeField&&(e._disableHeadSort=!0),e._hasSeqCol){e.seqColWidth=(""+e._dataset.recordCount()).length*e.charWidth+5;var t=jslet.ui.htmlclass.TABLECLASS.selectColWidth;e.seqColWidth=e.seqColWidth>t?e.seqColWidth:t}else e.seqColWidth=0;if(e._hasSelectCol?e.selectColWidth=jslet.ui.htmlclass.TABLECLASS.selectColWidth:e.selectColWidth=0,e._fixedRows>0?e.fixedSectionHt=e._fixedRows*e.rowHeight():e.fixedSectionHt=0,e.aggraded()&&e.dataset().checkAggraded()?e.footSectionHt=e.rowHeight():e.footSectionHt=0,e._prepareColumn(),e._fixedCols&&e._fixedCols>e.innerColumns.length&&(e._fixedCols=e.innerColumns.length),e.hasFixedCol=e._sysColumns.length>0||e._fixedCols>0,e.hasFixedCol){var l,i,n=0;for(l=0,i=e._sysColumns.length;i>l;l++)n+=e._sysColumns[l].width+1;for(l=0,i=e._fixedCols;i>l;l++)n+=e.innerColumns[l].width+1;e.fixedColWidth=n+1}else e.fixedColWidth=0},_setScrollBarMaxValue:function(e){var t=this,l=e+t._repairHeight;t.jqVScrollBar.find("div").height(l),t.contentSectionHt+t.footSectionHt>=l?t.jqVScrollBar.parent().addClass("jl-scrollbar-hidden"):t.jqVScrollBar.parent().removeClass("jl-scrollbar-hidden")},_changeColWidthCssRule:function(e,t){var l=this,i=document.getElementById(l._widthStyleId),n=i.styleSheet||i.sheet,a=n.cssRules||n.rules,s=null,r=!1;e="."+e;for(var o=0,d=a.length;d>o;o++)if(s=a[o],s.selectorText==e){r=!0;break}return r&&(s.style.width=t+"px"),r},_changeColWidth:function(e,t){var l=this,i=l.innerColumns[e];if(!(i.width+t<=0)){if(i.width+=t,i.field){l._dataset.designMode(!0);try{l._dataset.getField(i.field).displayWidth(Math.round(i.width/l.charWidth))}finally{l._dataset.designMode(!1)}}l._changeColWidthCssRule(i.widthCssName,i.width)&&l._changeContentWidth(t)}},_refreshSeqColWidth:function(){var e=this;if(e._hasSeqCol){var t=e.seqColWidth;e.seqColWidth=(""+e._dataset.recordCount()).length*e.charWidth;var l=jslet.ui.htmlclass.TABLECLASS.selectColWidth;if(e.seqColWidth=e.seqColWidth>l?e.seqColWidth:l,e.seqColWidth!=t){for(var i,n=0,a=e._sysColumns.length;a>n&&(i=e._sysColumns[n],!i.isSeqCol);n++);i.width=e.seqColWidth,e._changeColWidthCssRule(i.widthCssName,e.seqColWidth);var s=e.seqColWidth-t;e._changeContentWidth(s,!0)}}},_changeContentWidth:function(e,t){var l=this,i=l.getTotalWidth(t),n=i+"px";t?(l.fixedColWidth=i,l.leftHeadTbl.parentNode.parentNode.style.width=l.fixedColWidth+1+"px",l.leftHeadTbl.parentNode.style.width=n,l.leftFixedTbl.parentNode.style.width=n,l.leftContentTbl.parentNode.style.width=n):(l.rightHeadTbl.parentNode.style.width=n,l.rightFixedTbl.parentNode.style.width=n,l.rightContentTbl.parentNode.style.width=n,l.footSectionHt&&(l.rightFootTbl.style.width=n)),l._checkHoriOverflow()},_createFrame:function(){function e(){var e,t,i,n=['<style type="text/css" id="'+l._widthStyleId+'">\n'];for(t=0,i=l._sysColumns.length;i>t;t++)e=l._sysColumns[t],n.push("."+e.widthCssName+"{width:"+e.width+"px}\n");for(t=0,i=l.innerColumns.length;i>t;t++)e=l.innerColumns[t],n.push("."+e.widthCssName+"{width:"+e.width+"px}\n");return n.push("</style>"),n.join("")}function t(e){var t=e.jsletColCfg,i=r.rowIndex,n=r.cellIndex,a=e.parentNode.rowIndex,s=e.cellIndex,o=i==a&&s!=n;if(!o)return o;var d=r.fieldName,u=t.field,c=l._dataset.getField(d).parent(),h=u&&l._dataset.getField(u).parent();return o=c===h||h&&c.name()==h.name()}var l=this;l.el.style.position="relative";var i=jQuery(l.el);i.hasClass("jl-table")||i.addClass("jl-table jl-border-box jl-round5"),l._noborder&&i.addClass("jl-tbl-noborder");var n=['<div class="jl-tbl-splitter" style="display: none"></div>',e(),'<div class="jl-tbl-norecord">',jslet.locale.DBTable.norecord,"</div>",'<table class="jl-tbl-container"><tr>','<td><div class="jl-tbl-fixedcol"><table class="jl-tbl-data"><tbody /></table><table class="jl-tbl-data"><tbody /></table><div class="jl-tbl-content-div"><table class="jl-tbl-data"><tbody /></table></div><table><tbody /></table></div></td>','<td><div class="jl-tbl-contentcol"><div><table class="jl-tbl-data jl-tbl-content-table" border="0" cellpadding="0" cellspacing="0"><tbody /></table></div><div><table class="jl-tbl-data jl-tbl-content-table"><tbody /></table></div><div class="jl-tbl-content-div"><table class="jl-tbl-data jl-tbl-content-table"><tbody /></table></div><table class="jl-tbl-content-table jl-tbl-footer"><tbody /></table></div></td>','<td class="jl-scrollbar-col"><div class="jl-tbl-vscroll-head"></div><div class="jl-tbl-vscroll"><div /></div></td></tr></table>'];i.html(n.join(""));var a=i.find(".jl-tbl-fixedcol")[0].childNodes;l.leftHeadTbl=a[0],l.leftFixedTbl=a[1],l.leftContentTbl=a[2].firstChild,l.leftFootTbl=a[3],a=i.find(".jl-tbl-contentcol")[0].childNodes,l.rightHeadTbl=a[0].firstChild,l.rightFixedTbl=a[1].firstChild,l.rightContentTbl=a[2].firstChild,l.rightFootTbl=a[3],l.height=i.height(),l._hideHead&&(l.leftHeadTbl.style.display="none",l.rightHeadTbl.style.display="none",i.find(".jl-tbl-vscroll-head").css("display","none")),l._fixedRows<=0&&(l.leftFixedTbl.style.display="none",l.rightFixedTbl.style.display="none"),l.footSectionHt||(l.leftFootTbl.style.display="none",l.rightFootTbl.style.display="none"),l.leftHeadTbl.parentNode.parentNode.style.width=l.fixedColWidth+"px";var s=jQuery(l.rightHeadTbl);s.off();s.on("mousedown",l._doSplitHookDown),s.on("mouseup",l._doSplitHookUp);jQuery(l.leftHeadTbl).on("mousedown",".jl-tbl-header-cell",function(e){e=jQuery.event.fix(e||window.event);var t=e.target;if("jl-tbl-splitter-hook"!=t.className){var i=this.jsletColCfg;i.field&&l._processColumnSelection(i,e.ctrlKey,e.shiftKey,e.altKey)}}),s.on("mousedown",".jl-tbl-header-cell",function(e){e=jQuery.event.fix(e||window.event);var t=e.target;if("jl-tbl-splitter-hook"!=t.className){var i=this.jsletColCfg;i.field&&l._processColumnSelection(i,e.ctrlKey,e.shiftKey,e.altKey)}}),jQuery(l.leftHeadTbl).on("mouseup",".jl-focusable-item",function(e){e=jQuery.event.fix(e||window.event);e.target;if(!l.isDraggingColumn)return l._doHeadClick(this.parentNode.parentNode.parentNode.jsletColCfg,e.ctrlKey),l._head_label_cliecked=!0,e.stopImmediatePropagation(),e.preventDefault(),!1}),s.on("mouseup",".jl-focusable-item",function(e){e=jQuery.event.fix(e||window.event);e.target;if(!l.isDraggingColumn)return l._doHeadClick(this.parentNode.parentNode.parentNode.jsletColCfg,e.ctrlKey),l._head_label_cliecked=!0,e.stopImmediatePropagation(),e.preventDefault(),!1});var r=null;s.on("dragstart",".jl-focusable-item",function(e){l._filterPanel&&l._filterPanel.hide();var t=this.parentNode.parentNode.parentNode,i=t.jsletColCfg,n=e.originalEvent,a=n.dataTransfer;return a.dropEffect="link",a.effectAllowed="link",r={fieldName:i.field,rowIndex:t.parentNode.rowIndex,cellIndex:t.cellIndex},a.setData("fieldName",i.field),!0}),s.on("dragover",".jl-tbl-header-cell .jl-tbl-header-div",function(e){if(!r)return!1;var l=this.parentNode,i=e.originalEvent,n=i.dataTransfer;return t(l)?(jQuery(e.currentTarget).addClass("jl-tbl-col-over"),n.dropEffect="link"):n.dropEffect="move",!1}),s.on("dragenter",".jl-tbl-header-cell .jl-tbl-header-div",function(e){if(!r)return!1;var l=this.parentNode,i=e.originalEvent,n=i.dataTransfer;return t(l)?(jQuery(e.currentTarget).addClass("jl-tbl-col-over"),n.dropEffect="link"):n.dropEffect="move",!1}),s.on("dragleave",".jl-tbl-header-cell .jl-tbl-header-div",function(e){return r?(jQuery(e.currentTarget).removeClass("jl-tbl-col-over"),!1):!1}),s.on("drop",".jl-tbl-header-cell .jl-tbl-header-div",function(e){if(!r)return!1;jQuery(e.currentTarget).removeClass("jl-tbl-col-over");var i=this.parentNode,n=e.originalEvent,a=(n.dataTransfer,i.jsletColCfg,r.rowIndex),s=r.cellIndex,o=(i.parentNode.rowIndex,i.cellIndex);if(t(i)){var d=this.parentNode.jsletColCfg.field;if(d){r.fieldName;return l._moveColumn(a,s,o),!1}}});var o=jQuery(l.leftFixedTbl),d=jQuery(l.rightFixedTbl),u=jQuery(l.leftContentTbl),c=jQuery(l.rightContentTbl);o.off(),o.on("mouseenter","tr",function(){jQuery(this).addClass(jslet.ui.htmlclass.TABLECLASS.hoverrow),jQuery(d[0].rows[this.rowIndex]).addClass(jslet.ui.htmlclass.TABLECLASS.hoverrow)}),o.on("mouseleave","tr",function(){jQuery(this).removeClass(jslet.ui.htmlclass.TABLECLASS.hoverrow),jQuery(d[0].rows[this.rowIndex]).removeClass(jslet.ui.htmlclass.TABLECLASS.hoverrow)}),d.off(),d.on("mouseenter","tr",function(){jQuery(this).addClass(jslet.ui.htmlclass.TABLECLASS.hoverrow),jQuery(o[0].rows[this.rowIndex]).addClass(jslet.ui.htmlclass.TABLECLASS.hoverrow)}),d.on("mouseleave","tr",function(){jQuery(this).removeClass(jslet.ui.htmlclass.TABLECLASS.hoverrow),jQuery(o[0].rows[this.rowIndex]).removeClass(jslet.ui.htmlclass.TABLECLASS.hoverrow)}),u.off(),u.on("mouseenter","tr",function(){jQuery(this).addClass(jslet.ui.htmlclass.TABLECLASS.hoverrow),jQuery(c[0].rows[this.rowIndex]).addClass(jslet.ui.htmlclass.TABLECLASS.hoverrow)}),u.on("mouseleave","tr",function(){jQuery(this).removeClass(jslet.ui.htmlclass.TABLECLASS.hoverrow),jQuery(c[0].rows[this.rowIndex]).removeClass(jslet.ui.htmlclass.TABLECLASS.hoverrow)}),c.off(),c.on("mouseenter","tr",function(){jQuery(this).addClass(jslet.ui.htmlclass.TABLECLASS.hoverrow);var e=l._fixedRows>0||l._sysColumns.length>0;e&&jQuery(u[0].rows[this.rowIndex]).addClass(jslet.ui.htmlclass.TABLECLASS.hoverrow)}),c.on("mouseleave","tr",function(){jQuery(this).removeClass(jslet.ui.htmlclass.TABLECLASS.hoverrow);var e=l._fixedRows>0||l._sysColumns.length>0;e&&jQuery(u[0].rows[this.rowIndex]).removeClass(jslet.ui.htmlclass.TABLECLASS.hoverrow)}),l.jqVScrollBar=i.find(".jl-tbl-vscroll"),l.jqVScrollBar.width(jslet.scrollbarSize()+1),l.jqVScrollBar.off().on("scroll",function(){if(!l._keep_silence_){l._editable&&l._dataset.status()!=jslet.data.DataSetStatus.BROWSE&&l._dataset.confirm();var e=Math.round(this.scrollTop/l.rowHeight());if(e!=l.listvm.getVisibleStartRow()){l._keep_silence_=!0;try{l.listvm.setVisibleStartRow(e),l._showCurrentRow();var t=l.cellEditor();t&&t.hideEditor()}finally{l._keep_silence_=!1}}}}),i.find(".jl-tbl-contentcol").off().on("scroll",function(){if(l._isCurrCellInView()){jslet.temp.focusing=!0;try{l._showCurrentCell()}finally{jslet.temp.focusing=!1}}else{var e=l.cellEditor();e&&e.hideEditor()}l._filterPanel&&l._filterPanel.hide()});var h=i.find(".jl-tbl-splitter")[0];h._doDragStart=function(){this.style.display="block",l._filterPanel&&l._filterPanel.hide()},h._doDragging=function(e,t,l,i,n,a){var s=parseInt(jQuery(document.body).css("margin-left")),r=h.parentNode.jslet,o=r.innerColumns[r.currColId];o.width+n<=40||(h.style.left=l-jQuery(h.parentNode).offset().left-s+"px")},h._doDragEnd=function(e,t,l,i,n,a){var s=h.parentNode.jslet;s._changeColWidth(s.currColId,n),h.style.display="none",h.parentNode.jslet.isDraggingColumn=!1;var r=s.cellEditor();r&&r.showEditor()},h._doDragCancel=function(){h.style.display="none",h.parentNode.jslet.isDraggingColumn=!1},l.footSectionHt&&(l.leftFootTbl.style.display="",l.rightFootTbl.style.display=""),l._renderHeader(),l._hideHead?l.headSectionHt=0:l.headSectionHt=l.maxHeadRows*l.headRowHeight(),l._changeContentWidth(0),l.noRecordDiv=i.find(".jl-tbl-norecord")[0],l.noRecordDiv.style.top=l.headSectionHt+"px",l.noRecordDiv.style.left=i.find(".jl-tbl-fixedcol").width()+5+"px",i.find(".jl-tbl-vscroll-head").height(l.headSectionHt+l.fixedSectionHt),l._renderBody()},_moveColumn:function(e,t,l){function i(e,t,l,i,n){var a,s,r,o=0,d=[],u=[];for(s=0,r=e.length;r>s;s++){if(a=e[s],o>=t&&l>=o)d.push(a);else if(o>=i&&n>=o)u.push(a);else if(o>l&&o>n)break;o+=a.colSpan||1}var c;if(t>i)for(c=u[0],s=0,r=d.length;r>s;s++)jQuery(d[s]).insertBefore(c);else for(c=u[u.length-1],s=d.length;s>=0;s--)jQuery(d[s]).insertAfter(c)}function n(e,t,l,n,a,s){var r=e.length;if(0!==r&&r!==t)for(var o,d=(e[t].cells[l].jsletColCfg,t),u=e.length;u>d;d++)o=e[d],i(o.cells,l,n,a,s)}for(var a,s=this,r=s.rightHeadTbl.createTHead().rows,o=r[e],d=0,u=0,c=0,h=0,f=0,p=0,v=0,_=o.cells.length;_>v;v++)a=o.cells[v],f=p,p+=a.colSpan||1,v===t&&(d=f,u=p-1),v===l&&(c=f,h=p-1);var C=o.cells[t],j=o.cells[l],m=C.jsletColCfg,g=j.jsletColCfg,b=m.field,y=g.field;if(b&&y){s._dataset.designMode(!0);try{s._dataset.moveField(b,y)}finally{s._dataset.designMode(!1)}}var w=s.getFieldByColNum(s._currColNum),x=s.rightContentTbl.tBodies[0].rows;s._changeColNum(x[0],d,u,c,h);var k=s.rightHeadTbl.createTHead().rows;n(k,e,d,u,c,h),n(s.rightFixedTbl.tBodies[0].rows,0,d,u,c,h),n(x,0,d,u,c,h),n(s.rightFootTbl.tBodies[0].rows,0,d,u,c,h),s._dataset.selection.removeAll(),s._refreshSelection(),s.gotoField(w)},_changeColNum:function(e,t,l,i,n){if(e){var a,s,r,o=0,d=[],u=[],c=e.cells;for(s=0,r=c.length;r>s;s++){if(a=c[s],o>=t&&l>=o)d.push(a);else if(o>=i&&n>=o)u.push(a);else if(o>l&&o>n)break;o+=a.colSpan||1}var h,f=d.length,p=u.length,v=u[0].jsletColCfg.colNum,_=0;if(t>i){for(s=t;l>=s;s++)h=c[s].jsletColCfg,h.colNum=v+_++;for(s=i;t>s;s++)h=c[s].jsletColCfg,h.colNum=h.colNum+f}else{var C=v-f+p;for(s=t;l>=s;s++)h=c[s].jsletColCfg,h.colNum=C+_++;for(s=l+1;n>=s;s++)h=c[s].jsletColCfg,h.colNum=h.colNum-f}}},_calcAndSetContentHeight:function(){var e=this,t=jQuery(e.el);e.contentSectionHt=e.height-e.headSectionHt-e.fixedSectionHt-e.footSectionHt,e._isHoriOverflow&&(e.contentSectionHt-=jslet.ui.htmlclass.TABLECLASS.scrollBarWidth);var l=e.rowHeight();e.listvm.setVisibleCount(Math.floor(e.contentSectionHt/l),!0),e._repairHeight=e.contentSectionHt-e.listvm.getVisibleCount()*l,t.find(".jl-tbl-contentcol").height(e.height),t.find(".jl-tbl-content-div").height(e.contentSectionHt),e.jqVScrollBar.height(e.contentSectionHt+e.footSectionHt),e._setScrollBarMaxValue(e.listvm.getNeedShowRowCount()*l)},_checkHoriOverflow:function(){var e=this,t=e.getTotalWidth();e._hideHead?e._isHoriOverflow=t>jQuery(e.rightContentTbl.parentNode.parentNode).innerWidth():e._isHoriOverflow=t>e.rightHeadTbl.parentNode.parentNode.clientWidth,e._calcAndSetContentHeight()},_refreshHeadCell:function(e){var t,l=this,i=jQuery(l.el),n=null;if(i.find(".jl-tbl-header-cell").each(function(l,i){return t=this.jsletColCfg,t&&t.field==e?(n=this,!1):void 0}),n){var a=l._dataset.getField(t.field);t.label=a.displayLabel();var s=n.childNodes[0],r=t.cellRender||l._defaultCellRender;if(r&&r.createHeader)s.html(""),r.createHeader.call(l,s,t);else{var o=t.label||"&nbsp;";t.field&&l._isCellEditable(t)&&a&&a.required()&&(o='<span class="jl-lbl-required">*</span>'+o),jQuery(n).find(".jl-focusable-item").html(o)}}},_createHeadCell:function(e,t){var l=this,i=0,n=0;t.subHeads?n=t.colSpan:i=l.maxHeadRows-(t.level?t.level:0);var a=document.createElement("th");a.className="jl-tbl-header-cell jl-unselectable",a.noWrap=!0,a.jsletColCfg=t,i&&i>1&&(a.rowSpan=i),n&&n>1&&(a.colSpan=n),a.innerHTML='<div style="position: relative" unselectable="on" class="jl-unselectable jl-tbl-header-div jl-border-box '+(t.widthCssName||"")+'">';var s=a.childNodes[0],r=t.cellRender||l._defaultCellRender;if(r&&r.createHeader)r.createHeader.call(l,s,t);else{var o=t.label||"&nbsp;";if(t.field){var d=l._dataset.getField(t.field);d&&d.required()&&(o='<span class="jl-lbl-required">*</span>'+o)}s.innerHTML=[l._hasFilterDialog&&t.field&&!t.subHeads?'<button class="jl-tbl-filter" jsletfilterfield="'+t.field+'"><i class="fa fa-filter"></i></button>':"",'<span id="',t.id,'" unselectable="on" style="width:100%;padding:0px 2px">',l._disableHeadSort||t.disableHeadSort?o:'<span class="jl-focusable-item" draggable="true">'+o+"</span>",'</span><span unselectable="on" class="jl-tbl-sorter" title="',jslet.locale.DBTable.sorttitle,'">&nbsp;</span><div  unselectable="on" class="jl-tbl-splitter-hook" colid="',t.colNum,'">&nbsp;</div>'].join("")}e.appendChild(a)},_renderHeader:function(){function e(l){for(var i,n,a=0,o=l.length;o>a;a++)i=l[a],n=i.colNum<t._fixedCols?s.rows[i.level]:r.rows[i.level],t._createHeadCell(n,i),i.subHeads&&e(i.subHeads)}var t=this;if(!t._hideHead){var l,i,n,a,s=t.leftHeadTbl.createTHead(),r=t.rightHeadTbl.createTHead();for(n=0;n<t.maxHeadRows;n++)s.insertRow(-1),r.insertRow(-1);for(l=s.rows[0],n=0,a=t._sysColumns.length;a>n;n++)i=t._sysColumns[n],i.rowSpan=t.maxHeadRows,t._createHeadCell(l,i);e(t.innerHeads);var o,d,u=t.headRowHeight();for(n=0;n<=t.maxHeadRows;n++)o=jQuery(s.rows[n]),d=jQuery(r.rows[n]),o.height(u),d.height(u);t.sortedCell=null,t.indexField=null}},getTotalWidth:function(e){var t,l,i=this,n=0;if(e){for(t=0,l=i._sysColumns.length;l>t;t++)n+=i._sysColumns[t].width;for(t=0,l=i._fixedCols;l>t;t++)n+=i.innerColumns[t].width}else for(t=i._fixedCols,l=i.innerColumns.length;l>t;t++)n+=i.innerColumns[t].width;return n},_doSplitHookDown:function(e){e=jQuery.event.fix(e||window.event);var t=e.target;if("jl-tbl-splitter-hook"==t.className){var l=jslet.ui.findFirstParent(t,function(e){return"div"==e.tagName.toLowerCase()&&e.jslet&&e.jslet._dataset}),i=jQuery(l),n=jQuery(document.body),a=parseInt(n.css("margin-top")),s=parseInt(n.css("margin-left")),r=(i.position().top-a,jQuery(t)),o=i.height()-20,d=r.offset().left-i.offset().left-s,u=i.find(".jl-tbl-splitter")[0];u.style.left=d+"px",u.style.top="1px",u.style.height=o+"px",jslet.ui.dnd.bindControl(u),l.jslet.currColId=parseInt(r.attr("colid")),l.jslet.isDraggingColumn=!0}},_doSplitHookUp:function(e){e=jQuery.event.fix(e||window.event);var t=e.target.lastChild;if(t&&"jl-tbl-splitter-hook"==t.className){var l=jslet.ui.findFirstParent(t,function(e){return"div"==e.tagName.toLowerCase()&&e.jslet&&e.jslet._dataset}),i=jQuery(l),n=jQuery(document.body);n.css("cursor","auto");var a=i.find(".jl-tbl-splitter")[0];"none"!=a.style.display&&(a.style.display="none"),l.jslet.isDraggingColumn=!1}},_getColumnByField:function(e){var t=this;if(!t.innerColumns)return null;for(var l,i=0,n=t.innerColumns.length;n>i;i++)if(l=t.innerColumns[i],l.field==e)return l;return null},_doHeadClick:function(e,t){var l=this;l._disableHeadSort||e.disableHeadSort||l.isDraggingColumn||l._doSort(e.field,t)},_doSort:function(e,t){var l=this;l._dataset.confirm(),l._dataset.disableControls();try{l._onCustomSort?l._onCustomSort.call(l,e):l._dataset.toggleIndexField(e,!t),l.listvm.refreshModel()}finally{l._dataset.enableControls()}},_updateSortFlag:function(){var e=this;if(!e._hideHead){var t,l,i,n,a,s,r=e._dataset.mergedIndexFields(),o=e.leftHeadTbl.createTHead(),d=e.rightHeadTbl.createTHead(),u=[],c=o.rows.length;for(s=0;c>s;s++)for(t=o.rows[s].cells,n=0,a=t.length;a>n;n++)i=t[n],i.jsletColCfg&&(u[u.length]=i);for(s=0;c>s;s++)for(l=d.rows[s].cells,n=0,a=l.length;a>n;n++)i=l[n],i.jsletColCfg&&(u[u.length]=i);var h,f=r.length,p=u.length;for(n=0;p>n;n++)i=u[n],h=jQuery(i).find(".jl-tbl-sorter")[0],h&&(h.innerHTML="&nbsp;");var v,_,C,j=1;for(n=0;f>n;n++){C=r[n];for(var m=0;p>m;m++)if(i=u[m],v=i.jsletColCfg.field,v&&(h=jQuery(i).find(".jl-tbl-sorter")[0],_="&nbsp;",v==C.fieldName)){_=1===C.order?'<i class="fa fa-arrow-up"></i>':'<i class="fa fa-arrow-down"></i>',f>1&&(_+=j++);break}h.innerHTML=_}}},_doSelectBoxClick:function(e){var t=null;e?(e=jQuery.event.fix(e||window.event),t=e.target):t=this;var l=jslet.ui.getParentElement(t,2);try{jQuery(l).click()}finally{var i=jslet.ui.findFirstParent(l,function(e){return!!e.jslet}),n=i.jslet;if(n._onSelect){var a=n._onSelect.call(n,t.checked);if(void 0!==a&&!a)return void(t.checked=!t.checked)}n._beforeSelect&&n._beforeSelect.call(n),n._dataset.select(t.checked?1:0,n._selectBy),n._afterSelect&&n._afterSelect.call(n)}},_doCellClick:function(e){var t=this;t._onCellClick&&t._onCellClick.call(t,e)},_doRowDblClick:function(e){var t=jslet.ui.findFirstParent(this,function(e){return!!e.jslet}),l=t.jslet;l._onRowDblClick&&l._onRowDblClick.call(l,e)},_doRowClick:function(e){var t=jslet.ui.findFirstParent(this,function(e){return!!e.jslet}),l=t.jslet,i=l.dataset();if(this.jsletrecno!==i.recno()){i.status()&&i.confirm();var n=l.listvm.recnoToRowno(this.jsletrecno);l.listvm.setCurrentRowno(n),l._dataset.recno(l.listvm.getCurrentRecno())}l._onRowClick&&l._onRowClick.call(l,e)},_renderCell:function(e,t,l){var i=this,n=document.createElement("td");n.noWrap=!0,n.jsletColCfg=t,jQuery(n).addClass("jl-tbl-cell"),n.innerHTML='<div class="jl-tbl-cell-div '+(t.widthCssName||"")+'"></div>';var a=n.firstChild,s=t.cellRender||i._defaultCellRender;s&&s.createCell?s.createCell.call(i,a,t):i._isCellEditable(t)?(jslet.ui.DBTable.defaultCellRender.createCell.call(i,a,t),t.editable=!0):(jslet.ui.DBTable.defaultCellRender.createCell.call(i,a,t),t.editable=!1),e.appendChild(n)},_renderRow:function(e,t){var l,i=this,n=0,a=null,s=i._fixedCols>0||i._sysColumns.length>0;switch(e){case 1:n=i._fixedRows,s&&(a=i.leftFixedTbl.tBodies[0]),l=i.rightFixedTbl.tBodies[0];break;case 2:n=i.listvm.getVisibleCount(),s&&(a=i.leftContentTbl.tBodies[0]),l=i.rightContentTbl.tBodies[0]}var r,o,d,u,c=0,h=i.innerColumns.length;t&&(c=l.rows.length);
for(var f=i.rowHeight(),p=c;n>p;p++){if(s){r=a.insertRow(-1),r.style.height=f+"px",r.ondblclick=i._doRowDblClick,r.onclick=i._doRowClick;var v=i._sysColumns.length;for(u=0;v>u;u++)o=i._sysColumns[u],i._renderCell(r,o,0===u);for(d=0===v,u=0;u<i._fixedCols;u++)o=i.innerColumns[u],i._renderCell(r,o,d&&0===u)}for(d=!s,r=l.insertRow(-1),r.style.height=f+"px",r.ondblclick=i._doRowDblClick,r.onclick=i._doRowClick,u=i._fixedCols;h>u;u++)o=i.innerColumns[u],i._renderCell(r,o,u==i._fixedCols)}},_renderBody:function(e){var t=this;e?t._renderRow(2,!0):(t._renderRow(1),t._renderRow(2),t._renderTotalSection())},_renderTotalSection:function(){function e(e){var t=document.createElement("td");return t.noWrap=!0,t.innerHTML='<div class="jl-tbl-footer-div '+(e.widthCssName||"")+'"></div>',t.jsletColCfg=e,t}var t=this;if(t.footSectionHt){var l,i,n,a,s,r,o=t._fixedCols>0||t._sysColumns.length>0;if(o&&(l=t.leftFootTbl.tBodies[0]),i=t.rightFootTbl.tBodies[0],o){for(n=l.insertRow(-1),n.style.height=t.rowHeight()+"px",s=0,r=t._sysColumns.length;r>s;s++)a=t._sysColumns[s],n.appendChild(e(a));for(s=0;s<t._fixedCols;s++)a=t.innerColumns[s],n.appendChild(e(a))}for(n=i.insertRow(-1),n.style.height=t.rowHeight()+"px",s=t._fixedCols,r=t.innerColumns.length;r>s;s++)a=t.innerColumns[s],n.appendChild(e(a))}},_fillTotalSection:function(){var e=this,t=e._dataset.aggradedValues();if(e.footSectionHt&&t){var l,i,n=e._sysColumns.length,a=e._fixedCols>0||n>0;a&&(l=e.leftFootTbl.tBodies[0].rows[0]),i=e.rightFootTbl.tBodies[0].rows[0];var s,r,o,d,u,c,h=!1,f=!0;n>0&&(s=l.cells[n-1],s.innerHTML=jslet.locale.DBTable.totalLabel,f=!1);for(var p,v=0,_=e.innerColumns.length;_>v;v++)if(o=e.innerColumns[v],p=o.colNum,s=p<e._fixedCols?l.cells[p+n]:i.cells[p-e._fixedCols],s.style.textAlign="right",d=o.field,c=t[d]){f=!1,r=e._dataset.getField(d),u=r.getType()===jslet.data.DataType.NUMBER?c.sum:c.count;var C=r.displayFormat(),j=u;C&&r.getType()===jslet.data.DataType.NUMBER&&(j=u?jslet.formatNumber(u,C):""),s.firstChild.innerHTML=j,s.firstChild.title=j}else if(f){var m;h?m="&nbsp;":(m=jslet.locale.DBTable.totalLabel,h=!0),s.firstChild.innerHTML=m}}},_fillData:function(){var e=this,t=(e._dataset.recno(),e.listvm.getNeedShowRowCount()),l=t*e.rowHeight()+e.footSectionHt;e._setScrollBarMaxValue(l);var i=0===e.dataset().recordCount();e.noRecordDiv.style.display=i?"block":"none";var n=e._dataset.recnoSilence();try{e._fillRow(!0),e._fillRow(!1),e.footSectionHt&&e._fillTotalSection()}finally{e._dataset.recnoSilence(n)}e._refreshSeqColWidth(),e._cellEditor&&i&&e._cellEditor.hideEditor()},_fillRow:function(e){var t,l=this,i=0,n=0,a=null,s=l._fixedCols>0||l._sysColumns.length>0;if(e){if(i=l._fixedRows,n=-1*l._fixedRows,0===i)return;s&&(a=l.leftFixedTbl.tBodies[0]),t=l.rightFixedTbl.tBodies[0]}else i=l.listvm.getVisibleCount(),n=l.listvm.getVisibleStartRow(),s&&(a=l.leftContentTbl.tBodies[0]),t=l.rightContentTbl.tBodies[0];for(var r,o,d,u,c,h=-1,f=(l.innerColumns.length,l.listvm.getNeedShowRowCount()-l.listvm.getVisibleStartRow()),p=s?a.rows:null,v=t.rows,_={},C=!0,j=Math.min(v.length,i),m=0;j>m;m++)if(m+(e?n:0)>=f)s&&(r=p[m],r.style.display="none"),r=v[m],r.style.display="none";else{if(l.listvm.setCurrentRowno(m+n,!0),h=l.listvm.getCurrentRecno(),l._dataset.recnoSilence(h),s)for(r=p[m],r.jsletrecno=h,r.style.display="",l._onFillRow&&l._onFillRow.call(l,r,l._dataset),o=r.childNodes,d=o.length,c=0;d>c;c++)u=o[c],l._fillCell(h,u,_,C);for(r=v[m],r.jsletrecno=h,r.style.display="",l._onFillRow&&l._onFillRow.call(l,r,l._dataset),r=v[m],o=r.childNodes,d=o.length,c=0;d>c;c++)u=o[c],l._fillCell(h,u,_,C);C=0}},_fillCell:function(e,t,l,i){var n=this,a=t.jsletColCfg;if(a){var s=a.field,r=t.firstChild;if(n._onFillCell&&n._onFillCell.call(n,r,n._dataset,s),s&&a.mergeSame&&l)if(i||!n._dataset.isSameAsPrevious(s))l[s]={cell:t,count:1},jQuery(t).attr("rowspan",1),t.style.display="";else{var o=l[s];o.count++,t.style.display="none",jQuery(o.cell).attr("rowspan",o.count)}var d=a.cellRender||n._defaultCellRender;if(d&&d.refreshCell?d.refreshCell.call(n,r,a,e):jslet.ui.DBTable.defaultCellRender.refreshCell.call(n,r,a,e),s){var u=n._dataset.getFieldErrorByRecno(e,s),c=jQuery(t);r.title;u&&u.message?(c.hasClass("has-error")||c.addClass("has-error"),r.title=u.message):c.hasClass("has-error")&&c.removeClass("has-error")}}},refreshCurrentRow:function(){var e,t,l=this,i=l._fixedCols>0||l._hasSeqCol||l._hasSelectCol,n=null,a=l._dataset.recno();a<l._fixedRows?(i&&(n=l.leftFixedTbl.tBodies[0]),e=l.rightFixedTbl.tBodies[0],t=a):(i&&(n=l.leftContentTbl.tBodies[0]),e=l.rightContentTbl.tBodies[0],t=l.listvm.recnoToRowno(l._dataset.recno())-l.listvm.getVisibleStartRow());var s,r,o,d,u,c,h;if(i){if(s=n.rows[t],!s)return;r=s.childNodes,d=s.jsletrecno,l._onFillRow&&l._onFillRow.call(l,s,l._dataset);var f;for(c=0,h=r.length;h>c;c++)o=r[c],u=o.jsletColCfg,u&&u.isSeqCol?u.cellRender.refreshCell.call(l,o.firstChild,u):u&&u.isSelectCol?(f=o.firstChild,f.checked=l._dataset.selected()):l._fillCell(d,o)}if(s=e.rows[t])for(d=s.jsletrecno,l._onFillRow&&l._onFillRow.call(l,s,l._dataset),r=s.childNodes,c=0,h=r.length;h>c;c++)o=r[c],l._fillCell(d,o)},_getLeftRowByRecno:function(e){var t=this;if(e<t._fixedRows)return t.leftFixedTbl.tBodies[0].rows[e];for(var l,i=t.leftContentTbl.tBodies[0].rows,n=0,a=i.length;a>n;n++)if(l=i[n],l.jsletrecno==e)return l;return null},_showCurrentRow:function(e){var t=this,l=t.listvm.recnoToRowno(t._dataset.recno());t.listvm.setCurrentRowno(l,!1,e),t._showCurrentCell()},_getTrByRowno:function(e){var t,l,i,n,a=this,s=a._fixedCols>0||a._sysColumns.length>0;return 0>e?(l=a.rightFixedTbl.tBodies[0].rows,t=a._fixedRows+e,i=l[t],n=s?a.leftFixedTbl.tBodies[0].rows[t]:null,{fixed:n,content:i}):(l=a.rightContentTbl.tBodies[0].rows,t=e-a.listvm.getVisibleStartRow(),t>=0&&(i=l[t])?(n=s?a.leftContentTbl.tBodies[0].rows[t]:null,{fixed:n,content:i}):null)},_getCurrCellEl:function(){var e=this;if(!e._currRow)return null;for(var t,l,i=e._currRow.content,n=i.cells,a=0,s=n.length;s>a;a++)if(t=n[a],l=t.jsletColCfg,l&&l.colNum===e._currColNum)return t;return null},_adjustCurrentCellPos:function(e){var t=this;if(t._currRow){var l=jQuery(t.el),i=l.find(".jl-tbl-contentcol"),n=i[0];n.scrollLeft;if(!(t._currColNum<t._fixedCols)){var a=t._getCurrCellEl(),s=a.offsetLeft,r=a.offsetWidth,o=n.clientWidth,d=n.scrollLeft;return d>s?void(n.scrollLeft=s):void(s+r>d+o&&(n.scrollLeft=s+r-o))}}},_isCurrCellInView:function(){var e,t,l=this,i=jQuery(l.el),n=i.find(".jl-tbl-contentcol"),a=n[0],s=l._noborder?0:2,r=a.scrollLeft,o=0;if(l._currColNum<l._fixedCols)return!0;for(e=l._fixedCols,t=l.innerColumns.length;e<l._currColNum;e++)o+=l.innerColumns[e].width+s;if(r>o)return!1;var d=n.innerWidth(),u=n.find(".jl-tbl-content-div").width(),c=0;for(e=l.innerColumns.length-1;e>l._currColNum;e--)c+=l.innerColumns[e].width+s;return o=u-c-d,o=o>=0?o:0,!(o>r)},_showCurrentCell:function(){var e=this,t=e._currRow;if(t){var l;l=e._currColNum>=e._fixedCols?t.content:t.fixed;var i=l.jsletrecno,n=e.cellEditor();if(i!==e._dataset.recno())return e.prevCell&&e.prevCell.removeClass("jl-tbl-curr-cell"),void(n&&n.hideEditor());for(var a,s,r=l.cells,o=!1,d=0,u=r.length;u>d;d++)if(a=r[d],s=a.jsletColCfg,s&&s.colNum==e._currColNum){e.prevCell&&e.prevCell.removeClass("jl-tbl-curr-cell");var c=jQuery(a);c.addClass("jl-tbl-curr-cell"),e.prevCell=c,o=!0;break}n&&o&&(e._isCurrCellInView()?n.showEditor(s.field,a):n.hideEditor())}},_showSelected:function(e,t,l){var i=this,n=jQuery(e);void 0===l&&(l=i._dataset.recno());var a=i._dataset.selection.isSelected(l,t);a?n.addClass("jl-tbl-selected"):n.removeClass("jl-tbl-selected")},_refreshSelection:function(){var e=this;jQuery(e.el).find("td.jl-tbl-cell").each(function(t,l){var i=l.jsletColCfg,n=parseInt(l.parentNode.jsletrecno);if((n||0===n)&&i){var a=i.field;a&&e._showSelected(l,a,n)}})},_syncScrollBar:function(e){var t=this;if(!t._keep_silence_){var l=e*t.rowHeight();t._keep_silence_=!0;try{var i=t.jqVScrollBar[0];window.setTimeout(function(){i.scrollTop=l},10)}finally{t._keep_silence_=!1}}},toggle:function(){var e=this;if(0!==e._dataset.recordCount()){var t=e._dataset.expandedByRecno(e._dataset.recno());t?e.listvm.collapse(function(){e._fillData()}):e.listvm.expand(function(){e._fillData()})}},expand:function(){var e=this;if(0!==e._dataset.recordCount()){var t=e._dataset.expandedByRecno(e._dataset.recno());t||e.listvm.expand(function(){e._fillData()})}},collapse:function(){var e=this;if(0!==e._dataset.recordCount()){var t=e._dataset.expandedByRecno(e._dataset.recno());t&&e.listvm.collapse(function(){e._fillData()})}},expandAll:function(){var e=this;e.listvm.expandAll(function(){e._fillData()})},collapseAll:function(){var e=this;e.listvm.collapseAll(function(){e._fillData()})},_doMetaChanged:function(e,t){var l=this;if(!t)return void l.renderAll();if("label"==e&&!l._hideHead)return void l._refreshHeadCell(t);if("required"==e&&l._editable&&!l._hideHead)return void l._refreshHeadCell(t);if(l._editable&&("readOnly"==e||"disabled"==e)){var i=l.cellEditor();if(i){var n=i.currentField();n==t&&i.showEditor(t)}}},refreshControl:function(e){var t,l,i,n,a,s,r,o,d=this,u=e.eventType;if(u==jslet.data.RefreshEvent.CHANGEMETA)d._doMetaChanged(e.metaName,e.fieldName);else if(u==jslet.data.RefreshEvent.AGGRADED)d._fillTotalSection();else if(u==jslet.data.RefreshEvent.BEFORESCROLL);else if(u==jslet.data.RefreshEvent.SCROLL){if(0===d._dataset.recordCount())return;d._showCurrentRow(!0)}else if(u==jslet.data.RefreshEvent.UPDATEALL){if(!d.listvm)return;d.listvm.refreshModel(),d._updateSortFlag(!0),0===d._dataset.recordCount()&&(d._currRow=null),d._fillData(),d._showCurrentRow(!0),d._filterPanel&&d._filterPanel.checkFilterBtnStyle(),d._hasSelectCol&&(jQuery(d.el).find(".jl-tbl-select-all")[0].checked=!1)}else if(u==jslet.data.RefreshEvent.UPDATERECORD)d.refreshCurrentRow();else if(u==jslet.data.RefreshEvent.UPDATECOLUMN||u==jslet.data.RefreshEvent.UPDATELOOKUP)d._fillData();else if(u==jslet.data.RefreshEvent.INSERT){d.listvm.refreshModel(),o=d._dataset.recno();var c=e.preRecno;d._fillData(),d._keep_silence_=!0;try{d.refreshControl(jslet.data.RefreshEvent.scrollEvent(o,c))}finally{d._keep_silence_=!1}}else if(u==jslet.data.RefreshEvent.DELETE)d.listvm.refreshModel(),d._fillData(),0===d._dataset.recordCount()&&(d._currRow=null);else if(u==jslet.data.RefreshEvent.SELECTRECORD){if(!d._hasSelectCol)return;for(r=0,d._hasSeqCol&&r++,o=e.recno,t=0,l=o.length;l>t;t++)i=d._getLeftRowByRecno(o[t]),i&&(n=i.cells[r],a=!!e.selected,s=jQuery(n).find("[type=checkbox]")[0],s.checked=a,s.defaultChecked=a)}else if(u==jslet.data.RefreshEvent.SELECTALL){if(!d._hasSelectCol)return;r=0,d._hasSeqCol&&r++;var h=d.leftFixedTbl.tBodies[0],f=d.leftContentTbl.tBodies[0],p=d._dataset.recno();try{for(t=0,l=h.rows.length;l>t&&(i=h.rows[t],"none"!=i.style.display);t++)d._dataset.recnoSilence(i.jsletrecno),a=!!d._dataset.selected(),n=i.cells[r],s=jQuery(n).find("[type=checkbox]")[0],s.checked=a,s.defaultChecked=a;for(t=0,l=f.rows.length;l>t&&(i=f.rows[t],"none"!=i.style.display);t++)d._dataset.recnoSilence(i.jsletrecno),a=!!d._dataset.selected(),n=i.cells[r],s=jQuery(n).find("[type=checkbox]")[0],s.checked=a,s.defaultChecked=a}finally{d._dataset.recnoSilence(p)}}},_isCellEditable:function(e){var t=this;if(!t._editable)return!1;var l=e.field;if(!l)return!1;var i=t._dataset.getField(l),n=i.fieldDisabled()||i.fieldReadOnly()?0:1;return n},checkSizeChanged:function(){var e=this,t=jQuery(e.el),l=t.height();l!=e._oldHeight&&(e.height=l,e.renderAll())},_innerDestroy:function(){var e=this,t=jQuery(e.el);e._currRow=null,e.listvm.reset(),e.leftHeadTbl=null,e.rightHeadTbl=null,jQuery(e.rightHeadTbl).off(),e.leftFixedTbl=null,e.rightFixedTbl=null,e.leftContentTbl=null,e.rightContentTbl=null,e.leftFootTbl=null,e.rightFootTbl=null,e.noRecordDiv=null,e.jqVScrollBar&&e.jqVScrollBar.off(),e.jqVScrollBar=null;var l=t.find(".jl-tbl-splitter")[0];l&&(l._doDragging=null,l._doDragEnd=null,l._doDragCancel=null),e.parsedHeads=null,e.prevCell=null,t.find("tr").each(function(){this.ondblclick=null,this.onclick=null}),t.find(".jl-tbl-select-check").off(),e._filterPanel&&(e._filterPanel.destroy(),e._filterPanel=null),e._findDialog&&(e._findDialog.destroy(),e._findDialog=null),e._cellEditor&&(e._cellEditor.destroy(),e._cellEditor=null)},destroy:function($super){var e=this,t=jQuery(e.el);jslet.resizeEventBus.unsubscribe(e),t.off(),e._innerDestroy(),e.listvm.destroy(),e.listvm=null,$super()}}),jslet.ui.DBTable=jslet.Class.create(jslet.ui.AbstractDBTable,{}),jslet.ui.register("DBTable",jslet.ui.DBTable),jslet.ui.DBTable.htmlTemplate="<div></div>",jslet.ui.CellRender=jslet.Class.create({createHeader:function(e,t){},createCell:function(e,t){},refreshCell:function(e,t,l){}}),jslet.ui.DefaultCellRender=jslet.Class.create(jslet.ui.CellRender,{createCell:function(e,t){var l=this,i=t.field,n=l._dataset.getField(i);e.parentNode.style.textAlign=n.alignment()},refreshCell:function(e,t,l){if(t&&!t.noRefresh){var i=this,n=t.field;if(n){var a,s=i._dataset.getField(n);try{a=i._dataset.getFieldTextByRecno(l,n)}catch(r){a="error: "+r.message,console.error(r)}if(s.urlExpr()){var o="<a href="+s.calcUrl(),d=s.urlTarget();d&&(o+=" target="+d),o+=">"+a+"</a>",a=o}""!==a&&null!==a&&void 0!==a||(a="&nbsp;");var u=jQuery(e);u.html(a),e.title=u.text(),i._showSelected(e.parentNode,n,l)}}}}),jslet.ui.SequenceCellRender=jslet.Class.create(jslet.ui.CellRender,{createHeader:function(e,t){e.innerHTML=this._seqColHeader||"&nbsp;"},createCell:function(e,t){jQuery(e.parentNode).addClass("jl-tbl-sequence")},refreshCell:function(e,t){if(t&&!t.noRefresh){var l,i=jQuery(e),n=this.listvm.getCurrentRecno();l=this._reverseSeqCol?this._dataset.recordCount()-n:n+1;var a;this._dataset.existRecordError(n)?(i.parent().addClass("has-error"),a=this._dataset.getRecordErrorInfo(n)):(i.parent().removeClass("has-error"),a=l),e.title=a,i.html(l)}}}),jslet.ui.SelectCellRender=jslet.Class.create(jslet.ui.CellRender,{createHeader:function(e,t){e.style.textAlign="center";var l=document.createElement("input");l.type="checkbox";var i=this;jQuery(l).addClass("jl-tbl-select-check jl-tbl-select-all").on("click",function(e){i._beforeSelectAll&&i._beforeSelectAll.call(i),i._dataset.selectAll(this.checked?1:0,i._onSelectAll),i._afterSelectAll&&i._afterSelectAll.call(i)}),e.appendChild(l)},createCell:function(e,t){e.style.textAlign="center";var l=this,i=document.createElement("input"),n=jQuery(i);n.attr("type","checkbox").addClass("jl-tbl-select-check"),n.click(l._doSelectBoxClick),e.appendChild(i)},refreshCell:function(e,t,l){if(t&&!t.noRefresh){var i=this,n=e.firstChild;i._dataset.checkSelectable(l)?(n.checked=i._dataset.selectedByRecno(l),n.style.display=""):n.style.display="none"}}}),jslet.ui.SubgroupCellRender=jslet.Class.create(jslet.ui.CellRender,{createCell:function(e,t){}}),jslet.ui.BoolCellRender=jslet.Class.create(jslet.ui.DefaultCellRender,{refreshCell:function(e,t,l){if(t&&!t.noRefresh){e.style.textAlign="center";var i=jQuery(e);i.html("&nbsp;");var n=this,a=t.field;n._dataset.getField(a);n._dataset.getFieldValueByRecno(l,a)?(i.addClass("jl-tbl-checked"),i.removeClass("jl-tbl-unchecked")):(i.removeClass("jl-tbl-checked"),i.addClass("jl-tbl-unchecked")),n._showSelected(e.parentNode,a,l)}}}),jslet.ui.TreeCellRender=jslet.Class.create(jslet.ui.CellRender,{initialize:function(){},createCell:function(e,t,l){var i=this,n=document.createElement("div"),a=jQuery(n);n.style.height=i.rowHeight()-2+"px",a.html('<span class="jl-tbltree-indent"></span><span class="jl-tbltree-node"></span><span class="jl-tbltree-icon"></span><span class="jl-tbltree-text"></span>');var s=n.childNodes[1];s.onclick=function(e){var t=jslet.ui.findFirstParent(this,function(e){return e.tagName&&"tr"==e.tagName.toLowerCase()});return e.stopImmediatePropagation(),e.preventDefault(),i._dataset.recno(t.jsletrecno),i._dataset.aborted()?!1:(this.expanded?i.listvm.collapse(function(){i._fillData()}):i.listvm.expand(function(){i._fillData()}),!1)},s.onmouseover=function(e){var t=jQuery(this);t.hasClass("jl-tbltree-collapse")?t.addClass("jl-tbltree-collapse-hover"):t.addClass("jl-tbltree-expand-hover")},s.onmouseout=function(e){var t=jQuery(this);t.removeClass("jl-tbltree-collapse-hover"),t.removeClass("jl-tbltree-expand-hover")},e.appendChild(n)},refreshCell:function(e,t,l){if(t&&!t.noRefresh){var i=e.firstChild,n=i.childNodes,a=this,s=a.listvm.getLevel(l);jslet.ui.TreeCellRender.iconWidth||(jslet.ui.TreeCellRender.iconWidth=parseInt(jslet.ui.getCssValue("jl-tbltree-indent","width")));var r=a.listvm.hasChildren(l),o=(r?s:s+1)*jslet.ui.TreeCellRender.iconWidth,d=n[0];d.style.width=o+"px";var u=n[1];if(u.style.display=r?"inline-block":"none",r){u.expanded=a._dataset.expandedByRecno(l);var c=jQuery(u);c.removeClass("jl-tbltree-expand"),c.removeClass("jl-tbltree-collapse"),c.addClass(u.expanded?"jl-tbltree-expand":"jl-tbltree-collapse")}if(t.getIconClass){var h=t.getIconClass(s,r);if(h){var f=jQuery(n[2]);f.addClass("jl-tbltree-icon "+h)}}var p,v=n[3],_=t.field,C=a._dataset.getField(_);try{p=a._dataset.getFieldTextByRecno(l,_)}catch(j){p="error: "+j.message}if(e.title=p,C.urlExpr()){var m="<a href="+C.calcUrl(),g=C.urlTarget();g&&(m+=" target="+g),m+=">"+p+"</a>",p=m}v.innerHTML=p,a._showSelected(e.parentNode,_,l)}}}),jslet.ui.DBTable.defaultCellRender=new jslet.ui.DefaultCellRender,jslet.ui.DBTable.treeCellRender=new jslet.ui.TreeCellRender,jslet.ui.DBTable.boolCellRender=new jslet.ui.BoolCellRender,jslet.ui.DBTable.sequenceCellRender=new jslet.ui.SequenceCellRender,jslet.ui.DBTable.selectCellRender=new jslet.ui.SelectCellRender,jslet.ui.DBTable.subgroupCellRender=new jslet.ui.SubgroupCellRender,jslet.ui.Splitter=function(){if(!jslet.ui._splitDiv){var e=document.createElement("div");e.className="jl-split-column",e.style.display="none",jslet.ui._splitDiv=e,document.body.appendChild(e),e=null}this.isDragging=!1,this.attach=function(e,t,l,i){i||(i=jQuery(e).height());var n=jslet.ui._splitDiv;n.style.height=i+"px",n.style.left=t+"px",n.style.top=l+"px",n.style.display="block",jslet.ui.dnd.bindControl(this),this.isDragging=!1},this.unattach=function(){jslet.ui._splitDiv.style.display="none",this.onSplitEnd=null,this.onSplitCancel=null},this.onSplitEnd=null,this.onSplitCancel=null,this._doDragEnd=function(e,t,l,i,n,a){jslet.ui.dnd.unbindControl(),this.onSplitEnd&&this.onSplitEnd(l-e),this.unattach(),this.isDragging=!1},this._doDragging=function(e,t,l,i,n,a){this.isDragging=!0,jslet.ui._splitDiv.style.left=l+"px"},this._doDragCancel=function(){jslet.ui.dnd.unbindControl(),this.onSplitCancel&&this.onSplitCancel(),this.unattach(),this.isDragging=!1}},jslet.ui.DBTreeView=jslet.Class.create(jslet.ui.DBControl,{initialize:function($super,e,t){var l=this;l.allProperties="styleClass,dataset,displayFields,hasCheckBox,correlateCheck,onlyCheckChildren,readOnly,expandLevel,codeField,codeFormat,onItemClick,onItemDblClick,beforeCheckBoxClick,afterCheckBoxClick,iconClassField,onGetIconClass,onRenderItem,onCreateContextMenu",l.requiredProperties="displayFields",l._displayFields=null,l._hasCheckBox=!1,l._readOnly=!1,l._correlateCheck=!1,l._onlyCheckChildren=!1,l._iconClassField=null,l._expandLevel=-1,l._onItemClick=null,l._onItemDblClick=null,l._beforeCheckBoxClick=null,l._afterCheckBoxClick=null,l._onGetIconClass=null,l._onRenderItem=null,l._onCreateContextMenu=null,l.iconWidth=null,$super(e,t)},displayFields:function(e){if(void 0===e){var t=this._displayFields;if(t)return t;var l=this._dataset,i=l.nameField()||l.codeField()||l.keyField();if(i)return"["+i+"]";jslet.Checker.test("DBTreeView.displayFields",i).required()}e=jQuery.trim(e),jslet.Checker.test("DBTreeView.displayFields",e).required().isString(),this._displayFields=e},iconClassField:function(e){return void 0===e?this._iconClassField:(e=jQuery.trim(e),jslet.Checker.test("DBTreeView.iconClassField",e).isString(),void(this._iconClassField=e))},hasCheckBox:function(e){return void 0===e?this._hasCheckBox:void(this._hasCheckBox=!!e)},correlateCheck:function(e){return void 0===e?this._correlateCheck:void(this._correlateCheck=!!e)},onlyCheckChildren:function(e){return void 0===e?this._onlyCheckChildren:void(this._onlyCheckChildren=!!e)},readOnly:function(e){return void 0===e?this._readOnly:void(this._readOnly=!!e)},expandLevel:function(e){return void 0===e?this._expandLevel:(jslet.Checker.test("DBTreeView.expandLevel",e).isGTEZero(),void(this._expandLevel=parseInt(e)))},onItemClick:function(e){return void 0===e?this._onItemClick:(jslet.Checker.test("DBTreeView.onItemClick",e).isFunction(),void(this._onItemClick=e))},onItemDblClick:function(e){return void 0===e?this._onItemDblClick:(jslet.Checker.test("DBTreeView.onItemDblClick",e).isFunction(),void(this._onItemDblClick=e))},beforeCheckBoxClick:function(e){return void 0===e?this._beforeCheckBoxClick:(jslet.Checker.test("DBTreeView.beforeCheckBoxClick",e).isFunction(),void(this._beforeCheckBoxClick=e))},afterCheckBoxClick:function(e){return void 0===e?this._afterCheckBoxClick:(jslet.Checker.test("DBTreeView.afterCheckBoxClick",e).isFunction(),void(this._afterCheckBoxClick=e))},onGetIconClass:function(e){return void 0===e?this._onGetIconClass:(jslet.Checker.test("DBTreeView.onGetIconClass",e).isFunction(),void(this._onGetIconClass=e))},onRenderItem:function(e){return void 0===e?this._onRenderItem:(jslet.Checker.test("DBTreeView.onRenderItem",e).isFunction(),void(this._onRenderItem=e))},onCreateContextMenu:function(e){return void 0===e?this._onCreateContextMenu:(jslet.Checker.test("DBTreeView.onCreateContextMenu",e).isFunction(),void(this._onCreateContextMenu=e))},isValidTemplateTag:function(e){return"div"==e.tagName.toLowerCase()},bind:function(){var e=this,t=jQuery(e.el);e.scrBarSize=jslet.scrollbarSize()+1,void 0===e._keyField&&(e._keyField=e._dataset.keyField());var l=t.attr("tabindex");l||t.attr("tabindex",-1),t.keydown(function(t){e._doKeydown(t.which)&&t.preventDefault()}),t.on("mouseenter","td.jl-tree-text",function(e){jQuery(this).addClass("jl-tree-nodes-hover")}),t.on("mouseleave","td.jl-tree-text",function(e){jQuery(this).removeClass("jl-tree-nodes-hover")}),t.hasClass("jl-tree")||t.addClass("jl-tree");var i="object"==typeof e.el.onmousewheel,n=i?"mousewheel":"DOMMouseScroll";t.on(n,function(t){var l=t.originalEvent,n=i?l.wheelDelta/-120:l.detail/3;e.listvm.setVisibleStartRow(e.listvm.getVisibleStartRow()+n),t.preventDefault()}),e.renderAll(),e.refreshControl(jslet.data.RefreshEvent.scrollEvent(this._dataset.recno())),e._createContextMenu(),jslet.resizeEventBus.subscribe(e)},renderAll:function(){var e=this,t=jQuery(e.el);e.evaluator=new jslet.Expression(e._dataset,e.displayFields()),t.html(""),e.oldWidth=t.width(),e.oldHeight=t.height(),e.nodeHeight=e.iconWidth=parseInt(jslet.ui.getCssValue("jl-tree","line-height"));var l=t[0].style.height;l.indexOf("%")>0?e.treePanelHeight=t.parent().height()*parseFloat(l)/100:e.treePanelHeight=t.height(),e.treePanelWidth=t.width(),e.nodeCount=Math.floor(e.treePanelHeight/e.nodeHeight),e._initVm(),e._initFrame()},_initFrame:function(){var e=this,t=jQuery(e.el);t.find(".jl-tree-container").off(),t.find(".jl-tree-scrollbar").off();var l,i,n=[];for(l=0;5>l;l++)n.push('<td class="jl-tree-lines" '),n.push(jslet.ui.DBTreeView.NODETYPE),n.push('="0"></td>');var a=n.join(""),s=['<div class="jl-tree-container">'];for(l=0,i=e.nodeCount;i>l;l++)s.push('<table class="jl-tree-nodes" cellpadding="0" cellspacing="0"><tr>'),s.push(a),s.push('<td class="jl-tree-expander" '),s.push(jslet.ui.DBTreeView.NODETYPE),s.push('="1"></td><td '),s.push(jslet.ui.DBTreeView.NODETYPE),s.push('="2"></td><td '),s.push(jslet.ui.DBTreeView.NODETYPE),s.push('="3"></td><td class="jl-tree-text" '),s.push(jslet.ui.DBTreeView.NODETYPE),s.push('="9" nowrap="nowrap"></td></tr></table>');s.push('</div><div class="jl-tree-scrollbar"><div class="jl-tree-tracker"></div></div>'),t.html(s.join(""));var r=t.find(".jl-tree-container");r.on("click",function(t){e._doRowClick(t.target)}),r.on("dblclick",function(t){e._doRowDblClick(t.target)}),e.listvm.setVisibleCount(e.nodeCount);var o=t.find(".jl-tree-scrollbar");o.on("scroll",function(){var t=Math.ceil(this.scrollTop/e.nodeHeight);if(t!=e.listvm.getVisibleStartRow()){e._skip_=!0;try{e.listvm.setVisibleStartRow(t)}finally{e._skip_=!1}}})},resize:function(){var e=this,t=jQuery(e.el),l=t.height(),i=t.width();i!=e.oldWidth&&(e.oldWidth=i,e.treePanelWidth=t.innerWidth(),e._fillData()),l!=e.oldHeight&&(e.oldHeight=l,e.treePanelHeight=t.innerHeight(),e.nodeCount=Math.floor(l/e.nodeHeight)-1,e._initFrame())},hasChildren:function(){return this.listvm.hasChildren()},_initVm:function(){var e=this;e.listvm=new jslet.ui.ListViewModel(e._dataset,!0),e.listvm.refreshModel(e._expandLevel),e.listvm.fixedRows=0,e.listvm.onTopRownoChanged=function(t){t=e.listvm.getCurrentRowno(),e._fillData(),e._doCurrentRowChanged(t),e._syncScrollBar(t)},e.listvm.onVisibleCountChanged=function(){e._fillData();var t=e.listvm.getNeedShowRowCount();jQuery(e.el).find(".jl-tree-tracker").height(e.nodeHeight*t)},e.listvm.onCurrentRownoChanged=function(t,l){e._doCurrentRowChanged(l)},e.listvm.onNeedShowRowsCountChanged=function(t){e._fillData(),jQuery(e.el).find(".jl-tree-tracker").height(e.nodeHeight*(t+2))},e.listvm.onCheckStateChanged=function(){e._fillData()}},_doKeydown:function(e){var t=this,l=!1;return e===jslet.ui.KeyCode.SPACE?(t._doCheckBoxClick(),l=!0):e===jslet.ui.KeyCode.UP?(t.listvm.priorRow(),l=!0):e===jslet.ui.KeyCode.DOWN?(t.listvm.nextRow(),l=!0):e===jslet.ui.KeyCode.LEFT?(jslet.locale.isRtl?t.listvm.expand():t.listvm.collapse(),l=!0):e===jslet.ui.KeyCode.RIGHT?(jslet.locale.isRtl?t.listvm.collapse():t.listvm.expand(),l=!0):e===jslet.ui.KeyCode.PAGEUP?(t.listvm.priorPage(),l=!0):e===jslet.ui.KeyCode.PAGEDOWN&&(t.listvm.nextPage(),l=!0),l},_getTrByRowno:function(e){for(var t,l=jQuery(this.el).find(".jl-tree-nodes"),i=0,n=l.length;n>i;i++)if(t=l[i].rows[0],t.jsletrowno==e)return t;return null},_doCurrentRowChanged:function(e){var t=this;t.prevRow&&jQuery(t._getTextTd(t.prevRow)).removeClass(jslet.ui.htmlclass.TREENODECLASS.selected);var l=t._getTrByRowno(e);l&&jQuery(t._getTextTd(l)).addClass(jslet.ui.htmlclass.TREENODECLASS.selected),t.prevRow=l},_getTextTd:function(e){return e.cells[e.cells.length-1]},_doExpand:function(){this.expand()},_doRowClick:function(e){var t=this,l=e.getAttribute(jslet.ui.DBTreeView.NODETYPE);if(l){if("0"!=l&&t._syncToDs(e),"1"==l||"2"==l){var i=t.listvm.getCurrentRow();"1"==l&&i.children&&i.children.length>0&&(i.expanded?t.collapse():t.expand()),"2"==l&&t._doCheckBoxClick()}"9"==l&&(t._doCheckBoxClick(),t._onItemClick&&t._onItemClick.call(t))}},_doRowDblClick:function(e){this._syncToDs(e);var t=e.getAttribute(jslet.ui.DBTreeView.NODETYPE);this._onItemDblClick&&"9"==t&&this._onItemDblClick.call(this)},_doCheckBoxClick:function(){var e=this;if(!e._readOnly){var t=e.listvm.getCurrentRow();t.hasCheckbox&&(e._beforeCheckBoxClick&&!e._beforeCheckBoxClick.call(e)||(e.listvm.checkNode(e._dataset.selected()?0:1,e._correlateCheck,e._onlyCheckChildren),e._afterCheckBoxClick&&e._afterCheckBoxClick.call(e)))}},_syncToDs:function(e){for(var t,l=-1;;){if(t=e.jsletrowno,0===t||t){l=t;break}if(e=e.parentNode,!e)break}0>l||(this.listvm.setCurrentRowno(l),this._dataset.recno(this.listvm.getCurrentRecno()))},_fillData:function(){var e,t=this,l=t.listvm.getVisibleCount(),i=t.listvm.getVisibleStartRow(),n=t.listvm.getNeedShowRowCount(),a=l+i,s=0,r=jQuery(t.el),o=r.find(".jl-tree-nodes");if(!t._isRendering){t._isRendering=!0,t._skip_=!0;var d,u=t._dataset.recnoSilence(),c=t.listvm.getCurrentRowno(),h=!0,f=0;try{if(a>n){for(var p=a-n;p>0;p--)e=o[l-p],e.style.display="none";h=!1}else n=a;for(var v=n-1,_=i;v>=_;_++)e=o[s++],d=t._fillNode(e,_),h&&f<t.treePanelWidth&&(_==v&&d<t.treePanelWidth?h=!1:f=Math.max(f,d)),_==v&&h?e.style.display="none":(e.style.display="",e.jsletrowno=_)}finally{t.listvm.setCurrentRowno(c,!1),t._dataset.recnoSilence(u),t._isRendering=!1,t._skip_=!1}}},_getCheckClassName:function(e){return e?2==e?jslet.ui.htmlclass.TREECHECKBOXCLASS.mixedChecked:jslet.ui.htmlclass.TREECHECKBOXCLASS.checked:jslet.ui.htmlclass.TREECHECKBOXCLASS.unChecked},_fillNode:function(e,t){var l,i,n,a=e.rows[0],s=this,r=s.listvm.setCurrentRowno(t,!0),o=a.cells,d=o.length,u=r.level+4;if(s._dataset.recnoSilence(s.listvm.getCurrentRecno()),a.jsletrowno=t,u>d)for(i=1,n=u-d;n>=i;i++)l=a.insertCell(0),jQuery(l).addClass("jl-tree-lines").attr("jsletline",1);if(d>=u){for(i=0,n=d-u;n>i;i++)o[i].style.display="none";for(i=d-u;u>i;i++)o[i].style.display=""}d=o.length;var c=r,h=1,f=s.iconWidth*r.level;for(i=r.level;i>0;i--)l=a.cells[d-4-h++],c=c.parent,c.islast?l.className=jslet.ui.htmlclass.TREELINECLASS.empty:l.className=jslet.ui.htmlclass.TREELINECLASS.line;var p=a.cells[d-4];p.noWrap=!0,p.style.display="",r.children&&r.children.length>0?r.islast?p.className=r.expanded?jslet.ui.htmlclass.TREELINECLASS.minusBottom:jslet.ui.htmlclass.TREELINECLASS.plusBottom:p.className=r.expanded?jslet.ui.htmlclass.TREELINECLASS.minus:jslet.ui.htmlclass.TREELINECLASS.plus:r.islast?p.className=jslet.ui.htmlclass.TREELINECLASS.joinBottom:p.className=jslet.ui.htmlclass.TREELINECLASS.join,f+=s.iconWidth;var v=s._hasCheckBox&&s._dataset.checkSelectable(),_=s.listvm.getCurrentRow();_.hasCheckbox=v;var C=a.cells[d-3];v?(C.noWrap=!0,C.className=s._getCheckClassName(s._dataset.selected()),C.style.display="",f+=s.iconWidth):C.style.display="none";var j=a.cells[d-2],m="jl-tree-icon",g=null,b=!(r.children&&r.children.length>0);s._iconClassField||s._onGetIconClass?(s._iconClassField?g=s._dataset.getFieldValue(s._iconClassField):s._onGetIconClass&&(g=s._onGetIconClass.call(s,s._dataset.keyValue(),r.level,b)),g&&(m+=" "+g),j.className!=m&&(j.className=m),j.style.display="",f+=s.iconWidth):j.style.display="none";var y=s.evaluator.eval()||"      ";jslet.ui.textMeasurer.setElement(s.el);var w=Math.round(jslet.ui.textMeasurer.getWidth(y))+10;f+=w+10,jslet.ui.textMeasurer.setElement();var x=a.cells[d-1];x.style.width=w+"px";var k=jQuery(x);return k.html(y),r.isbold?k.addClass("jl-tree-child-checked"):k.removeClass("jl-tree-child-checked"),s._onRenderItem&&s._onRenderItem.call(s,j,x,r.level,b),f},_updateCheckboxState:function(){var e,t,l,i=this,n=i._dataset.recnoSilence(),a=jQuery(i.el),s=a.find(".jl-tree-nodes");try{for(var r=0,o=s.length;o>r;r++)l=s[r].rows[0],t=l.cells.length,e=l.jsletrowno,e&&(i.listvm.setCurrentRowno(e,!0),i._dataset.recnoSilence(i.listvm.getCurrentRecno()),l.cells[t-3].className=i._getCheckClassName(i._dataset.selected()))}finally{i._dataset.recnoSilence(n)}},_syncScrollBar:function(){var e=this;e._skip_||jQuery(e.el).find(".jl-tree-scrollbar").scrollTop(e.nodeHeight*e.listvm.getVisibleStartRow())},expand:function(){this.listvm.expand()},collapse:function(){this.listvm.collapse()},expandAll:function(){this.listvm.expandAll()},collapseAll:function(){this.listvm.collapseAll()},_createContextMenu:function(){if(jslet.ui.Menu){var e=this,t={type:"Menu",onItemClick:e._menuItemClick,items:[]};e._hasCheckBox&&(t.items.push({id:"checkAll",name:jslet.locale.DBTreeView.checkAll}),t.items.push({id:"uncheckAll",name:jslet.locale.DBTreeView.uncheckAll}),t.items.push({name:"-"})),t.items.push({id:"expandAll",name:jslet.locale.DBTreeView.expandAll}),t.items.push({id:"collapseAll",name:jslet.locale.DBTreeView.collapseAll}),e._onCreateContextMenu&&e._onCreateContextMenu.call(e,t.items),0!==t.items.length&&(e.contextMenu=jslet.ui.createControl(t),jQuery(e.el).on("contextmenu",function(t){var l=t.target,i=l.getAttribute(jslet.ui.DBTreeView.NODETYPE);i&&"0"!=i&&(e._syncToDs(l),e.contextMenu.showContextMenu(t,e))}))}},_menuItemClick:function(e,t){"expandAll"==e?this.expandAll():"collapseAll"==e?this.collapseAll():"checkAll"==e?this.listvm.checkChildNodes(!0,this._correlateCheck):"uncheckAll"==e&&this.listvm.checkChildNodes(!1,this._correlateCheck)},refreshControl:function(e){var t=this,l=e.eventType;l==jslet.data.RefreshEvent.CHANGEMETA||(l==jslet.data.RefreshEvent.UPDATEALL?t.renderAll():l==jslet.data.RefreshEvent.INSERT||l==jslet.data.RefreshEvent.DELETE?(t.listvm.refreshModel(t._expandLevel),
l==jslet.data.RefreshEvent.INSERT&&t.listvm.syncDataset()):l==jslet.data.RefreshEvent.UPDATERECORD||l==jslet.data.RefreshEvent.UPDATECOLUMN?t._fillData():l==jslet.data.RefreshEvent.SELECTALL?t._hasCheckBox&&t._fillData():l==jslet.data.RefreshEvent.SELECTRECORD?t._hasCheckBox&&t.listvm.checkNode(t._dataset.selected(),t._correlateCheck,t._onlyCheckChildren):l==jslet.data.RefreshEvent.SCROLL&&t.listvm.syncDataset())},checkSizeChanged:function(){this.resize()},destroy:function($super){var e=this,t=jQuery(e.el);jslet.resizeEventBus.unsubscribe(e),t.find(".jl-tree-nodes").off(),e.listvm.destroy(),e.listvm=null,e.prevRow=null,$super()}}),jslet.ui.htmlclass.TREELINECLASS={line:"jl-tree-lines jl-tree-line",join:"jl-tree-lines jl-tree-join",joinBottom:"jl-tree-lines jl-tree-join-bottom",minus:"jl-tree-lines jl-tree-minus",minusBottom:"jl-tree-lines jl-tree-minus-bottom",noLineMinus:"jl-tree-lines jl-tree-noline-minus",plus:"jl-tree-lines jl-tree-plus",plusBottom:"jl-tree-lines jl-tree-plus-bottom",noLinePlus:"jl-tree-lines jl-tree-noline-plus",empty:"jl-tree-empty"},jslet.ui.htmlclass.TREECHECKBOXCLASS={checked:"jl-tree-checkbox jl-tree-checked",unChecked:"jl-tree-checkbox jl-tree-unchecked",mixedChecked:"jl-tree-checkbox jl-tree-mixedchecked"},jslet.ui.htmlclass.TREENODECLASS={selected:"jl-tree-selected",childChecked:"jl-tree-child-checked",treeNodeLevel:"jl-tree-child-level"},jslet.ui.DBTreeView.NODETYPE="data-nodetype",jslet.ui.register("DBTreeView",jslet.ui.DBTreeView),jslet.ui.DBTreeView.htmlTemplate="<div></div>",jslet.ui.ListViewModel=function(e,t){var l=0,i=0,n=0,a=null,s=null,r=0,o=0;this.onTopRownoChanged=null,this.onVisibleCountChanged=null,this.onCurrentRownoChanged=null,this.onNeedShowRowsCountChanged=null,this.onCheckStateChanged=null,this.fixedRows=0;var d=function(){if(!t)return!1;var l=e;return!(!l._parentField||!l._keyField)};d(),this.refreshModel=function(l){if(t){void 0===l&&(l=-1);var i,n,a=e,r=(a.recordCount(),[]),o=a.recnoSilence();try{a.recnoSilence(this.fixedRows);var d,u,c,h,f,p,v,_=0,C=[];for(i=0,v=a.recordCount();v>i;i++){a.recnoSilence(i),p=a.keyValue(),_=0,u=null,n=a.parentValue();for(var j=C.length-1;j>=0;j--)if(c=C[j],h=c.keyvalue,null!==h&&void 0!==h&&""!==h&&h==n){_=c.level+1,u=c;break}if(u)for(var m=C.length-1;m>j;m--)C.pop();f=a.getRecord();var g=!0;g=l>=0&&l>=_?!0:a.expanded(),d={parent:u,recno:i,keyvalue:p,expanded:g,isbold:0,level:_},C.push(d),u?(u.children||(u.children=[]),u.children.push(d),this._updateParentNodeBoldByChecked(d)):r.push(d)}}finally{a.recnoSilence(o)}s=r,this._setLastFlag(r),this._refreshNeedShowRows()}},this._updateParentNodeBoldByChecked=function(t){if(e.selectedByRecno(t.recno)&&t.parent)for(var l=t.parent;;){if(l.isbold)return;if(l.isbold=1,l=l.parent,!l)return}},this._updateParentNodeBoldByNotChecked=function(t){if(!e.selectedByRecno(t.recno)&&t.parent)for(var l,i=t.parent;;){if(i.children){for(var n=0,a=i.children.length;a>n;n++)if(l=i.children[n],e.selectedByRecno(l.recno))return;i.isbold=0}if(i=i.parent,!i)return}},this._setLastFlag=function(e){if(e&&0!==e.length){var t;e[e.length-1].islast=!0;for(var l=0,i=e.length;i>l;l++)t=e[l],t.children&&t.children.length>0&&this._setLastFlag(t.children);return null}},this._refreshNeedShowRows=function(e){if(t){if(!s)return void this.refreshModel();a?a.length:0;a=[],this._findVisibleNode(s);var l=a.length;!e&&this.onNeedShowRowsCountChanged&&this.onNeedShowRowsCountChanged(l)}},this.hasChildren=function(l){if(!t)return!1;l||(l=e.recno());var i=this._innerFindNode(s,l);if(null!==i)return i.children&&i.children.length>0},this.getLevel=function(l){if(!t)return!1;l||(l=e.recno());var i=this._innerFindNode(s,l);if(null!==i)return i.level},this._findVisibleNode=function(e){if(e)for(var t,l=0,i=e.length;i>l;l++)t=e[l],a.push(t),t.expanded&&this._findVisibleNode(t.children)},this.rownoToRecno=function(e){return t?0>e?(e+=this.fixedRows,e>=0?e:-1):e>=a.length?-1:a[e].recno:e+this.fixedRows},this.recnoToRowno=function(e){if(!t)return e-this.fixedRows;for(var l=0,i=a.length;i>l;l++)if(a[l].recno==e)return l;return-1},this.setVisibleStartRow=function(e,t){if(e>=0){var a=this.getNeedShowRowCount()+1-l;e>a&&(e=a)}0>e&&(e=0),i!=e&&(i=e,n=e+l-1,!t&&this.onTopRownoChanged&&this.onTopRownoChanged(e))},this.getVisibleStartRow=function(){return i},this.setVisibleEndRow=function(e){n=e},this.getVisibleEndRow=function(){return n},this.setVisibleCount=function(e,t){l!=e&&(l=e,n=i+e-1,!t&&this.onVisibleCountChanged&&this.onVisibleCountChanged(e))},this.getVisibleCount=function(){return l},this.getNeedShowRowCount=function(){return t?a.length:e.recordCount()-this.fixedRows},this.getCurrentRow=function(){return a[r]},this.skipSetCurrentRowno=function(){this._skipSetCurrentRowno=!0},this.setCurrentRowno=function(e,n,s){if(this._skipSetCurrentRowno)return this._skipSetCurrentRowno=!1,null;if(void 0===e)return null;var d=r,u=0,c=null;if(0>e){var h=-1*this.fixedRows;h>e&&(e=h),u=this.fixedRows+e}else{var f=this.getNeedShowRowCount();if(0===f)return r=0,o=-1,null;e>=f&&(e=f-1),t?(c=a[e],u=c.recno):u=e+this.fixedRows,s&&(e>=0&&i>e?this.setVisibleStartRow(e):e>=i+l&&this.setVisibleStartRow(e-l+1))}return r=e,o=u,!n&&this.onCurrentRownoChanged&&this.onCurrentRownoChanged(d,r),c},this.getCurrentRowno=function(){return r},this.getCurrentRecno=function(){return o},this.nextRow=function(){e.confirm(),this.setCurrentRowno(r+1,!1,!0)},this.priorRow=function(t){e.confirm(),this.setCurrentRowno(r-1,!1,!0)},this.nextPage=function(){e.confirm(),this.setVisibleStartRow(i+l),this.setCurrentRowno(i)},this.priorPage=function(){e.confirm(),this.setVisibleStartRow(i-l),this.setCurrentRowno(i)},this._innerFindNode=function(e,t){for(var l,i=0,n=e.length-1;n>=i;i++){if(l=e[i],l.recno==t)return l;if(l.children){var a=this._innerFindNode(l.children,t);if(a)return a}}return null},this.expand=function(l){if(t){var i=this._innerFindNode(s,e.recno());if(null!==i){e.confirm();var n=e.recnoSilence();try{i.expanded=!!i.children,e.recnoSilence(i.recno),e.expanded(i.expanded);for(var a=i;;){if(a=a.parent,!a)break;a.expanded||(e.recnoSilence(a.recno),e.expanded(!0),a.expanded=!0)}}finally{e.recnoSilence(n)}this._refreshNeedShowRows(),l&&l()}}},this.collapse=function(l){if(t){var i=this._innerFindNode(s,e.recno());if(null!==i){e.confirm();var n=e.recnoSilence();try{e.recnoSilence(i.recno),e.expanded(!1),i.expanded=!1}finally{e.recnoSilence(n)}this._refreshNeedShowRows(),l&&l()}}},this._iterateNode=function(e,t){for(var l,i=0,n=e.length;n>i;i++)l=e[i],l.children&&(t&&t(l),l.children&&l.children.length>0&&this._iterateNode(l.children,t));return null},this._callbackFn=function(t,l){var i=e.recnoSilence();try{e.recnoSilence(t.recno),e.expanded(l),t.expanded=l}finally{e.recnoSilence(i)}},this.expandAll=function(l){if(t){e.confirm();var i=this;i._iterateNode(s,function(e){i._callbackFn(e,!0)}),i._refreshNeedShowRows(),l&&l()}},this.collapseAll=function(l){if(t){e.confirm();var i=this;i._iterateNode(s,function(e){i._callbackFn(e,!1)}),i._refreshNeedShowRows(),l&&l()}},this.syncDataset=function(){var t=e.recno();if(!(0>t)){var l=this._innerFindNode(s,e.recno()),i=l.parent;if(i&&!i.expanded)for(;;){if(i.expanded)break;if(i.expanded=!0,i=i.parent,!i)break}this._refreshNeedShowRows();var n=this.recnoToRowno(t);this.setCurrentRowno(n,!1,!0)}},this.checkNode=function(t,l,i){var n=this.getCurrentRow();e.selected(t?1:0),l&&(n.children&&n.children.length>0&&this._updateChildState(n,t),n.parent&&!i&&this._updateParentState(n,t)),t?this._updateParentNodeBoldByChecked(n):this._updateParentNodeBoldByNotChecked(n),this.onCheckStateChanged&&this.onCheckStateChanged()},this.checkChildNodes=function(t,l){var i=this.getCurrentRow();e.selected(t?1:0),i.children&&i.children.length>0&&this._updateChildState(i,t),l&&i.parent&&this._updateParentState(i,t),t?this._updateParentNodeBoldByChecked(i):this._updateParentNodeBoldByNotChecked(i),this.onCheckStateChanged&&this.onCheckStateChanged()},this._updateChildState=function(t,l){var i,n=e.recnoSilence();try{for(var a=0,s=t.children.length;s>a;a++)i=t.children[a],e.recnoSilence(i.recno),e.selected(l),i.children&&i.children.length>0&&this._updateChildState(i,l)}finally{e.recnoSilence(n)}},this._updateParentState=function(t,l){var i=t.parent;if(i){var n,a,s;if(2!=l)for(var r=0,o=i.children.length;o>r;r++){if(n=i.children[r],s=e.selectedByRecno(n.recno),2==s){a=2;break}if(0===r)a=s;else if(a!=s){a=2;break}}else a=l;var d=e.selectedByRecno(i.recno);if(d!=a){var u=e.recnoSilence();try{e.recnoSilence(i.recno),e.selected(a)}finally{e.recnoSilence(u)}}this._updateParentState(i,a)}},this.reset=function(){l=0,i=0,n=0,a=null,s=null,r=0,o=0,this.fixedRows=0},this.destroy=function(){e=null,s=null,this.reset(),this.onTopRownoChanged=null,this.onVisibleCountChanged=null,this.onCurrentRownoChanged=null,this.onNeedShowRowsCountChanged=null,this.onCheckStateChanged=null}},jslet.ui.DBPlace=jslet.Class.create(jslet.ui.DBFieldControl,{initialize:function($super,e,t){this.allProperties="styleClass,dataset,field,expandChildWidth",this.editControl=null,this._expandChildWidth=!0,$super(e,t)},isValidTemplateTag:function(e){var t=e.tagName.toLowerCase();return"div"==t},bind:function(){var e=this;e.renderAll()},expandChildWidth:function(e){return void 0===e?this._expandChildWidth:(this._expandChildWidth=!!e,this)},refreshControl:function(e){var t=this,l=e.eventType;return l!=jslet.data.RefreshEvent.CHANGEMETA||t._field!=e.fieldName||"editControl"!=e.metaName&&"valueStyle"!=e.metaName?void 0:(t.renderAll(),!0)},renderAll:function(){var e=this;e.removeAllChildControls();var t=e._dataset.getField(e._field),l=t.editControl();t.valueStyle()==jslet.data.FieldValueStyle.BETWEEN&&(l={type:"DBBetweenEdit"}),l.dataset=e._dataset,l.field=e._field,(e._tabIndex||0===e._tabIndex)&&(l.tabIndex=e._tabIndex);var i=jslet.ui.createControl(l,e.el);e._expandChildWidth||(i.el.style.width="100%"),e.addChildControl(i),i.tableId(e._tableId)},canFocus:function(){return!1}}),jslet.ui.register("DBPlace",jslet.ui.DBPlace),jslet.ui.DBPlace.htmlTemplate="<div></div>",jslet.ui.DBText=jslet.Class.create(jslet.ui.DBFieldControl,{initialize:function($super,e,t){var l=this;l.allProperties="styleClass,dataset,field,beforeUpdateToDataset,enableInvalidTip,onKeyDown,autoSelectAll",l._beforeUpdateToDataset=null,l._enableInvalidTip=!0,l._enterProcessed=!1,l._autoSelectAll=!0,l.oldValue=null,l.editMask=null,l._position=null,$super(e,t)},beforeUpdateToDataset:function(e){return void 0===e?this._beforeUpdateToDataset:(jslet.Checker.test("DBText.beforeUpdateToDataset",e).isFunction(),void(this._beforeUpdateToDataset=e))},enableInvalidTip:function(e){return void 0===e?this._enableInvalidTip:void(this._enableInvalidTip=!!e)},autoSelectAll:function(e){return void 0===e?this._autoSelectAll:void(this._autoSelectAll=!!e)},isValidTemplateTag:function(e){return"input"==e.tagName.toLowerCase()&&"text"==e.type.toLowerCase()},bind:function(){var e=this;e.renderAll();var t=jQuery(e.el);t.addClass("form-control"),e.doFocus&&t.on("focus",jQuery.proxy(e.doFocus,e)),e.doBlur&&t.on("blur",jQuery.proxy(e.doBlur,e)),e.doKeydown&&t.on("keydown",e.doKeydown),e.doKeypress&&t.on("keypress",e.doKeypress),e.doMetaChanged("required")},doFocus:function(){var e=this;e._skipFocusEvent||(jslet.ui.focusManager.activeDataset(e._dataset.name()).activeField(e._field).activeValueIndex(e._valueIndex),e.doValueChanged(),e.oldValue=e.el.value,e._autoSelectAll&&jslet.ui.textutil.selectText(e.el))},doBlur:function(){var e=this,t=e._dataset.getField(e._field);if(jslet.ui.focusManager.activeDataset(null).activeField(null).activeValueIndex(null),e._position=jslet.ui.textutil.getCursorPos(e.el),!t.readOnly()&&!t.disabled()){var l=jQuery(this);if(!l.attr("readOnly")&&!l.attr("disabled")){e.updateToDataset(),e._isBluring=!0;try{e.doValueChanged()}finally{e._isBluring=!1}}}},doKeydown:function(e){e=jQuery.event.fix(e||window.event);var t=e.which,l=this.jslet,i=jslet.ui.KeyCode;t===i.ENTER&&(l._enterProcessed=!0,l.updateToDataset());var n=l._dataset.status()>0;!n||t!==i.UP&&t!==i.DOWN&&t!==i.PAGEUP&&t!==i.PAGEDOWN||(l._enterProcessed=!0,l.updateToDataset());var a=l._dataset.getField(l._field);if(a.readOnly()||a.disabled()||t!==i.BACKSPACE&&t!==i.DELETE||l._dataset.editRecord(),t===i.LEFT||t===i.RIGHT){var s=jslet.ui.textutil.getCursorPos(l.el);(t===i.LEFT&&s.begin>0||39===t&&s.begin<l.el.value.length)&&e.stopImmediatePropagation()}},doKeypress:function(e){var t=this.jslet,l=t._dataset.getField(t._field);if(!l.readOnly()&&!l.disabled()){e=jQuery.event.fix(e||window.event);var i=e.which,n=jslet.getRemainingString(t.el.value,jslet.ui.textutil.getSelectedText(t.el)),a=jslet.ui.textutil.getCursorPos(t.el);if(!t._dataset.fieldValidator().checkInputChar(l,String.fromCharCode(i),n,a.begin))return e.preventDefault(),!1;t._dataset.editRecord(),i===jslet.ui.KeyCode.ENTER&&(t._enterProcessed?t._enterProcessed=!1:t.updateToDataset())}},selectText:function(e,t){jslet.ui.textutil.selectText(this.el,e,t)},inputText:function(e){if(e){jslet.Checker.test("DBText.inputText#text",e).isString();var t=this,l=t._dataset.getField(t._field);if(l.getType()!==jslet.data.DataType.STRING)return void console.warn("Only String Field can be input!");for(var i,n=[],a=0,s=e.length;s>a;a++)i=e[a],t._dataset.fieldValidator().checkInputChar(l,i)&&n.push(i);t._position||(t._position=jslet.ui.textutil.getCursorPos(t.el));var r=(n.join(""),t.el.value),o=t._position.begin,d=t._position.end,u=r.substring(0,o),c=r.substring(d);t.el.value=u+e+c,t._position=jslet.ui.textutil.getCursorPos(t.el),t.updateToDataset()}},refreshControl:function($super,e,t){$super(e,t)&&this.afterRefreshControl&&this.afterRefreshControl(e)},doMetaChanged:function($super,e){$super(e);var t=this,l=t._dataset.getField(t._field);if(e&&"disabled"!=e&&"readOnly"!=e||jslet.ui.setEditableStyle(t.el,l.disabled(),l.readOnly(),!1,l.required()),e&&"required"==e){var i=jQuery(t.el);l.required()?i.addClass("jl-ctrl-required"):i.removeClass("jl-ctrl-required")}if(!e||"editMask"==e){var n=l.editMask();if(n){t.editMask||(t.editMask=new jslet.ui.EditMask,t.editMask.attach(t.el));var a=n.mask,s=n.keepChar,r=n.transform;t.editMask.setMask(a,s,r)}else t.editMask&&(t.editMask.detach(),t.editMask=null)}e&&"tabIndex"!=e||t.setTabIndex(),t.el.maxLength=l.getEditLength()},doValueChanged:function(){var e=this;if(!e._keep_silence_){var t=e.getFieldError();if(t&&t.message)return e.el.value=t.inputText||"",void e.renderInvalid(t);e.renderInvalid(null);var l=e._dataset.getField(e._field),i=l.alignment();jslet.locale.isRtl&&(i="left"==i?"right":"left"),e.el.style.textAlign=i;var n;e.editMask?(n=e.getText(),e.editMask.setValue(n)):(n=document.activeElement!=e.el||e.el.readOnly||e._isBluring?e.getText(!1):e.getText(!0),l.getType()===jslet.data.DataType.STRING&&l.antiXss()&&(n=jslet.htmlDecode(n)),e.el.value=n),e.oldValue=e.el.value}},renderAll:function(){this.refreshControl(jslet.data.RefreshEvent.updateAllEvent(),!0)},updateToDataset:function(){var e=this;if(e._keep_silence_)return!0;var t=e.el.value;if(e.oldValue==t)return!0;if(e._dataset.editRecord(),this.editMask&&!this.editMask.validateValue())return!1;if(e._beforeUpdateToDataset&&!e._beforeUpdateToDataset.call(e))return!1;e._keep_silence_=!0;try{e.editMask&&(t=e.editMask.getValue()),e._dataset.setFieldText(e._field,t,e._valueIndex)}finally{e._keep_silence_=!1}return e.refreshControl(jslet.data.RefreshEvent.updateRecordEvent(e._field)),!0},destroy:function($super){var e=this;jQuery(e.el).off(),e.editMask&&(e.editMask.detach(),e.editMask=null),e._beforeUpdateToDataset=null,e.onKeyDown=null,$super()}}),jslet.ui.register("DBText",jslet.ui.DBText),jslet.ui.DBText.htmlTemplate='<input type="text"></input>',jslet.ui.DBPassword=jslet.Class.create(jslet.ui.DBText,{initialize:function($super,e,t){$super(e,t)},isValidTemplateTag:function(e){return"input"==e.tagName.toLowerCase()&&"password"==e.type.toLowerCase()}}),jslet.ui.register("DBPassword",jslet.ui.DBPassword),jslet.ui.DBPassword.htmlTemplate='<input type="password"></input>',jslet.ui.DBTextArea=jslet.Class.create(jslet.ui.DBText,{initialize:function($super,e,t){$super(e,t)},isValidTemplateTag:function(e){return"textarea"==e.tagName.toLowerCase()}}),jslet.ui.register("DBTextArea",jslet.ui.DBTextArea),jslet.ui.DBTextArea.htmlTemplate="<textarea></textarea>",jslet.ui.DBCustomComboBox=jslet.Class.create(jslet.ui.DBFieldControl,{initialize:function($super,e,t){var l=this;l.allProperties="styleClass,dataset,field,textReadOnly",l._textReadOnly=!1,l.enableInvalidTip=!1,$super(e,t)},textReadOnly:function(e){return void 0===e?this._textReadOnly:void(this._textReadOnly=!!e)},afterBind:function($super){$super(),this._textReadOnly&&(this.el.childNodes[0].readOnly=!0)},bind:function(){var e=this,t=jQuery(e.el);t.hasClass("input-group")||t.addClass("input-group input-group-sm");var l=e.comboButtonCls?e.comboButtonCls:"fa-caret-down",i='<input type="text" class="form-control"><span class="input-group-btn jl-comb-btn-group"><button class="btn btn-default btn-sm " tabindex="-1"><i class="fa '+l+'"></i></button></span>';t.html(i);var n=t.find('[type="text"]')[0];e.textCtrl=new jslet.ui.DBText(n,{type:"dbtext",dataset:e._dataset,field:e._textField||e._field,enableInvalidTip:!0,valueIndex:e._valueIndex,tabIndex:e._tabIndex}),jQuery(n).on("keydown",function(t){var l=t.which;l!==jslet.ui.KeyCode.BACKSPACE||this.value||e.buttonClick()}),e.addChildControl(e.textCtrl);var a=t.find("button");this.buttonClick&&(a.on("click",function(t){e.buttonClick(a[0])}),a.focus(function(t){jslet.ui.focusManager.activeDataset(e._dataset.name()).activeField(e._field).activeValueIndex(e._valueIndex)}),a.blur(function(e){jslet.ui.focusManager.activeDataset(null).activeField(null).activeValueIndex(null)}))},tableId:function($super,e){$super(e),this.textCtrl.tableId(e)},renderAll:function(){this.refreshControl()},innerFocus:function(){var e=this;e._textReadOnly?jQuery(e.el).find("button").focus():e.textCtrl.focus()},doMetaChanged:function($super,e){$super(e);var t=this;if(!e||"disabled"==e||"readOnly"==e){var l=t._dataset.getField(t._field),i=l.disabled()||l.readOnly(),n=jQuery(t.el);n.find("button").attr("disabled",i)}},destroy:function($super){var e=this,t=e.el.childNodes[1];t.onclick=null,jQuery(e.textCtrl.el).off("keydown",this.popupUp),e.textCtrl.destroy(),e.textCtrl=null,$super()}}),jslet.ui.DBAutoComplete=jslet.Class.create(jslet.ui.DBText,{MatchModes:["start","end","any"],initialize:function($super,e,t){var l=this;l.allProperties||(l.allProperties="styleClass,dataset,field,lookupField,minChars,minDelay,displayTemplate,matchMode,beforePopup,onGetFilterField,filterFields"),l._lookupField=null,l._minChars=0,l._minDelay=0,l._beforePopup=null,l._filterFields=null,l._defaultFilterFields=null,l._onGetFilterField=null,l._matchMode="start",l._timeoutHandler=null,$super(e,t)},lookupField:function(e){return void 0===e?this._lookupField:(jslet.Checker.test("DBAutoComplete.lookupField",e).isString(),this._lookupField=e,this)},minChars:function(e){return void 0===e?this._minChars:(jslet.Checker.test("DBAutoComplete.minChars",e).isGTEZero(),this._minChars=parseInt(e),this)},minDelay:function(e){return void 0===e?this._minDelay:(jslet.Checker.test("DBAutoComplete.minDelay",e).isGTEZero(),this._minDelay=parseInt(e),this)},matchMode:function(e){if(void 0===e)return this._matchMode;e=jQuery.trim(e);var t=jslet.Checker.test("DBAutoComplete.matchMode",e).isString();return e=e.toLowerCase(),t.testValue(e).inArray(this.MatchModes),this._matchMode=e,this},beforePopup:function(e){return void 0===e?this._beforePopup:(this._beforePopup=e,this)},filterFields:function(e){var t=this;return void 0===e?t._filterFields:(jslet.Checker.test("DBAutoComplete.filterFields",e).isString(),t._filterFields=e,this)},onGetFilterField:function(e){return void 0===e?this._onGetFilterField:(this._onGetFilterField=e,this)},isValidTemplateTag:function(e){return"input"==e.tagName.toLowerCase()&&"text"==e.type.toLowerCase()},doBlur:function(){var e=this;if(!e.el.disabled&&!e.el.readOnly){var t=e._dataset.getField(e._field);if(!t.readOnly()&&!t.disabled())if(e.contentPanel&&e.contentPanel.isShowing()){if(e._isSelecting)return;var l=e.el.value,i=!0;if(!e._lookupField){t=e._dataset.getField(e._field);var n=t.lookup(),a=n.dataset();l.length>0&&0===a.recordCount()&&(i=!1)}e.contentPanel&&e.contentPanel.isShowing()&&e.contentPanel.closePopup(),e.updateToDataset(),e.refreshControl(jslet.data.RefreshEvent.updateRecordEvent(e._field)),i||e.el.focus()}else e.updateToDataset(),e.refreshControl(jslet.data.RefreshEvent.updateRecordEvent(e._field))}},doChange:null,doKeydown:function(e){if(!this.disabled&&!this.readOnly){e=jQuery.event.fix(e||window.event);var t=e.which,l=this.jslet,i=jslet.ui.KeyCode;if(!(t>=i.F1&&t<=i.F12||t===i.SHIFT||t===i.CONTROL||t===i.ALT||t===i.CAPSLOCK||t===i.INSERT||t===i.HOME||t===i.END||t===i.PAGEUP||t===i.PAGEDOWN||t===i.LEFT||t===i.RIGHT)){if(t===i.ESCAPE&&l.contentPanel)return void l.contentPanel.closePopup();if(t!==i.UP&&t!==i.DOWN)return t===i.DELETE||t===i.BACKSPACE||t===i.IME?void l._invokePopup():void(t!==i.ENTER&&t!==i.TAB?l._invokePopup():l.contentPanel&&l.contentPanel.isShowing()&&l.contentPanel.confirmSelect());if(l.contentPanel&&l.contentPanel.isPop){var n=l._dataset.getField(l._lookupField||l._field),a=n.lookup(),s=a.dataset();t===i.UP&&(s.prior(),e.preventDefault(),e.stopImmediatePropagation()),t===i.DOWN&&(s.next(),e.preventDefault(),e.stopImmediatePropagation())}else l.tableId()||l._invokePopup()}}},doKeypress:function(e){this.disabled||this.readOnly},_invokePopup:function(){var e=this;e._timeoutHandler&&clearTimeout(e._timeoutHandler);var t=100;e._minDelay&&(t=parseInt(e._minDelay)),e._timeoutHandler=setTimeout(function(){e._populate(e.el.value)},t)},_getDefaultFilterFields:function(e){var t=this;if(t._defaultFilterFields)return t._defaultFilterFields;var l=e.codeField(),i=e.nameField(),n=e.dataset(),a=n.getField(l),s=n.getField(i),r=[];return a&&a.visible()&&r.push(l),l!=i&&s&&s.visible()&&r.push(i),t._defaultFilterFields=r,r},_getFilterFields:function(e,t){var l=this,i=null,n=jslet.getFunction(l._onGetFilterField);n&&(i=n.call(l,e.dataset(),t),jslet.Checker.test("DBAutoComplete.onGetFilterField#return",i).isString()),i=i||l._filterFields;var a;if(a=i?i.split(","):l._getDefaultFilterFields(e),0===a.length)throw new Error("Not specified [filter fields]!");var s=t;"start"==l._matchMode?s+="%":s="end"==l._matchMode?"%"+s:"%"+s+"%";for(var r,o="",d=0,u=a.length;u>d;d++)r=a[d],d>0&&(o+=" || "),o+="like(["+r+'],"'+s+'")';return o},_populate:function(e){var t=this;if(!(t._minChars>0&&e&&e.length<t._minChars)){var l=t._dataset.getField(t._lookupField||t._field),i=l.lookup();if(!i)return void console.error(t._field+" is NOT a lookup field!");var n=i.dataset(),a=n.autoRefreshHostDataset();n.autoRefreshHostDataset(!1);try{var s=i.editFilter(),r=jslet.getFunction(t._beforePopup);if(r)r.call(t,n,e,s);else if(e){var o=t._getFilterFields(i,e);s&&(o=o?"("+s+") && ("+o+")":s),n.filter(o),n.filtered(!0)}else s?(n.filter(s),n.filtered(!0)):(n.filter(null),n.fixedFilter()||n.filtered(!1))}finally{n.autoRefreshHostDataset(a)}if(t._lookupField&&(t._dataset.getRecord()[t._lookupField]=null),t.contentPanel){if(t.contentPanel.isShowing())return}else t.contentPanel=new jslet.ui.DBAutoCompletePanel(t);jslet.ui.PopupPanel.excludedElement=t.el;var d=jQuery(t.el),u=d.offset(),c=d.outerHeight(),h=u.left,f=u.top+c;jslet.locale.isRtl&&(h=h+d.outerWidth()-t.contentPanel.dlgWidth),t.contentPanel.showPopup(h,f,0,c)}},_destroyPopPanel:function(){var e=this;e.contentPanel&&(e.contentPanel.destroy(),e.contentPanel=null)},doLookupChanged:function(e){e&&this._destroyPopPanel()},destroy:function($super){this._destroyPopPanel(),jQuery(this.el).off(),$super()}}),jslet.ui.DBAutoCompletePanel=function(e){var t=this;t.dlgWidth=320,t.dlgHeight=180;t.comboCfg=e,t.dataset=e.dataset(),t.field=e.lookupField()||e.field(),t.panel=null,t.lkDataset=null,t.popup=new jslet.ui.PopupPanel,t.isPop=!1,t.create=function(){t.panel||(t.panel=document.createElement("div"),t.panel.style.width="100%",t.panel.style.height="100%",jQuery(t.panel).on("mousedown",function(e){t.comboCfg._isSelecting=!0,e.stopPropagation()}));var e=t.dataset.getField(t.field),l=e.lookup(),i=l.dataset();t.lkDataset=i;for(var n=i.getNormalFields(),a=0,s=0,r=n.length;r>s;s++)e=n[s],e.visible()&&(a+=e.displayWidth());var o=a*(jslet.global.defaultCharWidth||12)+30;t.dlgWidth=o,t.dlgWidth<150&&(t.dlgWidth=150),t.dlgWidth>500&&(t.dlgWidth=500),t.panel.innerHTML="";var d=(t.dlgWidth-4,t.dlgHeight-4),u={type:"DBTable",dataset:i,readOnly:!0,noborder:!0,hasSelectCol:!1,hasSeqCol:!1,hideHead:!0};return u.onRowClick=t.confirmSelect,t.otable=jslet.ui.createControl(u,t.panel,"100%",d),t.otable.el.focus(),t.otable.el.style.border="0",t.panel},t.confirmSelect=function(){t.comboCfg._isSelecting=!0;var e=t.lkDataset.keyValue();(e||0===e)&&(t.dataset.setFieldValue(t.field,e,t.valueIndex),t.comboCfg.el.focus()),t.comboCfg.afterSelect&&t.comboCfg.afterSelect(t.dataset,t.lkDataset),t.closePopup()},t.showPopup=function(e,l,i,n){t.panel||(t.panel=t.create()),t.comboCfg._isSelecting=!1,t.isPop=!0;var a=t.popup.getPopupPanel();a.style.padding="0",t.popup.setContent(t.panel),t.popup.onHidePopup=t.doClosePopup,t.popup.show(e,l,t.dlgWidth,t.dlgHeight,i,n)},t.doClosePopup=function(){t.isPop=!1;var e=t.lkDataset.recno()||0;try{t.lkDataset.filter(null)}finally{e>=0&&t.lkDataset.recno(e)}},t.closePopup=function(){t.popup.hide()},t.isShowing=function(){return t.popup?t.popup.isShowing:!1},t.destroy=function(){jQuery(t.panel).off(),t.otable.onRowClick=null,t.otable.destroy(),t.otable=null,t.panel=null,t.popup.destroy(),t.popup=null,t.comboCfg=null,t.dataset=null,t.field=null,t.lkDataset=null}},jslet.ui.register("DBAutoComplete",jslet.ui.DBAutoComplete),jslet.ui.DBAutoComplete.htmlTemplate='<input type="text"></input>',jslet.ui.DBBetweenEdit=jslet.Class.create(jslet.ui.DBFieldControl,{initialize:function($super,e,t){this.allProperties="styleClass,dataset,field",this._minEleId=null,this._maxEleId=null,$super(e,t)},isValidTemplateTag:function(e){var t=e.tagName.toLowerCase();return"div"==t},bind:function(){var e=this;e.renderAll()},refreshControl:function(e){},renderAll:function(){var e=this;e.removeAllChildControls(),jslet.ui.textMeasurer.setElement(e.el);var t=jslet.locale.Dataset.betweenLabel;t||(t="-"),t="&nbsp;"+t+"&nbsp;";var l=jslet.ui.textMeasurer.getWidth(t),i=['<table style="width:100%;margin:0px" cellspacing="0" cellpadding="0"><col /><col width="',l,'px" /><col /><tbody><tr><td></td><td>',t,"</td><td></td></tr></tbody></table>"];e.el.innerHTML=i.join("");var n=jQuery(e.el).find("td"),a=n[0],s=n[2],r=e._dataset.getField(e._field),o=r.editControl();o.dataset=e._dataset,o.field=e._field,o.valueIndex=0;var d=jslet.ui.createControl(o,a);e._minEleId=d.el.id,d.el.style.width="98%",e.addChildControl(d),o.valueIndex=1,d=jslet.ui.createControl(o,s),d.el.style.width="98%",e._maxEleId=d.el.id,e.addChildControl(d)},tableId:function($super,e){$super(e),jslet("#"+this._minEleId).tableId(e),jslet("#"+this._maxEleId).tableId(e)},innerFocus:function(){jslet("#"+this._minEleId).focus()}}),jslet.ui.register("DBBetweenEdit",jslet.ui.DBBetweenEdit),jslet.ui.DBBetweenEdit.htmlTemplate="<div></div>",jslet.ui.DBCheckBox=jslet.Class.create(jslet.ui.DBFieldControl,{initialize:function($super,e,t){var l=this;l.isCheckBox=!0,l.allProperties="styleClass,dataset,field,beforeClick",l._beforeClick=null,l._skipRefresh=!1,$super(e,t)},beforeClick:function(e){return void 0===e?this._beforeClick:(jslet.Checker.test("DBCheckBox.beforeClick",e).isFunction(),void(this._beforeClick=e))},isValidTemplateTag:function(e){return"input"==e.tagName.toLowerCase()&&"checkbox"==e.type.toLowerCase()},bind:function(){var e=this;e.renderAll();var t=jQuery(e.el);t.hasClass("jl-dbcheck")||t.addClass("jl-dbcheck"),t.on("click",e._doClick),t.focus(function(t){jslet.ui.focusManager.activeDataset(e._dataset.name()).activeField(e._field).activeValueIndex(e._valueIndex)}),t.blur(function(e){jslet.ui.focusManager.activeDataset(null).activeField(null).activeValueIndex(null)}),t.addClass("checkbox-inline")},_doClick:function(e){var t=this.jslet;if(t._beforeClick){var l=t._beforeClick.call(t,t.el);if(!l)return}t.updateToDataset()},doMetaChanged:function($super,e){$super(e);var t=this,l=t._dataset.getField(t._field);if(!e||"disabled"==e||"readOnly"==e){var i=l.disabled()||l.readOnly();jslet.ui.setEditableStyle(t.el,i,i,!1,l.required()),t.setTabIndex()}e&&"tabIndex"!=e||t.setTabIndex()},doValueChanged:function(){var e=this;if(!e._skipRefresh){var t=(e._dataset.getField(e._field),e.getValue());t?e.el.checked=!0:e.el.checked=!1}},focus:function(){this.el.focus()},renderAll:function(){this.refreshControl(jslet.data.RefreshEvent.updateAllEvent(),!0)},updateToDataset:function(){var e=this;if(!e._keep_silence_){var t=(e._dataset.getField(e._field),e.el.checked);e._keep_silence_=!0;try{e._dataset.setFieldValue(e._field,t,e._valueIndex)}finally{e._keep_silence_=!1}}},destroy:function($super){jQuery(this.el).off(),$super()}}),jslet.ui.register("DBCheckBox",jslet.ui.DBCheckBox),jslet.ui.DBCheckBox.htmlTemplate='<input type="checkbox"></input>',jslet.ui.DBCheckBoxGroup=jslet.Class.create(jslet.ui.DBFieldControl,{initialize:function($super,e,t){var l=this;l.allProperties="styleClass,dataset,field,columnCount,hasSelectAllBox",l._columnCount=99999,l._itemIds=null,$super(e,t)},columnCount:function(e){return void 0===e?this._columnCount:(jslet.Checker.test("DBCheckBoxGroup.columnCount",e).isGTEZero(),void(this._columnCount=parseInt(e)))},hasSelectAllBox:function(e){return void 0===e?this._hasSelectAllBox:void(this._hasSelectAllBox=!!e)},isValidTemplateTag:function(e){var t=e.tagName.toLowerCase();return"div"==t},bind:function(){var e=this;e.renderAll();var t=jQuery(e.el);t.on("keydown",function(t){var l,i,n,a=t.which;if(a===jslet.ui.KeyCode.LEFT){if(!e._itemIds||0===e._itemIds.length)return;if(i=document.activeElement,n=i&&i.id,l=e._itemIds.indexOf(n),0===l)return;document.getElementById(e._itemIds[l-1]).focus(),t.preventDefault(),t.stopImmediatePropagation()}else if(a===jslet.ui.KeyCode.RIGHT){if(!e._itemIds||0===e._itemIds.length)return;if(i=document.activeElement,n=i&&i.id,l=e._itemIds.indexOf(n),l===e._itemIds.length-1)return;document.getElementById(e._itemIds[l+1]).focus(),t.preventDefault(),t.stopImmediatePropagation()}}),t.on("click",'input[type="checkbox"]',function(e){var t=this;window.setTimeout(function(){e.delegateTarget.jslet.updateToDataset(t)},5)}),t.on("focus",'input[type="checkbox"]',function(t){jslet.ui.focusManager.activeDataset(e._dataset.name()).activeField(e._field).activeValueIndex(e._valueIndex)}),t.on("blur",'input[type="checkbox"]',function(e){jslet.ui.focusManager.activeDataset(null).activeField(null).activeValueIndex(null)}),t.addClass("form-control"),t.css("height","auto")},doMetaChanged:function($super,e){$super(e);var t=this,l=t._dataset.getField(t._field);if(!e||"disabled"==e||"readOnly"==e||"tabIndex"==e){var i=l.disabled(),n=l.readOnly();i=i||n;for(var a,s=jQuery(t.el).find('input[type="checkbox"]'),r=l.tabIndex(),o=l.required(),d=0,u=s.length;u>d;d++)a=s[d],jslet.ui.setEditableStyle(a,i,n,!1,o),a.tabIndex=r}},doValueChanged:function(){var e=this;if(!e._keep_silence_){var t,l,i=jQuery(e.el).find('input[type="checkbox"]'),n=i.length;for(l=0;n>l;l++)t=i[l],jQuery(t).hasClass("jl-selectall")||(t.checked=!1);var a=e.getValue();if(a&&a.length>0){var s,r=a.length;for(l=0;n>l;l++){t=i[l];for(var o=0;r>o;o++)s=a[o],s==t.value&&(t.checked=!0)}}}},doLookupChanged:function(){var e=this,t=e._dataset.getField(e._field),l=t.lookup();if(!l)return void console.error(jslet.formatMessage(jslet.locale.Dataset.lookupNotFound,[t.name()]));t.valueStyle()!=jslet.data.FieldValueStyle.MULTIPLE&&t.valueStyle(jslet.data.FieldValueStyle.MULTIPLE);var i=l.dataset(),n=i.recordCount();if(0===n)return void(e.el.innerHTML=jslet.locale.DBCheckBoxGroup.noOptions);e._itemIds=[];var a=['<table cellpadding="0" cellspacing="0">'],s=!1,r=l.editFilter();
e._innerEditFilterExpr=null;var o=l.editItemDisabled();r&&(e._innerEditFilterExpr=new jslet.Expression(i,r));var d,u=!1,c=-1;e._hasSelectAllBox&&n>0&&(a.push("<tr>"),d=jslet.nextId(),a.push('<td style="white-space: nowrap;vertical-align:middle"><input type="checkbox" class="jl-selectall"'),a.push(' id="'),a.push(d),a.push('"/><label for="'),a.push(d),a.push('">'),a.push(jslet.locale.DBCheckBoxGroup.selectAll),a.push("</label></td>"),c=0,e._itemIds.push(d)),e.el.innerHTML="";var h=i.recnoSilence();try{for(var f=0;n>f;f++){if(i.recnoSilence(f),u=!1,e._innerEditFilterExpr&&!e._innerEditFilterExpr.eval()){if(!o)continue;u=!0}c++,s=c%e._columnCount===0,s&&(c>0&&a.push("</tr>"),a.push("<tr>")),d=jslet.nextId(),e._itemIds.push(d),a.push('<td style="white-space: nowrap; "><input type="checkbox" value="'),a.push(i.getFieldValue(l.keyField())),a.push('" id="'),a.push(d),a.push('" '+(u?" disabled":"")+'/><label for="'),a.push(d),a.push('">'),a.push(l.getCurrentDisplayValue()),a.push("</label></td>"),s=c%e._columnCount===0}n>0&&a.push("</tr>"),a.push("</table>"),e.el.innerHTML=a.join("")}finally{i.recnoSilence(h)}e.doMetaChanged()},updateToDataset:function(e){var t=this;if(!t._is_silence_){var l,i,n,a=jQuery(t.el).find('input[type="checkbox"]');if(jQuery(e).hasClass("jl-selectall")){var s=e.checked;for(i=0,n=a.length;n>i;i++)l=a[i],l!=e&&(l.disabled||(l.checked=s))}var r=t._dataset.getField(t._field),o=r.valueCountLimit(),d=[],u=0;for(i=0,n=a.length;n>i;i++)l=a[i],jQuery(l).hasClass("jl-selectall")||l.checked&&(d.push(l.value),u++);if(o&&u>o)return e.checked=!e.checked,void jslet.showInfo(jslet.formatMessage(jslet.locale.DBCheckBoxGroup.invalidCheckedCount,[""+o]));t._is_silence_=!0;try{t._dataset.setFieldValue(t._field,d)}finally{t._is_silence_=!1}}},innerFocus:function(){var e=this._itemIds;e&&e.length>0&&document.getElementById(e[0]).focus()},renderAll:function(){var e=this,t=jQuery(e.el);t.hasClass("jl-checkboxgroup")||t.addClass("jl-checkboxgroup"),e.refreshControl(jslet.data.RefreshEvent.updateAllEvent(),!0)},destroy:function($super){var e=jQuery(this.el);e.off(),$super()}}),jslet.ui.register("DBCheckBoxGroup",jslet.ui.DBCheckBoxGroup),jslet.ui.DBCheckBoxGroup.htmlTemplate="<div></div>",jslet.ui.DBComboSelect=jslet.Class.create(jslet.ui.DBCustomComboBox,{showStyles:["auto","table","tree"],initialize:function($super,e,t){var l=this;l.allProperties="styleClass,dataset,field,textField,searchField,popupHeight,popupWidth,showStyle,textReadOnly,onGetSearchField,correlateCheck,autoSelected",l._textField=null,l._showStyle="auto",l._popupWidth=300,l._popupHeight=300,l._contentPanel=null,l._pickupField=null,l._onGetSearchField=null,l._correlateCheck=!1,l._autoSelected=!0,$super(e,t)},textField:function(e){return void 0===e?this._textField:(jslet.Checker.test("DBComboSelect.textField",e).required().isString(),void(this._textField=e.trim()))},popupHeight:function(e){return void 0===e?this._popupHeight:(jslet.Checker.test("DBComboSelect.popupHeight",e).isGTEZero(),void(this._popupHeight=parseInt(e)))},popupWidth:function(e){return void 0===e?this._popupWidth:(jslet.Checker.test("DBComboSelect.popupWidth",e).isGTEZero(),void(this._popupWidth=parseInt(e)))},showStyle:function(e){if(void 0===e)return this._showStyle;e=jQuery.trim(e);var t=jslet.Checker.test("DBComboSelect.showStyle",e).isString();e=e.toLowerCase(),t.testValue(e).inArray(this.showStyles),this._showStyle=e},onGetSearchField:function(e){return void 0===e?this._onGetSearchField:void(this._onGetSearchField=e)},correlateCheck:function(e){return void 0===e?this._correlateCheck:void(this._correlateCheck=e)},autoSelected:function(e){return void 0===e?this._autoSelected:void(this._autoSelected=e)},isValidTemplateTag:function(e){return!0},afterBind:function($super){$super(),this._contentPanel&&(this._contentPanel=null)},buttonClick:function(e){var t=this,l=t.el,i=t._dataset.getField(t._field),n=i.lookup(),a=jQuery(l);if(!i.readOnly()&&!i.disabled()){if(null===n||void 0===n)throw new Error(t._field+" is NOT a lookup field!");var s=t._showStyle;"auto"==t._showStyle&&(s=n.parentField()?"tree":"table"),t._contentPanel||(t._contentPanel=new jslet.ui.DBComboSelectPanel(t),t._contentPanel.showStyle=s,t._contentPanel.customButtonLabel=t.customButtonLabel,t._contentPanel.onCustomButtonClick=t.onCustomButtonClick,t._popupWidth&&(t._contentPanel.popupWidth=t._popupWidth),t._popupHeight&&(t._contentPanel.popupHeight=t._popupHeight)),jslet.ui.PopupPanel.excludedElement=e;var r=a.offset(),o=a.outerHeight(),d=r.left,u=r.top+o;jslet.locale.isRtl&&(d+=a.outerWidth()),t._contentPanel.showPopup(d,u,0,o)}},closePopup:function(){this._contentPanel&&this._contentPanel.closePopup(),this._contentPanel=null},doLookupChanged:function(e){e&&this._destroyPopPanel()},_destroyPopPanel:function(){var e=this;e._contentPanel&&(e._contentPanel.destroy(),e._contentPanel=null),jslet.ui.PopupPanel.excludedElement=null},destroy:function($super){this._destroyPopPanel(),$super()}}),jslet.ui.DBComboSelectPanel=function(e){var t=this;t.showStyle="auto",t.customButtonLabel=null,t.onCustomButtonClick=null,t.popupWidth=350,t.popupHeight=350,t._isShowing=!1;t.comboSelectObj=e,t.dataset=e._dataset,t.field=e._field,t.fieldObject=t.dataset.getField(t.field),t.panel=null,t.searchBoxEle=null,t.popup=new jslet.ui.PopupPanel,t.popup.onHidePopup=function(){t._isShowing=!1,t._restoreLkDsEvent(),t.comboSelectObj&&t.comboSelectObj.focus()},t._confirmSelectDebounce=jslet.debounce(this._confirmSelect,50)},jslet.ui.DBComboSelectPanel.prototype={lookupDs:function(){return this.fieldObject.lookup().dataset()},isMultiple:function(){return this.fieldObject&&this.fieldObject.valueStyle()===jslet.data.FieldValueStyle.MULTIPLE},showPopup:function(e,t,l,i){var n=this;if(!n._isShowing){n._initSelected();var a=n.showStyle.toLowerCase();if(n.panel){var s=n.otree?n.otree:n.otable;s.dataset().addLinkedControl(s),window.setTimeout(function(){s.renderAll()},1)}else n.panel=n._create();if("table"==a){for(var r,o=n.lookupDs().getNormalFields(),d=0,u=0,c=o.length;c>u;u++)r=o[u],r.visible()&&(d+=r.displayWidth());var h=d*(jslet.global.defaultCharWidth||12)+40;n.popupWidth=h,n.popupWidth<150&&(n.popupWidth=150),n.popupWidth>500&&(n.popupWidth=500)}n._setLookupDsEvent(),n._isShowing=!0,n.popup.setContent(n.panel,"100%","100%"),n.popup.show(e,t,n.popupWidth,n.popupHeight,l,i),n._showTips(jslet.locale.DBComboSelect.find),n._focus()}},closePopup:function(){var e=this;e.popup.hide();var t=e.otree?e.otree:e.otable;t&&t.dataset().removeLinkedControl(t)},_setLookupDsEvent:function(){var e=this;if(e.isMultiple()){var t=e.dataset.getField(e.field),l=t.lookup(),i=l.dataset();e._oldLkDsCheckSelectable=null,l.onlyLeafLevel()&&(e._oldLkDsCheckSelectable=i.onCheckSelectable(),i.onCheckSelectable(function(){return!this.hasChildren()})),i=e.lookupDs(),e._oldLkDsListener=i.datasetListener(),i.datasetListener(function(t){e._oldLkDsListener&&e._oldLkDsListener.call(i,t),t===jslet.data.DatasetEvent.AFTERSELECT&&e._confirmSelectDebounce.call(e)})}},_restoreLkDsEvent:function(){var e=this;if(e.isMultiple()){var t=e.dataset.getField(e.field),l=t.lookup(),i=l.dataset();i.onCheckSelectable(e._oldLkDsCheckSelectable?e._oldLkDsCheckSelectable:null),i.datasetListener(e._oldLkDsListener?e._oldLkDsListener:null)}},_create:function(){var e=this;e.panel||(e.panel=document.createElement("div"));var t=e.dataset.getField(e.field),l=t.lookup(),i=(l.parentField(),e.showStyle.toLowerCase()),n=e.lookupDs(),a=['<div class="jl-combopnl-tip" style="display:none"></div>','<div class="jl-combopnl-head"><label class="col-xs-4"></label>','<div class="col-xs-8 input-group input-group-sm">','<input class="form-control" type="text" size="10"></input>','<span class="input-group-btn">','<button class="jl-combopnl-search btn btn-secondary" type="button"><i class="fa fa-search"></i></button>','<button class="jl-combopnl-closesearch btn btn-secondary" type="button"><i class="fa fa-times"></i></button>',"</span>","</div></div>",'<div class="jl-combopnl-content"></div>'];e.panel.innerHTML=a.join("");var s=jQuery(e.panel),r=s.find(".jl-combopnl-head");s.on("keydown",function(t){var l=t.which;return l===jslet.ui.KeyCode.ESCAPE&&e.closePopup(),t.ctrlKey&&l===jslet.ui.KeyCode.F?(s.find(".jl-combopnl-head").slideDown(),e.searchBoxEle.focus(),t.preventDefault(),t.stopImmediatePropagation(),!1):void 0}),e.searchBoxEle=r.find("input")[0],jQuery(e.searchBoxEle).on("keydown",jQuery.proxy(e._findData,e)),s.find(".jl-combopnl-closesearch").click(function(){s.find(".jl-combopnl-head").slideUp(),e._focus()});var o=s.find(".jl-combopnl-content")[0];if("tree"==i){var d={type:"DBTreeView",dataset:n,readOnly:!1,displayFields:l.displayFields(),hasCheckBox:e.isMultiple(),expandLevel:1};e.isMultiple()||(d.onItemClick=jQuery.proxy(e._confirmAndClose,e)),d.correlateCheck=e.comboSelectObj.correlateCheck(),window.setTimeout(function(){e.otree=jslet.ui.createControl(d,o,"100%","100%")},1)}else{var u={type:"DBTable",dataset:n,readOnly:!0,hasSelectCol:e.isMultiple(),hasSeqCol:!1,hasFindDialog:!1,hasFilterDialog:!1};e.isMultiple()||(u.onRowClick=jQuery.proxy(e._confirmAndClose,e)),window.setTimeout(function(){e.otable=jslet.ui.createControl(u,o,"100%","100%")},1)}return e.panel},_initSelected:function(){var e=this,t=e.comboSelectObj.getValue(),l=e.lookupDs(),i=e.dataset.getField(e.field),n=i.lookup();if(n.onlyLeafLevel()&&l.onCheckSelectable(function(){return!this.hasChildren()}),!e.isMultiple())return void(t&&l.findByKey(t));l.disableControls();try{if(l.selectAll(!1),t){var a=t;jslet.isArray(t)||(a=t.split(jslet.global.valueSeparator));for(var s=0,r=a.length;r>s;s++)l.selectByKeyValue(!0,a[s])}}finally{l.enableControls()}},_findData:function(e){if(e=jQuery.event.fix(e||window.event),13==e.which){var t=this,l=t.comboSelectObj.searchField,i=this.searchBoxEle.value;if(i){var n=jslet.getFunction(t.comboSelectObj.onGetSearchField);n&&(l=n.call(i));var a=null,s=t.lookupDs();if(l)a=l.split(",");else{a=[];for(var r,o=s.getNormalFields(),d=0,u=o.length;u>d;d++)r=o[d],r.visible()&&a.push(r.name())}if(!a||0===a.length)return void console.warn("Search field NOT specified! Can't search data!");var c=s.recno()+1,h=s.findByField(a,i,c,!0,"any");h||(h=s.findByField(a,i,0,!0,"any")),h&&t.comboSelectObj.autoSelected()&&s.select(!0),h||t._showTips(jslet.locale.DBComboSelect.notFound),e.currentTarget.focus()}}},_focus:function(){var e=this;window.setTimeout(function(){var t=e.otable||e.otree;t&&t.el.focus()},10)},_showTips:function(e){var t=jQuery(this.panel);t.find(".jl-combopnl-tip").html(e).slideDown(),window.setTimeout(function(){t.find(".jl-combopnl-tip").slideUp()},1500)},_confirmSelect:function(){var e=this,t=e.comboSelectObj.getValue(),l=e.dataset.getField(e.field),i=(l.lookup(),e.isMultiple()),n=e.lookupDs();t=i?n.selectedKeyValues():n.keyValue(),e.dataset.setFieldValue(e.field,t,e._valueIndex),!i&&e.comboSelectObj._afterSelect&&e.comboSelectObj._afterSelect(e.dataset,n)},_confirmAndClose:function(){this._confirmSelect(),this.closePopup()},destroy:function(){var e=this;e._restoreLkDsEvent(),e.popup.onHidePopup=null,e.otree&&(e.otree.destroy(),e.otree=null),e.otable&&(e.otable.destroy(),e.otable=null),e.comboSelectObj=null,jQuery(e.searchBoxEle).off(),e.fieldObject=null,e.searchBoxEle=null,e.popup=null,e.panel=null}},jslet.ui.register("DBComboSelect",jslet.ui.DBComboSelect),jslet.ui.DBComboSelect.htmlTemplate="<div></div>",jslet.ui.DBDataLabel=jslet.Class.create(jslet.ui.DBFieldControl,{initialize:function($super,e,t){this.allProperties="styleClass,dataset,field",$super(e,t)},bind:function(){this.renderAll(),jQuery(this.el).addClass("form-control-static jl-datalabel")},isValidTemplateTag:function(e){return"label"==e.tagName.toLowerCase()},doValueChanged:function(){var e=this,t=(e._dataset.getField(e._field),e.getText());e.el.innerHTML=t,e.el.title=t},renderAll:function(){this.refreshControl(jslet.data.RefreshEvent.updateAllEvent(),!0)},canFocus:function(){return!1}}),jslet.ui.register("DBDataLabel",jslet.ui.DBDataLabel),jslet.ui.DBDataLabel.htmlTemplate="<label></label>",jslet.ui.DBDatePicker=jslet.Class.create(jslet.ui.DBCustomComboBox,{initialize:function($super,e,t){var l=this;l.allProperties="styleClass,dataset,field,textReadOnly,popupWidth, popupHeight",l._popupWidth=260,l._popupHeight=226,l.popup=new jslet.ui.PopupPanel,l.popup.onHidePopup=function(){l.focus()},l.comboButtonCls="fa-calendar",$super(e,t)},popupHeight:function(e){return void 0===e?this._popupHeight:(jslet.Checker.test("DBDatePicker.popupHeight",e).isGTEZero(),void(this._popupHeight=parseInt(e)))},popupWidth:function(e){return void 0===e?this._popupWidth:(jslet.Checker.test("DBDatePicker.popupWidth",e).isGTEZero(),void(this._popupWidth=parseInt(e)))},isValidTemplateTag:function(e){return!0},buttonClick:function(e){var t=this.el,l=this,i=l._dataset.getField(l._field),n=jQuery(t);if(!i.readOnly()&&!i.disabled()){var a=l._popupWidth,s=l._popupHeight,r=l.getValue(),o=i.dataRange(),d=null,u=null;o&&(o.min&&(d=o.min),o.max&&(u=o.max)),l.contentPanel||(l.contentPanel=jslet.ui.createControl({type:"Calendar",value:r,minDate:d,maxDate:u,onDateSelected:function(e){l._dataset.setFieldValue(l._field,new Date(e.getTime()),l._valueIndex),l.popup.hide();try{l.el.focus()}catch(t){}}},null,a+"px",s+"px",!0)),jslet.ui.PopupPanel.excludedElement=e;var c=n.offset(),h=n.outerHeight(),f=c.left,p=c.top+h;jslet.locale.isRtl&&(f+=n.outerWidth()),l.popup.setContent(l.contentPanel.el,"100%","100%"),l.contentPanel.el.style.display="block",l.contentPanel.setValue(r),l.popup.show(f,p,a+3,s+3,0,h),l.contentPanel.focus()}},destroy:function($super){var e=this;e.contentPanel&&(e.contentPanel.destroy(),e.contentPanel=null),e.popup.destroy(),e.popup=null,$super()}}),jslet.ui.register("DBDatePicker",jslet.ui.DBDatePicker),jslet.ui.DBDatePicker.htmlTemplate="<div></div>",jslet.ui.DBHtml=jslet.Class.create(jslet.ui.DBFieldControl,{initialize:function($super,e,t){this.allProperties="styleClass,dataset,field",$super(e,t)},bind:function(){this.renderAll(),jQuery(this.el).addClass("form-control")},isValidTemplateTag:function(e){return"div"==e.tagName.toLowerCase()},doValueChanged:function(){var e=this.getText();this.el.innerHTML=e},renderAll:function(){this.refreshControl(jslet.data.RefreshEvent.updateAllEvent(),!0)},canFocus:function(){return!1}}),jslet.ui.register("DBHtml",jslet.ui.DBHtml),jslet.ui.DBHtml.htmlTemplate='<div style="width:200px;height:200px"></div>',jslet.ui.DBImage=jslet.Class.create(jslet.ui.DBFieldControl,{initialize:function($super,e,t){var l=this;l.allProperties="styleClass,dataset,field,locked,baseUrl,altField",l._locked=!1,l._baseUrl=null,l._altField=null,$super(e,t)},baseUrl:function(e){return void 0===e?this._baseUrl:(e=jQuery.trim(e),jslet.Checker.test("DBImage.baseUrl",e).isString(),void(this._baseUrl=e))},altField:function(e){return void 0===e?this._altField:(e=jQuery.trim(e),jslet.Checker.test("DBImage.altField",e).isString(),void(this._altField=e))},locked:function(e){return void 0===e?this._locked:void(this._locked=e)},isValidTemplateTag:function(e){return"img"==e.tagName.toLowerCase()},bind:function(){this.renderAll(),jQuery(this.el).addClass("img-responsive img-rounded")},doValueChanged:function(){var e=this;e._dataset.getField(e._field);if(e._locked)return e.el.alt=jslet.locale.DBImage.lockedImageTips,void(e.el.src="");var t=e.getValue();if(t?e._baseUrl&&(t=e._baseUrl+t):t="",e.el.src!=t){var l=t;e._altField&&(l=e._dataset.getFieldText(e._altField)),e.el.alt=l,e.el.src=t}},renderAll:function(){this.refreshControl(jslet.data.RefreshEvent.updateAllEvent(),!0)},canFocus:function(){return!1}}),jslet.ui.register("DBImage",jslet.ui.DBImage),jslet.ui.DBImage.htmlTemplate="<img></img>",jslet.ui.DBLabel=jslet.Class.create(jslet.ui.DBFieldControl,{initialize:function($super,e,t){this.allProperties="styleClass,dataset,field",this.isLabel=!0,$super(e,t)},bind:function(){jQuery(this.el).addClass("control-label"),this.renderAll()},isValidTemplateTag:function(e){return"label"==e.tagName.toLowerCase()},doMetaChanged:function(e){if(!(e&&jslet.ui.DBLabel.METANAMES.indexOf(e)<0)){var t=this,l=t._fieldMeta,i=t._dataset.getField(t._field),n="";if(!i)throw new Error("Field: "+this._field+" NOT exist!");if(!(l&&"label"!=l||e&&"label"!=e&&"required"!=e))return i.required()&&(n+='<span class="jl-lbl-required">'+jslet.ui.DBLabel.REQUIREDCHAR+"</span>"),n+=i.displayLabel(),void(t.el.innerHTML=n||"");if(l&&"tip"==l&&(!e||e==l))return n=i.tip(),void(t.el.innerHTML=n||"");if(l&&"error"==l&&e&&e==l){var a=t.getFieldError();return n=a&&a.message,void(t.el.innerHTML=n||"")}}},renderAll:function(){var e=jQuery(this.el),t=this.fieldMeta();this.refreshControl(jslet.data.RefreshEvent.updateAllEvent()),"error"==t?e.hasClass("jl-lbl-error")||e.addClass("jl-lbl-error"):"tip"==t?e.hasClass("jl-lbl-tip")||e.addClass("jl-lbl-tip"):e.hasClass("jl-lbl")||e.addClass("jl-lbl")}}),jslet.ui.DBLabel.REQUIREDCHAR="*",jslet.ui.DBLabel.METANAMES=["label","required","tip","error"],jslet.ui.register("DBLabel",jslet.ui.DBLabel),jslet.ui.DBLabel.htmlTemplate="<label></label>",jslet.ui.DBList=jslet.Class.create(jslet.ui.DBFieldControl,{showStyles:["auto","table","tree"],initialize:function($super,e,t){var l=this;l.allProperties="styleClass,dataset,field,showStyle,correlateCheck",l._showStyle="auto",l._correlateCheck=!1,$super(e,t)},showStyle:function(e){if(void 0===e)return this._showStyle;e=jQuery.trim(e);var t=jslet.Checker.test("DBComboSelect.showStyle",e).isString();e=e.toLowerCase(),t.testValue(e).inArray(this.showStyles),this._showStyle=e},correlateCheck:function(e){return void 0===e?this._correlateCheck:void(this._correlateCheck=e)},isValidTemplateTag:function(e){return"div"==e.tagName.toLowerCase()},bind:function(){this.renderAll()},renderAll:function(){var e=this,t=jQuery(e.el);t.hasClass("jl-dblist")&&t.addClass("jl-dblist");var l=e._dataset.getField(e._field),i=l.lookup(),n=i.parentField(),a=e._showStyle.toLowerCase(),s=i.dataset(),r=l.valueStyle()===jslet.data.FieldValueStyle.MULTIPLE;if("auto"==a&&n&&(a="tree"),"tree"==a){var o={type:"DBTreeView",dataset:s,readOnly:!1,displayFields:i.displayFields(),hasCheckBox:r,correlateCheck:e._correlateCheck,expandLevel:99};r?o.afterCheckBoxClick=function(){e.updateToDataset()}:o.onItemClick=function(){e.updateToDataset()},window.setTimeout(function(){jslet.ui.createControl(o,e.el,"100%","100%"),jQuery(e.el.childNodes[0]).on("focus",function(t){jslet.ui.focusManager.activeDataset(e._dataset.name()).activeField(e._field).activeValueIndex(e._valueIndex)}).on("blur",function(e){jslet.ui.focusManager.activeDataset(null).activeField(null).activeValueIndex(null)})},1)}else{var d={type:"DBTable",dataset:s,readOnly:!0,hasSelectCol:r,hasSeqCol:!1,hasFindDialog:!1,hasFilterDialog:!1};r?d.afterSelect=d.afterSelectAll=function(){e.updateToDataset()}:d.onRowClick=function(){e.updateToDataset()},window.setTimeout(function(){jslet.ui.createControl(d,e.el,"100%","100%")},1)}},doMetaChanged:function($super,e){$super(e);var t=this,l=t._dataset.getField(t._field);if(e&&"disabled"!=e&&"readOnly"!=e?t.el.disabled=!1:t.el.disabled=!0,e&&"required"==e){var i=jQuery(t.el);l.required()?i.addClass("jl-ctrl-required"):i.removeClass("jl-ctrl-required")}e&&"tabIndex"!=e||t.setTabIndex()},updateToDataset:function(){var e=this;if(e._keep_silence_)return!0;var t,l=e._dataset.getField(e._field),i=l.lookup(),n=i.dataset(),a=l.valueStyle()===jslet.data.FieldValueStyle.MULTIPLE;t=a?n.selectedKeyValues():n.keyValue(),e._dataset.editRecord(),e._keep_silence_=!0;try{e._dataset.setFieldValue(e._field,t,e._valueIndex)}finally{e._keep_silence_=!1}return e.refreshControl(jslet.data.RefreshEvent.updateRecordEvent(e._field)),!0},doValueChanged:function(){var e=this;if(!e._keep_silence_){var t=e.getFieldError();if(t&&t.message)return e.el.value=t.inputText||"",void e.renderInvalid(t);e.renderInvalid(null);var l=e._dataset.getField(e._field),i=l.getValue(),n=l.lookup(),a=(n.parentField(),n.dataset()),s=l.valueStyle()===jslet.data.FieldValueStyle.MULTIPLE;if(s){a.disableControls();try{if(a.selectAll(!1),i)for(var r=0,o=i.length;o>r;r++)a.findByKey(i[r]),a.selected(!0)}finally{a.enableControls()}}else a.findByKey(i)}},destroy:function($super){$super()}}),jslet.ui.register("DBList",jslet.ui.DBList),jslet.ui.DBList.htmlTemplate="<div></div>",jslet.ui.DBLookupLabel=jslet.Class.create(jslet.ui.DBControl,{initialize:function($super,e,t){var l=this;l.allProperties="styleClass,dataset,lookupField,returnField,lookupValue",l.requiredProperties="lookupValue,lookupField,returnField",l.lookupField=null,l.lookupValue=null,l.returnField=null,$super(e,t)},bind:function(){this.renderAll(),jQuery(this.el).addClass("form-control")},isValidTemplateTag:function(e){return"label"==e.tagName.toLowerCase()},refreshControl:function(e,t){if(e.eventType==jslet.data.RefreshEvent.UPDATEALL&&t){var l=this,i=l.dataset.lookup(l.lookupField,l.lookupValue,l.returnField);null===i&&(i="NOT found: "+l.lookupValue),l.el.innerHTML=i}},renderAll:function(){this.refreshControl(jslet.data.RefreshEvent.updateAllEvent,!0)},canFocus:function(){return!1}}),jslet.ui.register("DBLookupLabel",jslet.ui.DBLookupLabel),jslet.ui.DBLookupLabel.htmlTemplate="<label></label>",jslet.ui.DBRadioGroup=jslet.Class.create(jslet.ui.DBFieldControl,{initialize:function($super,e,t){var l=this;l.allProperties="styleClass,dataset,field,columnCount",l._columnCount=99999,l._itemIds=null,$super(e,t)},columnCount:function(e){return void 0===e?this._columnCount:(jslet.Checker.test("DBRadioGroup.columnCount",e).isGTEZero(),void(this._columnCount=parseInt(e)))},isValidTemplateTag:function(e){var t=e.tagName.toLowerCase();return"div"==t},bind:function(){var e=this;e.renderAll();var t=jQuery(e.el);t.on("keydown",function(t){var l,i,n,a=t.which;if(a===jslet.ui.KeyCode.LEFT){if(!e._itemIds||0===e._itemIds.length)return;if(i=document.activeElement,n=i&&i.id,l=e._itemIds.indexOf(n),0===l)return;document.getElementById(e._itemIds[l-1]).focus(),t.preventDefault(),t.stopImmediatePropagation()}else if(a===jslet.ui.KeyCode.RIGHT){if(!e._itemIds||0===e._itemIds.length)return;if(i=document.activeElement,n=i&&i.id,l=e._itemIds.indexOf(n),l===e._itemIds.length-1)return;document.getElementById(e._itemIds[l+1]).focus(),t.preventDefault(),t.stopImmediatePropagation()}}),t.on("click",'input[type="radio"]',function(e){var t=this;window.setTimeout(function(){e.delegateTarget.jslet.updateToDataset(t)},5)}),t.on("focus",'input[type="radio"]',function(t){jslet.ui.focusManager.activeDataset(e._dataset.name()).activeField(e._field).activeValueIndex(e._valueIndex)}),t.on("blur",'input[type="radio"]',function(e){jslet.ui.focusManager.activeDataset(null).activeField(null).activeValueIndex(null)}),t.addClass("form-control"),t.css("height","auto")},doMetaChanged:function($super,e){$super(e);var t=this,l=t._dataset.getField(t._field);if(!e||"disabled"==e||"readOnly"==e||"tabIndex"==e){var i=l.disabled(),n=l.readOnly();t.disabled=i||n,i=t.disabled;for(var a,s=jQuery(t.el).find('input[type="radio"]'),r=l.required(),o=l.tabIndex(),d=0,u=s.length;u>d;d++)a=s[d],jslet.ui.setEditableStyle(a,i,n,!1,r),a.tabIndex=o}},doValueChanged:function(){var e=this;if(!e._keep_silence_)for(var t,l=e.getValue(),i=jQuery(e.el).find('input[type="radio"]'),n=0,a=i.length;a>n;n++)t=i[n],t.checked=l==jQuery(t.parentNode).attr("value")},doLookupChanged:function(){var e=this,t=e._dataset.getField(e._field),l=t.lookup();if(!l)return void console.error(jslet.formatMessage(jslet.locale.Dataset.lookupNotFound,[t.name()]));var i=l.dataset(),n=i.recordCount();if(0===n)return void(e.el.innerHTML=jslet.locale.DBRadioGroup.noOptions);var a=i.recno();try{var s,r=['<table cellpadding="0" cellspacing="0">'],o=!1,d=l.editFilter();e._innerEditFilterExpr=null;var u=l.editItemDisabled();d&&(e._innerEditFilterExpr=new jslet.Expression(i,d));var c=!1,h=-1;e._itemIds=[];for(var f=0;n>f;f++){if(i.recnoSilence(f),c=!1,e._innerEditFilterExpr&&!e._innerEditFilterExpr.eval()){if(!u)continue;c=!0}h++,o=h%e._columnCount===0,o&&(h>0&&r.push("</tr>"),r.push("<tr>")),s=jslet.nextId(),e._itemIds.push(s),r.push('<td style="white-space: nowrap;vertical-align:middle" value="'),r.push(i.getFieldValue(l.keyField())),r.push('"><input name="'),r.push(e._field),r.push('" type="radio" id="'),r.push(s),r.push('" '+(c?" disabled":"")+'/><label for="'),r.push(s),r.push('">'),r.push(l.getCurrentDisplayValue()),r.push("</label></td>")}n>0&&r.push("</tr>"),r.push("</table>"),e.el.innerHTML=r.join("")}finally{i.recnoSilence(a)}e.doMetaChanged()},updateToDataset:function(e){var t=this;if(!t._keep_silence_&&!t.disabled){t._keep_silence_=!0;try{t._dataset.setFieldValue(t._field,jQuery(e.parentNode).attr("value")),e.checked=!0}finally{t._keep_silence_=!1}}},innerFocus:function(){var e=this._itemIds;e&&e.length>0&&document.getElementById(e[0]).focus()},renderAll:function(){var e=this,t=jQuery(e.el);t.hasClass("jl-radiogroup")||t.addClass("jl-radiogroup"),e.refreshControl(jslet.data.RefreshEvent.updateAllEvent(),!0)},destroy:function($super){var e=jQuery(this.el);e.off(),$super()}}),jslet.ui.register("DBRadioGroup",jslet.ui.DBRadioGroup),jslet.ui.DBRadioGroup.htmlTemplate="<div></div>",jslet.ui.DBRangeSelect=jslet.Class.create(jslet.ui.DBFieldControl,{initialize:function($super,e,t){var l=this;l.allProperties="styleClass,dataset,field,beginItem,endItem,step",l.requiredProperties||(l.requiredProperties="field,beginItem,endItem,step"),l._beginItem=0,l._endItem=10,l._step=1,$super(e,t)},beginItem:function(e){return void 0===e?this._beginItem:(jslet.Checker.test("DBRangeSelect.beginItem",e).isNumber(),void(this._beginItem=parseInt(e)))},endItem:function(e){return void 0===e?this._endItem:(jslet.Checker.test("DBRangeSelect.endItem",e).isNumber(),void(this._endItem=parseInt(e)))},step:function(e){return void 0===e?this._step:(jslet.Checker.test("DBRangeSelect.step",e).isNumber(),void(this._step=parseInt(e)))},isValidTemplateTag:function(e){return"select"==e.tagName.toLowerCase()},bind:function(){var e=this,t=e._dataset.getField(e._field),l=t.valueStyle();e.el.multiple&&l!=jslet.data.FieldValueStyle.MULTIPLE?t.valueStyle(jslet.data.FieldValueStyle.MULTIPLE):l!=jslet.data.FieldValueStyle.MULTIPLE||e.el.multiple||(e.el.multiple="multiple"),e.renderAll();var i=jQuery(e.el);i.on("change",e._doChanged),i.focus(function(t){jslet.ui.focusManager.activeDataset(e._dataset.name()).activeField(e._field).activeValueIndex(e._valueIndex)}),i.blur(function(e){jslet.ui.focusManager.activeDataset(null).activeField(null).activeValueIndex(null)}),e.el.multiple&&i.on("click","option",function(){e._currOption=this}),i.addClass("form-control")},_doChanged:function(e){var t=this.jslet;if(t.el.multiple){t.inProcessing&&(t.inProcessing=!1);var l=t._dataset.getField(t._field),i=l.valueCountLimit();if(i){var n=t.getValue(),a=1;if(jslet.isArray(n)&&(a=n.length),a>=i)return jslet.showInfo(jslet.formatMessage(jslet.locale.DBCheckBoxGroup.invalidCheckedCount,[""+i])),void window.setTimeout(function(){t._currOption&&(t.inProcessing=!0,t._currOption.selected=!1)},10)}}this.jslet.updateToDataset()},renderOptions:function(){var e=this,t=[],l=e._dataset.getField(e._field);l.required()||(t.push('<option value="_null_">'),t.push(l.nullText()),t.push("</option>"));for(var i=e._beginItem;i<=e._endItem;i+=e._step)t.push('<option value="'),t.push(i),t.push('">'),t.push(i),t.push("</option>");jQuery(e.el).html(t.join(""))},doMetaChanged:function($super,e){$super(e);var t=this,l=t._dataset.getField(t._field);if(!e||"disabled"==e||"readOnly"==e){var i=l.disabled()||l.readOnly();t.el.disabled=i,jslet.ui.setEditableStyle(t.el,i,i,!0,l.required())}e&&"tabIndex"!=e||t.setTabIndex()},doValueChanged:function(){var e=this;if(!e._keep_silence_)if(e.el.multiple){var t,l,i,n=e.getValue(),a=e.el.options.length;e._keep_silence_=!0;try{for(i=0;a>i;i++)t=e.el.options[i],t&&(t.selected=!1);var s,r=n.length-1;for(i=0;a>i;i++)for(t=e.el.options[i],s=r;s>=0;s--)l=n[s]==t.value,l&&(t.selected=l)}finally{e._keep_silence_=!1}}else{var o=e.getValue();null!==o?e.el.value=o:e.el.value=null}},focus:function(){this.el.focus()},renderAll:function(){this.renderOptions(),this.refreshControl(jslet.data.RefreshEvent.updateAllEvent(),!0)},updateToDataset:function(){var e=this;if(!e._keep_silence_){var t,l=e.el.multiple;if(l){var i,n=jQuery(e.el).find("option"),a=n.length-1;t=[];for(var s=0;a>=s;s++)i=n[s],i.selected&&t.push(i.value)}else{t=e.el.value;var r=e._dataset.getField(e._field);"_null_"!=t||r.required()||(t=null)}e._keep_silence_=!0;try{l?e._dataset.setFieldValue(e._field,t):e._dataset.setFieldValue(e._field,t,e._valueIndex)}finally{e._keep_silence_=!1}}},destroy:function($super){jQuery(this.el).off(),$super()}}),jslet.ui.register("DBRangeSelect",jslet.ui.DBRangeSelect),jslet.ui.DBRangeSelect.htmlTemplate="<select></select>",jslet.ui.DBRating=jslet.Class.create(jslet.ui.DBFieldControl,{initialize:function($super,e,t){var l=this;l.allProperties="styleClass,dataset,field,itemCount,splitCountitemWidth",l._itemCount=5,l._splitCount=1,l._itemWidth=20,l._required=!1,l._readOnly=!1,$super(e,t)},itemCount:function(e){return void 0===e?this._itemCount:(jslet.Checker.test("DBRating.itemCount",e).isGTZero(),void(this._itemCount=parseInt(e)))},splitCount:function(e){return void 0===e?this._splitCount:(jslet.Checker.test("DBRating.splitCount",e).isGTZero(),void(this._splitCount=parseInt(e)))},itemWidth:function(e){return void 0===e?this._itemWidth:(jslet.Checker.test("DBRating.itemWidth",e).isGTZero(),void(this._itemWidth=parseInt(e)))},isValidTemplateTag:function(e){return"div"==e.tagName.toLowerCase()},bind:function(){var e=this;e.renderAll();var t=jQuery(e.el);t.on("mousedown","td",e._mouseDown),t.on("mousemove","td",e._mouseMove),t.on("mouseout","td",e._mouseOut),t.on("mouseup","td",e._mouseUp)},_mouseMove:function(e){e=jQuery.event.fix(e||window.event);var t=e.delegateTarget,l=t.jslet;if(!l._readOnly)for(var i=jQuery(t),n=e.pageX-i.offset().left,a=(Math.ceil(n/l.splitWidth),t.firstChild.rows[0]),s=a.cells.length,r=this.cellIndex+1,o=0;s>o;o++){var d=a.cells[o];l._setBackgroundPos(d,l._getPosX(o%l._splitCount,r>o?1:2))}},_mouseOut:function(e){e=jQuery.event.fix(e||window.event);var t=e.delegateTarget.jslet;t._readOnly||t.doValueChanged()},_mouseDown:function(e){e=jQuery.event.fix(e||window.event);var t=e.delegateTarget,l=t.jslet;if(!l._readOnly){var i=t.firstChild.rows[0],n=(i.cells.length,this.cellIndex+1);l._required||1!=n||(n=l.value*l._splitCount==1?0:1),l.value=n/l._splitCount,l._dataset.setFieldValue(l._field,l.value,l._valueIndex),l.doValueChanged()}},_mouseUp:function(e){e=jQuery.event.fix(e||window.event);var t=e.delegateTarget,l=t.firstChild.rows[0],i=t.jslet;if(!i._readOnly&&i._selectedItem>=0){var n=l.cells[i._selectedItem];i._setBackgroundPos(n,i._selectedPx)}},_getPosX:function(e,t){var l,i=this,n=jslet.locale.isRtl;return l=0-t*i._itemWidth,n?l+=(e+1)*i.splitWidth-i._itemWidth:l-=e*i.splitWidth,l},_setBackgroundPos:function(e,t){void 0!==e.style.backgroundPositionX?e.style.backgroundPositionX=t+"px":e.style.backgroundPosition=t+"px 0px"},doMetaChanged:function($super,e){$super(e);var t=this,l=t._dataset.getField(t._field);e&&"disabled"!=e&&"readOnly"!=e||(t._readOnly=l.disabled()||l.readOnly()),e&&"required"!=e||(t._required=l.required())},doValueChanged:function(){var e,t=this,l=(t._dataset.getField(t._field),t.getValue()),i=t._itemCount*t._splitCount,n=Math.ceil(l*t._splitCount),a=t.el.firstChild.rows[0];2*t._itemWidth,jslet.locale.isRtl;t.value=l;for(var s=0;i>s;s++)e=a.childNodes[s],t._setBackgroundPos(e,t._getPosX(s%t._splitCount,n>s?0:2))},renderAll:function(){var e=this,t=(e._dataset.getField(e._field),jQuery(e.el));t.hasClass("jl-rating")||t.addClass("jl-rating"),t.html('<table border="0" cellspacing="0" cellpadding="0" style="table-layout:fixed;border-collapse:collapse"><tr></tr></table>');var l,i=e._itemCount*e._splitCount,n=e.el.firstChild.rows[0];e.splitWidth=parseInt(e._itemWidth/e._splitCount);for(var a=1;i>=a;a++)l=document.createElement("td"),l.className="jl-rating-item",
l.style.width=e.splitWidth+"px",l.style.height=e._itemWidth+"px",l.title=a/e._splitCount,n.appendChild(l);t.width(e._itemCount*e._itemWidth),e.refreshControl(jslet.data.RefreshEvent.updateAllEvent(),!0)},destroy:function($super){var e=jQuery(this.el);e.off(),$super()},canFocus:function(){return!1}}),jslet.ui.DBRating.CHECKED=0,jslet.ui.DBRating.UNCHECKED=1,jslet.ui.DBRating.FOCUS=2,jslet.ui.register("DBRating",jslet.ui.DBRating),jslet.ui.DBRating.htmlTemplate="<Div></Div>",jslet.ui.DBSelect=jslet.Class.create(jslet.ui.DBFieldControl,{initialize:function($super,e,t){var l=this;l.allProperties="styleClass,dataset,field,groupField,lookupDataset",l._groupField=null,l._lookupDataset=null,l._enableInvalidTip=!0,l._innerEditFilterExpr=null,$super(e,t)},groupField:function(e){return void 0===e?this._groupField:(e=jQuery.trim(e),jslet.Checker.test("DBSelect.groupField",e).isString(),void(this._groupField=e))},lookupDataset:function(e){return void 0===e?this._lookupDataset:(jslet.isString(e)&&(e=jslet.data.dataModule.get(jQuery.trim(e))),jslet.Checker.test("DBSelect.lookupDataset",e).isClass(jslet.data.Dataset.className),void(this._lookupDataset=e))},isValidTemplateTag:function(e){return"select"==e.tagName.toLowerCase()},bind:function(){var e=this,t=e._dataset.getField(e._field),l=t.valueStyle();e.el.multiple&&l!=jslet.data.FieldValueStyle.MULTIPLE?t.valueStyle(jslet.data.FieldValueStyle.MULTIPLE):l!=jslet.data.FieldValueStyle.MULTIPLE||e.el.multiple||(e.el.multiple="multiple"),e.renderAll();var i=jQuery(e.el);i.on("change",e._doChanged),i.focus(function(t){jslet.ui.focusManager.activeDataset(e._dataset.name()).activeField(e._field).activeValueIndex(e._valueIndex)}),i.blur(function(e){jslet.ui.focusManager.activeDataset(null).activeField(null).activeValueIndex(null)}),e.el.multiple&&i.on("click","option",e._doCheckLimitCount),i.addClass("form-control"),e.doMetaChanged("required")},_doChanged:function(e){var t=this.jslet;if(t.el.multiple){t.inProcessing&&(t.inProcessing=!1);var l=t._dataset.getField(t._field),i=l.valueCountLimit();if(i){var n=t._dataset.getFieldValue(t._field),a=1;if(jslet.isArray(n)&&(a=n.length),a>=i)return jslet.showInfo(jslet.formatMessage(jslet.locale.DBCheckBoxGroup.invalidCheckedCount,[""+i])),void window.setTimeout(function(){t._currOption&&(t.inProcessing=!0,t._currOption.selected=!1)},10)}}this.jslet.updateToDataset()},_doCheckLimitCount:function(e){var t=e.delegateTarget.jslet;t._currOption=this},_setDefaultValue:function(e,t){if(t&&e.required()){var l=e.defaultValue();if(l){var i=e.lookup().dataset(),n=i.findByKey(l);if(n)return;l=null}l||e.defaultValue(t),this._dataset.changedStatus()&&!e.getValue()&&e.setValue(t)}},doLookupChanged:function(){var e=this,t=e._dataset.getField(e._field),l=t.lookup();if(e._lookupDataset)l=new jslet.data.FieldLookup,l.dataset(e._lookupDataset);else if(!l)return;var i,n,a,s=l.dataset(),r=!1;if(e._groupField){if(n=s.getField(e._groupField),null===n)throw"NOT found field: "+e._groupField+" in "+s.name();i=n.lookup(),r=null!==i,a=r?e._groupField+"."+i.codeField():e._groupField;var o=s.indexFields();o?s.indexFields(a+";"+o):s.indexFields(a)}var d,u,c=null,h=[];e.el.multiple||t.required()||(h.push('<option value="_null_">'),h.push(t.nullText()),h.push("</option>"));var f,p=s.recno(),v=null,_=l.editFilter();e._innerEditFilterExpr=null;var C=l.editItemDisabled();_&&(e._innerEditFilterExpr=new jslet.Expression(s,_));var j=!1;try{for(var m=0,g=s.recordCount();g>m;m++){if(s.recnoSilence(m),j=!1,e._innerEditFilterExpr&&!e._innerEditFilterExpr.eval()){if(!C)continue;j=!0}if(e._groupField&&(d=s.getFieldValue(e._groupField),d!=c)){if(null!==c&&h.push("</optgroup>"),r){if(!i.dataset().findByField(i.keyField(),d))throw"Not found: ["+d+"] in Dataset: ["+i.dataset().name()+"]field: ["+i.keyField()+"]";u=i.getCurrentDisplayValue()}else u=d;h.push('<optgroup label="'),h.push(u),h.push('">'),c=d}h.push('<option value="'),f=s.getFieldValue(l.keyField()),null===v&&(v=f),h.push(f),h.push('"'+(j?" disabled":"")+">"),h.push(l.getCurrentDisplayValue()),h.push("</option>")}null!==c&&h.push("</optgroup>"),jQuery(e.el).html(h.join("")),e._setDefaultValue(t,v),e.doValueChanged()}finally{s.recnoSilence(p)}},doMetaChanged:function($super,e){$super(e);var t=this,l=t._dataset.getField(t._field);if(!e||"disabled"==e||"readOnly"==e){var i=l.disabled()||l.readOnly();t.el.disabled=i,jslet.ui.setEditableStyle(t.el,i,i,!0,l.required())}if(e&&"required"==e){var n=jQuery(t.el);l.required()?n.addClass("jl-ctrl-required"):n.removeClass("jl-ctrl-required")}e&&"tabIndex"!=e||t.setTabIndex()},doValueChanged:function(){var e=this;if(!e._skipRefresh){var t=e.getFieldError();if(t&&t.message)return e.el.value=t.inputText,void e.renderInvalid(t);e.renderInvalid(null);var l=e.getValue();if(e.el.multiple||l!==e.el.value){var i,n,a=e.el.options.length;for(i=0;a>i;i++)n=e.el.options[i],n&&(n.selected=!1);var s=e._dataset.getField(e._field);if(e.el.multiple){var r=l;if(null===r||0===r.length)return;var o,d=r.length-1;e._skipRefresh=!0;try{for(i=0;a>i;i++){n=e.el.options[i];for(var u=d;u>=0;u--)o=r[u]==n.value,o&&(n.selected=o)}}finally{e._skipRefresh=!1}}else e._checkOptionEditable(s,l)||(l=null),null===l&&(s.required()||(l="_null_")),e.el.value=l}}},_checkOptionEditable:function(e,t){var l=this;if(!l._innerEditFilterExpr||null===t||void 0===t||""===t)return!0;var i=e.lookup().dataset();return!i.findByKey(t)||l._innerEditFilterExpr.eval()},renderAll:function(){this.refreshControl(jslet.data.RefreshEvent.updateAllEvent(),!0)},updateToDataset:function(){var e=this;if(!e._skipRefresh){var t,l,i=e.el.multiple;if(i){var n=jQuery(e.el).find("option"),a=n.length-1;l=[];for(var s=0;a>=s;s++)t=n[s],t.selected&&l.push(t.value?t.value:t.innerHTML)}else l=e.el.value,l||(t=e.el.options[e.el.selectedIndex],l=t.innerHTML);e._skipRefresh=!0;try{if(i)e._dataset.setFieldValue(e._field,l);else{var r=e._dataset.getField(e._field);"_null_"!=l||r.required()||(l=null),e._dataset.setFieldValue(e._field,l,e._valueIndex)}}finally{e._skipRefresh=!1}}},destroy:function($super){this._currOption=null,jQuery(this.el).off(),$super()}}),jslet.ui.register("DBSelect",jslet.ui.DBSelect),jslet.ui.DBSelect.htmlTemplate="<select></select>",jslet.ui.DBSpinEdit=jslet.Class.create(jslet.ui.DBFieldControl,{initialize:function($super,e,t){var l=this;l.allProperties="styleClass,dataset,field,step",l._step=1,$super(e,t)},step:function(e){return void 0===e?this._step:(jslet.Checker.test("DBSpinEdit.step",e).isNumber(),void(this._step=e))},isValidTemplateTag:function(e){var t=e.tagName.toLowerCase();return"div"==t},bind:function(){var e=this,t=jQuery(e.el);t.hasClass("jl-spinedit")||t.addClass("input-group jl-spinedit"),e._createControl(),e.renderAll()},_createControl:function(){var e=this,t=jQuery(e.el),l='<input type="text" class="form-control"><div class="jl-spinedit-btn-group"><button class="btn btn-default jl-spinedit-up" tabindex="-1"><i class="fa fa-caret-up"></i></button><button class="btn btn-default jl-spinedit-down" tabindex="-1"><i class="fa fa-caret-down"></i></button>';t.html(l);var i=t.find("input")[0],n=t.find(".jl-spinedit-up")[0],a=t.find(".jl-spinedit-down")[0];e.editor=i,jQuery(e.editor).on("keydown",function(t){if(!e._isDisabled()){var l=t.keyCode;return l===jslet.ui.KeyCode.UP?(e.decValue(),void t.preventDefault()):l===jslet.ui.KeyCode.DOWN?(e.incValue(),void t.preventDefault()):void 0}}),new jslet.ui.DBText(i,{dataset:e._dataset,field:e._field,beforeUpdateToDataset:e.beforeUpdateToDataset,valueIndex:e._valueIndex,tabIndex:e._tabIndex});var s=jQuery(n);s.on("click",function(){e.incValue()}),s.focus(function(t){jslet.ui.focusManager.activeDataset(e._dataset.name()).activeField(e._field).activeValueIndex(e._valueIndex)}),s.blur(function(e){jslet.ui.focusManager.activeDataset(null).activeField(null).activeValueIndex(null)}),s=jQuery(a),s.on("click",function(){e.decValue()}),s.focus(function(t){jslet.ui.focusManager.activeDataset(e._dataset.name()).activeField(e._field).activeValueIndex(e._valueIndex)}),s.blur(function(e){jslet.ui.focusManager.activeDataset(null).activeField(null).activeValueIndex(null)})},_isDisabled:function(){var e=this,t=e._dataset.getField(e._field);return t.disabled()||t.readOnly()},beforeUpdateToDataset:function(){var e=this,t=e.el.value,l=e._dataset.getField(e._field),i=l.dataRange(),n=Number.NEGATIVE_INFINITY,a=Number.POSITIVE_INFINITY;return i&&((i.min||0===i.min)&&(n=parseFloat(i.min)),(i.max||0===i.min)&&(a=parseFloat(i.max))),t&&(t=parseFloat(t)),jQuery(e.el).attr("aria-valuenow",t),e.el.value=t,!0},setValueToDataset:function(e){var t=this;if(!t.silence){t.silence=!0,void 0===e&&(e=t.value);try{t._dataset.setFieldValue(t._field,e,t._valueIndex)}finally{t.silence=!1}}},incValue:function(){var e=this,t=e.getValue();t||(t=0);var l=e._getRange().maxValue;t!==l&&(l>t?t+=e._step:t=l,t>l&&(t=l),jQuery(e.el).attr("aria-valuenow",t),e.setValueToDataset(t))},_getRange:function(){var e=this,t=e._dataset.getField(e._field),l=t.dataRange(),i=Number.NEGATIVE_INFINITY,n=Number.POSITIVE_INFINITY;return l&&((l.min||0===l.min)&&(i=parseFloat(l.min)),(l.max||0===l.min)&&(n=parseFloat(l.max))),{minValue:i,maxValue:n}},decValue:function(){var e=this,t=e.getValue();t||(t=0);var l=e._getRange().minValue;t!==l&&(t>l?t-=e._step:t=l,l>t&&(t=l),jQuery(e.el).attr("aria-valuenow",t),e.setValueToDataset(t))},innerFocus:function(){this.editor.focus()},doMetaChanged:function($super,e){$super(e);var t=this,l=jQuery(this.el),i=t._dataset.getField(t._field);if(!e||"disabled"==e||"readOnly"==e){var n=i.disabled()||i.readOnly(),a=l.find(".jl-spinedit-up"),s=l.find(".jl-spinedit-down");n?(a.attr("disabled","disabled"),s.attr("disabled","disabled")):(a.attr("disabled",!1),s.attr("disabled",!1))}if(!e||"dataRange"==e){var r=i.dataRange();l.attr("aria-valuemin",r&&(r.min||0===r.min)?r.min:""),l.attr("aria-valuemin",r&&(r.max||0===r.max)?r.max:"")}e&&"tabIndex"!=e||t.setTabIndex()},renderAll:function(){this.refreshControl(jslet.data.RefreshEvent.updateAllEvent(),!0)},tableId:function($super,e){$super(e),this.editor.jslet.tableId(e)},destroy:function(){var e=jQuery(this.el);jQuery(this.editor).off(),this.editor=null,e.find(".jl-upbtn-up").off(),e.find(".jl-downbtn-up").off()}}),jslet.ui.register("DBSpinEdit",jslet.ui.DBSpinEdit),jslet.ui.DBSpinEdit.htmlTemplate="<div></div>",jslet.ui.DBTimePicker=jslet.Class.create(jslet.ui.DBFieldControl,{initialize:function($super,e,t){var l=this;l.allProperties="styleClass,dataset,field,is12Hour,hasSecond",l._is12Hour=!1,l._hasSecond=!1,$super(e,t)},is12Hour:function(e){return void 0===e?this._is12Hour:void(this._is12Hour=!!e)},hasSecond:function(e){return void 0===e?this._hasSecond:void(this._hasSecond=!!e)},isValidTemplateTag:function(e){var t=e.tagName.toLowerCase();return"div"==t||"span"==t},bind:function(){var e=this,t=jQuery(e.el);t.hasClass("jl-timepicker")||t.addClass("form-control jl-timepicker"),e.renderAll(),t.on("change","select",function(t){e.updateToDataset()})},renderAll:function(){var e=this,t=jQuery(e.el),l=e._dataset.getField(e._field),i=l.dataRange(),n={hour:0,minute:0,second:0},a={hour:23,minute:59,second:59};i&&(i.min&&(n=e._splitTime(i.min)),i.max&&(a=e._splitTime(i.max)));var s=[];if(s.push('<select class="jl-time-hour">'),e._is12Hour){for(var r,o=n.hour,d=a.hour,u=100,c=0,h=o;d>h;h++)r=h,h>11&&(r=h-12),u=Math.min(u,r),c=Math.max(c,r);s.push(e._getOptions(u,c))}else s.push(e._getOptions(n.hour,a.hour||23));s.push("</select>"),s.push('<select class="jl-time-minute">'),s.push(e._getOptions(0,59)),s.push("</select>"),e._hasSecond&&(s.push('<select class="jl-time-second">'),s.push(e._getOptions(0,59)),s.push("</select>")),e._is12Hour&&s.push('<select class="jl-time-ampm"><option value="am">AM</option><option value="pm">PM</option></select>'),t.html(s.join("")),e.refreshControl(jslet.data.RefreshEvent.updateAllEvent(),!0)},_getOptions:function(e,t){for(var l,i=[],n=e;t>=n;n++)l=10>n?"0"+n:""+n,i.push('<option value="'),i.push(n),i.push('">'),i.push(l),i.push("</option>");return i.join("")},doMetaChanged:function($super,e){$super(e);var t=this,l=t._dataset.getField(t._field);if(!e||"disabled"==e||"readOnly"==e||"tabIndex"==e)for(var i,n=l.disabled()||l.readOnly(),a=jQuery(t.el).find("select"),s=l.required(),r=l.tabIndex(),o=0,d=a.length;d>o;o++)i=a[o],i.disabled=n,jslet.ui.setEditableStyle(i,n,n,!0,s),i.tabIndex=r},doValueChanged:function(){var e=this;if(!e._keep_silence_){var t=e.getValue(),l=e._splitTime(t),i=l.hour,n=jQuery(e.el),a=n.find(".jl-time-hour"),s=n.find(".jl-time-minute");if(e._is12Hour){var r=n.find(".jl-time-ampm");r.prop("selectedIndex",12>i?0:1),i>11&&(i-=12)}a.val(i),s.val(l.minute),e._hasSecond&&(s=n.find(".jl-time-second"),s.val(l.second))}},_splitTime:function(e){var t=0,l=0,i=0;if(e)if(jslet.isDate(e))t=e.getHours(),l=e.getMinutes(),i=e.getSeconds();else if(jslet.isString(e)){var n=e.split(":");t=parseInt(n[0]),n.length>1&&(l=parseInt(n[1])),n.length>2&&(i=parseInt(n[2]))}return{hour:t,minute:l,second:i}},_prefix:function(e){return parseInt(e)<10?"0"+e:e},updateToDataset:function(){var e=this;if(e._keep_silence_)return!0;e._keep_silence_=!0;try{var t,l=jQuery(e.el),i=e._dataset.getField(e._field),n=null;if(i.getType()!=jslet.data.DataType.DATE)n=[],e._is12Hour&&l.find(".jl-time-ampm").prop("selectedIndex")>0?(t=parseInt(l.find(".jl-time-hour").val())+12,n.push(t)):n.push(e._prefix(l.find(".jl-time-hour").val())),n.push(":"),n.push(e._prefix(l.find(".jl-time-minute").val())),e._hasSecond&&(n.push(":"),n.push(e._prefix(l.find(".jl-time-second").val()))),n=n.join("");else{n=e.getValue(),n||(n=new Date),t=parseInt(l.find(".jl-time-hour").val()),e._is12Hour&&l.find(".jl-time-ampm").prop("selectedIndex")>0&&(t+=12);var a=parseInt(l.find(".jl-time-minute").val()),s=0;e._hasSecond&&(s=parseInt(l.find(".jl-time-second").val())),n.setHours(t),n.setMinutes(a),n.setSeconds(s)}e._dataset.setFieldValue(e._field,n,e._valueIndex)}finally{e._keep_silence_=!1}return!0},innerFocus:function(){var e=jQuery(this.el);e.find(".jl-time-hour").focus()},destroy:function($super){jQuery(this.el).off(),$super()}}),jslet.ui.register("DBTimePicker",jslet.ui.DBTimePicker),jslet.ui.DBTimePicker.htmlTemplate="<div></div>",jslet.ui.DBError=jslet.Class.create(jslet.ui.DBControl,{initialize:function($super,e,t){this.allProperties="styleClass,dataset",$super(e,t)},isValidTemplateTag:function(e){var t=e.tagName.toLowerCase();return"div"==t},bind:function(){var e=this,t=jQuery(e.el);t.hasClass("jl-errorpanel")||t.addClass("jl-errorpanel"),e.renderAll()},refreshControl:function(e){e&&e.eventType==jslet.data.RefreshEvent.ERROR&&(this.el.innerHTML=e.message||"")},renderAll:function(){this.refreshControl()},destroy:function($super){$super()}}),jslet.ui.register("DBError",jslet.ui.DBError),jslet.ui.DBError.htmlTemplate="<div></div>",jslet.ui.DBPageBar=jslet.Class.create(jslet.ui.DBControl,{initialize:function($super,e,t){var l=this;l.allProperties="styleClass,dataset,showPageSize,pageSizeList",l._showPageSize=!0,l._pageSizeList=[100,200,500],l._currPageCount=0,$super(e,t)},showPageSize:function(e){return void 0===e?this._showPageSize:void(this._showPageSize=!!e)},pageSizeList:function(e){if(void 0===e)return this._pageSizeList;jslet.Checker.test("DBPageBar.pageSizeList",e).isArray();for(var t,l=0,i=e.length;i>l;l++)t=e[l],jslet.Checker.test("DBPageBar.pageSizeList",t).isGTZero();this._pageSizeList=e},isValidTemplateTag:function(e){var t=e.tagName.toLowerCase();return"div"==t},bind:function(){var e=this,t=jQuery(e.el);t.hasClass("jl-pagebar")||t.addClass("jl-pagebar");var l=['<div class="form-inline form-group">','<select class="form-control input-sm jl-pb-pagesize" title="',jslet.locale.DBPageBar.pageSize,'"></select>','<button class="btn btn-default btn-sm jl-pb-first" title="',jslet.locale.DBPageBar.first,'"><i class="fa fa-angle-double-left" aria-hidden="true"></i></button>','<button class="btn btn-default btn-sm jl-pb-prior" title="',jslet.locale.DBPageBar.prior,'"><i class="fa fa-angle-left" aria-hidden="true"></i></button>','<button class="btn btn-default btn-sm jl-pb-next" title="',jslet.locale.DBPageBar.next,'"><i class="fa fa-angle-right" aria-hidden="true"></i></button>','<button class="btn btn-default btn-sm jl-pb-last" title="',jslet.locale.DBPageBar.last,'"><i class="fa fa-angle-double-right" aria-hidden="true"></i></button>','<button class="btn btn-default btn-sm jl-pb-refresh" title="',jslet.locale.DBPageBar.refresh,'"><i class="fa fa-refresh" aria-hidden="true"></i></button>','<select class="form-control input-sm jl-pb-pagenum" title="',jslet.locale.DBPageBar.pageNum,'"></select>',"</div>"];if(t.html(l.join("")),e._jqPageSize=t.find(".jl-pb-pagesize"),e._showPageSize){e._jqPageSize.removeClass("jl-hidden");for(var i,n=e._pageSizeList,a=n.length,s="",r=0;a>r;r++)i=n[r],s+='<option value="'+i+'">'+i+"</option>";e._jqPageSize.html(s),a>0&&e._dataset.pageSize(parseInt(n[0])),e._jqPageSize.on("change",function(t){var l=e.dataset();l.pageNo(1),l.pageSize(parseInt(this.value)),l.requery()})}else e._jqPageSize.addClass("jl-hidden");e._jqFirstBtn=t.find(".jl-pb-first"),e._jqPriorBtn=t.find(".jl-pb-prior"),e._jqNextBtn=t.find(".jl-pb-next"),e._jqLastBtn=t.find(".jl-pb-last"),e._jqRefreshBtn=t.find(".jl-pb-refresh"),e._jqPageNum=t.find(".jl-pb-pagenum"),e._jqFirstBtn.on("click",function(t){if(!this.disabled){var l=e.dataset();l.pageNo(1),l.requery()}}),e._jqPriorBtn.on("click",function(t){if(!this.disabled){var l=e.dataset(),i=l.pageNo();1!=i&&(l.pageNo(i-1),l.requery())}}),e._jqPageNum.on("change",function(t){var l=e.dataset(),i=parseInt(this.value);l.pageNo(i),l.requery()}),e._jqNextBtn.on("click",function(t){if(!this.disabled){var l=e.dataset(),i=l.pageNo();i>=l.pageCount()||(l.pageNo(++i),l.requery())}}),e._jqLastBtn.on("click",function(t){if(!this.disabled){var l=e.dataset();l.pageCount()<1||(l.pageNo(l.pageCount()),l.requery())}}),e._jqRefreshBtn.on("click",function(t){e.dataset().requery()}),e.renderAll()},refreshControl:function(e){e&&e.eventType!=jslet.data.RefreshEvent.CHANGEPAGE||(this._refreshPageNum(),this._refreshButtonStatus())},_refreshPageNum:function(){var e=this,t=e._dataset.pageNo(),l=e._dataset.pageCount();if(l!==e._currPageCount){for(var i="",n=1;l>=n;n++)i+='<option value="'+n+'">'+n+"</option>";e._jqPageNum.html(i),e._currPageCount=l}e._jqPageNum.val(t)},_refreshButtonStatus:function(){var e=this,t=e._dataset,l=t.pageNo(),i=t.pageCount(),n=!0,a=!0;l>1&&(n=!1),i>l&&(a=!1),e._jqFirstBtn.attr("disabled",n),e._jqPriorBtn.attr("disabled",n),e._jqNextBtn.attr("disabled",a),e._jqLastBtn.attr("disabled",a)},renderAll:function(){this.refreshControl()},destroy:function($super){var e=this;e._jqPageSize&&(e._jqPageSize.off(),e._jqPageSize=null),e._jqFirstBtn.off(),e._jqPriorBtn.off(),e._jqNextBtn.off(),e._jqLastBtn.off(),e._jqPageNum.off(),e._jqRefreshBtn.off(),e._jqFirstBtn=null,e._jqPriorBtn=null,e._jqNextBtn=null,e._jqLastBtn=null,e._jqPageNum=null,e._jqRefreshBtn=null,$super()}}),jslet.ui.register("DBPageBar",jslet.ui.DBPageBar),jslet.ui.DBPageBar.htmlTemplate="<div></div>",jslet});
//# sourceMappingURL=jslet-ui.min.js.map
